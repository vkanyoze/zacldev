var wU=Object.defineProperty;var vU=(n,t,e)=>t in n?wU(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _t=(n,t,e)=>(vU(n,typeof t!="symbol"?t+"":t,e),e);function CU(n,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function X$(n,t){return function(){return n.apply(t,arguments)}}const{toString:IU}=Object.prototype,{getPrototypeOf:Pv}=Object,{iterator:Qm,toStringTag:Y$}=Symbol,tb=(n=>t=>{const e=IU.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),ur=n=>(n=n.toLowerCase(),t=>tb(t)===n),eb=n=>t=>typeof t===n,{isArray:nu}=Array,Lh=eb("undefined");function ld(n){return n!==null&&!Lh(n)&&n.constructor!==null&&!Lh(n.constructor)&&qs(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const J$=ur("ArrayBuffer");function kU(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&J$(n.buffer),t}const SU=eb("string"),qs=eb("function"),Z$=eb("number"),ud=n=>n!==null&&typeof n=="object",_U=n=>n===!0||n===!1,Mg=n=>{if(tb(n)!=="object")return!1;const t=Pv(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Y$ in n)&&!(Qm in n)},TU=n=>{if(!ud(n)||ld(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},EU=ur("Date"),$U=ur("File"),NU=ur("Blob"),RU=ur("FileList"),AU=n=>ud(n)&&qs(n.pipe),DU=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||qs(n.append)&&((t=tb(n))==="formdata"||t==="object"&&qs(n.toString)&&n.toString()==="[object FormData]"))},OU=ur("URLSearchParams"),[PU,FU,MU,LU]=["ReadableStream","Request","Response","Headers"].map(ur),BU=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function hd(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let s,i;if(typeof n!="object"&&(n=[n]),nu(n))for(s=0,i=n.length;s<i;s++)t.call(null,n[s],s,n);else{if(ld(n))return;const r=e?Object.getOwnPropertyNames(n):Object.keys(n),o=r.length;let a;for(s=0;s<o;s++)a=r[s],t.call(null,n[a],a,n)}}function Q$(n,t){if(ld(n))return null;t=t.toLowerCase();const e=Object.keys(n);let s=e.length,i;for(;s-- >0;)if(i=e[s],t===i.toLowerCase())return i;return null}const uc=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),t2=n=>!Lh(n)&&n!==uc;function yw(){const{caseless:n}=t2(this)&&this||{},t={},e=(s,i)=>{const r=n&&Q$(t,i)||i;Mg(t[r])&&Mg(s)?t[r]=yw(t[r],s):Mg(s)?t[r]=yw({},s):nu(s)?t[r]=s.slice():t[r]=s};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&hd(arguments[s],e);return t}const zU=(n,t,e,{allOwnKeys:s}={})=>(hd(t,(i,r)=>{e&&qs(i)?n[r]=X$(i,e):n[r]=i},{allOwnKeys:s}),n),WU=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),VU=(n,t,e,s)=>{n.prototype=Object.create(t.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},UU=(n,t,e,s)=>{let i,r,o;const a={};if(t=t||{},n==null)return t;do{for(i=Object.getOwnPropertyNames(n),r=i.length;r-- >0;)o=i[r],(!s||s(o,n,t))&&!a[o]&&(t[o]=n[o],a[o]=!0);n=e!==!1&&Pv(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},HU=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const s=n.indexOf(t,e);return s!==-1&&s===e},GU=n=>{if(!n)return null;if(nu(n))return n;let t=n.length;if(!Z$(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},jU=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&Pv(Uint8Array)),qU=(n,t)=>{const s=(n&&n[Qm]).call(n);let i;for(;(i=s.next())&&!i.done;){const r=i.value;t.call(n,r[0],r[1])}},KU=(n,t)=>{let e;const s=[];for(;(e=n.exec(t))!==null;)s.push(e);return s},XU=ur("HTMLFormElement"),YU=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,i){return s.toUpperCase()+i}),t_=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),JU=ur("RegExp"),e2=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),s={};hd(e,(i,r)=>{let o;(o=t(i,r,n))!==!1&&(s[r]=o||i)}),Object.defineProperties(n,s)},ZU=n=>{e2(n,(t,e)=>{if(qs(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=n[e];if(qs(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},QU=(n,t)=>{const e={},s=i=>{i.forEach(r=>{e[r]=!0})};return nu(n)?s(n):s(String(n).split(t)),e},t4=()=>{},e4=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function n4(n){return!!(n&&qs(n.append)&&n[Y$]==="FormData"&&n[Qm])}const s4=n=>{const t=new Array(10),e=(s,i)=>{if(ud(s)){if(t.indexOf(s)>=0)return;if(ld(s))return s;if(!("toJSON"in s)){t[i]=s;const r=nu(s)?[]:{};return hd(s,(o,a)=>{const c=e(o,i+1);!Lh(c)&&(r[a]=c)}),t[i]=void 0,r}}return s};return e(n,0)},i4=ur("AsyncFunction"),r4=n=>n&&(ud(n)||qs(n))&&qs(n.then)&&qs(n.catch),n2=((n,t)=>n?setImmediate:t?((e,s)=>(uc.addEventListener("message",({source:i,data:r})=>{i===uc&&r===e&&s.length&&s.shift()()},!1),i=>{s.push(i),uc.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",qs(uc.postMessage)),o4=typeof queueMicrotask<"u"?queueMicrotask.bind(uc):typeof process<"u"&&process.nextTick||n2,a4=n=>n!=null&&qs(n[Qm]),lt={isArray:nu,isArrayBuffer:J$,isBuffer:ld,isFormData:DU,isArrayBufferView:kU,isString:SU,isNumber:Z$,isBoolean:_U,isObject:ud,isPlainObject:Mg,isEmptyObject:TU,isReadableStream:PU,isRequest:FU,isResponse:MU,isHeaders:LU,isUndefined:Lh,isDate:EU,isFile:$U,isBlob:NU,isRegExp:JU,isFunction:qs,isStream:AU,isURLSearchParams:OU,isTypedArray:jU,isFileList:RU,forEach:hd,merge:yw,extend:zU,trim:BU,stripBOM:WU,inherits:VU,toFlatObject:UU,kindOf:tb,kindOfTest:ur,endsWith:HU,toArray:GU,forEachEntry:qU,matchAll:KU,isHTMLForm:XU,hasOwnProperty:t_,hasOwnProp:t_,reduceDescriptors:e2,freezeMethods:ZU,toObjectSet:QU,toCamelCase:YU,noop:t4,toFiniteNumber:e4,findKey:Q$,global:uc,isContextDefined:t2,isSpecCompliantForm:n4,toJSONObject:s4,isAsyncFn:i4,isThenable:r4,setImmediate:n2,asap:o4,isIterable:a4};function ie(n,t,e,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}lt.inherits(ie,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const s2=ie.prototype,i2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{i2[n]={value:n}});Object.defineProperties(ie,i2);Object.defineProperty(s2,"isAxiosError",{value:!0});ie.from=(n,t,e,s,i,r)=>{const o=Object.create(s2);return lt.toFlatObject(n,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),ie.call(o,n.message,t,e,s,i),o.cause=n,o.name=n.name,r&&Object.assign(o,r),o};const c4=null;function ww(n){return lt.isPlainObject(n)||lt.isArray(n)}function r2(n){return lt.endsWith(n,"[]")?n.slice(0,-2):n}function e_(n,t,e){return n?n.concat(t).map(function(i,r){return i=r2(i),!e&&r?"["+i+"]":i}).join(e?".":""):t}function l4(n){return lt.isArray(n)&&!n.some(ww)}const u4=lt.toFlatObject(lt,{},null,function(t){return/^is[A-Z]/.test(t)});function nb(n,t,e){if(!lt.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=lt.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,b){return!lt.isUndefined(b[x])});const s=e.metaTokens,i=e.visitor||u,r=e.dots,o=e.indexes,c=(e.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(t);if(!lt.isFunction(i))throw new TypeError("visitor must be a function");function l(m){if(m===null)return"";if(lt.isDate(m))return m.toISOString();if(lt.isBoolean(m))return m.toString();if(!c&&lt.isBlob(m))throw new ie("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(m)||lt.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,x,b){let y=m;if(m&&!b&&typeof m=="object"){if(lt.endsWith(x,"{}"))x=s?x:x.slice(0,-2),m=JSON.stringify(m);else if(lt.isArray(m)&&l4(m)||(lt.isFileList(m)||lt.endsWith(x,"[]"))&&(y=lt.toArray(m)))return x=r2(x),y.forEach(function(k,I){!(lt.isUndefined(k)||k===null)&&t.append(o===!0?e_([x],I,r):o===null?x:x+"[]",l(k))}),!1}return ww(m)?!0:(t.append(e_(b,x,r),l(m)),!1)}const h=[],f=Object.assign(u4,{defaultVisitor:u,convertValue:l,isVisitable:ww});function g(m,x){if(!lt.isUndefined(m)){if(h.indexOf(m)!==-1)throw Error("Circular reference detected in "+x.join("."));h.push(m),lt.forEach(m,function(y,v){(!(lt.isUndefined(y)||y===null)&&i.call(t,y,lt.isString(v)?v.trim():v,x,f))===!0&&g(y,x?x.concat(v):[v])}),h.pop()}}if(!lt.isObject(n))throw new TypeError("data must be an object");return g(n),t}function n_(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Fv(n,t){this._pairs=[],n&&nb(n,this,t)}const o2=Fv.prototype;o2.append=function(t,e){this._pairs.push([t,e])};o2.toString=function(t){const e=t?function(s){return t.call(this,s,n_)}:n_;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function h4(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function a2(n,t,e){if(!t)return n;const s=e&&e.encode||h4;lt.isFunction(e)&&(e={serialize:e});const i=e&&e.serialize;let r;if(i?r=i(t,e):r=lt.isURLSearchParams(t)?t.toString():new Fv(t,e).toString(s),r){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}class d4{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lt.forEach(this.handlers,function(s){s!==null&&t(s)})}}const s_=d4,c2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},f4=typeof URLSearchParams<"u"?URLSearchParams:Fv,p4=typeof FormData<"u"?FormData:null,g4=typeof Blob<"u"?Blob:null,m4={isBrowser:!0,classes:{URLSearchParams:f4,FormData:p4,Blob:g4},protocols:["http","https","file","blob","url","data"]},Mv=typeof window<"u"&&typeof document<"u",vw=typeof navigator=="object"&&navigator||void 0,b4=Mv&&(!vw||["ReactNative","NativeScript","NS"].indexOf(vw.product)<0),x4=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),y4=Mv&&window.location.href||"http://localhost",w4=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Mv,hasStandardBrowserEnv:b4,hasStandardBrowserWebWorkerEnv:x4,navigator:vw,origin:y4},Symbol.toStringTag,{value:"Module"})),ms={...w4,...m4};function v4(n,t){return nb(n,new ms.classes.URLSearchParams,{visitor:function(e,s,i,r){return ms.isNode&&lt.isBuffer(e)?(this.append(s,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}function C4(n){return lt.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function I4(n){const t={},e=Object.keys(n);let s;const i=e.length;let r;for(s=0;s<i;s++)r=e[s],t[r]=n[r];return t}function l2(n){function t(e,s,i,r){let o=e[r++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=r>=e.length;return o=!o&&lt.isArray(i)?i.length:o,c?(lt.hasOwnProp(i,o)?i[o]=[i[o],s]:i[o]=s,!a):((!i[o]||!lt.isObject(i[o]))&&(i[o]=[]),t(e,s,i[o],r)&&lt.isArray(i[o])&&(i[o]=I4(i[o])),!a)}if(lt.isFormData(n)&&lt.isFunction(n.entries)){const e={};return lt.forEachEntry(n,(s,i)=>{t(C4(s),i,e,0)}),e}return null}function k4(n,t,e){if(lt.isString(n))try{return(t||JSON.parse)(n),lt.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(n)}const Lv={transitional:c2,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",i=s.indexOf("application/json")>-1,r=lt.isObject(t);if(r&&lt.isHTMLForm(t)&&(t=new FormData(t)),lt.isFormData(t))return i?JSON.stringify(l2(t)):t;if(lt.isArrayBuffer(t)||lt.isBuffer(t)||lt.isStream(t)||lt.isFile(t)||lt.isBlob(t)||lt.isReadableStream(t))return t;if(lt.isArrayBufferView(t))return t.buffer;if(lt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return v4(t,this.formSerializer).toString();if((a=lt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return nb(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),k4(t)):t}],transformResponse:[function(t){const e=this.transitional||Lv.transitional,s=e&&e.forcedJSONParsing,i=this.responseType==="json";if(lt.isResponse(t)||lt.isReadableStream(t))return t;if(t&&lt.isString(t)&&(s&&!this.responseType||i)){const o=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?ie.from(a,ie.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ms.classes.FormData,Blob:ms.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],n=>{Lv.headers[n]={}});const Bv=Lv,S4=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_4=n=>{const t={};let e,s,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),e=o.substring(0,i).trim().toLowerCase(),s=o.substring(i+1).trim(),!(!e||t[e]&&S4[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},i_=Symbol("internals");function sh(n){return n&&String(n).trim().toLowerCase()}function Lg(n){return n===!1||n==null?n:lt.isArray(n)?n.map(Lg):String(n)}function T4(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(n);)t[s[1]]=s[2];return t}const E4=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function N0(n,t,e,s,i){if(lt.isFunction(s))return s.call(this,t,e);if(i&&(t=e),!!lt.isString(t)){if(lt.isString(s))return t.indexOf(s)!==-1;if(lt.isRegExp(s))return s.test(t)}}function $4(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function N4(n,t){const e=lt.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+e,{value:function(i,r,o){return this[s].call(this,t,i,r,o)},configurable:!0})})}class sb{constructor(t){t&&this.set(t)}set(t,e,s){const i=this;function r(a,c,l){const u=sh(c);if(!u)throw new Error("header name must be a non-empty string");const h=lt.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=Lg(a))}const o=(a,c)=>lt.forEach(a,(l,u)=>r(l,u,c));if(lt.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(lt.isString(t)&&(t=t.trim())&&!E4(t))o(_4(t),e);else if(lt.isObject(t)&&lt.isIterable(t)){let a={},c,l;for(const u of t){if(!lt.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[l=u[0]]=(c=a[l])?lt.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}o(a,e)}else t!=null&&r(e,t,s);return this}get(t,e){if(t=sh(t),t){const s=lt.findKey(this,t);if(s){const i=this[s];if(!e)return i;if(e===!0)return T4(i);if(lt.isFunction(e))return e.call(this,i,s);if(lt.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=sh(t),t){const s=lt.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||N0(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let i=!1;function r(o){if(o=sh(o),o){const a=lt.findKey(s,o);a&&(!e||N0(s,s[a],a,e))&&(delete s[a],i=!0)}}return lt.isArray(t)?t.forEach(r):r(t),i}clear(t){const e=Object.keys(this);let s=e.length,i=!1;for(;s--;){const r=e[s];(!t||N0(this,this[r],r,t,!0))&&(delete this[r],i=!0)}return i}normalize(t){const e=this,s={};return lt.forEach(this,(i,r)=>{const o=lt.findKey(s,r);if(o){e[o]=Lg(i),delete e[r];return}const a=t?$4(r):String(r).trim();a!==r&&delete e[r],e[a]=Lg(i),s[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return lt.forEach(this,(s,i)=>{s!=null&&s!==!1&&(e[i]=t&&lt.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(i=>s.set(i)),s}static accessor(t){const s=(this[i_]=this[i_]={accessors:{}}).accessors,i=this.prototype;function r(o){const a=sh(o);s[a]||(N4(i,o),s[a]=!0)}return lt.isArray(t)?t.forEach(r):r(t),this}}sb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);lt.reduceDescriptors(sb.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[e]=s}}});lt.freezeMethods(sb);const tr=sb;function R0(n,t){const e=this||Bv,s=t||e,i=tr.from(s.headers);let r=s.data;return lt.forEach(n,function(a){r=a.call(e,r,i.normalize(),t?t.status:void 0)}),i.normalize(),r}function u2(n){return!!(n&&n.__CANCEL__)}function su(n,t,e){ie.call(this,n??"canceled",ie.ERR_CANCELED,t,e),this.name="CanceledError"}lt.inherits(su,ie,{__CANCEL__:!0});function h2(n,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?n(e):t(new ie("Request failed with status code "+e.status,[ie.ERR_BAD_REQUEST,ie.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function R4(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function A4(n,t){n=n||10;const e=new Array(n),s=new Array(n);let i=0,r=0,o;return t=t!==void 0?t:1e3,function(c){const l=Date.now(),u=s[r];o||(o=l),e[i]=c,s[i]=l;let h=r,f=0;for(;h!==i;)f+=e[h++],h=h%n;if(i=(i+1)%n,i===r&&(r=(r+1)%n),l-o<t)return;const g=u&&l-u;return g?Math.round(f*1e3/g):void 0}}function D4(n,t){let e=0,s=1e3/t,i,r;const o=(l,u=Date.now())=>{e=u,i=null,r&&(clearTimeout(r),r=null),n(...l)};return[(...l)=>{const u=Date.now(),h=u-e;h>=s?o(l,u):(i=l,r||(r=setTimeout(()=>{r=null,o(i)},s-h)))},()=>i&&o(i)]}const nm=(n,t,e=3)=>{let s=0;const i=A4(50,250);return D4(r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,c=o-s,l=i(c),u=o<=a;s=o;const h={loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:l||void 0,estimated:l&&a&&u?(a-o)/l:void 0,event:r,lengthComputable:a!=null,[t?"download":"upload"]:!0};n(h)},e)},r_=(n,t)=>{const e=n!=null;return[s=>t[0]({lengthComputable:e,total:n,loaded:s}),t[1]]},o_=n=>(...t)=>lt.asap(()=>n(...t)),O4=ms.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,ms.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(ms.origin),ms.navigator&&/(msie|trident)/i.test(ms.navigator.userAgent)):()=>!0,P4=ms.hasStandardBrowserEnv?{write(n,t,e,s,i,r){const o=[n+"="+encodeURIComponent(t)];lt.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),lt.isString(s)&&o.push("path="+s),lt.isString(i)&&o.push("domain="+i),r===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const t=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function F4(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function M4(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function d2(n,t,e){let s=!F4(t);return n&&(s||e==!1)?M4(n,t):t}const a_=n=>n instanceof tr?{...n}:n;function vc(n,t){t=t||{};const e={};function s(l,u,h,f){return lt.isPlainObject(l)&&lt.isPlainObject(u)?lt.merge.call({caseless:f},l,u):lt.isPlainObject(u)?lt.merge({},u):lt.isArray(u)?u.slice():u}function i(l,u,h,f){if(lt.isUndefined(u)){if(!lt.isUndefined(l))return s(void 0,l,h,f)}else return s(l,u,h,f)}function r(l,u){if(!lt.isUndefined(u))return s(void 0,u)}function o(l,u){if(lt.isUndefined(u)){if(!lt.isUndefined(l))return s(void 0,l)}else return s(void 0,u)}function a(l,u,h){if(h in t)return s(l,u);if(h in n)return s(void 0,l)}const c={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,u,h)=>i(a_(l),a_(u),h,!0)};return lt.forEach(Object.keys({...n,...t}),function(u){const h=c[u]||i,f=h(n[u],t[u],u);lt.isUndefined(f)&&h!==a||(e[u]=f)}),e}const f2=n=>{const t=vc({},n);let{data:e,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:r,headers:o,auth:a}=t;t.headers=o=tr.from(o),t.url=a2(d2(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(lt.isFormData(e)){if(ms.hasStandardBrowserEnv||ms.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[l,...u]=c?c.split(";").map(h=>h.trim()).filter(Boolean):[];o.setContentType([l||"multipart/form-data",...u].join("; "))}}if(ms.hasStandardBrowserEnv&&(s&&lt.isFunction(s)&&(s=s(t)),s||s!==!1&&O4(t.url))){const l=i&&r&&P4.read(r);l&&o.set(i,l)}return t},L4=typeof XMLHttpRequest<"u",B4=L4&&function(n){return new Promise(function(e,s){const i=f2(n);let r=i.data;const o=tr.from(i.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:l}=i,u,h,f,g,m;function x(){g&&g(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(u),i.signal&&i.signal.removeEventListener("abort",u)}let b=new XMLHttpRequest;b.open(i.method.toUpperCase(),i.url,!0),b.timeout=i.timeout;function y(){if(!b)return;const k=tr.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),_={data:!a||a==="text"||a==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:k,config:n,request:b};h2(function(R){e(R),x()},function(R){s(R),x()},_),b=null}"onloadend"in b?b.onloadend=y:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(y)},b.onabort=function(){b&&(s(new ie("Request aborted",ie.ECONNABORTED,n,b)),b=null)},b.onerror=function(){s(new ie("Network Error",ie.ERR_NETWORK,n,b)),b=null},b.ontimeout=function(){let I=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const _=i.transitional||c2;i.timeoutErrorMessage&&(I=i.timeoutErrorMessage),s(new ie(I,_.clarifyTimeoutError?ie.ETIMEDOUT:ie.ECONNABORTED,n,b)),b=null},r===void 0&&o.setContentType(null),"setRequestHeader"in b&&lt.forEach(o.toJSON(),function(I,_){b.setRequestHeader(_,I)}),lt.isUndefined(i.withCredentials)||(b.withCredentials=!!i.withCredentials),a&&a!=="json"&&(b.responseType=i.responseType),l&&([f,m]=nm(l,!0),b.addEventListener("progress",f)),c&&b.upload&&([h,g]=nm(c),b.upload.addEventListener("progress",h),b.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(u=k=>{b&&(s(!k||k.type?new su(null,n,b):k),b.abort(),b=null)},i.cancelToken&&i.cancelToken.subscribe(u),i.signal&&(i.signal.aborted?u():i.signal.addEventListener("abort",u)));const v=R4(i.url);if(v&&ms.protocols.indexOf(v)===-1){s(new ie("Unsupported protocol "+v+":",ie.ERR_BAD_REQUEST,n));return}b.send(r||null)})},z4=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let s=new AbortController,i;const r=function(l){if(!i){i=!0,a();const u=l instanceof Error?l:this.reason;s.abort(u instanceof ie?u:new su(u instanceof Error?u.message:u))}};let o=t&&setTimeout(()=>{o=null,r(new ie(`timeout ${t} of ms exceeded`,ie.ETIMEDOUT))},t);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(l=>{l.unsubscribe?l.unsubscribe(r):l.removeEventListener("abort",r)}),n=null)};n.forEach(l=>l.addEventListener("abort",r));const{signal:c}=s;return c.unsubscribe=()=>lt.asap(a),c}},W4=z4,V4=function*(n,t){let e=n.byteLength;if(!t||e<t){yield n;return}let s=0,i;for(;s<e;)i=s+t,yield n.slice(s,i),s=i},U4=async function*(n,t){for await(const e of H4(n))yield*V4(e,t)},H4=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},c_=(n,t,e,s)=>{const i=U4(n,t);let r=0,o,a=c=>{o||(o=!0,s&&s(c))};return new ReadableStream({async pull(c){try{const{done:l,value:u}=await i.next();if(l){a(),c.close();return}let h=u.byteLength;if(e){let f=r+=h;e(f)}c.enqueue(new Uint8Array(u))}catch(l){throw a(l),l}},cancel(c){return a(c),i.return()}},{highWaterMark:2})},ib=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",p2=ib&&typeof ReadableStream=="function",G4=ib&&(typeof TextEncoder=="function"?(n=>t=>n.encode(t))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),g2=(n,...t)=>{try{return!!n(...t)}catch{return!1}},j4=p2&&g2(()=>{let n=!1;const t=new Request(ms.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!t}),l_=64*1024,Cw=p2&&g2(()=>lt.isReadableStream(new Response("").body)),sm={stream:Cw&&(n=>n.body)};ib&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!sm[t]&&(sm[t]=lt.isFunction(n[t])?e=>e[t]():(e,s)=>{throw new ie(`Response type '${t}' is not supported`,ie.ERR_NOT_SUPPORT,s)})})})(new Response);const q4=async n=>{if(n==null)return 0;if(lt.isBlob(n))return n.size;if(lt.isSpecCompliantForm(n))return(await new Request(ms.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(lt.isArrayBufferView(n)||lt.isArrayBuffer(n))return n.byteLength;if(lt.isURLSearchParams(n)&&(n=n+""),lt.isString(n))return(await G4(n)).byteLength},K4=async(n,t)=>{const e=lt.toFiniteNumber(n.getContentLength());return e??q4(t)},X4=ib&&(async n=>{let{url:t,method:e,data:s,signal:i,cancelToken:r,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:l,headers:u,withCredentials:h="same-origin",fetchOptions:f}=f2(n);l=l?(l+"").toLowerCase():"text";let g=W4([i,r&&r.toAbortSignal()],o),m;const x=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let b;try{if(c&&j4&&e!=="get"&&e!=="head"&&(b=await K4(u,s))!==0){let _=new Request(t,{method:"POST",body:s,duplex:"half"}),$;if(lt.isFormData(s)&&($=_.headers.get("content-type"))&&u.setContentType($),_.body){const[R,A]=r_(b,nm(o_(c)));s=c_(_.body,l_,R,A)}}lt.isString(h)||(h=h?"include":"omit");const y="credentials"in Request.prototype;m=new Request(t,{...f,signal:g,method:e.toUpperCase(),headers:u.normalize().toJSON(),body:s,duplex:"half",credentials:y?h:void 0});let v=await fetch(m,f);const k=Cw&&(l==="stream"||l==="response");if(Cw&&(a||k&&x)){const _={};["status","statusText","headers"].forEach(F=>{_[F]=v[F]});const $=lt.toFiniteNumber(v.headers.get("content-length")),[R,A]=a&&r_($,nm(o_(a),!0))||[];v=new Response(c_(v.body,l_,R,()=>{A&&A(),x&&x()}),_)}l=l||"text";let I=await sm[lt.findKey(sm,l)||"text"](v,n);return!k&&x&&x(),await new Promise((_,$)=>{h2(_,$,{data:I,headers:tr.from(v.headers),status:v.status,statusText:v.statusText,config:n,request:m})})}catch(y){throw x&&x(),y&&y.name==="TypeError"&&/Load failed|fetch/i.test(y.message)?Object.assign(new ie("Network Error",ie.ERR_NETWORK,n,m),{cause:y.cause||y}):ie.from(y,y&&y.code,n,m)}}),Iw={http:c4,xhr:B4,fetch:X4};lt.forEach(Iw,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const u_=n=>`- ${n}`,Y4=n=>lt.isFunction(n)||n===null||n===!1,m2={getAdapter:n=>{n=lt.isArray(n)?n:[n];const{length:t}=n;let e,s;const i={};for(let r=0;r<t;r++){e=n[r];let o;if(s=e,!Y4(e)&&(s=Iw[(o=String(e)).toLowerCase()],s===void 0))throw new ie(`Unknown adapter '${o}'`);if(s)break;i[o||"#"+r]=s}if(!s){const r=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=t?r.length>1?`since :
`+r.map(u_).join(`
`):" "+u_(r[0]):"as no adapter specified";throw new ie("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:Iw};function A0(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new su(null,n)}function h_(n){return A0(n),n.headers=tr.from(n.headers),n.data=R0.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),m2.getAdapter(n.adapter||Bv.adapter)(n).then(function(s){return A0(n),s.data=R0.call(n,n.transformResponse,s),s.headers=tr.from(s.headers),s},function(s){return u2(s)||(A0(n),s&&s.response&&(s.response.data=R0.call(n,n.transformResponse,s.response),s.response.headers=tr.from(s.response.headers))),Promise.reject(s)})}const b2="1.11.0",rb={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{rb[n]=function(s){return typeof s===n||"a"+(t<1?"n ":" ")+n}});const d_={};rb.transitional=function(t,e,s){function i(r,o){return"[Axios v"+b2+"] Transitional option '"+r+"'"+o+(s?". "+s:"")}return(r,o,a)=>{if(t===!1)throw new ie(i(o," has been removed"+(e?" in "+e:"")),ie.ERR_DEPRECATED);return e&&!d_[o]&&(d_[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(r,o,a):!0}};rb.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function J4(n,t,e){if(typeof n!="object")throw new ie("options must be an object",ie.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let i=s.length;for(;i-- >0;){const r=s[i],o=t[r];if(o){const a=n[r],c=a===void 0||o(a,r,n);if(c!==!0)throw new ie("option "+r+" must be "+c,ie.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ie("Unknown option "+r,ie.ERR_BAD_OPTION)}}const Bg={assertOptions:J4,validators:rb},xr=Bg.validators;class im{constructor(t){this.defaults=t||{},this.interceptors={request:new s_,response:new s_}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=vc(this.defaults,e);const{transitional:s,paramsSerializer:i,headers:r}=e;s!==void 0&&Bg.assertOptions(s,{silentJSONParsing:xr.transitional(xr.boolean),forcedJSONParsing:xr.transitional(xr.boolean),clarifyTimeoutError:xr.transitional(xr.boolean)},!1),i!=null&&(lt.isFunction(i)?e.paramsSerializer={serialize:i}:Bg.assertOptions(i,{encode:xr.function,serialize:xr.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Bg.assertOptions(e,{baseUrl:xr.spelling("baseURL"),withXsrfToken:xr.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=r&&lt.merge(r.common,r[e.method]);r&&lt.forEach(["delete","get","head","post","put","patch","common"],m=>{delete r[m]}),e.headers=tr.concat(o,r);const a=[];let c=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(e)===!1||(c=c&&x.synchronous,a.unshift(x.fulfilled,x.rejected))});const l=[];this.interceptors.response.forEach(function(x){l.push(x.fulfilled,x.rejected)});let u,h=0,f;if(!c){const m=[h_.bind(this),void 0];for(m.unshift(...a),m.push(...l),f=m.length,u=Promise.resolve(e);h<f;)u=u.then(m[h++],m[h++]);return u}f=a.length;let g=e;for(h=0;h<f;){const m=a[h++],x=a[h++];try{g=m(g)}catch(b){x.call(this,b);break}}try{u=h_.call(this,g)}catch(m){return Promise.reject(m)}for(h=0,f=l.length;h<f;)u=u.then(l[h++],l[h++]);return u}getUri(t){t=vc(this.defaults,t);const e=d2(t.baseURL,t.url,t.allowAbsoluteUrls);return a2(e,t.params,t.paramsSerializer)}}lt.forEach(["delete","get","head","options"],function(t){im.prototype[t]=function(e,s){return this.request(vc(s||{},{method:t,url:e,data:(s||{}).data}))}});lt.forEach(["post","put","patch"],function(t){function e(s){return function(r,o,a){return this.request(vc(a||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}im.prototype[t]=e(),im.prototype[t+"Form"]=e(!0)});const zg=im;class zv{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(r){e=r});const s=this;this.promise.then(i=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](i);s._listeners=null}),this.promise.then=i=>{let r;const o=new Promise(a=>{s.subscribe(a),r=a}).then(i);return o.cancel=function(){s.unsubscribe(r)},o},t(function(r,o,a){s.reason||(s.reason=new su(r,o,a),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new zv(function(i){t=i}),cancel:t}}}const Z4=zv;function Q4(n){return function(e){return n.apply(null,e)}}function tH(n){return lt.isObject(n)&&n.isAxiosError===!0}const kw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kw).forEach(([n,t])=>{kw[t]=n});const eH=kw;function x2(n){const t=new zg(n),e=X$(zg.prototype.request,t);return lt.extend(e,zg.prototype,t,{allOwnKeys:!0}),lt.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return x2(vc(n,i))},e}const An=x2(Bv);An.Axios=zg;An.CanceledError=su;An.CancelToken=Z4;An.isCancel=u2;An.VERSION=b2;An.toFormData=nb;An.AxiosError=ie;An.Cancel=An.CanceledError;An.all=function(t){return Promise.all(t)};An.spread=Q4;An.isAxiosError=tH;An.mergeConfig=vc;An.AxiosHeaders=tr;An.formToJSON=n=>l2(lt.isHTMLForm(n)?new FormData(n):n);An.getAdapter=m2.getAdapter;An.HttpStatusCode=eH;An.default=An;const nH=An;var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function y2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function sH(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}),e}var rm={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */rm.exports;(function(n,t){(function(){var e,s="4.17.21",i=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",a="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",l=500,u="__lodash_placeholder__",h=1,f=2,g=4,m=1,x=2,b=1,y=2,v=4,k=8,I=16,_=32,$=64,R=128,A=256,F=512,L=30,V="...",j=800,Z=16,et=1,K=2,tt=3,it=1/0,st=9007199254740991,ot=17976931348623157e292,bt=0/0,ft=4294967295,yt=ft-1,vt=ft>>>1,St=[["ary",R],["bind",b],["bindKey",y],["curry",k],["curryRight",I],["flip",F],["partial",_],["partialRight",$],["rearg",A]],pt="[object Arguments]",Ct="[object Array]",Mt="[object AsyncFunction]",Bt="[object Boolean]",At="[object Date]",Jt="[object DOMException]",Yt="[object Error]",re="[object Function]",Ee="[object GeneratorFunction]",pe="[object Map]",be="[object Number]",_e="[object Null]",xe="[object Object]",Oe="[object Promise]",ti="[object Proxy]",Xe="[object RegExp]",dn="[object Set]",vn="[object String]",Zn="[object Symbol]",Is="[object Undefined]",he="[object WeakMap]",fi="[object WeakSet]",as="[object ArrayBuffer]",Qn="[object DataView]",Wi="[object Float32Array]",Vr="[object Float64Array]",Ur="[object Int8Array]",Oa="[object Int16Array]",pi="[object Int32Array]",Hr="[object Uint8Array]",Pa="[object Uint8ClampedArray]",Cu="[object Uint16Array]",Iu="[object Uint32Array]",qx=/\b__p \+= '';/g,ku=/\b(__p \+=) '' \+/g,Vi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Wf=/&(?:amp|lt|gt|quot|#39);/g,Gr=/[&<>"']/g,Kx=RegExp(Wf.source),Vf=RegExp(Gr.source),Uf=/<%-([\s\S]+?)%>/g,Hf=/<%([\s\S]+?)%>/g,Su=/<%=([\s\S]+?)%>/g,Xx=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yx=/^\w*$/,Jx=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lo=/[\\^$.*+?()[\]{}|]/g,Zx=RegExp(Lo.source),Qc=/^\s+/,Qx=/\s/,ty=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ey=/\{\n\/\* \[wrapped with (.+)\] \*/,ny=/,? & /,sy=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,iy=/[()=,{}\[\]\/\s]/,Gf=/\\(\\)?/g,jr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jf=/\w*$/,ry=/^[-+]0x[0-9a-f]+$/i,oy=/^0b[01]+$/i,_u=/^\[object .+?Constructor\]$/,Tu=/^0o[0-7]+$/i,ay=/^(?:0|[1-9]\d*)$/,cy=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tl=/($^)/,ly=/['\n\r\u2028\u2029\\]/g,Bo="\\ud800-\\udfff",uy="\\u0300-\\u036f",hy="\\ufe20-\\ufe2f",dy="\\u20d0-\\u20ff",qf=uy+hy+dy,Kf="\\u2700-\\u27bf",gi="a-z\\xdf-\\xf6\\xf8-\\xff",Xf="\\xac\\xb1\\xd7\\xf7",qr="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Eu="\\u2000-\\u206f",fy=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Yf="A-Z\\xc0-\\xd6\\xd8-\\xde",Jf="\\ufe0e\\ufe0f",Zf=Xf+qr+Eu+fy,Fa="['’]",py="["+Bo+"]",Qf="["+Zf+"]",Ma="["+qf+"]",La="\\d+",Ba="["+Kf+"]",tp="["+gi+"]",zo="[^"+Bo+Zf+La+Kf+gi+Yf+"]",$u="\\ud83c[\\udffb-\\udfff]",gy="(?:"+Ma+"|"+$u+")",ep="[^"+Bo+"]",Nu="(?:\\ud83c[\\udde6-\\uddff]){2}",Ru="[\\ud800-\\udbff][\\udc00-\\udfff]",Wo="["+Yf+"]",np="\\u200d",el="(?:"+tp+"|"+zo+")",Kr="(?:"+Wo+"|"+zo+")",sp="(?:"+Fa+"(?:d|ll|m|re|s|t|ve))?",ip="(?:"+Fa+"(?:D|LL|M|RE|S|T|VE))?",rp=gy+"?",op="["+Jf+"]?",ap="(?:"+np+"(?:"+[ep,Nu,Ru].join("|")+")"+op+rp+")*",my="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",cp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",lp=op+rp+ap,by="(?:"+[Ba,Nu,Ru].join("|")+")"+lp,xy="(?:"+[ep+Ma+"?",Ma,Nu,Ru,py].join("|")+")",yy=RegExp(Fa,"g"),wy=RegExp(Ma,"g"),Au=RegExp($u+"(?="+$u+")|"+xy+lp,"g"),vy=RegExp([Wo+"?"+tp+"+"+sp+"(?="+[Qf,Wo,"$"].join("|")+")",Kr+"+"+ip+"(?="+[Qf,Wo+el,"$"].join("|")+")",Wo+"?"+el+"+"+sp,Wo+"+"+ip,cp,my,La,by].join("|"),"g"),Cy=RegExp("["+np+Bo+qf+Jf+"]"),Iy=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,up=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ky=-1,Ue={};Ue[Wi]=Ue[Vr]=Ue[Ur]=Ue[Oa]=Ue[pi]=Ue[Hr]=Ue[Pa]=Ue[Cu]=Ue[Iu]=!0,Ue[pt]=Ue[Ct]=Ue[as]=Ue[Bt]=Ue[Qn]=Ue[At]=Ue[Yt]=Ue[re]=Ue[pe]=Ue[be]=Ue[xe]=Ue[Xe]=Ue[dn]=Ue[vn]=Ue[he]=!1;var Dt={};Dt[pt]=Dt[Ct]=Dt[as]=Dt[Qn]=Dt[Bt]=Dt[At]=Dt[Wi]=Dt[Vr]=Dt[Ur]=Dt[Oa]=Dt[pi]=Dt[pe]=Dt[be]=Dt[xe]=Dt[Xe]=Dt[dn]=Dt[vn]=Dt[Zn]=Dt[Hr]=Dt[Pa]=Dt[Cu]=Dt[Iu]=!0,Dt[Yt]=Dt[re]=Dt[he]=!1;var Du={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},nl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Sy={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},_y={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},hp=parseFloat,Ty=parseInt,dp=typeof Ti=="object"&&Ti&&Ti.Object===Object&&Ti,Ey=typeof self=="object"&&self&&self.Object===Object&&self,Pn=dp||Ey||Function("return this")(),Ou=t&&!t.nodeType&&t,Vo=Ou&&!0&&n&&!n.nodeType&&n,fp=Vo&&Vo.exports===Ou,Pu=fp&&dp.process,ei=function(){try{var X=Vo&&Vo.require&&Vo.require("util").types;return X||Pu&&Pu.binding&&Pu.binding("util")}catch{}}(),pp=ei&&ei.isArrayBuffer,gp=ei&&ei.isDate,mp=ei&&ei.isMap,bp=ei&&ei.isRegExp,xp=ei&&ei.isSet,yp=ei&&ei.isTypedArray;function ks(X,dt,at){switch(at.length){case 0:return X.call(dt);case 1:return X.call(dt,at[0]);case 2:return X.call(dt,at[0],at[1]);case 3:return X.call(dt,at[0],at[1],at[2])}return X.apply(dt,at)}function $y(X,dt,at,Ot){for(var Qt=-1,Pe=X==null?0:X.length;++Qt<Pe;){var Fn=X[Qt];dt(Ot,Fn,at(Fn),X)}return Ot}function Fs(X,dt){for(var at=-1,Ot=X==null?0:X.length;++at<Ot&&dt(X[at],at,X)!==!1;);return X}function Ny(X,dt){for(var at=X==null?0:X.length;at--&&dt(X[at],at,X)!==!1;);return X}function wp(X,dt){for(var at=-1,Ot=X==null?0:X.length;++at<Ot;)if(!dt(X[at],at,X))return!1;return!0}function pr(X,dt){for(var at=-1,Ot=X==null?0:X.length,Qt=0,Pe=[];++at<Ot;){var Fn=X[at];dt(Fn,at,X)&&(Pe[Qt++]=Fn)}return Pe}function sl(X,dt){var at=X==null?0:X.length;return!!at&&kt(X,dt,0)>-1}function Fu(X,dt,at){for(var Ot=-1,Qt=X==null?0:X.length;++Ot<Qt;)if(at(dt,X[Ot]))return!0;return!1}function Ye(X,dt){for(var at=-1,Ot=X==null?0:X.length,Qt=Array(Ot);++at<Ot;)Qt[at]=dt(X[at],at,X);return Qt}function Je(X,dt){for(var at=-1,Ot=dt.length,Qt=X.length;++at<Ot;)X[Qt+at]=dt[at];return X}function za(X,dt,at,Ot){var Qt=-1,Pe=X==null?0:X.length;for(Ot&&Pe&&(at=X[++Qt]);++Qt<Pe;)at=dt(at,X[Qt],Qt,X);return at}function Ry(X,dt,at,Ot){var Qt=X==null?0:X.length;for(Ot&&Qt&&(at=X[--Qt]);Qt--;)at=dt(at,X[Qt],Qt,X);return at}function E(X,dt){for(var at=-1,Ot=X==null?0:X.length;++at<Ot;)if(dt(X[at],at,X))return!0;return!1}var C=$e("length");function T(X){return X.split("")}function M(X){return X.match(sy)||[]}function B(X,dt,at){var Ot;return at(X,function(Qt,Pe,Fn){if(dt(Qt,Pe,Fn))return Ot=Pe,!1}),Ot}function ht(X,dt,at,Ot){for(var Qt=X.length,Pe=at+(Ot?1:-1);Ot?Pe--:++Pe<Qt;)if(dt(X[Pe],Pe,X))return Pe;return-1}function kt(X,dt,at){return dt===dt?oL(X,dt,at):ht(X,Zt,at)}function Lt(X,dt,at,Ot){for(var Qt=at-1,Pe=X.length;++Qt<Pe;)if(Ot(X[Qt],dt))return Qt;return-1}function Zt(X){return X!==X}function ve(X,dt){var at=X==null?0:X.length;return at?il(X,dt)/at:bt}function $e(X){return function(dt){return dt==null?e:dt[X]}}function an(X){return function(dt){return X==null?e:X[dt]}}function Wa(X,dt,at,Ot,Qt){return Qt(X,function(Pe,Fn,He){at=Ot?(Ot=!1,Pe):dt(at,Pe,Fn,He)}),at}function Ay(X,dt){var at=X.length;for(X.sort(dt);at--;)X[at]=X[at].value;return X}function il(X,dt){for(var at,Ot=-1,Qt=X.length;++Ot<Qt;){var Pe=dt(X[Ot]);Pe!==e&&(at=at===e?Pe:at+Pe)}return at}function Mu(X,dt){for(var at=-1,Ot=Array(X);++at<X;)Ot[at]=dt(at);return Ot}function vp(X,dt){return Ye(dt,function(at){return[at,X[at]]})}function Cp(X){return X&&X.slice(0,uk(X)+1).replace(Qc,"")}function cs(X){return function(dt){return X(dt)}}function Lu(X,dt){return Ye(dt,function(at){return X[at]})}function Va(X,dt){return X.has(dt)}function Bu(X,dt){for(var at=-1,Ot=X.length;++at<Ot&&kt(dt,X[at],0)>-1;);return at}function zu(X,dt){for(var at=X.length;at--&&kt(dt,X[at],0)>-1;);return at}function Ip(X,dt){for(var at=X.length,Ot=0;at--;)X[at]===dt&&++Ot;return Ot}var Wu=an(Du),Vu=an(nl);function kp(X){return"\\"+_y[X]}function Dy(X,dt){return X==null?e:X[dt]}function Uo(X){return Cy.test(X)}function Oy(X){return Iy.test(X)}function Py(X){for(var dt,at=[];!(dt=X.next()).done;)at.push(dt.value);return at}function rl(X){var dt=-1,at=Array(X.size);return X.forEach(function(Ot,Qt){at[++dt]=[Qt,Ot]}),at}function lk(X,dt){return function(at){return X(dt(at))}}function Ho(X,dt){for(var at=-1,Ot=X.length,Qt=0,Pe=[];++at<Ot;){var Fn=X[at];(Fn===dt||Fn===u)&&(X[at]=u,Pe[Qt++]=at)}return Pe}function Sp(X){var dt=-1,at=Array(X.size);return X.forEach(function(Ot){at[++dt]=Ot}),at}function rL(X){var dt=-1,at=Array(X.size);return X.forEach(function(Ot){at[++dt]=[Ot,Ot]}),at}function oL(X,dt,at){for(var Ot=at-1,Qt=X.length;++Ot<Qt;)if(X[Ot]===dt)return Ot;return-1}function aL(X,dt,at){for(var Ot=at+1;Ot--;)if(X[Ot]===dt)return Ot;return Ot}function ol(X){return Uo(X)?lL(X):C(X)}function Ui(X){return Uo(X)?uL(X):T(X)}function uk(X){for(var dt=X.length;dt--&&Qx.test(X.charAt(dt)););return dt}var cL=an(Sy);function lL(X){for(var dt=Au.lastIndex=0;Au.test(X);)++dt;return dt}function uL(X){return X.match(Au)||[]}function hL(X){return X.match(vy)||[]}var dL=function X(dt){dt=dt==null?Pn:al.defaults(Pn.Object(),dt,al.pick(Pn,up));var at=dt.Array,Ot=dt.Date,Qt=dt.Error,Pe=dt.Function,Fn=dt.Math,He=dt.Object,Fy=dt.RegExp,fL=dt.String,mi=dt.TypeError,_p=at.prototype,pL=Pe.prototype,cl=He.prototype,Tp=dt["__core-js_shared__"],Ep=pL.toString,Be=cl.hasOwnProperty,gL=0,hk=function(){var d=/[^.]+$/.exec(Tp&&Tp.keys&&Tp.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),$p=cl.toString,mL=Ep.call(He),bL=Pn._,xL=Fy("^"+Ep.call(Be).replace(Lo,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Np=fp?dt.Buffer:e,Go=dt.Symbol,Rp=dt.Uint8Array,dk=Np?Np.allocUnsafe:e,Ap=lk(He.getPrototypeOf,He),fk=He.create,pk=cl.propertyIsEnumerable,Dp=_p.splice,gk=Go?Go.isConcatSpreadable:e,Uu=Go?Go.iterator:e,Ua=Go?Go.toStringTag:e,Op=function(){try{var d=Ka(He,"defineProperty");return d({},"",{}),d}catch{}}(),yL=dt.clearTimeout!==Pn.clearTimeout&&dt.clearTimeout,wL=Ot&&Ot.now!==Pn.Date.now&&Ot.now,vL=dt.setTimeout!==Pn.setTimeout&&dt.setTimeout,Pp=Fn.ceil,Fp=Fn.floor,My=He.getOwnPropertySymbols,CL=Np?Np.isBuffer:e,mk=dt.isFinite,IL=_p.join,kL=lk(He.keys,He),Mn=Fn.max,ls=Fn.min,SL=Ot.now,_L=dt.parseInt,bk=Fn.random,TL=_p.reverse,Ly=Ka(dt,"DataView"),Hu=Ka(dt,"Map"),By=Ka(dt,"Promise"),ll=Ka(dt,"Set"),Gu=Ka(dt,"WeakMap"),ju=Ka(He,"create"),Mp=Gu&&new Gu,ul={},EL=Xa(Ly),$L=Xa(Hu),NL=Xa(By),RL=Xa(ll),AL=Xa(Gu),Lp=Go?Go.prototype:e,qu=Lp?Lp.valueOf:e,xk=Lp?Lp.toString:e;function D(d){if(fn(d)&&!ne(d)&&!(d instanceof ye)){if(d instanceof bi)return d;if(Be.call(d,"__wrapped__"))return yS(d)}return new bi(d)}var hl=function(){function d(){}return function(p){if(!hn(p))return{};if(fk)return fk(p);d.prototype=p;var w=new d;return d.prototype=e,w}}();function Bp(){}function bi(d,p){this.__wrapped__=d,this.__actions__=[],this.__chain__=!!p,this.__index__=0,this.__values__=e}D.templateSettings={escape:Uf,evaluate:Hf,interpolate:Su,variable:"",imports:{_:D}},D.prototype=Bp.prototype,D.prototype.constructor=D,bi.prototype=hl(Bp.prototype),bi.prototype.constructor=bi;function ye(d){this.__wrapped__=d,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ft,this.__views__=[]}function DL(){var d=new ye(this.__wrapped__);return d.__actions__=Ms(this.__actions__),d.__dir__=this.__dir__,d.__filtered__=this.__filtered__,d.__iteratees__=Ms(this.__iteratees__),d.__takeCount__=this.__takeCount__,d.__views__=Ms(this.__views__),d}function OL(){if(this.__filtered__){var d=new ye(this);d.__dir__=-1,d.__filtered__=!0}else d=this.clone(),d.__dir__*=-1;return d}function PL(){var d=this.__wrapped__.value(),p=this.__dir__,w=ne(d),S=p<0,N=w?d.length:0,O=q3(0,N,this.__views__),z=O.start,U=O.end,Q=U-z,gt=S?U:z-1,mt=this.__iteratees__,wt=mt.length,$t=0,zt=ls(Q,this.__takeCount__);if(!w||!S&&N==Q&&zt==Q)return Vk(d,this.__actions__);var qt=[];t:for(;Q--&&$t<zt;){gt+=p;for(var ae=-1,Kt=d[gt];++ae<wt;){var ge=mt[ae],Ce=ge.iteratee,ii=ge.type,Ts=Ce(Kt);if(ii==K)Kt=Ts;else if(!Ts){if(ii==et)continue t;break t}}qt[$t++]=Kt}return qt}ye.prototype=hl(Bp.prototype),ye.prototype.constructor=ye;function Ha(d){var p=-1,w=d==null?0:d.length;for(this.clear();++p<w;){var S=d[p];this.set(S[0],S[1])}}function FL(){this.__data__=ju?ju(null):{},this.size=0}function ML(d){var p=this.has(d)&&delete this.__data__[d];return this.size-=p?1:0,p}function LL(d){var p=this.__data__;if(ju){var w=p[d];return w===c?e:w}return Be.call(p,d)?p[d]:e}function BL(d){var p=this.__data__;return ju?p[d]!==e:Be.call(p,d)}function zL(d,p){var w=this.__data__;return this.size+=this.has(d)?0:1,w[d]=ju&&p===e?c:p,this}Ha.prototype.clear=FL,Ha.prototype.delete=ML,Ha.prototype.get=LL,Ha.prototype.has=BL,Ha.prototype.set=zL;function Xr(d){var p=-1,w=d==null?0:d.length;for(this.clear();++p<w;){var S=d[p];this.set(S[0],S[1])}}function WL(){this.__data__=[],this.size=0}function VL(d){var p=this.__data__,w=zp(p,d);if(w<0)return!1;var S=p.length-1;return w==S?p.pop():Dp.call(p,w,1),--this.size,!0}function UL(d){var p=this.__data__,w=zp(p,d);return w<0?e:p[w][1]}function HL(d){return zp(this.__data__,d)>-1}function GL(d,p){var w=this.__data__,S=zp(w,d);return S<0?(++this.size,w.push([d,p])):w[S][1]=p,this}Xr.prototype.clear=WL,Xr.prototype.delete=VL,Xr.prototype.get=UL,Xr.prototype.has=HL,Xr.prototype.set=GL;function Yr(d){var p=-1,w=d==null?0:d.length;for(this.clear();++p<w;){var S=d[p];this.set(S[0],S[1])}}function jL(){this.size=0,this.__data__={hash:new Ha,map:new(Hu||Xr),string:new Ha}}function qL(d){var p=Zp(this,d).delete(d);return this.size-=p?1:0,p}function KL(d){return Zp(this,d).get(d)}function XL(d){return Zp(this,d).has(d)}function YL(d,p){var w=Zp(this,d),S=w.size;return w.set(d,p),this.size+=w.size==S?0:1,this}Yr.prototype.clear=jL,Yr.prototype.delete=qL,Yr.prototype.get=KL,Yr.prototype.has=XL,Yr.prototype.set=YL;function Ga(d){var p=-1,w=d==null?0:d.length;for(this.__data__=new Yr;++p<w;)this.add(d[p])}function JL(d){return this.__data__.set(d,c),this}function ZL(d){return this.__data__.has(d)}Ga.prototype.add=Ga.prototype.push=JL,Ga.prototype.has=ZL;function Hi(d){var p=this.__data__=new Xr(d);this.size=p.size}function QL(){this.__data__=new Xr,this.size=0}function t3(d){var p=this.__data__,w=p.delete(d);return this.size=p.size,w}function e3(d){return this.__data__.get(d)}function n3(d){return this.__data__.has(d)}function s3(d,p){var w=this.__data__;if(w instanceof Xr){var S=w.__data__;if(!Hu||S.length<i-1)return S.push([d,p]),this.size=++w.size,this;w=this.__data__=new Yr(S)}return w.set(d,p),this.size=w.size,this}Hi.prototype.clear=QL,Hi.prototype.delete=t3,Hi.prototype.get=e3,Hi.prototype.has=n3,Hi.prototype.set=s3;function yk(d,p){var w=ne(d),S=!w&&Ya(d),N=!w&&!S&&Yo(d),O=!w&&!S&&!N&&gl(d),z=w||S||N||O,U=z?Mu(d.length,fL):[],Q=U.length;for(var gt in d)(p||Be.call(d,gt))&&!(z&&(gt=="length"||N&&(gt=="offset"||gt=="parent")||O&&(gt=="buffer"||gt=="byteLength"||gt=="byteOffset")||to(gt,Q)))&&U.push(gt);return U}function wk(d){var p=d.length;return p?d[Yy(0,p-1)]:e}function i3(d,p){return Qp(Ms(d),ja(p,0,d.length))}function r3(d){return Qp(Ms(d))}function zy(d,p,w){(w!==e&&!Gi(d[p],w)||w===e&&!(p in d))&&Jr(d,p,w)}function Ku(d,p,w){var S=d[p];(!(Be.call(d,p)&&Gi(S,w))||w===e&&!(p in d))&&Jr(d,p,w)}function zp(d,p){for(var w=d.length;w--;)if(Gi(d[w][0],p))return w;return-1}function o3(d,p,w,S){return jo(d,function(N,O,z){p(S,N,w(N),z)}),S}function vk(d,p){return d&&mr(p,Un(p),d)}function a3(d,p){return d&&mr(p,Bs(p),d)}function Jr(d,p,w){p=="__proto__"&&Op?Op(d,p,{configurable:!0,enumerable:!0,value:w,writable:!0}):d[p]=w}function Wy(d,p){for(var w=-1,S=p.length,N=at(S),O=d==null;++w<S;)N[w]=O?e:v0(d,p[w]);return N}function ja(d,p,w){return d===d&&(w!==e&&(d=d<=w?d:w),p!==e&&(d=d>=p?d:p)),d}function xi(d,p,w,S,N,O){var z,U=p&h,Q=p&f,gt=p&g;if(w&&(z=N?w(d,S,N,O):w(d)),z!==e)return z;if(!hn(d))return d;var mt=ne(d);if(mt){if(z=X3(d),!U)return Ms(d,z)}else{var wt=us(d),$t=wt==re||wt==Ee;if(Yo(d))return Gk(d,U);if(wt==xe||wt==pt||$t&&!N){if(z=Q||$t?{}:uS(d),!U)return Q?L3(d,a3(z,d)):M3(d,vk(z,d))}else{if(!Dt[wt])return N?d:{};z=Y3(d,wt,U)}}O||(O=new Hi);var zt=O.get(d);if(zt)return zt;O.set(d,z),BS(d)?d.forEach(function(Kt){z.add(xi(Kt,p,w,Kt,d,O))}):MS(d)&&d.forEach(function(Kt,ge){z.set(ge,xi(Kt,p,w,ge,d,O))});var qt=gt?Q?a0:o0:Q?Bs:Un,ae=mt?e:qt(d);return Fs(ae||d,function(Kt,ge){ae&&(ge=Kt,Kt=d[ge]),Ku(z,ge,xi(Kt,p,w,ge,d,O))}),z}function c3(d){var p=Un(d);return function(w){return Ck(w,d,p)}}function Ck(d,p,w){var S=w.length;if(d==null)return!S;for(d=He(d);S--;){var N=w[S],O=p[N],z=d[N];if(z===e&&!(N in d)||!O(z))return!1}return!0}function Ik(d,p,w){if(typeof d!="function")throw new mi(o);return eh(function(){d.apply(e,w)},p)}function Xu(d,p,w,S){var N=-1,O=sl,z=!0,U=d.length,Q=[],gt=p.length;if(!U)return Q;w&&(p=Ye(p,cs(w))),S?(O=Fu,z=!1):p.length>=i&&(O=Va,z=!1,p=new Ga(p));t:for(;++N<U;){var mt=d[N],wt=w==null?mt:w(mt);if(mt=S||mt!==0?mt:0,z&&wt===wt){for(var $t=gt;$t--;)if(p[$t]===wt)continue t;Q.push(mt)}else O(p,wt,S)||Q.push(mt)}return Q}var jo=Yk(gr),kk=Yk(Uy,!0);function l3(d,p){var w=!0;return jo(d,function(S,N,O){return w=!!p(S,N,O),w}),w}function Wp(d,p,w){for(var S=-1,N=d.length;++S<N;){var O=d[S],z=p(O);if(z!=null&&(U===e?z===z&&!si(z):w(z,U)))var U=z,Q=O}return Q}function u3(d,p,w,S){var N=d.length;for(w=oe(w),w<0&&(w=-w>N?0:N+w),S=S===e||S>N?N:oe(S),S<0&&(S+=N),S=w>S?0:WS(S);w<S;)d[w++]=p;return d}function Sk(d,p){var w=[];return jo(d,function(S,N,O){p(S,N,O)&&w.push(S)}),w}function ts(d,p,w,S,N){var O=-1,z=d.length;for(w||(w=Z3),N||(N=[]);++O<z;){var U=d[O];p>0&&w(U)?p>1?ts(U,p-1,w,S,N):Je(N,U):S||(N[N.length]=U)}return N}var Vy=Jk(),_k=Jk(!0);function gr(d,p){return d&&Vy(d,p,Un)}function Uy(d,p){return d&&_k(d,p,Un)}function Vp(d,p){return pr(p,function(w){return eo(d[w])})}function qa(d,p){p=Ko(p,d);for(var w=0,S=p.length;d!=null&&w<S;)d=d[br(p[w++])];return w&&w==S?d:e}function Tk(d,p,w){var S=p(d);return ne(d)?S:Je(S,w(d))}function Ss(d){return d==null?d===e?Is:_e:Ua&&Ua in He(d)?j3(d):rB(d)}function Hy(d,p){return d>p}function h3(d,p){return d!=null&&Be.call(d,p)}function d3(d,p){return d!=null&&p in He(d)}function f3(d,p,w){return d>=ls(p,w)&&d<Mn(p,w)}function Gy(d,p,w){for(var S=w?Fu:sl,N=d[0].length,O=d.length,z=O,U=at(O),Q=1/0,gt=[];z--;){var mt=d[z];z&&p&&(mt=Ye(mt,cs(p))),Q=ls(mt.length,Q),U[z]=!w&&(p||N>=120&&mt.length>=120)?new Ga(z&&mt):e}mt=d[0];var wt=-1,$t=U[0];t:for(;++wt<N&&gt.length<Q;){var zt=mt[wt],qt=p?p(zt):zt;if(zt=w||zt!==0?zt:0,!($t?Va($t,qt):S(gt,qt,w))){for(z=O;--z;){var ae=U[z];if(!(ae?Va(ae,qt):S(d[z],qt,w)))continue t}$t&&$t.push(qt),gt.push(zt)}}return gt}function p3(d,p,w,S){return gr(d,function(N,O,z){p(S,w(N),O,z)}),S}function Yu(d,p,w){p=Ko(p,d),d=pS(d,p);var S=d==null?d:d[br(wi(p))];return S==null?e:ks(S,d,w)}function Ek(d){return fn(d)&&Ss(d)==pt}function g3(d){return fn(d)&&Ss(d)==as}function m3(d){return fn(d)&&Ss(d)==At}function Ju(d,p,w,S,N){return d===p?!0:d==null||p==null||!fn(d)&&!fn(p)?d!==d&&p!==p:b3(d,p,w,S,Ju,N)}function b3(d,p,w,S,N,O){var z=ne(d),U=ne(p),Q=z?Ct:us(d),gt=U?Ct:us(p);Q=Q==pt?xe:Q,gt=gt==pt?xe:gt;var mt=Q==xe,wt=gt==xe,$t=Q==gt;if($t&&Yo(d)){if(!Yo(p))return!1;z=!0,mt=!1}if($t&&!mt)return O||(O=new Hi),z||gl(d)?aS(d,p,w,S,N,O):H3(d,p,Q,w,S,N,O);if(!(w&m)){var zt=mt&&Be.call(d,"__wrapped__"),qt=wt&&Be.call(p,"__wrapped__");if(zt||qt){var ae=zt?d.value():d,Kt=qt?p.value():p;return O||(O=new Hi),N(ae,Kt,w,S,O)}}return $t?(O||(O=new Hi),G3(d,p,w,S,N,O)):!1}function x3(d){return fn(d)&&us(d)==pe}function jy(d,p,w,S){var N=w.length,O=N,z=!S;if(d==null)return!O;for(d=He(d);N--;){var U=w[N];if(z&&U[2]?U[1]!==d[U[0]]:!(U[0]in d))return!1}for(;++N<O;){U=w[N];var Q=U[0],gt=d[Q],mt=U[1];if(z&&U[2]){if(gt===e&&!(Q in d))return!1}else{var wt=new Hi;if(S)var $t=S(gt,mt,Q,d,p,wt);if(!($t===e?Ju(mt,gt,m|x,S,wt):$t))return!1}}return!0}function $k(d){if(!hn(d)||tB(d))return!1;var p=eo(d)?xL:_u;return p.test(Xa(d))}function y3(d){return fn(d)&&Ss(d)==Xe}function w3(d){return fn(d)&&us(d)==dn}function v3(d){return fn(d)&&rg(d.length)&&!!Ue[Ss(d)]}function Nk(d){return typeof d=="function"?d:d==null?zs:typeof d=="object"?ne(d)?Dk(d[0],d[1]):Ak(d):ZS(d)}function qy(d){if(!th(d))return kL(d);var p=[];for(var w in He(d))Be.call(d,w)&&w!="constructor"&&p.push(w);return p}function C3(d){if(!hn(d))return iB(d);var p=th(d),w=[];for(var S in d)S=="constructor"&&(p||!Be.call(d,S))||w.push(S);return w}function Ky(d,p){return d<p}function Rk(d,p){var w=-1,S=Ls(d)?at(d.length):[];return jo(d,function(N,O,z){S[++w]=p(N,O,z)}),S}function Ak(d){var p=l0(d);return p.length==1&&p[0][2]?dS(p[0][0],p[0][1]):function(w){return w===d||jy(w,d,p)}}function Dk(d,p){return h0(d)&&hS(p)?dS(br(d),p):function(w){var S=v0(w,d);return S===e&&S===p?C0(w,d):Ju(p,S,m|x)}}function Up(d,p,w,S,N){d!==p&&Vy(p,function(O,z){if(N||(N=new Hi),hn(O))I3(d,p,z,w,Up,S,N);else{var U=S?S(f0(d,z),O,z+"",d,p,N):e;U===e&&(U=O),zy(d,z,U)}},Bs)}function I3(d,p,w,S,N,O,z){var U=f0(d,w),Q=f0(p,w),gt=z.get(Q);if(gt){zy(d,w,gt);return}var mt=O?O(U,Q,w+"",d,p,z):e,wt=mt===e;if(wt){var $t=ne(Q),zt=!$t&&Yo(Q),qt=!$t&&!zt&&gl(Q);mt=Q,$t||zt||qt?ne(U)?mt=U:Cn(U)?mt=Ms(U):zt?(wt=!1,mt=Gk(Q,!0)):qt?(wt=!1,mt=jk(Q,!0)):mt=[]:nh(Q)||Ya(Q)?(mt=U,Ya(U)?mt=VS(U):(!hn(U)||eo(U))&&(mt=uS(Q))):wt=!1}wt&&(z.set(Q,mt),N(mt,Q,S,O,z),z.delete(Q)),zy(d,w,mt)}function Ok(d,p){var w=d.length;if(w)return p+=p<0?w:0,to(p,w)?d[p]:e}function Pk(d,p,w){p.length?p=Ye(p,function(O){return ne(O)?function(z){return qa(z,O.length===1?O[0]:O)}:O}):p=[zs];var S=-1;p=Ye(p,cs(Gt()));var N=Rk(d,function(O,z,U){var Q=Ye(p,function(gt){return gt(O)});return{criteria:Q,index:++S,value:O}});return Ay(N,function(O,z){return F3(O,z,w)})}function k3(d,p){return Fk(d,p,function(w,S){return C0(d,S)})}function Fk(d,p,w){for(var S=-1,N=p.length,O={};++S<N;){var z=p[S],U=qa(d,z);w(U,z)&&Zu(O,Ko(z,d),U)}return O}function S3(d){return function(p){return qa(p,d)}}function Xy(d,p,w,S){var N=S?Lt:kt,O=-1,z=p.length,U=d;for(d===p&&(p=Ms(p)),w&&(U=Ye(d,cs(w)));++O<z;)for(var Q=0,gt=p[O],mt=w?w(gt):gt;(Q=N(U,mt,Q,S))>-1;)U!==d&&Dp.call(U,Q,1),Dp.call(d,Q,1);return d}function Mk(d,p){for(var w=d?p.length:0,S=w-1;w--;){var N=p[w];if(w==S||N!==O){var O=N;to(N)?Dp.call(d,N,1):Qy(d,N)}}return d}function Yy(d,p){return d+Fp(bk()*(p-d+1))}function _3(d,p,w,S){for(var N=-1,O=Mn(Pp((p-d)/(w||1)),0),z=at(O);O--;)z[S?O:++N]=d,d+=w;return z}function Jy(d,p){var w="";if(!d||p<1||p>st)return w;do p%2&&(w+=d),p=Fp(p/2),p&&(d+=d);while(p);return w}function de(d,p){return p0(fS(d,p,zs),d+"")}function T3(d){return wk(ml(d))}function E3(d,p){var w=ml(d);return Qp(w,ja(p,0,w.length))}function Zu(d,p,w,S){if(!hn(d))return d;p=Ko(p,d);for(var N=-1,O=p.length,z=O-1,U=d;U!=null&&++N<O;){var Q=br(p[N]),gt=w;if(Q==="__proto__"||Q==="constructor"||Q==="prototype")return d;if(N!=z){var mt=U[Q];gt=S?S(mt,Q,U):e,gt===e&&(gt=hn(mt)?mt:to(p[N+1])?[]:{})}Ku(U,Q,gt),U=U[Q]}return d}var Lk=Mp?function(d,p){return Mp.set(d,p),d}:zs,$3=Op?function(d,p){return Op(d,"toString",{configurable:!0,enumerable:!1,value:k0(p),writable:!0})}:zs;function N3(d){return Qp(ml(d))}function yi(d,p,w){var S=-1,N=d.length;p<0&&(p=-p>N?0:N+p),w=w>N?N:w,w<0&&(w+=N),N=p>w?0:w-p>>>0,p>>>=0;for(var O=at(N);++S<N;)O[S]=d[S+p];return O}function R3(d,p){var w;return jo(d,function(S,N,O){return w=p(S,N,O),!w}),!!w}function Hp(d,p,w){var S=0,N=d==null?S:d.length;if(typeof p=="number"&&p===p&&N<=vt){for(;S<N;){var O=S+N>>>1,z=d[O];z!==null&&!si(z)&&(w?z<=p:z<p)?S=O+1:N=O}return N}return Zy(d,p,zs,w)}function Zy(d,p,w,S){var N=0,O=d==null?0:d.length;if(O===0)return 0;p=w(p);for(var z=p!==p,U=p===null,Q=si(p),gt=p===e;N<O;){var mt=Fp((N+O)/2),wt=w(d[mt]),$t=wt!==e,zt=wt===null,qt=wt===wt,ae=si(wt);if(z)var Kt=S||qt;else gt?Kt=qt&&(S||$t):U?Kt=qt&&$t&&(S||!zt):Q?Kt=qt&&$t&&!zt&&(S||!ae):zt||ae?Kt=!1:Kt=S?wt<=p:wt<p;Kt?N=mt+1:O=mt}return ls(O,yt)}function Bk(d,p){for(var w=-1,S=d.length,N=0,O=[];++w<S;){var z=d[w],U=p?p(z):z;if(!w||!Gi(U,Q)){var Q=U;O[N++]=z===0?0:z}}return O}function zk(d){return typeof d=="number"?d:si(d)?bt:+d}function ni(d){if(typeof d=="string")return d;if(ne(d))return Ye(d,ni)+"";if(si(d))return xk?xk.call(d):"";var p=d+"";return p=="0"&&1/d==-it?"-0":p}function qo(d,p,w){var S=-1,N=sl,O=d.length,z=!0,U=[],Q=U;if(w)z=!1,N=Fu;else if(O>=i){var gt=p?null:V3(d);if(gt)return Sp(gt);z=!1,N=Va,Q=new Ga}else Q=p?[]:U;t:for(;++S<O;){var mt=d[S],wt=p?p(mt):mt;if(mt=w||mt!==0?mt:0,z&&wt===wt){for(var $t=Q.length;$t--;)if(Q[$t]===wt)continue t;p&&Q.push(wt),U.push(mt)}else N(Q,wt,w)||(Q!==U&&Q.push(wt),U.push(mt))}return U}function Qy(d,p){return p=Ko(p,d),d=pS(d,p),d==null||delete d[br(wi(p))]}function Wk(d,p,w,S){return Zu(d,p,w(qa(d,p)),S)}function Gp(d,p,w,S){for(var N=d.length,O=S?N:-1;(S?O--:++O<N)&&p(d[O],O,d););return w?yi(d,S?0:O,S?O+1:N):yi(d,S?O+1:0,S?N:O)}function Vk(d,p){var w=d;return w instanceof ye&&(w=w.value()),za(p,function(S,N){return N.func.apply(N.thisArg,Je([S],N.args))},w)}function t0(d,p,w){var S=d.length;if(S<2)return S?qo(d[0]):[];for(var N=-1,O=at(S);++N<S;)for(var z=d[N],U=-1;++U<S;)U!=N&&(O[N]=Xu(O[N]||z,d[U],p,w));return qo(ts(O,1),p,w)}function Uk(d,p,w){for(var S=-1,N=d.length,O=p.length,z={};++S<N;){var U=S<O?p[S]:e;w(z,d[S],U)}return z}function e0(d){return Cn(d)?d:[]}function n0(d){return typeof d=="function"?d:zs}function Ko(d,p){return ne(d)?d:h0(d,p)?[d]:xS(Fe(d))}var A3=de;function Xo(d,p,w){var S=d.length;return w=w===e?S:w,!p&&w>=S?d:yi(d,p,w)}var Hk=yL||function(d){return Pn.clearTimeout(d)};function Gk(d,p){if(p)return d.slice();var w=d.length,S=dk?dk(w):new d.constructor(w);return d.copy(S),S}function s0(d){var p=new d.constructor(d.byteLength);return new Rp(p).set(new Rp(d)),p}function D3(d,p){var w=p?s0(d.buffer):d.buffer;return new d.constructor(w,d.byteOffset,d.byteLength)}function O3(d){var p=new d.constructor(d.source,jf.exec(d));return p.lastIndex=d.lastIndex,p}function P3(d){return qu?He(qu.call(d)):{}}function jk(d,p){var w=p?s0(d.buffer):d.buffer;return new d.constructor(w,d.byteOffset,d.length)}function qk(d,p){if(d!==p){var w=d!==e,S=d===null,N=d===d,O=si(d),z=p!==e,U=p===null,Q=p===p,gt=si(p);if(!U&&!gt&&!O&&d>p||O&&z&&Q&&!U&&!gt||S&&z&&Q||!w&&Q||!N)return 1;if(!S&&!O&&!gt&&d<p||gt&&w&&N&&!S&&!O||U&&w&&N||!z&&N||!Q)return-1}return 0}function F3(d,p,w){for(var S=-1,N=d.criteria,O=p.criteria,z=N.length,U=w.length;++S<z;){var Q=qk(N[S],O[S]);if(Q){if(S>=U)return Q;var gt=w[S];return Q*(gt=="desc"?-1:1)}}return d.index-p.index}function Kk(d,p,w,S){for(var N=-1,O=d.length,z=w.length,U=-1,Q=p.length,gt=Mn(O-z,0),mt=at(Q+gt),wt=!S;++U<Q;)mt[U]=p[U];for(;++N<z;)(wt||N<O)&&(mt[w[N]]=d[N]);for(;gt--;)mt[U++]=d[N++];return mt}function Xk(d,p,w,S){for(var N=-1,O=d.length,z=-1,U=w.length,Q=-1,gt=p.length,mt=Mn(O-U,0),wt=at(mt+gt),$t=!S;++N<mt;)wt[N]=d[N];for(var zt=N;++Q<gt;)wt[zt+Q]=p[Q];for(;++z<U;)($t||N<O)&&(wt[zt+w[z]]=d[N++]);return wt}function Ms(d,p){var w=-1,S=d.length;for(p||(p=at(S));++w<S;)p[w]=d[w];return p}function mr(d,p,w,S){var N=!w;w||(w={});for(var O=-1,z=p.length;++O<z;){var U=p[O],Q=S?S(w[U],d[U],U,w,d):e;Q===e&&(Q=d[U]),N?Jr(w,U,Q):Ku(w,U,Q)}return w}function M3(d,p){return mr(d,u0(d),p)}function L3(d,p){return mr(d,cS(d),p)}function jp(d,p){return function(w,S){var N=ne(w)?$y:o3,O=p?p():{};return N(w,d,Gt(S,2),O)}}function dl(d){return de(function(p,w){var S=-1,N=w.length,O=N>1?w[N-1]:e,z=N>2?w[2]:e;for(O=d.length>3&&typeof O=="function"?(N--,O):e,z&&_s(w[0],w[1],z)&&(O=N<3?e:O,N=1),p=He(p);++S<N;){var U=w[S];U&&d(p,U,S,O)}return p})}function Yk(d,p){return function(w,S){if(w==null)return w;if(!Ls(w))return d(w,S);for(var N=w.length,O=p?N:-1,z=He(w);(p?O--:++O<N)&&S(z[O],O,z)!==!1;);return w}}function Jk(d){return function(p,w,S){for(var N=-1,O=He(p),z=S(p),U=z.length;U--;){var Q=z[d?U:++N];if(w(O[Q],Q,O)===!1)break}return p}}function B3(d,p,w){var S=p&b,N=Qu(d);function O(){var z=this&&this!==Pn&&this instanceof O?N:d;return z.apply(S?w:this,arguments)}return O}function Zk(d){return function(p){p=Fe(p);var w=Uo(p)?Ui(p):e,S=w?w[0]:p.charAt(0),N=w?Xo(w,1).join(""):p.slice(1);return S[d]()+N}}function fl(d){return function(p){return za(YS(XS(p).replace(yy,"")),d,"")}}function Qu(d){return function(){var p=arguments;switch(p.length){case 0:return new d;case 1:return new d(p[0]);case 2:return new d(p[0],p[1]);case 3:return new d(p[0],p[1],p[2]);case 4:return new d(p[0],p[1],p[2],p[3]);case 5:return new d(p[0],p[1],p[2],p[3],p[4]);case 6:return new d(p[0],p[1],p[2],p[3],p[4],p[5]);case 7:return new d(p[0],p[1],p[2],p[3],p[4],p[5],p[6])}var w=hl(d.prototype),S=d.apply(w,p);return hn(S)?S:w}}function z3(d,p,w){var S=Qu(d);function N(){for(var O=arguments.length,z=at(O),U=O,Q=pl(N);U--;)z[U]=arguments[U];var gt=O<3&&z[0]!==Q&&z[O-1]!==Q?[]:Ho(z,Q);if(O-=gt.length,O<w)return sS(d,p,qp,N.placeholder,e,z,gt,e,e,w-O);var mt=this&&this!==Pn&&this instanceof N?S:d;return ks(mt,this,z)}return N}function Qk(d){return function(p,w,S){var N=He(p);if(!Ls(p)){var O=Gt(w,3);p=Un(p),w=function(U){return O(N[U],U,N)}}var z=d(p,w,S);return z>-1?N[O?p[z]:z]:e}}function tS(d){return Qr(function(p){var w=p.length,S=w,N=bi.prototype.thru;for(d&&p.reverse();S--;){var O=p[S];if(typeof O!="function")throw new mi(o);if(N&&!z&&Jp(O)=="wrapper")var z=new bi([],!0)}for(S=z?S:w;++S<w;){O=p[S];var U=Jp(O),Q=U=="wrapper"?c0(O):e;Q&&d0(Q[0])&&Q[1]==(R|k|_|A)&&!Q[4].length&&Q[9]==1?z=z[Jp(Q[0])].apply(z,Q[3]):z=O.length==1&&d0(O)?z[U]():z.thru(O)}return function(){var gt=arguments,mt=gt[0];if(z&&gt.length==1&&ne(mt))return z.plant(mt).value();for(var wt=0,$t=w?p[wt].apply(this,gt):mt;++wt<w;)$t=p[wt].call(this,$t);return $t}})}function qp(d,p,w,S,N,O,z,U,Q,gt){var mt=p&R,wt=p&b,$t=p&y,zt=p&(k|I),qt=p&F,ae=$t?e:Qu(d);function Kt(){for(var ge=arguments.length,Ce=at(ge),ii=ge;ii--;)Ce[ii]=arguments[ii];if(zt)var Ts=pl(Kt),ri=Ip(Ce,Ts);if(S&&(Ce=Kk(Ce,S,N,zt)),O&&(Ce=Xk(Ce,O,z,zt)),ge-=ri,zt&&ge<gt){var In=Ho(Ce,Ts);return sS(d,p,qp,Kt.placeholder,w,Ce,In,U,Q,gt-ge)}var ji=wt?w:this,so=$t?ji[d]:d;return ge=Ce.length,U?Ce=oB(Ce,U):qt&&ge>1&&Ce.reverse(),mt&&Q<ge&&(Ce.length=Q),this&&this!==Pn&&this instanceof Kt&&(so=ae||Qu(so)),so.apply(ji,Ce)}return Kt}function eS(d,p){return function(w,S){return p3(w,d,p(S),{})}}function Kp(d,p){return function(w,S){var N;if(w===e&&S===e)return p;if(w!==e&&(N=w),S!==e){if(N===e)return S;typeof w=="string"||typeof S=="string"?(w=ni(w),S=ni(S)):(w=zk(w),S=zk(S)),N=d(w,S)}return N}}function i0(d){return Qr(function(p){return p=Ye(p,cs(Gt())),de(function(w){var S=this;return d(p,function(N){return ks(N,S,w)})})})}function Xp(d,p){p=p===e?" ":ni(p);var w=p.length;if(w<2)return w?Jy(p,d):p;var S=Jy(p,Pp(d/ol(p)));return Uo(p)?Xo(Ui(S),0,d).join(""):S.slice(0,d)}function W3(d,p,w,S){var N=p&b,O=Qu(d);function z(){for(var U=-1,Q=arguments.length,gt=-1,mt=S.length,wt=at(mt+Q),$t=this&&this!==Pn&&this instanceof z?O:d;++gt<mt;)wt[gt]=S[gt];for(;Q--;)wt[gt++]=arguments[++U];return ks($t,N?w:this,wt)}return z}function nS(d){return function(p,w,S){return S&&typeof S!="number"&&_s(p,w,S)&&(w=S=e),p=no(p),w===e?(w=p,p=0):w=no(w),S=S===e?p<w?1:-1:no(S),_3(p,w,S,d)}}function Yp(d){return function(p,w){return typeof p=="string"&&typeof w=="string"||(p=vi(p),w=vi(w)),d(p,w)}}function sS(d,p,w,S,N,O,z,U,Q,gt){var mt=p&k,wt=mt?z:e,$t=mt?e:z,zt=mt?O:e,qt=mt?e:O;p|=mt?_:$,p&=~(mt?$:_),p&v||(p&=~(b|y));var ae=[d,p,N,zt,wt,qt,$t,U,Q,gt],Kt=w.apply(e,ae);return d0(d)&&gS(Kt,ae),Kt.placeholder=S,mS(Kt,d,p)}function r0(d){var p=Fn[d];return function(w,S){if(w=vi(w),S=S==null?0:ls(oe(S),292),S&&mk(w)){var N=(Fe(w)+"e").split("e"),O=p(N[0]+"e"+(+N[1]+S));return N=(Fe(O)+"e").split("e"),+(N[0]+"e"+(+N[1]-S))}return p(w)}}var V3=ll&&1/Sp(new ll([,-0]))[1]==it?function(d){return new ll(d)}:T0;function iS(d){return function(p){var w=us(p);return w==pe?rl(p):w==dn?rL(p):vp(p,d(p))}}function Zr(d,p,w,S,N,O,z,U){var Q=p&y;if(!Q&&typeof d!="function")throw new mi(o);var gt=S?S.length:0;if(gt||(p&=~(_|$),S=N=e),z=z===e?z:Mn(oe(z),0),U=U===e?U:oe(U),gt-=N?N.length:0,p&$){var mt=S,wt=N;S=N=e}var $t=Q?e:c0(d),zt=[d,p,w,S,N,mt,wt,O,z,U];if($t&&sB(zt,$t),d=zt[0],p=zt[1],w=zt[2],S=zt[3],N=zt[4],U=zt[9]=zt[9]===e?Q?0:d.length:Mn(zt[9]-gt,0),!U&&p&(k|I)&&(p&=~(k|I)),!p||p==b)var qt=B3(d,p,w);else p==k||p==I?qt=z3(d,p,U):(p==_||p==(b|_))&&!N.length?qt=W3(d,p,w,S):qt=qp.apply(e,zt);var ae=$t?Lk:gS;return mS(ae(qt,zt),d,p)}function rS(d,p,w,S){return d===e||Gi(d,cl[w])&&!Be.call(S,w)?p:d}function oS(d,p,w,S,N,O){return hn(d)&&hn(p)&&(O.set(p,d),Up(d,p,e,oS,O),O.delete(p)),d}function U3(d){return nh(d)?e:d}function aS(d,p,w,S,N,O){var z=w&m,U=d.length,Q=p.length;if(U!=Q&&!(z&&Q>U))return!1;var gt=O.get(d),mt=O.get(p);if(gt&&mt)return gt==p&&mt==d;var wt=-1,$t=!0,zt=w&x?new Ga:e;for(O.set(d,p),O.set(p,d);++wt<U;){var qt=d[wt],ae=p[wt];if(S)var Kt=z?S(ae,qt,wt,p,d,O):S(qt,ae,wt,d,p,O);if(Kt!==e){if(Kt)continue;$t=!1;break}if(zt){if(!E(p,function(ge,Ce){if(!Va(zt,Ce)&&(qt===ge||N(qt,ge,w,S,O)))return zt.push(Ce)})){$t=!1;break}}else if(!(qt===ae||N(qt,ae,w,S,O))){$t=!1;break}}return O.delete(d),O.delete(p),$t}function H3(d,p,w,S,N,O,z){switch(w){case Qn:if(d.byteLength!=p.byteLength||d.byteOffset!=p.byteOffset)return!1;d=d.buffer,p=p.buffer;case as:return!(d.byteLength!=p.byteLength||!O(new Rp(d),new Rp(p)));case Bt:case At:case be:return Gi(+d,+p);case Yt:return d.name==p.name&&d.message==p.message;case Xe:case vn:return d==p+"";case pe:var U=rl;case dn:var Q=S&m;if(U||(U=Sp),d.size!=p.size&&!Q)return!1;var gt=z.get(d);if(gt)return gt==p;S|=x,z.set(d,p);var mt=aS(U(d),U(p),S,N,O,z);return z.delete(d),mt;case Zn:if(qu)return qu.call(d)==qu.call(p)}return!1}function G3(d,p,w,S,N,O){var z=w&m,U=o0(d),Q=U.length,gt=o0(p),mt=gt.length;if(Q!=mt&&!z)return!1;for(var wt=Q;wt--;){var $t=U[wt];if(!(z?$t in p:Be.call(p,$t)))return!1}var zt=O.get(d),qt=O.get(p);if(zt&&qt)return zt==p&&qt==d;var ae=!0;O.set(d,p),O.set(p,d);for(var Kt=z;++wt<Q;){$t=U[wt];var ge=d[$t],Ce=p[$t];if(S)var ii=z?S(Ce,ge,$t,p,d,O):S(ge,Ce,$t,d,p,O);if(!(ii===e?ge===Ce||N(ge,Ce,w,S,O):ii)){ae=!1;break}Kt||(Kt=$t=="constructor")}if(ae&&!Kt){var Ts=d.constructor,ri=p.constructor;Ts!=ri&&"constructor"in d&&"constructor"in p&&!(typeof Ts=="function"&&Ts instanceof Ts&&typeof ri=="function"&&ri instanceof ri)&&(ae=!1)}return O.delete(d),O.delete(p),ae}function Qr(d){return p0(fS(d,e,CS),d+"")}function o0(d){return Tk(d,Un,u0)}function a0(d){return Tk(d,Bs,cS)}var c0=Mp?function(d){return Mp.get(d)}:T0;function Jp(d){for(var p=d.name+"",w=ul[p],S=Be.call(ul,p)?w.length:0;S--;){var N=w[S],O=N.func;if(O==null||O==d)return N.name}return p}function pl(d){var p=Be.call(D,"placeholder")?D:d;return p.placeholder}function Gt(){var d=D.iteratee||S0;return d=d===S0?Nk:d,arguments.length?d(arguments[0],arguments[1]):d}function Zp(d,p){var w=d.__data__;return Q3(p)?w[typeof p=="string"?"string":"hash"]:w.map}function l0(d){for(var p=Un(d),w=p.length;w--;){var S=p[w],N=d[S];p[w]=[S,N,hS(N)]}return p}function Ka(d,p){var w=Dy(d,p);return $k(w)?w:e}function j3(d){var p=Be.call(d,Ua),w=d[Ua];try{d[Ua]=e;var S=!0}catch{}var N=$p.call(d);return S&&(p?d[Ua]=w:delete d[Ua]),N}var u0=My?function(d){return d==null?[]:(d=He(d),pr(My(d),function(p){return pk.call(d,p)}))}:E0,cS=My?function(d){for(var p=[];d;)Je(p,u0(d)),d=Ap(d);return p}:E0,us=Ss;(Ly&&us(new Ly(new ArrayBuffer(1)))!=Qn||Hu&&us(new Hu)!=pe||By&&us(By.resolve())!=Oe||ll&&us(new ll)!=dn||Gu&&us(new Gu)!=he)&&(us=function(d){var p=Ss(d),w=p==xe?d.constructor:e,S=w?Xa(w):"";if(S)switch(S){case EL:return Qn;case $L:return pe;case NL:return Oe;case RL:return dn;case AL:return he}return p});function q3(d,p,w){for(var S=-1,N=w.length;++S<N;){var O=w[S],z=O.size;switch(O.type){case"drop":d+=z;break;case"dropRight":p-=z;break;case"take":p=ls(p,d+z);break;case"takeRight":d=Mn(d,p-z);break}}return{start:d,end:p}}function K3(d){var p=d.match(ey);return p?p[1].split(ny):[]}function lS(d,p,w){p=Ko(p,d);for(var S=-1,N=p.length,O=!1;++S<N;){var z=br(p[S]);if(!(O=d!=null&&w(d,z)))break;d=d[z]}return O||++S!=N?O:(N=d==null?0:d.length,!!N&&rg(N)&&to(z,N)&&(ne(d)||Ya(d)))}function X3(d){var p=d.length,w=new d.constructor(p);return p&&typeof d[0]=="string"&&Be.call(d,"index")&&(w.index=d.index,w.input=d.input),w}function uS(d){return typeof d.constructor=="function"&&!th(d)?hl(Ap(d)):{}}function Y3(d,p,w){var S=d.constructor;switch(p){case as:return s0(d);case Bt:case At:return new S(+d);case Qn:return D3(d,w);case Wi:case Vr:case Ur:case Oa:case pi:case Hr:case Pa:case Cu:case Iu:return jk(d,w);case pe:return new S;case be:case vn:return new S(d);case Xe:return O3(d);case dn:return new S;case Zn:return P3(d)}}function J3(d,p){var w=p.length;if(!w)return d;var S=w-1;return p[S]=(w>1?"& ":"")+p[S],p=p.join(w>2?", ":" "),d.replace(ty,`{
/* [wrapped with `+p+`] */
`)}function Z3(d){return ne(d)||Ya(d)||!!(gk&&d&&d[gk])}function to(d,p){var w=typeof d;return p=p??st,!!p&&(w=="number"||w!="symbol"&&ay.test(d))&&d>-1&&d%1==0&&d<p}function _s(d,p,w){if(!hn(w))return!1;var S=typeof p;return(S=="number"?Ls(w)&&to(p,w.length):S=="string"&&p in w)?Gi(w[p],d):!1}function h0(d,p){if(ne(d))return!1;var w=typeof d;return w=="number"||w=="symbol"||w=="boolean"||d==null||si(d)?!0:Yx.test(d)||!Xx.test(d)||p!=null&&d in He(p)}function Q3(d){var p=typeof d;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?d!=="__proto__":d===null}function d0(d){var p=Jp(d),w=D[p];if(typeof w!="function"||!(p in ye.prototype))return!1;if(d===w)return!0;var S=c0(w);return!!S&&d===S[0]}function tB(d){return!!hk&&hk in d}var eB=Tp?eo:$0;function th(d){var p=d&&d.constructor,w=typeof p=="function"&&p.prototype||cl;return d===w}function hS(d){return d===d&&!hn(d)}function dS(d,p){return function(w){return w==null?!1:w[d]===p&&(p!==e||d in He(w))}}function nB(d){var p=sg(d,function(S){return w.size===l&&w.clear(),S}),w=p.cache;return p}function sB(d,p){var w=d[1],S=p[1],N=w|S,O=N<(b|y|R),z=S==R&&w==k||S==R&&w==A&&d[7].length<=p[8]||S==(R|A)&&p[7].length<=p[8]&&w==k;if(!(O||z))return d;S&b&&(d[2]=p[2],N|=w&b?0:v);var U=p[3];if(U){var Q=d[3];d[3]=Q?Kk(Q,U,p[4]):U,d[4]=Q?Ho(d[3],u):p[4]}return U=p[5],U&&(Q=d[5],d[5]=Q?Xk(Q,U,p[6]):U,d[6]=Q?Ho(d[5],u):p[6]),U=p[7],U&&(d[7]=U),S&R&&(d[8]=d[8]==null?p[8]:ls(d[8],p[8])),d[9]==null&&(d[9]=p[9]),d[0]=p[0],d[1]=N,d}function iB(d){var p=[];if(d!=null)for(var w in He(d))p.push(w);return p}function rB(d){return $p.call(d)}function fS(d,p,w){return p=Mn(p===e?d.length-1:p,0),function(){for(var S=arguments,N=-1,O=Mn(S.length-p,0),z=at(O);++N<O;)z[N]=S[p+N];N=-1;for(var U=at(p+1);++N<p;)U[N]=S[N];return U[p]=w(z),ks(d,this,U)}}function pS(d,p){return p.length<2?d:qa(d,yi(p,0,-1))}function oB(d,p){for(var w=d.length,S=ls(p.length,w),N=Ms(d);S--;){var O=p[S];d[S]=to(O,w)?N[O]:e}return d}function f0(d,p){if(!(p==="constructor"&&typeof d[p]=="function")&&p!="__proto__")return d[p]}var gS=bS(Lk),eh=vL||function(d,p){return Pn.setTimeout(d,p)},p0=bS($3);function mS(d,p,w){var S=p+"";return p0(d,J3(S,aB(K3(S),w)))}function bS(d){var p=0,w=0;return function(){var S=SL(),N=Z-(S-w);if(w=S,N>0){if(++p>=j)return arguments[0]}else p=0;return d.apply(e,arguments)}}function Qp(d,p){var w=-1,S=d.length,N=S-1;for(p=p===e?S:p;++w<p;){var O=Yy(w,N),z=d[O];d[O]=d[w],d[w]=z}return d.length=p,d}var xS=nB(function(d){var p=[];return d.charCodeAt(0)===46&&p.push(""),d.replace(Jx,function(w,S,N,O){p.push(N?O.replace(Gf,"$1"):S||w)}),p});function br(d){if(typeof d=="string"||si(d))return d;var p=d+"";return p=="0"&&1/d==-it?"-0":p}function Xa(d){if(d!=null){try{return Ep.call(d)}catch{}try{return d+""}catch{}}return""}function aB(d,p){return Fs(St,function(w){var S="_."+w[0];p&w[1]&&!sl(d,S)&&d.push(S)}),d.sort()}function yS(d){if(d instanceof ye)return d.clone();var p=new bi(d.__wrapped__,d.__chain__);return p.__actions__=Ms(d.__actions__),p.__index__=d.__index__,p.__values__=d.__values__,p}function cB(d,p,w){(w?_s(d,p,w):p===e)?p=1:p=Mn(oe(p),0);var S=d==null?0:d.length;if(!S||p<1)return[];for(var N=0,O=0,z=at(Pp(S/p));N<S;)z[O++]=yi(d,N,N+=p);return z}function lB(d){for(var p=-1,w=d==null?0:d.length,S=0,N=[];++p<w;){var O=d[p];O&&(N[S++]=O)}return N}function uB(){var d=arguments.length;if(!d)return[];for(var p=at(d-1),w=arguments[0],S=d;S--;)p[S-1]=arguments[S];return Je(ne(w)?Ms(w):[w],ts(p,1))}var hB=de(function(d,p){return Cn(d)?Xu(d,ts(p,1,Cn,!0)):[]}),dB=de(function(d,p){var w=wi(p);return Cn(w)&&(w=e),Cn(d)?Xu(d,ts(p,1,Cn,!0),Gt(w,2)):[]}),fB=de(function(d,p){var w=wi(p);return Cn(w)&&(w=e),Cn(d)?Xu(d,ts(p,1,Cn,!0),e,w):[]});function pB(d,p,w){var S=d==null?0:d.length;return S?(p=w||p===e?1:oe(p),yi(d,p<0?0:p,S)):[]}function gB(d,p,w){var S=d==null?0:d.length;return S?(p=w||p===e?1:oe(p),p=S-p,yi(d,0,p<0?0:p)):[]}function mB(d,p){return d&&d.length?Gp(d,Gt(p,3),!0,!0):[]}function bB(d,p){return d&&d.length?Gp(d,Gt(p,3),!0):[]}function xB(d,p,w,S){var N=d==null?0:d.length;return N?(w&&typeof w!="number"&&_s(d,p,w)&&(w=0,S=N),u3(d,p,w,S)):[]}function wS(d,p,w){var S=d==null?0:d.length;if(!S)return-1;var N=w==null?0:oe(w);return N<0&&(N=Mn(S+N,0)),ht(d,Gt(p,3),N)}function vS(d,p,w){var S=d==null?0:d.length;if(!S)return-1;var N=S-1;return w!==e&&(N=oe(w),N=w<0?Mn(S+N,0):ls(N,S-1)),ht(d,Gt(p,3),N,!0)}function CS(d){var p=d==null?0:d.length;return p?ts(d,1):[]}function yB(d){var p=d==null?0:d.length;return p?ts(d,it):[]}function wB(d,p){var w=d==null?0:d.length;return w?(p=p===e?1:oe(p),ts(d,p)):[]}function vB(d){for(var p=-1,w=d==null?0:d.length,S={};++p<w;){var N=d[p];S[N[0]]=N[1]}return S}function IS(d){return d&&d.length?d[0]:e}function CB(d,p,w){var S=d==null?0:d.length;if(!S)return-1;var N=w==null?0:oe(w);return N<0&&(N=Mn(S+N,0)),kt(d,p,N)}function IB(d){var p=d==null?0:d.length;return p?yi(d,0,-1):[]}var kB=de(function(d){var p=Ye(d,e0);return p.length&&p[0]===d[0]?Gy(p):[]}),SB=de(function(d){var p=wi(d),w=Ye(d,e0);return p===wi(w)?p=e:w.pop(),w.length&&w[0]===d[0]?Gy(w,Gt(p,2)):[]}),_B=de(function(d){var p=wi(d),w=Ye(d,e0);return p=typeof p=="function"?p:e,p&&w.pop(),w.length&&w[0]===d[0]?Gy(w,e,p):[]});function TB(d,p){return d==null?"":IL.call(d,p)}function wi(d){var p=d==null?0:d.length;return p?d[p-1]:e}function EB(d,p,w){var S=d==null?0:d.length;if(!S)return-1;var N=S;return w!==e&&(N=oe(w),N=N<0?Mn(S+N,0):ls(N,S-1)),p===p?aL(d,p,N):ht(d,Zt,N,!0)}function $B(d,p){return d&&d.length?Ok(d,oe(p)):e}var NB=de(kS);function kS(d,p){return d&&d.length&&p&&p.length?Xy(d,p):d}function RB(d,p,w){return d&&d.length&&p&&p.length?Xy(d,p,Gt(w,2)):d}function AB(d,p,w){return d&&d.length&&p&&p.length?Xy(d,p,e,w):d}var DB=Qr(function(d,p){var w=d==null?0:d.length,S=Wy(d,p);return Mk(d,Ye(p,function(N){return to(N,w)?+N:N}).sort(qk)),S});function OB(d,p){var w=[];if(!(d&&d.length))return w;var S=-1,N=[],O=d.length;for(p=Gt(p,3);++S<O;){var z=d[S];p(z,S,d)&&(w.push(z),N.push(S))}return Mk(d,N),w}function g0(d){return d==null?d:TL.call(d)}function PB(d,p,w){var S=d==null?0:d.length;return S?(w&&typeof w!="number"&&_s(d,p,w)?(p=0,w=S):(p=p==null?0:oe(p),w=w===e?S:oe(w)),yi(d,p,w)):[]}function FB(d,p){return Hp(d,p)}function MB(d,p,w){return Zy(d,p,Gt(w,2))}function LB(d,p){var w=d==null?0:d.length;if(w){var S=Hp(d,p);if(S<w&&Gi(d[S],p))return S}return-1}function BB(d,p){return Hp(d,p,!0)}function zB(d,p,w){return Zy(d,p,Gt(w,2),!0)}function WB(d,p){var w=d==null?0:d.length;if(w){var S=Hp(d,p,!0)-1;if(Gi(d[S],p))return S}return-1}function VB(d){return d&&d.length?Bk(d):[]}function UB(d,p){return d&&d.length?Bk(d,Gt(p,2)):[]}function HB(d){var p=d==null?0:d.length;return p?yi(d,1,p):[]}function GB(d,p,w){return d&&d.length?(p=w||p===e?1:oe(p),yi(d,0,p<0?0:p)):[]}function jB(d,p,w){var S=d==null?0:d.length;return S?(p=w||p===e?1:oe(p),p=S-p,yi(d,p<0?0:p,S)):[]}function qB(d,p){return d&&d.length?Gp(d,Gt(p,3),!1,!0):[]}function KB(d,p){return d&&d.length?Gp(d,Gt(p,3)):[]}var XB=de(function(d){return qo(ts(d,1,Cn,!0))}),YB=de(function(d){var p=wi(d);return Cn(p)&&(p=e),qo(ts(d,1,Cn,!0),Gt(p,2))}),JB=de(function(d){var p=wi(d);return p=typeof p=="function"?p:e,qo(ts(d,1,Cn,!0),e,p)});function ZB(d){return d&&d.length?qo(d):[]}function QB(d,p){return d&&d.length?qo(d,Gt(p,2)):[]}function tz(d,p){return p=typeof p=="function"?p:e,d&&d.length?qo(d,e,p):[]}function m0(d){if(!(d&&d.length))return[];var p=0;return d=pr(d,function(w){if(Cn(w))return p=Mn(w.length,p),!0}),Mu(p,function(w){return Ye(d,$e(w))})}function SS(d,p){if(!(d&&d.length))return[];var w=m0(d);return p==null?w:Ye(w,function(S){return ks(p,e,S)})}var ez=de(function(d,p){return Cn(d)?Xu(d,p):[]}),nz=de(function(d){return t0(pr(d,Cn))}),sz=de(function(d){var p=wi(d);return Cn(p)&&(p=e),t0(pr(d,Cn),Gt(p,2))}),iz=de(function(d){var p=wi(d);return p=typeof p=="function"?p:e,t0(pr(d,Cn),e,p)}),rz=de(m0);function oz(d,p){return Uk(d||[],p||[],Ku)}function az(d,p){return Uk(d||[],p||[],Zu)}var cz=de(function(d){var p=d.length,w=p>1?d[p-1]:e;return w=typeof w=="function"?(d.pop(),w):e,SS(d,w)});function _S(d){var p=D(d);return p.__chain__=!0,p}function lz(d,p){return p(d),d}function tg(d,p){return p(d)}var uz=Qr(function(d){var p=d.length,w=p?d[0]:0,S=this.__wrapped__,N=function(O){return Wy(O,d)};return p>1||this.__actions__.length||!(S instanceof ye)||!to(w)?this.thru(N):(S=S.slice(w,+w+(p?1:0)),S.__actions__.push({func:tg,args:[N],thisArg:e}),new bi(S,this.__chain__).thru(function(O){return p&&!O.length&&O.push(e),O}))});function hz(){return _S(this)}function dz(){return new bi(this.value(),this.__chain__)}function fz(){this.__values__===e&&(this.__values__=zS(this.value()));var d=this.__index__>=this.__values__.length,p=d?e:this.__values__[this.__index__++];return{done:d,value:p}}function pz(){return this}function gz(d){for(var p,w=this;w instanceof Bp;){var S=yS(w);S.__index__=0,S.__values__=e,p?N.__wrapped__=S:p=S;var N=S;w=w.__wrapped__}return N.__wrapped__=d,p}function mz(){var d=this.__wrapped__;if(d instanceof ye){var p=d;return this.__actions__.length&&(p=new ye(this)),p=p.reverse(),p.__actions__.push({func:tg,args:[g0],thisArg:e}),new bi(p,this.__chain__)}return this.thru(g0)}function bz(){return Vk(this.__wrapped__,this.__actions__)}var xz=jp(function(d,p,w){Be.call(d,w)?++d[w]:Jr(d,w,1)});function yz(d,p,w){var S=ne(d)?wp:l3;return w&&_s(d,p,w)&&(p=e),S(d,Gt(p,3))}function wz(d,p){var w=ne(d)?pr:Sk;return w(d,Gt(p,3))}var vz=Qk(wS),Cz=Qk(vS);function Iz(d,p){return ts(eg(d,p),1)}function kz(d,p){return ts(eg(d,p),it)}function Sz(d,p,w){return w=w===e?1:oe(w),ts(eg(d,p),w)}function TS(d,p){var w=ne(d)?Fs:jo;return w(d,Gt(p,3))}function ES(d,p){var w=ne(d)?Ny:kk;return w(d,Gt(p,3))}var _z=jp(function(d,p,w){Be.call(d,w)?d[w].push(p):Jr(d,w,[p])});function Tz(d,p,w,S){d=Ls(d)?d:ml(d),w=w&&!S?oe(w):0;var N=d.length;return w<0&&(w=Mn(N+w,0)),og(d)?w<=N&&d.indexOf(p,w)>-1:!!N&&kt(d,p,w)>-1}var Ez=de(function(d,p,w){var S=-1,N=typeof p=="function",O=Ls(d)?at(d.length):[];return jo(d,function(z){O[++S]=N?ks(p,z,w):Yu(z,p,w)}),O}),$z=jp(function(d,p,w){Jr(d,w,p)});function eg(d,p){var w=ne(d)?Ye:Rk;return w(d,Gt(p,3))}function Nz(d,p,w,S){return d==null?[]:(ne(p)||(p=p==null?[]:[p]),w=S?e:w,ne(w)||(w=w==null?[]:[w]),Pk(d,p,w))}var Rz=jp(function(d,p,w){d[w?0:1].push(p)},function(){return[[],[]]});function Az(d,p,w){var S=ne(d)?za:Wa,N=arguments.length<3;return S(d,Gt(p,4),w,N,jo)}function Dz(d,p,w){var S=ne(d)?Ry:Wa,N=arguments.length<3;return S(d,Gt(p,4),w,N,kk)}function Oz(d,p){var w=ne(d)?pr:Sk;return w(d,ig(Gt(p,3)))}function Pz(d){var p=ne(d)?wk:T3;return p(d)}function Fz(d,p,w){(w?_s(d,p,w):p===e)?p=1:p=oe(p);var S=ne(d)?i3:E3;return S(d,p)}function Mz(d){var p=ne(d)?r3:N3;return p(d)}function Lz(d){if(d==null)return 0;if(Ls(d))return og(d)?ol(d):d.length;var p=us(d);return p==pe||p==dn?d.size:qy(d).length}function Bz(d,p,w){var S=ne(d)?E:R3;return w&&_s(d,p,w)&&(p=e),S(d,Gt(p,3))}var zz=de(function(d,p){if(d==null)return[];var w=p.length;return w>1&&_s(d,p[0],p[1])?p=[]:w>2&&_s(p[0],p[1],p[2])&&(p=[p[0]]),Pk(d,ts(p,1),[])}),ng=wL||function(){return Pn.Date.now()};function Wz(d,p){if(typeof p!="function")throw new mi(o);return d=oe(d),function(){if(--d<1)return p.apply(this,arguments)}}function $S(d,p,w){return p=w?e:p,p=d&&p==null?d.length:p,Zr(d,R,e,e,e,e,p)}function NS(d,p){var w;if(typeof p!="function")throw new mi(o);return d=oe(d),function(){return--d>0&&(w=p.apply(this,arguments)),d<=1&&(p=e),w}}var b0=de(function(d,p,w){var S=b;if(w.length){var N=Ho(w,pl(b0));S|=_}return Zr(d,S,p,w,N)}),RS=de(function(d,p,w){var S=b|y;if(w.length){var N=Ho(w,pl(RS));S|=_}return Zr(p,S,d,w,N)});function AS(d,p,w){p=w?e:p;var S=Zr(d,k,e,e,e,e,e,p);return S.placeholder=AS.placeholder,S}function DS(d,p,w){p=w?e:p;var S=Zr(d,I,e,e,e,e,e,p);return S.placeholder=DS.placeholder,S}function OS(d,p,w){var S,N,O,z,U,Q,gt=0,mt=!1,wt=!1,$t=!0;if(typeof d!="function")throw new mi(o);p=vi(p)||0,hn(w)&&(mt=!!w.leading,wt="maxWait"in w,O=wt?Mn(vi(w.maxWait)||0,p):O,$t="trailing"in w?!!w.trailing:$t);function zt(In){var ji=S,so=N;return S=N=e,gt=In,z=d.apply(so,ji),z}function qt(In){return gt=In,U=eh(ge,p),mt?zt(In):z}function ae(In){var ji=In-Q,so=In-gt,QS=p-ji;return wt?ls(QS,O-so):QS}function Kt(In){var ji=In-Q,so=In-gt;return Q===e||ji>=p||ji<0||wt&&so>=O}function ge(){var In=ng();if(Kt(In))return Ce(In);U=eh(ge,ae(In))}function Ce(In){return U=e,$t&&S?zt(In):(S=N=e,z)}function ii(){U!==e&&Hk(U),gt=0,S=Q=N=U=e}function Ts(){return U===e?z:Ce(ng())}function ri(){var In=ng(),ji=Kt(In);if(S=arguments,N=this,Q=In,ji){if(U===e)return qt(Q);if(wt)return Hk(U),U=eh(ge,p),zt(Q)}return U===e&&(U=eh(ge,p)),z}return ri.cancel=ii,ri.flush=Ts,ri}var Vz=de(function(d,p){return Ik(d,1,p)}),Uz=de(function(d,p,w){return Ik(d,vi(p)||0,w)});function Hz(d){return Zr(d,F)}function sg(d,p){if(typeof d!="function"||p!=null&&typeof p!="function")throw new mi(o);var w=function(){var S=arguments,N=p?p.apply(this,S):S[0],O=w.cache;if(O.has(N))return O.get(N);var z=d.apply(this,S);return w.cache=O.set(N,z)||O,z};return w.cache=new(sg.Cache||Yr),w}sg.Cache=Yr;function ig(d){if(typeof d!="function")throw new mi(o);return function(){var p=arguments;switch(p.length){case 0:return!d.call(this);case 1:return!d.call(this,p[0]);case 2:return!d.call(this,p[0],p[1]);case 3:return!d.call(this,p[0],p[1],p[2])}return!d.apply(this,p)}}function Gz(d){return NS(2,d)}var jz=A3(function(d,p){p=p.length==1&&ne(p[0])?Ye(p[0],cs(Gt())):Ye(ts(p,1),cs(Gt()));var w=p.length;return de(function(S){for(var N=-1,O=ls(S.length,w);++N<O;)S[N]=p[N].call(this,S[N]);return ks(d,this,S)})}),x0=de(function(d,p){var w=Ho(p,pl(x0));return Zr(d,_,e,p,w)}),PS=de(function(d,p){var w=Ho(p,pl(PS));return Zr(d,$,e,p,w)}),qz=Qr(function(d,p){return Zr(d,A,e,e,e,p)});function Kz(d,p){if(typeof d!="function")throw new mi(o);return p=p===e?p:oe(p),de(d,p)}function Xz(d,p){if(typeof d!="function")throw new mi(o);return p=p==null?0:Mn(oe(p),0),de(function(w){var S=w[p],N=Xo(w,0,p);return S&&Je(N,S),ks(d,this,N)})}function Yz(d,p,w){var S=!0,N=!0;if(typeof d!="function")throw new mi(o);return hn(w)&&(S="leading"in w?!!w.leading:S,N="trailing"in w?!!w.trailing:N),OS(d,p,{leading:S,maxWait:p,trailing:N})}function Jz(d){return $S(d,1)}function Zz(d,p){return x0(n0(p),d)}function Qz(){if(!arguments.length)return[];var d=arguments[0];return ne(d)?d:[d]}function tW(d){return xi(d,g)}function eW(d,p){return p=typeof p=="function"?p:e,xi(d,g,p)}function nW(d){return xi(d,h|g)}function sW(d,p){return p=typeof p=="function"?p:e,xi(d,h|g,p)}function iW(d,p){return p==null||Ck(d,p,Un(p))}function Gi(d,p){return d===p||d!==d&&p!==p}var rW=Yp(Hy),oW=Yp(function(d,p){return d>=p}),Ya=Ek(function(){return arguments}())?Ek:function(d){return fn(d)&&Be.call(d,"callee")&&!pk.call(d,"callee")},ne=at.isArray,aW=pp?cs(pp):g3;function Ls(d){return d!=null&&rg(d.length)&&!eo(d)}function Cn(d){return fn(d)&&Ls(d)}function cW(d){return d===!0||d===!1||fn(d)&&Ss(d)==Bt}var Yo=CL||$0,lW=gp?cs(gp):m3;function uW(d){return fn(d)&&d.nodeType===1&&!nh(d)}function hW(d){if(d==null)return!0;if(Ls(d)&&(ne(d)||typeof d=="string"||typeof d.splice=="function"||Yo(d)||gl(d)||Ya(d)))return!d.length;var p=us(d);if(p==pe||p==dn)return!d.size;if(th(d))return!qy(d).length;for(var w in d)if(Be.call(d,w))return!1;return!0}function dW(d,p){return Ju(d,p)}function fW(d,p,w){w=typeof w=="function"?w:e;var S=w?w(d,p):e;return S===e?Ju(d,p,e,w):!!S}function y0(d){if(!fn(d))return!1;var p=Ss(d);return p==Yt||p==Jt||typeof d.message=="string"&&typeof d.name=="string"&&!nh(d)}function pW(d){return typeof d=="number"&&mk(d)}function eo(d){if(!hn(d))return!1;var p=Ss(d);return p==re||p==Ee||p==Mt||p==ti}function FS(d){return typeof d=="number"&&d==oe(d)}function rg(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=st}function hn(d){var p=typeof d;return d!=null&&(p=="object"||p=="function")}function fn(d){return d!=null&&typeof d=="object"}var MS=mp?cs(mp):x3;function gW(d,p){return d===p||jy(d,p,l0(p))}function mW(d,p,w){return w=typeof w=="function"?w:e,jy(d,p,l0(p),w)}function bW(d){return LS(d)&&d!=+d}function xW(d){if(eB(d))throw new Qt(r);return $k(d)}function yW(d){return d===null}function wW(d){return d==null}function LS(d){return typeof d=="number"||fn(d)&&Ss(d)==be}function nh(d){if(!fn(d)||Ss(d)!=xe)return!1;var p=Ap(d);if(p===null)return!0;var w=Be.call(p,"constructor")&&p.constructor;return typeof w=="function"&&w instanceof w&&Ep.call(w)==mL}var w0=bp?cs(bp):y3;function vW(d){return FS(d)&&d>=-st&&d<=st}var BS=xp?cs(xp):w3;function og(d){return typeof d=="string"||!ne(d)&&fn(d)&&Ss(d)==vn}function si(d){return typeof d=="symbol"||fn(d)&&Ss(d)==Zn}var gl=yp?cs(yp):v3;function CW(d){return d===e}function IW(d){return fn(d)&&us(d)==he}function kW(d){return fn(d)&&Ss(d)==fi}var SW=Yp(Ky),_W=Yp(function(d,p){return d<=p});function zS(d){if(!d)return[];if(Ls(d))return og(d)?Ui(d):Ms(d);if(Uu&&d[Uu])return Py(d[Uu]());var p=us(d),w=p==pe?rl:p==dn?Sp:ml;return w(d)}function no(d){if(!d)return d===0?d:0;if(d=vi(d),d===it||d===-it){var p=d<0?-1:1;return p*ot}return d===d?d:0}function oe(d){var p=no(d),w=p%1;return p===p?w?p-w:p:0}function WS(d){return d?ja(oe(d),0,ft):0}function vi(d){if(typeof d=="number")return d;if(si(d))return bt;if(hn(d)){var p=typeof d.valueOf=="function"?d.valueOf():d;d=hn(p)?p+"":p}if(typeof d!="string")return d===0?d:+d;d=Cp(d);var w=oy.test(d);return w||Tu.test(d)?Ty(d.slice(2),w?2:8):ry.test(d)?bt:+d}function VS(d){return mr(d,Bs(d))}function TW(d){return d?ja(oe(d),-st,st):d===0?d:0}function Fe(d){return d==null?"":ni(d)}var EW=dl(function(d,p){if(th(p)||Ls(p)){mr(p,Un(p),d);return}for(var w in p)Be.call(p,w)&&Ku(d,w,p[w])}),US=dl(function(d,p){mr(p,Bs(p),d)}),ag=dl(function(d,p,w,S){mr(p,Bs(p),d,S)}),$W=dl(function(d,p,w,S){mr(p,Un(p),d,S)}),NW=Qr(Wy);function RW(d,p){var w=hl(d);return p==null?w:vk(w,p)}var AW=de(function(d,p){d=He(d);var w=-1,S=p.length,N=S>2?p[2]:e;for(N&&_s(p[0],p[1],N)&&(S=1);++w<S;)for(var O=p[w],z=Bs(O),U=-1,Q=z.length;++U<Q;){var gt=z[U],mt=d[gt];(mt===e||Gi(mt,cl[gt])&&!Be.call(d,gt))&&(d[gt]=O[gt])}return d}),DW=de(function(d){return d.push(e,oS),ks(HS,e,d)});function OW(d,p){return B(d,Gt(p,3),gr)}function PW(d,p){return B(d,Gt(p,3),Uy)}function FW(d,p){return d==null?d:Vy(d,Gt(p,3),Bs)}function MW(d,p){return d==null?d:_k(d,Gt(p,3),Bs)}function LW(d,p){return d&&gr(d,Gt(p,3))}function BW(d,p){return d&&Uy(d,Gt(p,3))}function zW(d){return d==null?[]:Vp(d,Un(d))}function WW(d){return d==null?[]:Vp(d,Bs(d))}function v0(d,p,w){var S=d==null?e:qa(d,p);return S===e?w:S}function VW(d,p){return d!=null&&lS(d,p,h3)}function C0(d,p){return d!=null&&lS(d,p,d3)}var UW=eS(function(d,p,w){p!=null&&typeof p.toString!="function"&&(p=$p.call(p)),d[p]=w},k0(zs)),HW=eS(function(d,p,w){p!=null&&typeof p.toString!="function"&&(p=$p.call(p)),Be.call(d,p)?d[p].push(w):d[p]=[w]},Gt),GW=de(Yu);function Un(d){return Ls(d)?yk(d):qy(d)}function Bs(d){return Ls(d)?yk(d,!0):C3(d)}function jW(d,p){var w={};return p=Gt(p,3),gr(d,function(S,N,O){Jr(w,p(S,N,O),S)}),w}function qW(d,p){var w={};return p=Gt(p,3),gr(d,function(S,N,O){Jr(w,N,p(S,N,O))}),w}var KW=dl(function(d,p,w){Up(d,p,w)}),HS=dl(function(d,p,w,S){Up(d,p,w,S)}),XW=Qr(function(d,p){var w={};if(d==null)return w;var S=!1;p=Ye(p,function(O){return O=Ko(O,d),S||(S=O.length>1),O}),mr(d,a0(d),w),S&&(w=xi(w,h|f|g,U3));for(var N=p.length;N--;)Qy(w,p[N]);return w});function YW(d,p){return GS(d,ig(Gt(p)))}var JW=Qr(function(d,p){return d==null?{}:k3(d,p)});function GS(d,p){if(d==null)return{};var w=Ye(a0(d),function(S){return[S]});return p=Gt(p),Fk(d,w,function(S,N){return p(S,N[0])})}function ZW(d,p,w){p=Ko(p,d);var S=-1,N=p.length;for(N||(N=1,d=e);++S<N;){var O=d==null?e:d[br(p[S])];O===e&&(S=N,O=w),d=eo(O)?O.call(d):O}return d}function QW(d,p,w){return d==null?d:Zu(d,p,w)}function tV(d,p,w,S){return S=typeof S=="function"?S:e,d==null?d:Zu(d,p,w,S)}var jS=iS(Un),qS=iS(Bs);function eV(d,p,w){var S=ne(d),N=S||Yo(d)||gl(d);if(p=Gt(p,4),w==null){var O=d&&d.constructor;N?w=S?new O:[]:hn(d)?w=eo(O)?hl(Ap(d)):{}:w={}}return(N?Fs:gr)(d,function(z,U,Q){return p(w,z,U,Q)}),w}function nV(d,p){return d==null?!0:Qy(d,p)}function sV(d,p,w){return d==null?d:Wk(d,p,n0(w))}function iV(d,p,w,S){return S=typeof S=="function"?S:e,d==null?d:Wk(d,p,n0(w),S)}function ml(d){return d==null?[]:Lu(d,Un(d))}function rV(d){return d==null?[]:Lu(d,Bs(d))}function oV(d,p,w){return w===e&&(w=p,p=e),w!==e&&(w=vi(w),w=w===w?w:0),p!==e&&(p=vi(p),p=p===p?p:0),ja(vi(d),p,w)}function aV(d,p,w){return p=no(p),w===e?(w=p,p=0):w=no(w),d=vi(d),f3(d,p,w)}function cV(d,p,w){if(w&&typeof w!="boolean"&&_s(d,p,w)&&(p=w=e),w===e&&(typeof p=="boolean"?(w=p,p=e):typeof d=="boolean"&&(w=d,d=e)),d===e&&p===e?(d=0,p=1):(d=no(d),p===e?(p=d,d=0):p=no(p)),d>p){var S=d;d=p,p=S}if(w||d%1||p%1){var N=bk();return ls(d+N*(p-d+hp("1e-"+((N+"").length-1))),p)}return Yy(d,p)}var lV=fl(function(d,p,w){return p=p.toLowerCase(),d+(w?KS(p):p)});function KS(d){return I0(Fe(d).toLowerCase())}function XS(d){return d=Fe(d),d&&d.replace(cy,Wu).replace(wy,"")}function uV(d,p,w){d=Fe(d),p=ni(p);var S=d.length;w=w===e?S:ja(oe(w),0,S);var N=w;return w-=p.length,w>=0&&d.slice(w,N)==p}function hV(d){return d=Fe(d),d&&Vf.test(d)?d.replace(Gr,Vu):d}function dV(d){return d=Fe(d),d&&Zx.test(d)?d.replace(Lo,"\\$&"):d}var fV=fl(function(d,p,w){return d+(w?"-":"")+p.toLowerCase()}),pV=fl(function(d,p,w){return d+(w?" ":"")+p.toLowerCase()}),gV=Zk("toLowerCase");function mV(d,p,w){d=Fe(d),p=oe(p);var S=p?ol(d):0;if(!p||S>=p)return d;var N=(p-S)/2;return Xp(Fp(N),w)+d+Xp(Pp(N),w)}function bV(d,p,w){d=Fe(d),p=oe(p);var S=p?ol(d):0;return p&&S<p?d+Xp(p-S,w):d}function xV(d,p,w){d=Fe(d),p=oe(p);var S=p?ol(d):0;return p&&S<p?Xp(p-S,w)+d:d}function yV(d,p,w){return w||p==null?p=0:p&&(p=+p),_L(Fe(d).replace(Qc,""),p||0)}function wV(d,p,w){return(w?_s(d,p,w):p===e)?p=1:p=oe(p),Jy(Fe(d),p)}function vV(){var d=arguments,p=Fe(d[0]);return d.length<3?p:p.replace(d[1],d[2])}var CV=fl(function(d,p,w){return d+(w?"_":"")+p.toLowerCase()});function IV(d,p,w){return w&&typeof w!="number"&&_s(d,p,w)&&(p=w=e),w=w===e?ft:w>>>0,w?(d=Fe(d),d&&(typeof p=="string"||p!=null&&!w0(p))&&(p=ni(p),!p&&Uo(d))?Xo(Ui(d),0,w):d.split(p,w)):[]}var kV=fl(function(d,p,w){return d+(w?" ":"")+I0(p)});function SV(d,p,w){return d=Fe(d),w=w==null?0:ja(oe(w),0,d.length),p=ni(p),d.slice(w,w+p.length)==p}function _V(d,p,w){var S=D.templateSettings;w&&_s(d,p,w)&&(p=e),d=Fe(d),p=ag({},p,S,rS);var N=ag({},p.imports,S.imports,rS),O=Un(N),z=Lu(N,O),U,Q,gt=0,mt=p.interpolate||tl,wt="__p += '",$t=Fy((p.escape||tl).source+"|"+mt.source+"|"+(mt===Su?jr:tl).source+"|"+(p.evaluate||tl).source+"|$","g"),zt="//# sourceURL="+(Be.call(p,"sourceURL")?(p.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ky+"]")+`
`;d.replace($t,function(Kt,ge,Ce,ii,Ts,ri){return Ce||(Ce=ii),wt+=d.slice(gt,ri).replace(ly,kp),ge&&(U=!0,wt+=`' +
__e(`+ge+`) +
'`),Ts&&(Q=!0,wt+=`';
`+Ts+`;
__p += '`),Ce&&(wt+=`' +
((__t = (`+Ce+`)) == null ? '' : __t) +
'`),gt=ri+Kt.length,Kt}),wt+=`';
`;var qt=Be.call(p,"variable")&&p.variable;if(!qt)wt=`with (obj) {
`+wt+`
}
`;else if(iy.test(qt))throw new Qt(a);wt=(Q?wt.replace(qx,""):wt).replace(ku,"$1").replace(Vi,"$1;"),wt="function("+(qt||"obj")+`) {
`+(qt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(U?", __e = _.escape":"")+(Q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+wt+`return __p
}`;var ae=JS(function(){return Pe(O,zt+"return "+wt).apply(e,z)});if(ae.source=wt,y0(ae))throw ae;return ae}function TV(d){return Fe(d).toLowerCase()}function EV(d){return Fe(d).toUpperCase()}function $V(d,p,w){if(d=Fe(d),d&&(w||p===e))return Cp(d);if(!d||!(p=ni(p)))return d;var S=Ui(d),N=Ui(p),O=Bu(S,N),z=zu(S,N)+1;return Xo(S,O,z).join("")}function NV(d,p,w){if(d=Fe(d),d&&(w||p===e))return d.slice(0,uk(d)+1);if(!d||!(p=ni(p)))return d;var S=Ui(d),N=zu(S,Ui(p))+1;return Xo(S,0,N).join("")}function RV(d,p,w){if(d=Fe(d),d&&(w||p===e))return d.replace(Qc,"");if(!d||!(p=ni(p)))return d;var S=Ui(d),N=Bu(S,Ui(p));return Xo(S,N).join("")}function AV(d,p){var w=L,S=V;if(hn(p)){var N="separator"in p?p.separator:N;w="length"in p?oe(p.length):w,S="omission"in p?ni(p.omission):S}d=Fe(d);var O=d.length;if(Uo(d)){var z=Ui(d);O=z.length}if(w>=O)return d;var U=w-ol(S);if(U<1)return S;var Q=z?Xo(z,0,U).join(""):d.slice(0,U);if(N===e)return Q+S;if(z&&(U+=Q.length-U),w0(N)){if(d.slice(U).search(N)){var gt,mt=Q;for(N.global||(N=Fy(N.source,Fe(jf.exec(N))+"g")),N.lastIndex=0;gt=N.exec(mt);)var wt=gt.index;Q=Q.slice(0,wt===e?U:wt)}}else if(d.indexOf(ni(N),U)!=U){var $t=Q.lastIndexOf(N);$t>-1&&(Q=Q.slice(0,$t))}return Q+S}function DV(d){return d=Fe(d),d&&Kx.test(d)?d.replace(Wf,cL):d}var OV=fl(function(d,p,w){return d+(w?" ":"")+p.toUpperCase()}),I0=Zk("toUpperCase");function YS(d,p,w){return d=Fe(d),p=w?e:p,p===e?Oy(d)?hL(d):M(d):d.match(p)||[]}var JS=de(function(d,p){try{return ks(d,e,p)}catch(w){return y0(w)?w:new Qt(w)}}),PV=Qr(function(d,p){return Fs(p,function(w){w=br(w),Jr(d,w,b0(d[w],d))}),d});function FV(d){var p=d==null?0:d.length,w=Gt();return d=p?Ye(d,function(S){if(typeof S[1]!="function")throw new mi(o);return[w(S[0]),S[1]]}):[],de(function(S){for(var N=-1;++N<p;){var O=d[N];if(ks(O[0],this,S))return ks(O[1],this,S)}})}function MV(d){return c3(xi(d,h))}function k0(d){return function(){return d}}function LV(d,p){return d==null||d!==d?p:d}var BV=tS(),zV=tS(!0);function zs(d){return d}function S0(d){return Nk(typeof d=="function"?d:xi(d,h))}function WV(d){return Ak(xi(d,h))}function VV(d,p){return Dk(d,xi(p,h))}var UV=de(function(d,p){return function(w){return Yu(w,d,p)}}),HV=de(function(d,p){return function(w){return Yu(d,w,p)}});function _0(d,p,w){var S=Un(p),N=Vp(p,S);w==null&&!(hn(p)&&(N.length||!S.length))&&(w=p,p=d,d=this,N=Vp(p,Un(p)));var O=!(hn(w)&&"chain"in w)||!!w.chain,z=eo(d);return Fs(N,function(U){var Q=p[U];d[U]=Q,z&&(d.prototype[U]=function(){var gt=this.__chain__;if(O||gt){var mt=d(this.__wrapped__),wt=mt.__actions__=Ms(this.__actions__);return wt.push({func:Q,args:arguments,thisArg:d}),mt.__chain__=gt,mt}return Q.apply(d,Je([this.value()],arguments))})}),d}function GV(){return Pn._===this&&(Pn._=bL),this}function T0(){}function jV(d){return d=oe(d),de(function(p){return Ok(p,d)})}var qV=i0(Ye),KV=i0(wp),XV=i0(E);function ZS(d){return h0(d)?$e(br(d)):S3(d)}function YV(d){return function(p){return d==null?e:qa(d,p)}}var JV=nS(),ZV=nS(!0);function E0(){return[]}function $0(){return!1}function QV(){return{}}function tU(){return""}function eU(){return!0}function nU(d,p){if(d=oe(d),d<1||d>st)return[];var w=ft,S=ls(d,ft);p=Gt(p),d-=ft;for(var N=Mu(S,p);++w<d;)p(w);return N}function sU(d){return ne(d)?Ye(d,br):si(d)?[d]:Ms(xS(Fe(d)))}function iU(d){var p=++gL;return Fe(d)+p}var rU=Kp(function(d,p){return d+p},0),oU=r0("ceil"),aU=Kp(function(d,p){return d/p},1),cU=r0("floor");function lU(d){return d&&d.length?Wp(d,zs,Hy):e}function uU(d,p){return d&&d.length?Wp(d,Gt(p,2),Hy):e}function hU(d){return ve(d,zs)}function dU(d,p){return ve(d,Gt(p,2))}function fU(d){return d&&d.length?Wp(d,zs,Ky):e}function pU(d,p){return d&&d.length?Wp(d,Gt(p,2),Ky):e}var gU=Kp(function(d,p){return d*p},1),mU=r0("round"),bU=Kp(function(d,p){return d-p},0);function xU(d){return d&&d.length?il(d,zs):0}function yU(d,p){return d&&d.length?il(d,Gt(p,2)):0}return D.after=Wz,D.ary=$S,D.assign=EW,D.assignIn=US,D.assignInWith=ag,D.assignWith=$W,D.at=NW,D.before=NS,D.bind=b0,D.bindAll=PV,D.bindKey=RS,D.castArray=Qz,D.chain=_S,D.chunk=cB,D.compact=lB,D.concat=uB,D.cond=FV,D.conforms=MV,D.constant=k0,D.countBy=xz,D.create=RW,D.curry=AS,D.curryRight=DS,D.debounce=OS,D.defaults=AW,D.defaultsDeep=DW,D.defer=Vz,D.delay=Uz,D.difference=hB,D.differenceBy=dB,D.differenceWith=fB,D.drop=pB,D.dropRight=gB,D.dropRightWhile=mB,D.dropWhile=bB,D.fill=xB,D.filter=wz,D.flatMap=Iz,D.flatMapDeep=kz,D.flatMapDepth=Sz,D.flatten=CS,D.flattenDeep=yB,D.flattenDepth=wB,D.flip=Hz,D.flow=BV,D.flowRight=zV,D.fromPairs=vB,D.functions=zW,D.functionsIn=WW,D.groupBy=_z,D.initial=IB,D.intersection=kB,D.intersectionBy=SB,D.intersectionWith=_B,D.invert=UW,D.invertBy=HW,D.invokeMap=Ez,D.iteratee=S0,D.keyBy=$z,D.keys=Un,D.keysIn=Bs,D.map=eg,D.mapKeys=jW,D.mapValues=qW,D.matches=WV,D.matchesProperty=VV,D.memoize=sg,D.merge=KW,D.mergeWith=HS,D.method=UV,D.methodOf=HV,D.mixin=_0,D.negate=ig,D.nthArg=jV,D.omit=XW,D.omitBy=YW,D.once=Gz,D.orderBy=Nz,D.over=qV,D.overArgs=jz,D.overEvery=KV,D.overSome=XV,D.partial=x0,D.partialRight=PS,D.partition=Rz,D.pick=JW,D.pickBy=GS,D.property=ZS,D.propertyOf=YV,D.pull=NB,D.pullAll=kS,D.pullAllBy=RB,D.pullAllWith=AB,D.pullAt=DB,D.range=JV,D.rangeRight=ZV,D.rearg=qz,D.reject=Oz,D.remove=OB,D.rest=Kz,D.reverse=g0,D.sampleSize=Fz,D.set=QW,D.setWith=tV,D.shuffle=Mz,D.slice=PB,D.sortBy=zz,D.sortedUniq=VB,D.sortedUniqBy=UB,D.split=IV,D.spread=Xz,D.tail=HB,D.take=GB,D.takeRight=jB,D.takeRightWhile=qB,D.takeWhile=KB,D.tap=lz,D.throttle=Yz,D.thru=tg,D.toArray=zS,D.toPairs=jS,D.toPairsIn=qS,D.toPath=sU,D.toPlainObject=VS,D.transform=eV,D.unary=Jz,D.union=XB,D.unionBy=YB,D.unionWith=JB,D.uniq=ZB,D.uniqBy=QB,D.uniqWith=tz,D.unset=nV,D.unzip=m0,D.unzipWith=SS,D.update=sV,D.updateWith=iV,D.values=ml,D.valuesIn=rV,D.without=ez,D.words=YS,D.wrap=Zz,D.xor=nz,D.xorBy=sz,D.xorWith=iz,D.zip=rz,D.zipObject=oz,D.zipObjectDeep=az,D.zipWith=cz,D.entries=jS,D.entriesIn=qS,D.extend=US,D.extendWith=ag,_0(D,D),D.add=rU,D.attempt=JS,D.camelCase=lV,D.capitalize=KS,D.ceil=oU,D.clamp=oV,D.clone=tW,D.cloneDeep=nW,D.cloneDeepWith=sW,D.cloneWith=eW,D.conformsTo=iW,D.deburr=XS,D.defaultTo=LV,D.divide=aU,D.endsWith=uV,D.eq=Gi,D.escape=hV,D.escapeRegExp=dV,D.every=yz,D.find=vz,D.findIndex=wS,D.findKey=OW,D.findLast=Cz,D.findLastIndex=vS,D.findLastKey=PW,D.floor=cU,D.forEach=TS,D.forEachRight=ES,D.forIn=FW,D.forInRight=MW,D.forOwn=LW,D.forOwnRight=BW,D.get=v0,D.gt=rW,D.gte=oW,D.has=VW,D.hasIn=C0,D.head=IS,D.identity=zs,D.includes=Tz,D.indexOf=CB,D.inRange=aV,D.invoke=GW,D.isArguments=Ya,D.isArray=ne,D.isArrayBuffer=aW,D.isArrayLike=Ls,D.isArrayLikeObject=Cn,D.isBoolean=cW,D.isBuffer=Yo,D.isDate=lW,D.isElement=uW,D.isEmpty=hW,D.isEqual=dW,D.isEqualWith=fW,D.isError=y0,D.isFinite=pW,D.isFunction=eo,D.isInteger=FS,D.isLength=rg,D.isMap=MS,D.isMatch=gW,D.isMatchWith=mW,D.isNaN=bW,D.isNative=xW,D.isNil=wW,D.isNull=yW,D.isNumber=LS,D.isObject=hn,D.isObjectLike=fn,D.isPlainObject=nh,D.isRegExp=w0,D.isSafeInteger=vW,D.isSet=BS,D.isString=og,D.isSymbol=si,D.isTypedArray=gl,D.isUndefined=CW,D.isWeakMap=IW,D.isWeakSet=kW,D.join=TB,D.kebabCase=fV,D.last=wi,D.lastIndexOf=EB,D.lowerCase=pV,D.lowerFirst=gV,D.lt=SW,D.lte=_W,D.max=lU,D.maxBy=uU,D.mean=hU,D.meanBy=dU,D.min=fU,D.minBy=pU,D.stubArray=E0,D.stubFalse=$0,D.stubObject=QV,D.stubString=tU,D.stubTrue=eU,D.multiply=gU,D.nth=$B,D.noConflict=GV,D.noop=T0,D.now=ng,D.pad=mV,D.padEnd=bV,D.padStart=xV,D.parseInt=yV,D.random=cV,D.reduce=Az,D.reduceRight=Dz,D.repeat=wV,D.replace=vV,D.result=ZW,D.round=mU,D.runInContext=X,D.sample=Pz,D.size=Lz,D.snakeCase=CV,D.some=Bz,D.sortedIndex=FB,D.sortedIndexBy=MB,D.sortedIndexOf=LB,D.sortedLastIndex=BB,D.sortedLastIndexBy=zB,D.sortedLastIndexOf=WB,D.startCase=kV,D.startsWith=SV,D.subtract=bU,D.sum=xU,D.sumBy=yU,D.template=_V,D.times=nU,D.toFinite=no,D.toInteger=oe,D.toLength=WS,D.toLower=TV,D.toNumber=vi,D.toSafeInteger=TW,D.toString=Fe,D.toUpper=EV,D.trim=$V,D.trimEnd=NV,D.trimStart=RV,D.truncate=AV,D.unescape=DV,D.uniqueId=iU,D.upperCase=OV,D.upperFirst=I0,D.each=TS,D.eachRight=ES,D.first=IS,_0(D,function(){var d={};return gr(D,function(p,w){Be.call(D.prototype,w)||(d[w]=p)}),d}(),{chain:!1}),D.VERSION=s,Fs(["bind","bindKey","curry","curryRight","partial","partialRight"],function(d){D[d].placeholder=D}),Fs(["drop","take"],function(d,p){ye.prototype[d]=function(w){w=w===e?1:Mn(oe(w),0);var S=this.__filtered__&&!p?new ye(this):this.clone();return S.__filtered__?S.__takeCount__=ls(w,S.__takeCount__):S.__views__.push({size:ls(w,ft),type:d+(S.__dir__<0?"Right":"")}),S},ye.prototype[d+"Right"]=function(w){return this.reverse()[d](w).reverse()}}),Fs(["filter","map","takeWhile"],function(d,p){var w=p+1,S=w==et||w==tt;ye.prototype[d]=function(N){var O=this.clone();return O.__iteratees__.push({iteratee:Gt(N,3),type:w}),O.__filtered__=O.__filtered__||S,O}}),Fs(["head","last"],function(d,p){var w="take"+(p?"Right":"");ye.prototype[d]=function(){return this[w](1).value()[0]}}),Fs(["initial","tail"],function(d,p){var w="drop"+(p?"":"Right");ye.prototype[d]=function(){return this.__filtered__?new ye(this):this[w](1)}}),ye.prototype.compact=function(){return this.filter(zs)},ye.prototype.find=function(d){return this.filter(d).head()},ye.prototype.findLast=function(d){return this.reverse().find(d)},ye.prototype.invokeMap=de(function(d,p){return typeof d=="function"?new ye(this):this.map(function(w){return Yu(w,d,p)})}),ye.prototype.reject=function(d){return this.filter(ig(Gt(d)))},ye.prototype.slice=function(d,p){d=oe(d);var w=this;return w.__filtered__&&(d>0||p<0)?new ye(w):(d<0?w=w.takeRight(-d):d&&(w=w.drop(d)),p!==e&&(p=oe(p),w=p<0?w.dropRight(-p):w.take(p-d)),w)},ye.prototype.takeRightWhile=function(d){return this.reverse().takeWhile(d).reverse()},ye.prototype.toArray=function(){return this.take(ft)},gr(ye.prototype,function(d,p){var w=/^(?:filter|find|map|reject)|While$/.test(p),S=/^(?:head|last)$/.test(p),N=D[S?"take"+(p=="last"?"Right":""):p],O=S||/^find/.test(p);N&&(D.prototype[p]=function(){var z=this.__wrapped__,U=S?[1]:arguments,Q=z instanceof ye,gt=U[0],mt=Q||ne(z),wt=function(ge){var Ce=N.apply(D,Je([ge],U));return S&&$t?Ce[0]:Ce};mt&&w&&typeof gt=="function"&&gt.length!=1&&(Q=mt=!1);var $t=this.__chain__,zt=!!this.__actions__.length,qt=O&&!$t,ae=Q&&!zt;if(!O&&mt){z=ae?z:new ye(this);var Kt=d.apply(z,U);return Kt.__actions__.push({func:tg,args:[wt],thisArg:e}),new bi(Kt,$t)}return qt&&ae?d.apply(this,U):(Kt=this.thru(wt),qt?S?Kt.value()[0]:Kt.value():Kt)})}),Fs(["pop","push","shift","sort","splice","unshift"],function(d){var p=_p[d],w=/^(?:push|sort|unshift)$/.test(d)?"tap":"thru",S=/^(?:pop|shift)$/.test(d);D.prototype[d]=function(){var N=arguments;if(S&&!this.__chain__){var O=this.value();return p.apply(ne(O)?O:[],N)}return this[w](function(z){return p.apply(ne(z)?z:[],N)})}}),gr(ye.prototype,function(d,p){var w=D[p];if(w){var S=w.name+"";Be.call(ul,S)||(ul[S]=[]),ul[S].push({name:p,func:w})}}),ul[qp(e,y).name]=[{name:"wrapper",func:e}],ye.prototype.clone=DL,ye.prototype.reverse=OL,ye.prototype.value=PL,D.prototype.at=uz,D.prototype.chain=hz,D.prototype.commit=dz,D.prototype.next=fz,D.prototype.plant=gz,D.prototype.reverse=mz,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=bz,D.prototype.first=D.prototype.head,Uu&&(D.prototype[Uu]=pz),D},al=dL();Vo?((Vo.exports=al)._=al,Ou._=al):Pn._=al}).call(Ti)})(rm,rm.exports);rm.exports;function Eh(n){"@babel/helpers - typeof";return Eh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eh(n)}function qn(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function f_(n,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function Kn(n,t,e){return t&&f_(n.prototype,t),e&&f_(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function Bh(){return Bh=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},Bh.apply(this,arguments)}function Js(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Sw(n,t)}function om(n){return om=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},om(n)}function Sw(n,t){return Sw=Object.setPrototypeOf||function(s,i){return s.__proto__=i,s},Sw(n,t)}function iH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rH(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function oH(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rH(n)}function Zs(n){var t=iH();return function(){var s=om(n),i;if(t){var r=om(this).constructor;i=Reflect.construct(s,arguments,r)}else i=s.apply(this,arguments);return oH(this,i)}}var Wv=function(){function n(){qn(this,n)}return Kn(n,[{key:"listenForWhisper",value:function(e,s){return this.listen(".client-"+e,s)}},{key:"notification",value:function(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}},{key:"stopListeningForWhisper",value:function(e,s){return this.stopListening(".client-"+e,s)}}]),n}(),w2=function(){function n(t){qn(this,n),this.namespace=t}return Kn(n,[{key:"format",value:function(e){return[".","\\"].includes(e.charAt(0))?e.substring(1):(this.namespace&&(e=this.namespace+"."+e),e.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(e){this.namespace=e}}]),n}();function aH(n){try{new n}catch(t){if(t.message.includes("is not a constructor"))return!1}return!0}var Vv=function(n){Js(e,n);var t=Zs(e);function e(s,i,r){var o;return qn(this,e),o=t.call(this),o.name=i,o.pusher=s,o.options=r,o.eventFormatter=new w2(o.options.namespace),o.subscribe(),o}return Kn(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(i,r){return this.on(this.eventFormatter.format(i),r),this}},{key:"listenToAll",value:function(i){var r=this;return this.subscription.bind_global(function(o,a){if(!o.startsWith("pusher:")){var c=r.options.namespace.replace(/\./g,"\\"),l=o.startsWith(c)?o.substring(c.length+1):"."+o;i(l,a)}}),this}},{key:"stopListening",value:function(i,r){return r?this.subscription.unbind(this.eventFormatter.format(i),r):this.subscription.unbind(this.eventFormatter.format(i)),this}},{key:"stopListeningToAll",value:function(i){return i?this.subscription.unbind_global(i):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(i){return this.on("pusher:subscription_succeeded",function(){i()}),this}},{key:"error",value:function(i){return this.on("pusher:subscription_error",function(r){i(r)}),this}},{key:"on",value:function(i,r){return this.subscription.bind(i,r),this}}]),e}(Wv),v2=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"whisper",value:function(i,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(i),r),this}}]),e}(Vv),cH=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"whisper",value:function(i,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(i),r),this}}]),e}(Vv),lH=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"here",value:function(i){return this.on("pusher:subscription_succeeded",function(r){i(Object.keys(r.members).map(function(o){return r.members[o]}))}),this}},{key:"joining",value:function(i){return this.on("pusher:member_added",function(r){i(r.info)}),this}},{key:"whisper",value:function(i,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(i),r),this}},{key:"leaving",value:function(i){return this.on("pusher:member_removed",function(r){i(r.info)}),this}}]),e}(v2),C2=function(n){Js(e,n);var t=Zs(e);function e(s,i,r){var o;return qn(this,e),o=t.call(this),o.events={},o.listeners={},o.name=i,o.socket=s,o.options=r,o.eventFormatter=new w2(o.options.namespace),o.subscribe(),o}return Kn(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(i,r){return this.on(this.eventFormatter.format(i),r),this}},{key:"stopListening",value:function(i,r){return this.unbindEvent(this.eventFormatter.format(i),r),this}},{key:"subscribed",value:function(i){return this.on("connect",function(r){i(r)}),this}},{key:"error",value:function(i){return this}},{key:"on",value:function(i,r){var o=this;return this.listeners[i]=this.listeners[i]||[],this.events[i]||(this.events[i]=function(a,c){o.name===a&&o.listeners[i]&&o.listeners[i].forEach(function(l){return l(c)})},this.socket.on(i,this.events[i])),this.listeners[i].push(r),this}},{key:"unbind",value:function(){var i=this;Object.keys(this.events).forEach(function(r){i.unbindEvent(r)})}},{key:"unbindEvent",value:function(i,r){this.listeners[i]=this.listeners[i]||[],r&&(this.listeners[i]=this.listeners[i].filter(function(o){return o!==r})),(!r||this.listeners[i].length===0)&&(this.events[i]&&(this.socket.removeListener(i,this.events[i]),delete this.events[i]),delete this.listeners[i])}}]),e}(Wv),I2=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"whisper",value:function(i,r){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(i),data:r}),this}}]),e}(C2),uH=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"here",value:function(i){return this.on("presence:subscribed",function(r){i(r.map(function(o){return o.user_info}))}),this}},{key:"joining",value:function(i){return this.on("presence:joining",function(r){return i(r.user_info)}),this}},{key:"whisper",value:function(i,r){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(i),data:r}),this}},{key:"leaving",value:function(i){return this.on("presence:leaving",function(r){return i(r.user_info)}),this}}]),e}(I2),am=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(i,r){return this}},{key:"listenToAll",value:function(i){return this}},{key:"stopListening",value:function(i,r){return this}},{key:"subscribed",value:function(i){return this}},{key:"error",value:function(i){return this}},{key:"on",value:function(i,r){return this}}]),e}(Wv),k2=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"whisper",value:function(i,r){return this}}]),e}(am),hH=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"whisper",value:function(i,r){return this}}]),e}(am),dH=function(n){Js(e,n);var t=Zs(e);function e(){return qn(this,e),t.apply(this,arguments)}return Kn(e,[{key:"here",value:function(i){return this}},{key:"joining",value:function(i){return this}},{key:"whisper",value:function(i,r){return this}},{key:"leaving",value:function(i){return this}}]),e}(k2),Uv=function(){function n(t){qn(this,n),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(t),this.connect()}return Kn(n,[{key:"setOptions",value:function(e){this.options=Bh(this._defaultOptions,e);var s=this.csrfToken();return s&&(this.options.auth.headers["X-CSRF-TOKEN"]=s,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=s),s=this.options.bearerToken,s&&(this.options.auth.headers.Authorization="Bearer "+s,this.options.userAuthentication.headers.Authorization="Bearer "+s),e}},{key:"csrfToken",value:function(){var e;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(e=document.querySelector('meta[name="csrf-token"]'))?e.getAttribute("content"):null}}]),n}(),p_=function(n){Js(e,n);var t=Zs(e);function e(){var s;return qn(this,e),s=t.apply(this,arguments),s.channels={},s}return Kn(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(i,r,o){return this.channel(i).listen(r,o)}},{key:"channel",value:function(i){return this.channels[i]||(this.channels[i]=new Vv(this.pusher,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(i){return this.channels["private-"+i]||(this.channels["private-"+i]=new v2(this.pusher,"private-"+i,this.options)),this.channels["private-"+i]}},{key:"encryptedPrivateChannel",value:function(i){return this.channels["private-encrypted-"+i]||(this.channels["private-encrypted-"+i]=new cH(this.pusher,"private-encrypted-"+i,this.options)),this.channels["private-encrypted-"+i]}},{key:"presenceChannel",value:function(i){return this.channels["presence-"+i]||(this.channels["presence-"+i]=new lH(this.pusher,"presence-"+i,this.options)),this.channels["presence-"+i]}},{key:"leave",value:function(i){var r=this,o=[i,"private-"+i,"private-encrypted-"+i,"presence-"+i];o.forEach(function(a,c){r.leaveChannel(a)})}},{key:"leaveChannel",value:function(i){this.channels[i]&&(this.channels[i].unsubscribe(),delete this.channels[i])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),e}(Uv),g_=function(n){Js(e,n);var t=Zs(e);function e(){var s;return qn(this,e),s=t.apply(this,arguments),s.channels={},s}return Kn(e,[{key:"connect",value:function(){var i=this,r=this.getSocketIO();return this.socket=r(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(i.channels).forEach(function(o){o.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(i,r,o){return this.channel(i).listen(r,o)}},{key:"channel",value:function(i){return this.channels[i]||(this.channels[i]=new C2(this.socket,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(i){return this.channels["private-"+i]||(this.channels["private-"+i]=new I2(this.socket,"private-"+i,this.options)),this.channels["private-"+i]}},{key:"presenceChannel",value:function(i){return this.channels["presence-"+i]||(this.channels["presence-"+i]=new uH(this.socket,"presence-"+i,this.options)),this.channels["presence-"+i]}},{key:"leave",value:function(i){var r=this,o=[i,"private-"+i,"presence-"+i];o.forEach(function(a){r.leaveChannel(a)})}},{key:"leaveChannel",value:function(i){this.channels[i]&&(this.channels[i].unsubscribe(),delete this.channels[i])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),e}(Uv),fH=function(n){Js(e,n);var t=Zs(e);function e(){var s;return qn(this,e),s=t.apply(this,arguments),s.channels={},s}return Kn(e,[{key:"connect",value:function(){}},{key:"listen",value:function(i,r,o){return new am}},{key:"channel",value:function(i){return new am}},{key:"privateChannel",value:function(i){return new k2}},{key:"encryptedPrivateChannel",value:function(i){return new hH}},{key:"presenceChannel",value:function(i){return new dH}},{key:"leave",value:function(i){}},{key:"leaveChannel",value:function(i){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),e}(Uv),pH=function(){function n(t){qn(this,n),this.options=t,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return Kn(n,[{key:"channel",value:function(e){return this.connector.channel(e)}},{key:"connect",value:function(){if(this.options.broadcaster=="reverb")this.connector=new p_(Bh(Bh({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new p_(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new g_(this.options);else if(this.options.broadcaster=="null")this.connector=new fH(this.options);else if(typeof this.options.broadcaster=="function"&&aH(this.options.broadcaster))this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(Eh(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(e){return this.connector.presenceChannel(e)}},{key:"leave",value:function(e){this.connector.leave(e)}},{key:"leaveChannel",value:function(e){this.connector.leaveChannel(e)}},{key:"leaveAllChannels",value:function(){for(var e in this.connector.channels)this.leaveChannel(e)}},{key:"listen",value:function(e,s,i){return this.connector.listen(e,s,i)}},{key:"private",value:function(e){return this.connector.privateChannel(e)}},{key:"encryptedPrivate",value:function(e){if(this.connector instanceof g_)throw new Error("Broadcaster ".concat(Eh(this.options.broadcaster)," ").concat(this.options.broadcaster," does not support encrypted private channels."));return this.connector.encryptedPrivateChannel(e)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":Eh(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var e=this;Vue.http.interceptors.push(function(s,i){e.socketId()&&s.headers.set("X-Socket-ID",e.socketId()),i()})}},{key:"registerAxiosRequestInterceptor",value:function(){var e=this;axios.interceptors.request.use(function(s){return e.socketId()&&(s.headers["X-Socket-Id"]=e.socketId()),s})}},{key:"registerjQueryAjaxSetup",value:function(){var e=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(s,i,r){e.socketId()&&r.setRequestHeader("X-Socket-Id",e.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var e=this;document.addEventListener("turbo:before-fetch-request",function(s){s.detail.fetchOptions.headers["X-Socket-Id"]=e.socketId()})}}]),n}(),S2={exports:{}};/*!
 * Pusher JavaScript Library v8.4.0
 * https://pusher.com/
 *
 * Copyright 2020, Pusher
 * Released under the MIT licence.
 */(function(n,t){(function(s,i){n.exports=i()})(window,function(){return function(e){var s={};function i(r){if(s[r])return s[r].exports;var o=s[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=s,i.d=function(r,o,a){i.o(r,o)||Object.defineProperty(r,o,{enumerable:!0,get:a})},i.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i.t=function(r,o){if(o&1&&(r=i(r)),o&8||o&4&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),o&2&&typeof r!="string")for(var c in r)i.d(a,c,(function(l){return r[l]}).bind(null,c));return a},i.n=function(r){var o=r&&r.__esModule?function(){return r.default}:function(){return r};return i.d(o,"a",o),o},i.o=function(r,o){return Object.prototype.hasOwnProperty.call(r,o)},i.p="",i(i.s=2)}([function(e,s,i){var r=this&&this.__extends||function(){var x=function(b,y){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,k){v.__proto__=k}||function(v,k){for(var I in k)k.hasOwnProperty(I)&&(v[I]=k[I])},x(b,y)};return function(b,y){x(b,y);function v(){this.constructor=b}b.prototype=y===null?Object.create(y):(v.prototype=y.prototype,new v)}}();Object.defineProperty(s,"__esModule",{value:!0});var o=256,a=function(){function x(b){b===void 0&&(b="="),this._paddingCharacter=b}return x.prototype.encodedLength=function(b){return this._paddingCharacter?(b+2)/3*4|0:(b*8+5)/6|0},x.prototype.encode=function(b){for(var y="",v=0;v<b.length-2;v+=3){var k=b[v]<<16|b[v+1]<<8|b[v+2];y+=this._encodeByte(k>>>3*6&63),y+=this._encodeByte(k>>>2*6&63),y+=this._encodeByte(k>>>1*6&63),y+=this._encodeByte(k>>>0*6&63)}var I=b.length-v;if(I>0){var k=b[v]<<16|(I===2?b[v+1]<<8:0);y+=this._encodeByte(k>>>3*6&63),y+=this._encodeByte(k>>>2*6&63),I===2?y+=this._encodeByte(k>>>1*6&63):y+=this._paddingCharacter||"",y+=this._paddingCharacter||""}return y},x.prototype.maxDecodedLength=function(b){return this._paddingCharacter?b/4*3|0:(b*6+7)/8|0},x.prototype.decodedLength=function(b){return this.maxDecodedLength(b.length-this._getPaddingLength(b))},x.prototype.decode=function(b){if(b.length===0)return new Uint8Array(0);for(var y=this._getPaddingLength(b),v=b.length-y,k=new Uint8Array(this.maxDecodedLength(v)),I=0,_=0,$=0,R=0,A=0,F=0,L=0;_<v-4;_+=4)R=this._decodeChar(b.charCodeAt(_+0)),A=this._decodeChar(b.charCodeAt(_+1)),F=this._decodeChar(b.charCodeAt(_+2)),L=this._decodeChar(b.charCodeAt(_+3)),k[I++]=R<<2|A>>>4,k[I++]=A<<4|F>>>2,k[I++]=F<<6|L,$|=R&o,$|=A&o,$|=F&o,$|=L&o;if(_<v-1&&(R=this._decodeChar(b.charCodeAt(_)),A=this._decodeChar(b.charCodeAt(_+1)),k[I++]=R<<2|A>>>4,$|=R&o,$|=A&o),_<v-2&&(F=this._decodeChar(b.charCodeAt(_+2)),k[I++]=A<<4|F>>>2,$|=F&o),_<v-3&&(L=this._decodeChar(b.charCodeAt(_+3)),k[I++]=F<<6|L,$|=L&o),$!==0)throw new Error("Base64Coder: incorrect characters for decoding");return k},x.prototype._encodeByte=function(b){var y=b;return y+=65,y+=25-b>>>8&0-65-26+97,y+=51-b>>>8&26-97-52+48,y+=61-b>>>8&52-48-62+43,y+=62-b>>>8&62-43-63+47,String.fromCharCode(y)},x.prototype._decodeChar=function(b){var y=o;return y+=(42-b&b-44)>>>8&-o+b-43+62,y+=(46-b&b-48)>>>8&-o+b-47+63,y+=(47-b&b-58)>>>8&-o+b-48+52,y+=(64-b&b-91)>>>8&-o+b-65+0,y+=(96-b&b-123)>>>8&-o+b-97+26,y},x.prototype._getPaddingLength=function(b){var y=0;if(this._paddingCharacter){for(var v=b.length-1;v>=0&&b[v]===this._paddingCharacter;v--)y++;if(b.length<4||y>2)throw new Error("Base64Coder: incorrect padding")}return y},x}();s.Coder=a;var c=new a;function l(x){return c.encode(x)}s.encode=l;function u(x){return c.decode(x)}s.decode=u;var h=function(x){r(b,x);function b(){return x!==null&&x.apply(this,arguments)||this}return b.prototype._encodeByte=function(y){var v=y;return v+=65,v+=25-y>>>8&0-65-26+97,v+=51-y>>>8&26-97-52+48,v+=61-y>>>8&52-48-62+45,v+=62-y>>>8&62-45-63+95,String.fromCharCode(v)},b.prototype._decodeChar=function(y){var v=o;return v+=(44-y&y-46)>>>8&-o+y-45+62,v+=(94-y&y-96)>>>8&-o+y-95+63,v+=(47-y&y-58)>>>8&-o+y-48+52,v+=(64-y&y-91)>>>8&-o+y-65+0,v+=(96-y&y-123)>>>8&-o+y-97+26,v},b}(a);s.URLSafeCoder=h;var f=new h;function g(x){return f.encode(x)}s.encodeURLSafe=g;function m(x){return f.decode(x)}s.decodeURLSafe=m,s.encodedLength=function(x){return c.encodedLength(x)},s.maxDecodedLength=function(x){return c.maxDecodedLength(x)},s.decodedLength=function(x){return c.decodedLength(x)}},function(e,s,i){Object.defineProperty(s,"__esModule",{value:!0});var r="utf8: invalid string",o="utf8: invalid source encoding";function a(u){for(var h=new Uint8Array(c(u)),f=0,g=0;g<u.length;g++){var m=u.charCodeAt(g);m<128?h[f++]=m:m<2048?(h[f++]=192|m>>6,h[f++]=128|m&63):m<55296?(h[f++]=224|m>>12,h[f++]=128|m>>6&63,h[f++]=128|m&63):(g++,m=(m&1023)<<10,m|=u.charCodeAt(g)&1023,m+=65536,h[f++]=240|m>>18,h[f++]=128|m>>12&63,h[f++]=128|m>>6&63,h[f++]=128|m&63)}return h}s.encode=a;function c(u){for(var h=0,f=0;f<u.length;f++){var g=u.charCodeAt(f);if(g<128)h+=1;else if(g<2048)h+=2;else if(g<55296)h+=3;else if(g<=57343){if(f>=u.length-1)throw new Error(r);f++,h+=4}else throw new Error(r)}return h}s.encodedLength=c;function l(u){for(var h=[],f=0;f<u.length;f++){var g=u[f];if(g&128){var m=void 0;if(g<224){if(f>=u.length)throw new Error(o);var x=u[++f];if((x&192)!==128)throw new Error(o);g=(g&31)<<6|x&63,m=128}else if(g<240){if(f>=u.length-1)throw new Error(o);var x=u[++f],b=u[++f];if((x&192)!==128||(b&192)!==128)throw new Error(o);g=(g&15)<<12|(x&63)<<6|b&63,m=2048}else if(g<248){if(f>=u.length-2)throw new Error(o);var x=u[++f],b=u[++f],y=u[++f];if((x&192)!==128||(b&192)!==128||(y&192)!==128)throw new Error(o);g=(g&15)<<18|(x&63)<<12|(b&63)<<6|y&63,m=65536}else throw new Error(o);if(g<m||g>=55296&&g<=57343)throw new Error(o);if(g>=65536){if(g>1114111)throw new Error(o);g-=65536,h.push(String.fromCharCode(55296|g>>10)),g=56320|g&1023}}h.push(String.fromCharCode(g))}return h.join("")}s.decode=l},function(e,s,i){e.exports=i(3).default},function(e,s,i){i.r(s);class r{constructor(C,T){this.lastId=0,this.prefix=C,this.name=T}create(C){this.lastId++;var T=this.lastId,M=this.prefix+T,B=this.name+"["+T+"]",ht=!1,kt=function(){ht||(C.apply(null,arguments),ht=!0)};return this[T]=kt,{number:T,id:M,name:B,callback:kt}}remove(C){delete this[C.number]}}var o=new r("_pusher_script_","Pusher.ScriptReceivers"),a={VERSION:"8.4.0",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},c=a;class l{constructor(C){this.options=C,this.receivers=C.receivers||o,this.loading={}}load(C,T,M){var B=this;if(B.loading[C]&&B.loading[C].length>0)B.loading[C].push(M);else{B.loading[C]=[M];var ht=Dt.createScriptRequest(B.getPath(C,T)),kt=B.receivers.create(function(Lt){if(B.receivers.remove(kt),B.loading[C]){var Zt=B.loading[C];delete B.loading[C];for(var ve=function(an){an||ht.cleanup()},$e=0;$e<Zt.length;$e++)Zt[$e](Lt,ve)}});ht.send(kt)}}getRoot(C){var T,M=Dt.getDocument().location.protocol;return C&&C.useTLS||M==="https:"?T=this.options.cdn_https:T=this.options.cdn_http,T.replace(/\/*$/,"")+"/"+this.options.version}getPath(C,T){return this.getRoot(T)+"/"+C+this.options.suffix+".js"}}var u=new r("_pusher_dependencies","Pusher.DependenciesReceivers"),h=new l({cdn_http:c.cdn_http,cdn_https:c.cdn_https,version:c.VERSION,suffix:c.dependency_suffix,receivers:u});const f={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var m={buildLogSuffix:function(E){const C="See:",T=f.urls[E];if(!T)return"";let M;return T.fullUrl?M=T.fullUrl:T.path&&(M=f.baseUrl+T.path),M?`${C} ${M}`:""}},x;(function(E){E.UserAuthentication="user-authentication",E.ChannelAuthorization="channel-authorization"})(x||(x={}));class b extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class y extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class v extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class k extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class I extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class _ extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class $ extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class R extends Error{constructor(C){super(C),Object.setPrototypeOf(this,new.target.prototype)}}class A extends Error{constructor(C,T){super(T),this.status=C,Object.setPrototypeOf(this,new.target.prototype)}}var L=function(E,C,T,M,B){const ht=Dt.createXHR();ht.open("POST",T.endpoint,!0),ht.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var kt in T.headers)ht.setRequestHeader(kt,T.headers[kt]);if(T.headersProvider!=null){let Lt=T.headersProvider();for(var kt in Lt)ht.setRequestHeader(kt,Lt[kt])}return ht.onreadystatechange=function(){if(ht.readyState===4)if(ht.status===200){let Lt,Zt=!1;try{Lt=JSON.parse(ht.responseText),Zt=!0}catch{B(new A(200,`JSON returned from ${M.toString()} endpoint was invalid, yet status code was 200. Data was: ${ht.responseText}`),null)}Zt&&B(null,Lt)}else{let Lt="";switch(M){case x.UserAuthentication:Lt=m.buildLogSuffix("authenticationEndpoint");break;case x.ChannelAuthorization:Lt=`Clients must be authorized to join private or presence channels. ${m.buildLogSuffix("authorizationEndpoint")}`;break}B(new A(ht.status,`Unable to retrieve auth string from ${M.toString()} endpoint - received status: ${ht.status} from ${T.endpoint}. ${Lt}`),null)}},ht.send(C),ht};function V(E){return it(K(E))}var j=String.fromCharCode,Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",et=function(E){var C=E.charCodeAt(0);return C<128?E:C<2048?j(192|C>>>6)+j(128|C&63):j(224|C>>>12&15)+j(128|C>>>6&63)+j(128|C&63)},K=function(E){return E.replace(/[^\x00-\x7F]/g,et)},tt=function(E){var C=[0,2,1][E.length%3],T=E.charCodeAt(0)<<16|(E.length>1?E.charCodeAt(1):0)<<8|(E.length>2?E.charCodeAt(2):0),M=[Z.charAt(T>>>18),Z.charAt(T>>>12&63),C>=2?"=":Z.charAt(T>>>6&63),C>=1?"=":Z.charAt(T&63)];return M.join("")},it=window.btoa||function(E){return E.replace(/[\s\S]{1,3}/g,tt)};class st{constructor(C,T,M,B){this.clear=T,this.timer=C(()=>{this.timer&&(this.timer=B(this.timer))},M)}isRunning(){return this.timer!==null}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}}var ot=st;function bt(E){window.clearTimeout(E)}function ft(E){window.clearInterval(E)}class yt extends ot{constructor(C,T){super(setTimeout,bt,C,function(M){return T(),null})}}class vt extends ot{constructor(C,T){super(setInterval,ft,C,function(M){return T(),M})}}var St={now(){return Date.now?Date.now():new Date().valueOf()},defer(E){return new yt(0,E)},method(E,...C){var T=Array.prototype.slice.call(arguments,1);return function(M){return M[E].apply(M,T.concat(arguments))}}},pt=St;function Ct(E,...C){for(var T=0;T<C.length;T++){var M=C[T];for(var B in M)M[B]&&M[B].constructor&&M[B].constructor===Object?E[B]=Ct(E[B]||{},M[B]):E[B]=M[B]}return E}function Mt(){for(var E=["Pusher"],C=0;C<arguments.length;C++)typeof arguments[C]=="string"?E.push(arguments[C]):E.push(Zn(arguments[C]));return E.join(" : ")}function Bt(E,C){var T=Array.prototype.indexOf;if(E===null)return-1;if(T&&E.indexOf===T)return E.indexOf(C);for(var M=0,B=E.length;M<B;M++)if(E[M]===C)return M;return-1}function At(E,C){for(var T in E)Object.prototype.hasOwnProperty.call(E,T)&&C(E[T],T,E)}function Jt(E){var C=[];return At(E,function(T,M){C.push(M)}),C}function Yt(E){var C=[];return At(E,function(T){C.push(T)}),C}function re(E,C,T){for(var M=0;M<E.length;M++)C.call(T||window,E[M],M,E)}function Ee(E,C){for(var T=[],M=0;M<E.length;M++)T.push(C(E[M],M,E,T));return T}function pe(E,C){var T={};return At(E,function(M,B){T[B]=C(M)}),T}function be(E,C){C=C||function(B){return!!B};for(var T=[],M=0;M<E.length;M++)C(E[M],M,E,T)&&T.push(E[M]);return T}function _e(E,C){var T={};return At(E,function(M,B){(C&&C(M,B,E,T)||M)&&(T[B]=M)}),T}function xe(E){var C=[];return At(E,function(T,M){C.push([M,T])}),C}function Oe(E,C){for(var T=0;T<E.length;T++)if(C(E[T],T,E))return!0;return!1}function ti(E,C){for(var T=0;T<E.length;T++)if(!C(E[T],T,E))return!1;return!0}function Xe(E){return pe(E,function(C){return typeof C=="object"&&(C=Zn(C)),encodeURIComponent(V(C.toString()))})}function dn(E){var C=_e(E,function(M){return M!==void 0}),T=Ee(xe(Xe(C)),pt.method("join","=")).join("&");return T}function vn(E){var C=[],T=[];return function M(B,ht){var kt,Lt,Zt;switch(typeof B){case"object":if(!B)return null;for(kt=0;kt<C.length;kt+=1)if(C[kt]===B)return{$ref:T[kt]};if(C.push(B),T.push(ht),Object.prototype.toString.apply(B)==="[object Array]")for(Zt=[],kt=0;kt<B.length;kt+=1)Zt[kt]=M(B[kt],ht+"["+kt+"]");else{Zt={};for(Lt in B)Object.prototype.hasOwnProperty.call(B,Lt)&&(Zt[Lt]=M(B[Lt],ht+"["+JSON.stringify(Lt)+"]"))}return Zt;case"number":case"string":case"boolean":return B}}(E,"$")}function Zn(E){try{return JSON.stringify(E)}catch{return JSON.stringify(vn(E))}}class Is{constructor(){this.globalLog=C=>{window.console&&window.console.log&&window.console.log(C)}}debug(...C){this.log(this.globalLog,C)}warn(...C){this.log(this.globalLogWarn,C)}error(...C){this.log(this.globalLogError,C)}globalLogWarn(C){window.console&&window.console.warn?window.console.warn(C):this.globalLog(C)}globalLogError(C){window.console&&window.console.error?window.console.error(C):this.globalLogWarn(C)}log(C,...T){var M=Mt.apply(this,arguments);za.log?za.log(M):za.logToConsole&&C.bind(this)(M)}}var he=new Is,fi=function(E,C,T,M,B){(T.headers!==void 0||T.headersProvider!=null)&&he.warn(`To send headers with the ${M.toString()} request, you must use AJAX, rather than JSONP.`);var ht=E.nextAuthCallbackID.toString();E.nextAuthCallbackID++;var kt=E.getDocument(),Lt=kt.createElement("script");E.auth_callbacks[ht]=function($e){B(null,$e)};var Zt="Pusher.auth_callbacks['"+ht+"']";Lt.src=T.endpoint+"?callback="+encodeURIComponent(Zt)+"&"+C;var ve=kt.getElementsByTagName("head")[0]||kt.documentElement;ve.insertBefore(Lt,ve.firstChild)},as=fi;class Qn{constructor(C){this.src=C}send(C){var T=this,M="Error loading "+T.src;T.script=document.createElement("script"),T.script.id=C.id,T.script.src=T.src,T.script.type="text/javascript",T.script.charset="UTF-8",T.script.addEventListener?(T.script.onerror=function(){C.callback(M)},T.script.onload=function(){C.callback(null)}):T.script.onreadystatechange=function(){(T.script.readyState==="loaded"||T.script.readyState==="complete")&&C.callback(null)},T.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(T.errorScript=document.createElement("script"),T.errorScript.id=C.id+"_error",T.errorScript.text=C.name+"('"+M+"');",T.script.async=T.errorScript.async=!1):T.script.async=!0;var B=document.getElementsByTagName("head")[0];B.insertBefore(T.script,B.firstChild),T.errorScript&&B.insertBefore(T.errorScript,T.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class Wi{constructor(C,T){this.url=C,this.data=T}send(C){if(!this.request){var T=dn(this.data),M=this.url+"/"+C.number+"?"+T;this.request=Dt.createScriptRequest(M),this.request.send(C)}}cleanup(){this.request&&this.request.cleanup()}}var Vr=function(E,C){return function(T,M){var B="http"+(C?"s":"")+"://",ht=B+(E.host||E.options.host)+E.options.path,kt=Dt.createJSONPRequest(ht,T),Lt=Dt.ScriptReceivers.create(function(Zt,ve){o.remove(Lt),kt.cleanup(),ve&&ve.host&&(E.host=ve.host),M&&M(Zt,ve)});kt.send(Lt)}},Ur={name:"jsonp",getAgent:Vr},Oa=Ur;function pi(E,C,T){var M=E+(C.useTLS?"s":""),B=C.useTLS?C.hostTLS:C.hostNonTLS;return M+"://"+B+T}function Hr(E,C){var T="/app/"+E,M="?protocol="+c.PROTOCOL+"&client=js&version="+c.VERSION+(C?"&"+C:"");return T+M}var Pa={getInitial:function(E,C){var T=(C.httpPath||"")+Hr(E,"flash=false");return pi("ws",C,T)}},Cu={getInitial:function(E,C){var T=(C.httpPath||"/pusher")+Hr(E);return pi("http",C,T)}},Iu={getInitial:function(E,C){return pi("http",C,C.httpPath||"/pusher")},getPath:function(E,C){return Hr(E)}};class qx{constructor(){this._callbacks={}}get(C){return this._callbacks[ku(C)]}add(C,T,M){var B=ku(C);this._callbacks[B]=this._callbacks[B]||[],this._callbacks[B].push({fn:T,context:M})}remove(C,T,M){if(!C&&!T&&!M){this._callbacks={};return}var B=C?[ku(C)]:Jt(this._callbacks);T||M?this.removeCallback(B,T,M):this.removeAllCallbacks(B)}removeCallback(C,T,M){re(C,function(B){this._callbacks[B]=be(this._callbacks[B]||[],function(ht){return T&&T!==ht.fn||M&&M!==ht.context}),this._callbacks[B].length===0&&delete this._callbacks[B]},this)}removeAllCallbacks(C){re(C,function(T){delete this._callbacks[T]},this)}}function ku(E){return"_"+E}class Vi{constructor(C){this.callbacks=new qx,this.global_callbacks=[],this.failThrough=C}bind(C,T,M){return this.callbacks.add(C,T,M),this}bind_global(C){return this.global_callbacks.push(C),this}unbind(C,T,M){return this.callbacks.remove(C,T,M),this}unbind_global(C){return C?(this.global_callbacks=be(this.global_callbacks||[],T=>T!==C),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(C,T,M){for(var B=0;B<this.global_callbacks.length;B++)this.global_callbacks[B](C,T);var ht=this.callbacks.get(C),kt=[];if(M?kt.push(T,M):T&&kt.push(T),ht&&ht.length>0)for(var B=0;B<ht.length;B++)ht[B].fn.apply(ht[B].context||window,kt);else this.failThrough&&this.failThrough(C,T);return this}}class Wf extends Vi{constructor(C,T,M,B,ht){super(),this.initialize=Dt.transportConnectionInitializer,this.hooks=C,this.name=T,this.priority=M,this.key=B,this.options=ht,this.state="new",this.timeline=ht.timeline,this.activityTimeout=ht.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return!!this.hooks.handlesActivityChecks}supportsPing(){return!!this.hooks.supportsPing}connect(){if(this.socket||this.state!=="initialized")return!1;var C=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(C,this.options)}catch(T){return pt.defer(()=>{this.onError(T),this.changeState("closed")}),!1}return this.bindListeners(),he.debug("Connecting",{transport:this.name,url:C}),this.changeState("connecting"),!0}close(){return this.socket?(this.socket.close(),!0):!1}send(C){return this.state==="open"?(pt.defer(()=>{this.socket&&this.socket.send(C)}),!0):!1}ping(){this.state==="open"&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(C){this.emit("error",{type:"WebSocketError",error:C}),this.timeline.error(this.buildTimelineMessage({error:C.toString()}))}onClose(C){C?this.changeState("closed",{code:C.code,reason:C.reason,wasClean:C.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(C){this.emit("message",C)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=C=>{this.onError(C)},this.socket.onclose=C=>{this.onClose(C)},this.socket.onmessage=C=>{this.onMessage(C)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(C,T){this.state=C,this.timeline.info(this.buildTimelineMessage({state:C,params:T})),this.emit(C,T)}buildTimelineMessage(C){return Ct({cid:this.id},C)}}class Gr{constructor(C){this.hooks=C}isSupported(C){return this.hooks.isSupported(C)}createConnection(C,T,M,B){return new Wf(this.hooks,C,T,M,B)}}var Kx=new Gr({urls:Pa,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!Dt.getWebSocketAPI()},isSupported:function(){return!!Dt.getWebSocketAPI()},getSocket:function(E){return Dt.createWebSocket(E)}}),Vf={urls:Cu,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},Uf=Ct({getSocket:function(E){return Dt.HTTPFactory.createStreamingSocket(E)}},Vf),Hf=Ct({getSocket:function(E){return Dt.HTTPFactory.createPollingSocket(E)}},Vf),Su={isSupported:function(){return Dt.isXHRSupported()}},Xx=new Gr(Ct({},Uf,Su)),Yx=new Gr(Ct({},Hf,Su)),Jx={ws:Kx,xhr_streaming:Xx,xhr_polling:Yx},Lo=Jx,Zx=new Gr({file:"sockjs",urls:Iu,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(E,C){return new window.SockJS(E,null,{js_path:h.getPath("sockjs",{useTLS:C.useTLS}),ignore_null_origin:C.ignoreNullOrigin})},beforeOpen:function(E,C){E.send(JSON.stringify({path:C}))}}),Qc={isSupported:function(E){var C=Dt.isXDRSupported(E.useTLS);return C}},Qx=new Gr(Ct({},Uf,Qc)),ty=new Gr(Ct({},Hf,Qc));Lo.xdr_streaming=Qx,Lo.xdr_polling=ty,Lo.sockjs=Zx;var ey=Lo;class ny extends Vi{constructor(){super();var C=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){C.emit("online")},!1),window.addEventListener("offline",function(){C.emit("offline")},!1))}isOnline(){return window.navigator.onLine===void 0?!0:window.navigator.onLine}}var sy=new ny;class iy{constructor(C,T,M){this.manager=C,this.transport=T,this.minPingDelay=M.minPingDelay,this.maxPingDelay=M.maxPingDelay,this.pingDelay=void 0}createConnection(C,T,M,B){B=Ct({},B,{activityTimeout:this.pingDelay});var ht=this.transport.createConnection(C,T,M,B),kt=null,Lt=function(){ht.unbind("open",Lt),ht.bind("closed",Zt),kt=pt.now()},Zt=ve=>{if(ht.unbind("closed",Zt),ve.code===1002||ve.code===1003)this.manager.reportDeath();else if(!ve.wasClean&&kt){var $e=pt.now()-kt;$e<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max($e/2,this.minPingDelay))}};return ht.bind("open",Lt),ht}isSupported(C){return this.manager.isAlive()&&this.transport.isSupported(C)}}const Gf={decodeMessage:function(E){try{var C=JSON.parse(E.data),T=C.data;if(typeof T=="string")try{T=JSON.parse(C.data)}catch{}var M={event:C.event,channel:C.channel,data:T};return C.user_id&&(M.user_id=C.user_id),M}catch(B){throw{type:"MessageParseError",error:B,data:E.data}}},encodeMessage:function(E){return JSON.stringify(E)},processHandshake:function(E){var C=Gf.decodeMessage(E);if(C.event==="pusher:connection_established"){if(!C.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:C.data.socket_id,activityTimeout:C.data.activity_timeout*1e3}}else{if(C.event==="pusher:error")return{action:this.getCloseAction(C.data),error:this.getCloseError(C.data)};throw"Invalid handshake"}},getCloseAction:function(E){return E.code<4e3?E.code>=1002&&E.code<=1004?"backoff":null:E.code===4e3?"tls_only":E.code<4100?"refused":E.code<4200?"backoff":E.code<4300?"retry":"refused"},getCloseError:function(E){return E.code!==1e3&&E.code!==1001?{type:"PusherError",data:{code:E.code,message:E.reason||E.message}}:null}};var jr=Gf;class jf extends Vi{constructor(C,T){super(),this.id=C,this.transport=T,this.activityTimeout=T.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(C){return this.transport.send(C)}send_event(C,T,M){var B={event:C,data:T};return M&&(B.channel=M),he.debug("Event sent",B),this.send(jr.encodeMessage(B))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var C={message:M=>{var B;try{B=jr.decodeMessage(M)}catch(ht){this.emit("error",{type:"MessageParseError",error:ht,data:M.data})}if(B!==void 0){switch(he.debug("Event recd",B),B.event){case"pusher:error":this.emit("error",{type:"PusherError",data:B.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",B)}},activity:()=>{this.emit("activity")},error:M=>{this.emit("error",M)},closed:M=>{T(),M&&M.code&&this.handleCloseEvent(M),this.transport=null,this.emit("closed")}},T=()=>{At(C,(M,B)=>{this.transport.unbind(B,M)})};At(C,(M,B)=>{this.transport.bind(B,M)})}handleCloseEvent(C){var T=jr.getCloseAction(C),M=jr.getCloseError(C);M&&this.emit("error",M),T&&this.emit(T,{action:T,error:M})}}class ry{constructor(C,T){this.transport=C,this.callback=T,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=C=>{this.unbindListeners();var T;try{T=jr.processHandshake(C)}catch(M){this.finish("error",{error:M}),this.transport.close();return}T.action==="connected"?this.finish("connected",{connection:new jf(T.id,this.transport),activityTimeout:T.activityTimeout}):(this.finish(T.action,{error:T.error}),this.transport.close())},this.onClosed=C=>{this.unbindListeners();var T=jr.getCloseAction(C)||"backoff",M=jr.getCloseError(C);this.finish(T,{error:M})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(C,T){this.callback(Ct({transport:this.transport,action:C},T))}}class oy{constructor(C,T){this.timeline=C,this.options=T||{}}send(C,T){this.timeline.isEmpty()||this.timeline.send(Dt.TimelineTransport.getAgent(this,C),T)}}class _u extends Vi{constructor(C,T){super(function(M,B){he.debug("No callbacks on "+C+" for "+M)}),this.name=C,this.pusher=T,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(C,T){return T(null,{auth:""})}trigger(C,T){if(C.indexOf("client-")!==0)throw new b("Event '"+C+"' does not start with 'client-'");if(!this.subscribed){var M=m.buildLogSuffix("triggeringClientEvents");he.warn(`Client event triggered before channel 'subscription_succeeded' event . ${M}`)}return this.pusher.send_event(C,T,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(C){var T=C.event,M=C.data;if(T==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(C);else if(T==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(C);else if(T.indexOf("pusher_internal:")!==0){var B={};this.emit(T,M,B)}}handleSubscriptionSucceededEvent(C){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",C.data)}handleSubscriptionCountEvent(C){C.data.subscription_count&&(this.subscriptionCount=C.data.subscription_count),this.emit("pusher:subscription_count",C.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(C,T)=>{C?(this.subscriptionPending=!1,he.error(C.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:C.message},C instanceof A?{status:C.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:T.auth,channel_data:T.channel_data,channel:this.name})}))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class Tu extends _u{authorize(C,T){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:C},T)}}class ay{constructor(){this.reset()}get(C){return Object.prototype.hasOwnProperty.call(this.members,C)?{id:C,info:this.members[C]}:null}each(C){At(this.members,(T,M)=>{C(this.get(M))})}setMyID(C){this.myID=C}onSubscription(C){this.members=C.presence.hash,this.count=C.presence.count,this.me=this.get(this.myID)}addMember(C){return this.get(C.user_id)===null&&this.count++,this.members[C.user_id]=C.user_info,this.get(C.user_id)}removeMember(C){var T=this.get(C.user_id);return T&&(delete this.members[C.user_id],this.count--),T}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var cy=function(E,C,T,M){function B(ht){return ht instanceof T?ht:new T(function(kt){kt(ht)})}return new(T||(T=Promise))(function(ht,kt){function Lt($e){try{ve(M.next($e))}catch(an){kt(an)}}function Zt($e){try{ve(M.throw($e))}catch(an){kt(an)}}function ve($e){$e.done?ht($e.value):B($e.value).then(Lt,Zt)}ve((M=M.apply(E,C||[])).next())})};class tl extends Tu{constructor(C,T){super(C,T),this.members=new ay}authorize(C,T){super.authorize(C,(M,B)=>cy(this,void 0,void 0,function*(){if(!M)if(B=B,B.channel_data!=null){var ht=JSON.parse(B.channel_data);this.members.setMyID(ht.user_id)}else if(yield this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let kt=m.buildLogSuffix("authorizationEndpoint");he.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${kt}, or the user should be signed in.`),T("Invalid auth response");return}T(M,B)}))}handleEvent(C){var T=C.event;if(T.indexOf("pusher_internal:")===0)this.handleInternalEvent(C);else{var M=C.data,B={};C.user_id&&(B.user_id=C.user_id),this.emit(T,M,B)}}handleInternalEvent(C){var T=C.event,M=C.data;switch(T){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(C);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(C);break;case"pusher_internal:member_added":var B=this.members.addMember(M);this.emit("pusher:member_added",B);break;case"pusher_internal:member_removed":var ht=this.members.removeMember(M);ht&&this.emit("pusher:member_removed",ht);break}}handleSubscriptionSucceededEvent(C){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(C.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var ly=i(1),Bo=i(0);class uy extends Tu{constructor(C,T,M){super(C,T),this.key=null,this.nacl=M}authorize(C,T){super.authorize(C,(M,B)=>{if(M){T(M,B);return}let ht=B.shared_secret;if(!ht){T(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=Object(Bo.decode)(ht),delete B.shared_secret,T(null,B)})}trigger(C,T){throw new _("Client events are not currently supported for encrypted channels")}handleEvent(C){var T=C.event,M=C.data;if(T.indexOf("pusher_internal:")===0||T.indexOf("pusher:")===0){super.handleEvent(C);return}this.handleEncryptedEvent(T,M)}handleEncryptedEvent(C,T){if(!this.key){he.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!T.ciphertext||!T.nonce){he.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+T);return}let M=Object(Bo.decode)(T.ciphertext);if(M.length<this.nacl.secretbox.overheadLength){he.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${M.length}`);return}let B=Object(Bo.decode)(T.nonce);if(B.length<this.nacl.secretbox.nonceLength){he.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${B.length}`);return}let ht=this.nacl.secretbox.open(M,B,this.key);if(ht===null){he.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(kt,Lt)=>{if(kt){he.error(`Failed to make a request to the authEndpoint: ${Lt}. Unable to fetch new key, so dropping encrypted event`);return}if(ht=this.nacl.secretbox.open(M,B,this.key),ht===null){he.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(C,this.getDataToEmit(ht))});return}this.emit(C,this.getDataToEmit(ht))}getDataToEmit(C){let T=Object(ly.decode)(C);try{return JSON.parse(T)}catch{return T}}}class hy extends Vi{constructor(C,T){super(),this.state="initialized",this.connection=null,this.key=C,this.options=T,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var M=Dt.getNetwork();M.bind("online",()=>{this.timeline.info({netinfo:"online"}),(this.state==="connecting"||this.state==="unavailable")&&this.retryIn(0)}),M.bind("offline",()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()}),this.updateStrategy()}connect(){if(!(this.connection||this.runner)){if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}}send(C){return this.connection?this.connection.send(C):!1}send_event(C,T,M){return this.connection?this.connection.send_event(C,T,M):!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var C=(T,M)=>{T?this.runner=this.strategy.connect(0,C):M.action==="error"?(this.emit("error",{type:"HandshakeError",error:M.error}),this.timeline.error({handshakeError:M.error})):(this.abortConnecting(),this.handshakeCallbacks[M.action](M))};this.runner=this.strategy.connect(0,C)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var C=this.abandonConnection();C.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(C){this.timeline.info({action:"retry",delay:C}),C>0&&this.emit("connecting_in",Math.round(C/1e3)),this.retryTimer=new yt(C||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new yt(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new yt(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new yt(this.activityTimeout,()=>{this.sendActivityCheck()}))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(C){return Ct({},C,{message:T=>{this.resetActivityCheck(),this.emit("message",T)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:T=>{this.emit("error",T)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(C){return Ct({},C,{connected:T=>{this.activityTimeout=Math.min(this.options.activityTimeout,T.activityTimeout,T.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(T.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let C=T=>M=>{M.error&&this.emit("error",{type:"WebSocketError",error:M.error}),T(M)};return{tls_only:C(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:C(()=>{this.disconnect()}),backoff:C(()=>{this.retryIn(1e3)}),retry:C(()=>{this.retryIn(0)})}}setConnection(C){this.connection=C;for(var T in this.connectionCallbacks)this.connection.bind(T,this.connectionCallbacks[T]);this.resetActivityCheck()}abandonConnection(){if(this.connection){this.stopActivityCheck();for(var C in this.connectionCallbacks)this.connection.unbind(C,this.connectionCallbacks[C]);var T=this.connection;return this.connection=null,T}}updateState(C,T){var M=this.state;if(this.state=C,M!==C){var B=C;B==="connected"&&(B+=" with new socket ID "+T.socket_id),he.debug("State changed",M+" -> "+B),this.timeline.info({state:C,params:T}),this.emit("state_change",{previous:M,current:C}),this.emit(C,T)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class dy{constructor(){this.channels={}}add(C,T){return this.channels[C]||(this.channels[C]=qf(C,T)),this.channels[C]}all(){return Yt(this.channels)}find(C){return this.channels[C]}remove(C){var T=this.channels[C];return delete this.channels[C],T}disconnect(){At(this.channels,function(C){C.disconnect()})}}function qf(E,C){if(E.indexOf("private-encrypted-")===0){if(C.config.nacl)return gi.createEncryptedChannel(E,C,C.config.nacl);let T="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",M=m.buildLogSuffix("encryptedChannelSupport");throw new _(`${T}. ${M}`)}else{if(E.indexOf("private-")===0)return gi.createPrivateChannel(E,C);if(E.indexOf("presence-")===0)return gi.createPresenceChannel(E,C);if(E.indexOf("#")===0)throw new y('Cannot create a channel with name "'+E+'".');return gi.createChannel(E,C)}}var Kf={createChannels(){return new dy},createConnectionManager(E,C){return new hy(E,C)},createChannel(E,C){return new _u(E,C)},createPrivateChannel(E,C){return new Tu(E,C)},createPresenceChannel(E,C){return new tl(E,C)},createEncryptedChannel(E,C,T){return new uy(E,C,T)},createTimelineSender(E,C){return new oy(E,C)},createHandshake(E,C){return new ry(E,C)},createAssistantToTheTransportManager(E,C,T){return new iy(E,C,T)}},gi=Kf;class Xf{constructor(C){this.options=C||{},this.livesLeft=this.options.lives||1/0}getAssistant(C){return gi.createAssistantToTheTransportManager(this,C,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class qr{constructor(C,T){this.strategies=C,this.loop=!!T.loop,this.failFast=!!T.failFast,this.timeout=T.timeout,this.timeoutLimit=T.timeoutLimit}isSupported(){return Oe(this.strategies,pt.method("isSupported"))}connect(C,T){var M=this.strategies,B=0,ht=this.timeout,kt=null,Lt=(Zt,ve)=>{ve?T(null,ve):(B=B+1,this.loop&&(B=B%M.length),B<M.length?(ht&&(ht=ht*2,this.timeoutLimit&&(ht=Math.min(ht,this.timeoutLimit))),kt=this.tryStrategy(M[B],C,{timeout:ht,failFast:this.failFast},Lt)):T(!0))};return kt=this.tryStrategy(M[B],C,{timeout:ht,failFast:this.failFast},Lt),{abort:function(){kt.abort()},forceMinPriority:function(Zt){C=Zt,kt&&kt.forceMinPriority(Zt)}}}tryStrategy(C,T,M,B){var ht=null,kt=null;return M.timeout>0&&(ht=new yt(M.timeout,function(){kt.abort(),B(!0)})),kt=C.connect(T,function(Lt,Zt){Lt&&ht&&ht.isRunning()&&!M.failFast||(ht&&ht.ensureAborted(),B(Lt,Zt))}),{abort:function(){ht&&ht.ensureAborted(),kt.abort()},forceMinPriority:function(Lt){kt.forceMinPriority(Lt)}}}}class Eu{constructor(C){this.strategies=C}isSupported(){return Oe(this.strategies,pt.method("isSupported"))}connect(C,T){return fy(this.strategies,C,function(M,B){return function(ht,kt){if(B[M].error=ht,ht){Yf(B)&&T(!0);return}re(B,function(Lt){Lt.forceMinPriority(kt.transport.priority)}),T(null,kt)}})}}function fy(E,C,T){var M=Ee(E,function(B,ht,kt,Lt){return B.connect(C,T(ht,Lt))});return{abort:function(){re(M,Jf)},forceMinPriority:function(B){re(M,function(ht){ht.forceMinPriority(B)})}}}function Yf(E){return ti(E,function(C){return!!C.error})}function Jf(E){!E.error&&!E.aborted&&(E.abort(),E.aborted=!0)}class Zf{constructor(C,T,M){this.strategy=C,this.transports=T,this.ttl=M.ttl||1800*1e3,this.usingTLS=M.useTLS,this.timeline=M.timeline}isSupported(){return this.strategy.isSupported()}connect(C,T){var M=this.usingTLS,B=py(M),ht=B&&B.cacheSkipCount?B.cacheSkipCount:0,kt=[this.strategy];if(B&&B.timestamp+this.ttl>=pt.now()){var Lt=this.transports[B.transport];Lt&&(["ws","wss"].includes(B.transport)||ht>3?(this.timeline.info({cached:!0,transport:B.transport,latency:B.latency}),kt.push(new qr([Lt],{timeout:B.latency*2+1e3,failFast:!0}))):ht++)}var Zt=pt.now(),ve=kt.pop().connect(C,function $e(an,Wa){an?(Ma(M),kt.length>0?(Zt=pt.now(),ve=kt.pop().connect(C,$e)):T(an)):(Qf(M,Wa.transport.name,pt.now()-Zt,ht),T(null,Wa))});return{abort:function(){ve.abort()},forceMinPriority:function($e){C=$e,ve&&ve.forceMinPriority($e)}}}}function Fa(E){return"pusherTransport"+(E?"TLS":"NonTLS")}function py(E){var C=Dt.getLocalStorage();if(C)try{var T=C[Fa(E)];if(T)return JSON.parse(T)}catch{Ma(E)}return null}function Qf(E,C,T,M){var B=Dt.getLocalStorage();if(B)try{B[Fa(E)]=Zn({timestamp:pt.now(),transport:C,latency:T,cacheSkipCount:M})}catch{}}function Ma(E){var C=Dt.getLocalStorage();if(C)try{delete C[Fa(E)]}catch{}}class La{constructor(C,{delay:T}){this.strategy=C,this.options={delay:T}}isSupported(){return this.strategy.isSupported()}connect(C,T){var M=this.strategy,B,ht=new yt(this.options.delay,function(){B=M.connect(C,T)});return{abort:function(){ht.ensureAborted(),B&&B.abort()},forceMinPriority:function(kt){C=kt,B&&B.forceMinPriority(kt)}}}}class Ba{constructor(C,T,M){this.test=C,this.trueBranch=T,this.falseBranch=M}isSupported(){var C=this.test()?this.trueBranch:this.falseBranch;return C.isSupported()}connect(C,T){var M=this.test()?this.trueBranch:this.falseBranch;return M.connect(C,T)}}class tp{constructor(C){this.strategy=C}isSupported(){return this.strategy.isSupported()}connect(C,T){var M=this.strategy.connect(C,function(B,ht){ht&&M.abort(),T(B,ht)});return M}}function zo(E){return function(){return E.isSupported()}}var $u=function(E,C,T){var M={};function B(kp,Dy,Uo,Oy,Py){var rl=T(E,kp,Dy,Uo,Oy,Py);return M[kp]=rl,rl}var ht=Object.assign({},C,{hostNonTLS:E.wsHost+":"+E.wsPort,hostTLS:E.wsHost+":"+E.wssPort,httpPath:E.wsPath}),kt=Object.assign({},ht,{useTLS:!0}),Lt=Object.assign({},C,{hostNonTLS:E.httpHost+":"+E.httpPort,hostTLS:E.httpHost+":"+E.httpsPort,httpPath:E.httpPath}),Zt={loop:!0,timeout:15e3,timeoutLimit:6e4},ve=new Xf({minPingDelay:1e4,maxPingDelay:E.activityTimeout}),$e=new Xf({lives:2,minPingDelay:1e4,maxPingDelay:E.activityTimeout}),an=B("ws","ws",3,ht,ve),Wa=B("wss","ws",3,kt,ve),Ay=B("sockjs","sockjs",1,Lt),il=B("xhr_streaming","xhr_streaming",1,Lt,$e),Mu=B("xdr_streaming","xdr_streaming",1,Lt,$e),vp=B("xhr_polling","xhr_polling",1,Lt),Cp=B("xdr_polling","xdr_polling",1,Lt),cs=new qr([an],Zt),Lu=new qr([Wa],Zt),Va=new qr([Ay],Zt),Bu=new qr([new Ba(zo(il),il,Mu)],Zt),zu=new qr([new Ba(zo(vp),vp,Cp)],Zt),Ip=new qr([new Ba(zo(Bu),new Eu([Bu,new La(zu,{delay:4e3})]),zu)],Zt),Wu=new Ba(zo(Ip),Ip,Va),Vu;return C.useTLS?Vu=new Eu([cs,new La(Wu,{delay:2e3})]):Vu=new Eu([cs,new La(Lu,{delay:2e3}),new La(Wu,{delay:5e3})]),new Zf(new tp(new Ba(zo(an),Vu,Wu)),M,{ttl:18e5,timeline:C.timeline,useTLS:C.useTLS})},gy=$u,ep=function(){var E=this;E.timeline.info(E.buildTimelineMessage({transport:E.name+(E.options.useTLS?"s":"")})),E.hooks.isInitialized()?E.changeState("initialized"):E.hooks.file?(E.changeState("initializing"),h.load(E.hooks.file,{useTLS:E.options.useTLS},function(C,T){E.hooks.isInitialized()?(E.changeState("initialized"),T(!0)):(C&&E.onError(C),E.onClose(),T(!1))})):E.onClose()},Nu={getRequest:function(E){var C=new window.XDomainRequest;return C.ontimeout=function(){E.emit("error",new v),E.close()},C.onerror=function(T){E.emit("error",T),E.close()},C.onprogress=function(){C.responseText&&C.responseText.length>0&&E.onChunk(200,C.responseText)},C.onload=function(){C.responseText&&C.responseText.length>0&&E.onChunk(200,C.responseText),E.emit("finished",200),E.close()},C},abortRequest:function(E){E.ontimeout=E.onerror=E.onprogress=E.onload=null,E.abort()}},Ru=Nu;const Wo=256*1024;class np extends Vi{constructor(C,T,M){super(),this.hooks=C,this.method=T,this.url=M}start(C){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},Dt.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(C)}close(){this.unloader&&(Dt.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(C,T){for(;;){var M=this.advanceBuffer(T);if(M)this.emit("chunk",{status:C,data:M});else break}this.isBufferTooLong(T)&&this.emit("buffer_too_long")}advanceBuffer(C){var T=C.slice(this.position),M=T.indexOf(`
`);return M!==-1?(this.position+=M+1,T.slice(0,M)):null}isBufferTooLong(C){return this.position===C.length&&C.length>Wo}}var el;(function(E){E[E.CONNECTING=0]="CONNECTING",E[E.OPEN=1]="OPEN",E[E.CLOSED=3]="CLOSED"})(el||(el={}));var Kr=el,sp=1;class ip{constructor(C,T){this.hooks=C,this.session=cp(1e3)+"/"+lp(8),this.location=rp(T),this.readyState=Kr.CONNECTING,this.openStream()}send(C){return this.sendRaw(JSON.stringify([C]))}ping(){this.hooks.sendHeartbeat(this)}close(C,T){this.onClose(C,T,!0)}sendRaw(C){if(this.readyState===Kr.OPEN)try{return Dt.createSocketRequest("POST",ap(op(this.location,this.session))).start(C),!0}catch{return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(C,T,M){this.closeStream(),this.readyState=Kr.CLOSED,this.onclose&&this.onclose({code:C,reason:T,wasClean:M})}onChunk(C){if(C.status===200){this.readyState===Kr.OPEN&&this.onActivity();var T,M=C.data.slice(0,1);switch(M){case"o":T=JSON.parse(C.data.slice(1)||"{}"),this.onOpen(T);break;case"a":T=JSON.parse(C.data.slice(1)||"[]");for(var B=0;B<T.length;B++)this.onEvent(T[B]);break;case"m":T=JSON.parse(C.data.slice(1)||"null"),this.onEvent(T);break;case"h":this.hooks.onHeartbeat(this);break;case"c":T=JSON.parse(C.data.slice(1)||"[]"),this.onClose(T[0],T[1],!0);break}}}onOpen(C){this.readyState===Kr.CONNECTING?(C&&C.hostname&&(this.location.base=my(this.location.base,C.hostname)),this.readyState=Kr.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(C){this.readyState===Kr.OPEN&&this.onmessage&&this.onmessage({data:C})}onActivity(){this.onactivity&&this.onactivity()}onError(C){this.onerror&&this.onerror(C)}openStream(){this.stream=Dt.createSocketRequest("POST",ap(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",C=>{this.onChunk(C)}),this.stream.bind("finished",C=>{this.hooks.onFinished(this,C)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(C){pt.defer(()=>{this.onError(C),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}}function rp(E){var C=/([^\?]*)\/*(\??.*)/.exec(E);return{base:C[1],queryString:C[2]}}function op(E,C){return E.base+"/"+C+"/xhr_send"}function ap(E){var C=E.indexOf("?")===-1?"?":"&";return E+C+"t="+ +new Date+"&n="+sp++}function my(E,C){var T=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(E);return T[1]+C+T[3]}function cp(E){return Dt.randomInt(E)}function lp(E){for(var C=[],T=0;T<E;T++)C.push(cp(32).toString(32));return C.join("")}var by=ip,xy={getReceiveURL:function(E,C){return E.base+"/"+C+"/xhr_streaming"+E.queryString},onHeartbeat:function(E){E.sendRaw("[]")},sendHeartbeat:function(E){E.sendRaw("[]")},onFinished:function(E,C){E.onClose(1006,"Connection interrupted ("+C+")",!1)}},yy=xy,wy={getReceiveURL:function(E,C){return E.base+"/"+C+"/xhr"+E.queryString},onHeartbeat:function(){},sendHeartbeat:function(E){E.sendRaw("[]")},onFinished:function(E,C){C===200?E.reconnect():E.onClose(1006,"Connection interrupted ("+C+")",!1)}},Au=wy,vy={getRequest:function(E){var C=Dt.getXHRAPI(),T=new C;return T.onreadystatechange=T.onprogress=function(){switch(T.readyState){case 3:T.responseText&&T.responseText.length>0&&E.onChunk(T.status,T.responseText);break;case 4:T.responseText&&T.responseText.length>0&&E.onChunk(T.status,T.responseText),E.emit("finished",T.status),E.close();break}},T},abortRequest:function(E){E.onreadystatechange=null,E.abort()}},Cy=vy,Iy={createStreamingSocket(E){return this.createSocket(yy,E)},createPollingSocket(E){return this.createSocket(Au,E)},createSocket(E,C){return new by(E,C)},createXHR(E,C){return this.createRequest(Cy,E,C)},createRequest(E,C,T){return new np(E,C,T)}},up=Iy;up.createXDR=function(E,C){return this.createRequest(Ru,E,C)};var ky=up,Ue={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:o,DependenciesReceivers:u,getDefaultStrategy:gy,Transports:ey,transportConnectionInitializer:ep,HTTPFactory:ky,TimelineTransport:Oa,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(E){window.Pusher=E;var C=()=>{this.onDocumentBody(E.ready)};window.JSON?C():h.load("json2",{},C)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:L,jsonp:as}},onDocumentBody(E){document.body?E():setTimeout(()=>{this.onDocumentBody(E)},0)},createJSONPRequest(E,C){return new Wi(E,C)},createScriptRequest(E){return new Qn(E)},getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){var E=this.getXHRAPI();return new E},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return sy},createWebSocket(E){var C=this.getWebSocketAPI();return new C(E)},createSocketRequest(E,C){if(this.isXHRSupported())return this.HTTPFactory.createXHR(E,C);if(this.isXDRSupported(C.indexOf("https:")===0))return this.HTTPFactory.createXDR(E,C);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var E=this.getXHRAPI();return!!E&&new E().withCredentials!==void 0},isXDRSupported(E){var C=E?"https:":"http:",T=this.getProtocol();return!!window.XDomainRequest&&T===C},addUnloadListener(E){window.addEventListener!==void 0?window.addEventListener("unload",E,!1):window.attachEvent!==void 0&&window.attachEvent("onunload",E)},removeUnloadListener(E){window.addEventListener!==void 0?window.removeEventListener("unload",E,!1):window.detachEvent!==void 0&&window.detachEvent("onunload",E)},randomInt(E){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)}()*E)}},Dt=Ue,Du;(function(E){E[E.ERROR=3]="ERROR",E[E.INFO=6]="INFO",E[E.DEBUG=7]="DEBUG"})(Du||(Du={}));var nl=Du;class Sy{constructor(C,T,M){this.key=C,this.session=T,this.events=[],this.options=M||{},this.sent=0,this.uniqueID=0}log(C,T){C<=this.options.level&&(this.events.push(Ct({},T,{timestamp:pt.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(C){this.log(nl.ERROR,C)}info(C){this.log(nl.INFO,C)}debug(C){this.log(nl.DEBUG,C)}isEmpty(){return this.events.length===0}send(C,T){var M=Ct({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],C(M,(B,ht)=>{B||this.sent++,T&&T(B,ht)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class _y{constructor(C,T,M,B){this.name=C,this.priority=T,this.transport=M,this.options=B||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(C,T){if(this.isSupported()){if(this.priority<C)return hp(new k,T)}else return hp(new R,T);var M=!1,B=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),ht=null,kt=function(){B.unbind("initialized",kt),B.connect()},Lt=function(){ht=gi.createHandshake(B,function(an){M=!0,$e(),T(null,an)})},Zt=function(an){$e(),T(an)},ve=function(){$e();var an;an=Zn(B),T(new I(an))},$e=function(){B.unbind("initialized",kt),B.unbind("open",Lt),B.unbind("error",Zt),B.unbind("closed",ve)};return B.bind("initialized",kt),B.bind("open",Lt),B.bind("error",Zt),B.bind("closed",ve),B.initialize(),{abort:()=>{M||($e(),ht?ht.close():B.close())},forceMinPriority:an=>{M||this.priority<an&&(ht?ht.close():B.close())}}}}function hp(E,C){return pt.defer(function(){C(E)}),{abort:function(){},forceMinPriority:function(){}}}const{Transports:Ty}=Dt;var dp=function(E,C,T,M,B,ht){var kt=Ty[T];if(!kt)throw new $(T);var Lt=(!E.enabledTransports||Bt(E.enabledTransports,C)!==-1)&&(!E.disabledTransports||Bt(E.disabledTransports,C)===-1),Zt;return Lt?(B=Object.assign({ignoreNullOrigin:E.ignoreNullOrigin},B),Zt=new _y(C,M,ht?ht.getAssistant(kt):kt,B)):Zt=Ey,Zt},Ey={isSupported:function(){return!1},connect:function(E,C){var T=pt.defer(function(){C(new R)});return{abort:function(){T.ensureAborted()},forceMinPriority:function(){}}}};function Pn(E){if(E==null)throw"You must pass an options object";if(E.cluster==null)throw"Options object must provide a cluster";"disableStats"in E&&he.warn("The disableStats option is deprecated in favor of enableStats")}const Ou=(E,C)=>{var T="socket_id="+encodeURIComponent(E.socketId);for(var M in C.params)T+="&"+encodeURIComponent(M)+"="+encodeURIComponent(C.params[M]);if(C.paramsProvider!=null){let B=C.paramsProvider();for(var M in B)T+="&"+encodeURIComponent(M)+"="+encodeURIComponent(B[M])}return T};var fp=E=>{if(typeof Dt.getAuthorizers()[E.transport]>"u")throw`'${E.transport}' is not a recognized auth transport`;return(C,T)=>{const M=Ou(C,E);Dt.getAuthorizers()[E.transport](Dt,M,E,x.UserAuthentication,T)}};const Pu=(E,C)=>{var T="socket_id="+encodeURIComponent(E.socketId);T+="&channel_name="+encodeURIComponent(E.channelName);for(var M in C.params)T+="&"+encodeURIComponent(M)+"="+encodeURIComponent(C.params[M]);if(C.paramsProvider!=null){let B=C.paramsProvider();for(var M in B)T+="&"+encodeURIComponent(M)+"="+encodeURIComponent(B[M])}return T};var pp=E=>{if(typeof Dt.getAuthorizers()[E.transport]>"u")throw`'${E.transport}' is not a recognized auth transport`;return(C,T)=>{const M=Pu(C,E);Dt.getAuthorizers()[E.transport](Dt,M,E,x.ChannelAuthorization,T)}};const gp=(E,C,T)=>{const M={authTransport:C.transport,authEndpoint:C.endpoint,auth:{params:C.params,headers:C.headers}};return(B,ht)=>{const kt=E.channel(B.channelName);T(kt,M).authorize(B.socketId,ht)}};function mp(E,C){let T={activityTimeout:E.activityTimeout||c.activityTimeout,cluster:E.cluster,httpPath:E.httpPath||c.httpPath,httpPort:E.httpPort||c.httpPort,httpsPort:E.httpsPort||c.httpsPort,pongTimeout:E.pongTimeout||c.pongTimeout,statsHost:E.statsHost||c.stats_host,unavailableTimeout:E.unavailableTimeout||c.unavailableTimeout,wsPath:E.wsPath||c.wsPath,wsPort:E.wsPort||c.wsPort,wssPort:E.wssPort||c.wssPort,enableStats:$y(E),httpHost:bp(E),useTLS:ks(E),wsHost:xp(E),userAuthenticator:Fs(E),channelAuthorizer:wp(E,C)};return"disabledTransports"in E&&(T.disabledTransports=E.disabledTransports),"enabledTransports"in E&&(T.enabledTransports=E.enabledTransports),"ignoreNullOrigin"in E&&(T.ignoreNullOrigin=E.ignoreNullOrigin),"timelineParams"in E&&(T.timelineParams=E.timelineParams),"nacl"in E&&(T.nacl=E.nacl),T}function bp(E){return E.httpHost?E.httpHost:E.cluster?`sockjs-${E.cluster}.pusher.com`:c.httpHost}function xp(E){return E.wsHost?E.wsHost:yp(E.cluster)}function yp(E){return`ws-${E}.pusher.com`}function ks(E){return Dt.getProtocol()==="https:"?!0:E.forceTLS!==!1}function $y(E){return"enableStats"in E?E.enableStats:"disableStats"in E?!E.disableStats:!1}function Fs(E){const C=Object.assign(Object.assign({},c.userAuthentication),E.userAuthentication);return"customHandler"in C&&C.customHandler!=null?C.customHandler:fp(C)}function Ny(E,C){let T;return"channelAuthorization"in E?T=Object.assign(Object.assign({},c.channelAuthorization),E.channelAuthorization):(T={transport:E.authTransport||c.authTransport,endpoint:E.authEndpoint||c.authEndpoint},"auth"in E&&("params"in E.auth&&(T.params=E.auth.params),"headers"in E.auth&&(T.headers=E.auth.headers)),"authorizer"in E&&(T.customHandler=gp(C,T,E.authorizer))),T}function wp(E,C){const T=Ny(E,C);return"customHandler"in T&&T.customHandler!=null?T.customHandler:pp(T)}class pr extends Vi{constructor(C){super(function(T,M){he.debug(`No callbacks on watchlist events for ${T}`)}),this.pusher=C,this.bindWatchlistInternalEvent()}handleEvent(C){C.data.events.forEach(T=>{this.emit(T.name,T)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",C=>{var T=C.event;T==="pusher_internal:watchlist_events"&&this.handleEvent(C)})}}function sl(){let E,C;return{promise:new Promise((M,B)=>{E=M,C=B}),resolve:E,reject:C}}var Fu=sl;class Ye extends Vi{constructor(C){super(function(T,M){he.debug("No callbacks on user for "+T)}),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(T,M)=>{if(T){he.warn(`Error during signin: ${T}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:M.auth,user_data:M.user_data})},this.pusher=C,this.pusher.connection.bind("state_change",({previous:T,current:M})=>{T!=="connected"&&M==="connected"&&this._signin(),T==="connected"&&M!=="connected"&&(this._cleanup(),this._newSigninPromiseIfNeeded())}),this.watchlist=new pr(C),this.pusher.connection.bind("message",T=>{var M=T.event;M==="pusher:signin_success"&&this._onSigninSuccess(T.data),this.serverToUserChannel&&this.serverToUserChannel.name===T.channel&&this.serverToUserChannel.handleEvent(T)})}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),this.pusher.connection.state==="connected"&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(C){try{this.user_data=JSON.parse(C.user_data)}catch{he.error(`Failed parsing user data after signin: ${C.user_data}`),this._cleanup();return}if(typeof this.user_data.id!="string"||this.user_data.id===""){he.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){const C=T=>{T.subscriptionPending&&T.subscriptionCancelled?T.reinstateSubscription():!T.subscriptionPending&&this.pusher.connection.state==="connected"&&T.subscribe()};this.serverToUserChannel=new _u(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((T,M)=>{T.indexOf("pusher_internal:")===0||T.indexOf("pusher:")===0||this.emit(T,M)}),C(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested||this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:C,resolve:T,reject:M}=Fu();C.done=!1;const B=()=>{C.done=!0};C.then(B).catch(B),this.signinDonePromise=C,this._signinDoneResolve=T}}class Je{static ready(){Je.isReady=!0;for(var C=0,T=Je.instances.length;C<T;C++)Je.instances[C].connect()}static getClientFeatures(){return Jt(_e({ws:Dt.Transports.ws},function(C){return C.isSupported({})}))}constructor(C,T){Ry(C),Pn(T),this.key=C,this.config=mp(T,this),this.channels=gi.createChannels(),this.global_emitter=new Vi,this.sessionID=Dt.randomInt(1e9),this.timeline=new Sy(this.key,this.sessionID,{cluster:this.config.cluster,features:Je.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:nl.INFO,version:c.VERSION}),this.config.enableStats&&(this.timelineSender=gi.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+Dt.TimelineTransport.name}));var M=B=>Dt.getDefaultStrategy(this.config,B,dp);this.connection=gi.createConnectionManager(this.key,{getStrategy:M,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}),this.connection.bind("message",B=>{var ht=B.event,kt=ht.indexOf("pusher_internal:")===0;if(B.channel){var Lt=this.channel(B.channel);Lt&&Lt.handleEvent(B)}kt||this.global_emitter.emit(B.event,B.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",B=>{he.warn(B)}),Je.instances.push(this),this.timeline.info({instances:Je.instances.length}),this.user=new Ye(this),Je.isReady&&this.connect()}channel(C){return this.channels.find(C)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var C=this.connection.isUsingTLS(),T=this.timelineSender;this.timelineSenderTimer=new vt(6e4,function(){T.send(C)})}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(C,T,M){return this.global_emitter.bind(C,T,M),this}unbind(C,T,M){return this.global_emitter.unbind(C,T,M),this}bind_global(C){return this.global_emitter.bind_global(C),this}unbind_global(C){return this.global_emitter.unbind_global(C),this}unbind_all(C){return this.global_emitter.unbind_all(),this}subscribeAll(){var C;for(C in this.channels.channels)this.channels.channels.hasOwnProperty(C)&&this.subscribe(C)}subscribe(C){var T=this.channels.add(C,this);return T.subscriptionPending&&T.subscriptionCancelled?T.reinstateSubscription():!T.subscriptionPending&&this.connection.state==="connected"&&T.subscribe(),T}unsubscribe(C){var T=this.channels.find(C);T&&T.subscriptionPending?T.cancelSubscription():(T=this.channels.remove(C),T&&T.subscribed&&T.unsubscribe())}send_event(C,T,M){return this.connection.send_event(C,T,M)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}Je.instances=[],Je.isReady=!1,Je.logToConsole=!1,Je.Runtime=Dt,Je.ScriptReceivers=Dt.ScriptReceivers,Je.DependenciesReceivers=Dt.DependenciesReceivers,Je.auth_callbacks=Dt.auth_callbacks;var za=s.default=Je;function Ry(E){if(E==null)throw"You must pass your app key when you instantiate Pusher."}Dt.setup(Je)}])})})(S2);var gH=S2.exports;const mH=y2(gH);window.axios=nH;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.Pusher=mH;window.Echo=new pH({broadcaster:"pusher",key:{}.MIX_PUSHER_APP_KEY,cluster:{}.MIX_PUSHER_APP_CLUSTER,wsHost:window.location.hostname,wsPort:6001,wssPort:6001,forceTLS:!0,enabledTransports:["ws","wss"],disableStats:!0});var K$;window.Echo.private(`admin.notifications.${(K$=window.Laravel.user)==null?void 0:K$.id}`).listen(".notification.received",n=>{console.log("New notification received:",n),window.dispatchEvent(new CustomEvent("new-notification",{detail:n}))});const bH=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2=function(n){const t=[];let e=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128)}return t},xH=function(n){const t=[];let e=0,s=0;for(;e<n.length;){const i=n[e++];if(i<128)t[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[e++];t[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[e++],o=n[e++],a=n[e++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[s++]=String.fromCharCode(55296+(c>>10)),t[s++]=String.fromCharCode(56320+(c&1023))}else{const r=n[e++],o=n[e++];t[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return t.join("")},T2={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0,u=r>>2,h=(r&3)<<4|a>>4;let f=(a&15)<<2|l>>6,g=l&63;c||(g=64,o||(f=64)),s.push(e[u],e[h],e[f],e[g])}return s.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(_2(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):xH(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=e[n.charAt(i++)],a=i<n.length?e[n.charAt(i)]:0;++i;const l=i<n.length?e[n.charAt(i)]:64;++i;const h=i<n.length?e[n.charAt(i)]:64;if(++i,r==null||a==null||l==null||h==null)throw new yH;const f=r<<2|a>>4;if(s.push(f),l!==64){const g=a<<4&240|l>>2;if(s.push(g),h!==64){const m=l<<6&192|h;s.push(m)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class yH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wH=function(n){const t=_2(n);return T2.encodeByteArray(t,!0)},E2=function(n){return wH(n).replace(/\./g,"")},$2=function(n){try{return T2.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vH(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CH=()=>vH().__FIREBASE_DEFAULTS__,IH=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kH=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&$2(n[1]);return t&&JSON.parse(t)},Hv=()=>{try{return bH()||CH()||IH()||kH()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},SH=n=>{var t,e;return(e=(t=Hv())==null?void 0:t.emulatorHosts)==null?void 0:e[n]},N2=()=>{var n;return(n=Hv())==null?void 0:n.config},R2=n=>{var t;return(t=Hv())==null?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _H{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,s)=>{e?this.reject(e):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ob(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function TH(n){return(await fetch(n,{credentials:"include"})).ok}const $h={};function EH(){const n={prod:[],emulator:[]};for(const t of Object.keys($h))$h[t]?n.emulator.push(t):n.prod.push(t);return n}function $H(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let m_=!1;function NH(n,t){if(typeof window>"u"||typeof document>"u"||!ob(window.location.host)||$h[n]===t||$h[n]||m_)return;$h[n]=t;function e(f){return`__firebase__banner__${f}`}const s="__firebase__banner",r=EH().prod.length>0;function o(){const f=document.getElementById(s);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,g){f.setAttribute("width","24"),f.setAttribute("id",g),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function l(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{m_=!0,o()},f}function u(f,g){f.setAttribute("id",g),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=$H(s),g=e("text"),m=document.getElementById(g)||document.createElement("span"),x=e("learnmore"),b=document.getElementById(x)||document.createElement("a"),y=e("preprendIcon"),v=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const k=f.element;a(k),u(b,x);const I=l();c(v,y),k.append(v,m,b,I),document.body.appendChild(k)}r?(m.innerText="Preview backend disconnected.",v.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(v.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,m.innerText="Preview backend running in this workspace."),m.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RH(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(As())}function AH(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function DH(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function OH(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function PH(){const n=As();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function FH(){try{return typeof indexedDB=="object"}catch{return!1}}function MH(){return new Promise((n,t)=>{try{let e=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var r;t(((r=i.error)==null?void 0:r.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LH="FirebaseError";class Ca extends Error{constructor(t,e,s){super(e),this.code=t,this.customData=s,this.name=LH,Object.setPrototypeOf(this,Ca.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dd.prototype.create)}}class dd{constructor(t,e,s){this.service=t,this.serviceName=e,this.errors=s}create(t,...e){const s=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],o=r?BH(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Ca(i,a,s)}}function BH(n,t){return n.replace(zH,(e,s)=>{const i=t[s];return i!=null?String(i):`<${s}?>`})}const zH=/\{\$([^}]+)}/g;function WH(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Ml(n,t){if(n===t)return!0;const e=Object.keys(n),s=Object.keys(t);for(const i of e){if(!s.includes(i))return!1;const r=n[i],o=t[i];if(b_(r)&&b_(o)){if(!Ml(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!e.includes(i))return!1;return!0}function b_(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(n){const t=[];for(const[e,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function ph(n){const t={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");t[decodeURIComponent(i)]=decodeURIComponent(r)}}),t}function gh(n){const t=n.indexOf("?");if(!t)return"";const e=n.indexOf("#",t);return n.substring(t,e>0?e:void 0)}function VH(n,t){const e=new UH(n,t);return e.subscribe.bind(e)}class UH{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(s=>{this.error(s)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,s){let i;if(t===void 0&&e===void 0&&s===void 0)throw new Error("Missing Observer.");HH(t,["next","error","complete"])?i=t:i={next:t,error:e,complete:s},i.next===void 0&&(i.next=D0),i.error===void 0&&(i.error=D0),i.complete===void 0&&(i.complete=D0);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function HH(n,t){if(typeof n!="object"||n===null)return!1;for(const e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function D0(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(n){return n&&n._delegate?n._delegate:n}class Ll{constructor(t,e,s){this.name=t,this.instanceFactory=e,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GH{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const s=new _H;if(this.instancesDeferred.set(e,s),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),s=(t==null?void 0:t.optional)??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(qH(t))try{this.getOrInitializeService({instanceIdentifier:sc})}catch{}for(const[e,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(t=sc){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=sc){return this.instances.has(t)}getOptions(t=sc){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:e});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(t,e){const s=this.normalizeInstanceIdentifier(e),i=this.onInitCallbacks.get(s)??new Set;i.add(t),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&t(r,s),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const s=this.onInitCallbacks.get(e);if(s)for(const i of s)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:jH(t),options:e}),this.instances.set(t,s),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch{}return s||null}normalizeInstanceIdentifier(t=sc){return this.component?this.component.multipleInstances?t:sc:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jH(n){return n===sc?void 0:n}function qH(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KH{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new GH(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ge;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ge||(Ge={}));const XH={debug:Ge.DEBUG,verbose:Ge.VERBOSE,info:Ge.INFO,warn:Ge.WARN,error:Ge.ERROR,silent:Ge.SILENT},YH=Ge.INFO,JH={[Ge.DEBUG]:"log",[Ge.VERBOSE]:"log",[Ge.INFO]:"info",[Ge.WARN]:"warn",[Ge.ERROR]:"error"},ZH=(n,t,...e)=>{if(t<n.logLevel)return;const s=new Date().toISOString(),i=JH[t];if(i)console[i](`[${s}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};let A2=class{constructor(t){this.name=t,this._logLevel=YH,this._logHandler=ZH,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Ge))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?XH[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Ge.DEBUG,...t),this._logHandler(this,Ge.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Ge.VERBOSE,...t),this._logHandler(this,Ge.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Ge.INFO,...t),this._logHandler(this,Ge.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Ge.WARN,...t),this._logHandler(this,Ge.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Ge.ERROR,...t),this._logHandler(this,Ge.ERROR,...t)}};const QH=(n,t)=>t.some(e=>n instanceof e);let x_,y_;function tG(){return x_||(x_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eG(){return y_||(y_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D2=new WeakMap,_w=new WeakMap,O2=new WeakMap,O0=new WeakMap,Gv=new WeakMap;function nG(n){const t=new Promise((e,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{e(aa(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&D2.set(e,n)}).catch(()=>{}),Gv.set(t,n),t}function sG(n){if(_w.has(n))return;const t=new Promise((e,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{e(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});_w.set(n,t)}let Tw={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return _w.get(n);if(t==="objectStoreNames")return n.objectStoreNames||O2.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return aa(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function iG(n){Tw=n(Tw)}function rG(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const s=n.call(P0(this),t,...e);return O2.set(s,t.sort?t.sort():[t]),aa(s)}:eG().includes(n)?function(...t){return n.apply(P0(this),t),aa(D2.get(this))}:function(...t){return aa(n.apply(P0(this),t))}}function oG(n){return typeof n=="function"?rG(n):(n instanceof IDBTransaction&&sG(n),QH(n,tG())?new Proxy(n,Tw):n)}function aa(n){if(n instanceof IDBRequest)return nG(n);if(O0.has(n))return O0.get(n);const t=oG(n);return t!==n&&(O0.set(n,t),Gv.set(t,n)),t}const P0=n=>Gv.get(n);function aG(n,t,{blocked:e,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,t),a=aa(o);return s&&o.addEventListener("upgradeneeded",c=>{s(aa(o.result),c.oldVersion,c.newVersion,aa(o.transaction),c)}),e&&o.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),a.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const cG=["get","getKey","getAll","getAllKeys","count"],lG=["put","add","delete","clear"],F0=new Map;function w_(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(F0.get(t))return F0.get(t);const e=t.replace(/FromIndex$/,""),s=t!==e,i=lG.includes(e);if(!(e in(s?IDBIndex:IDBObjectStore).prototype)||!(i||cG.includes(e)))return;const r=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let l=c.store;return s&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),i&&c.done]))[0]};return F0.set(t,r),r}iG(n=>({...n,get:(t,e,s)=>w_(t,e)||n.get(t,e,s),has:(t,e)=>!!w_(t,e)||n.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uG{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(hG(e)){const s=e.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(e=>e).join(" ")}}function hG(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const Ew="@firebase/app",v_="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _o=new A2("@firebase/app"),dG="@firebase/app-compat",fG="@firebase/analytics-compat",pG="@firebase/analytics",gG="@firebase/app-check-compat",mG="@firebase/app-check",bG="@firebase/auth",xG="@firebase/auth-compat",yG="@firebase/database",wG="@firebase/data-connect",vG="@firebase/database-compat",CG="@firebase/functions",IG="@firebase/functions-compat",kG="@firebase/installations",SG="@firebase/installations-compat",_G="@firebase/messaging",TG="@firebase/messaging-compat",EG="@firebase/performance",$G="@firebase/performance-compat",NG="@firebase/remote-config",RG="@firebase/remote-config-compat",AG="@firebase/storage",DG="@firebase/storage-compat",OG="@firebase/firestore",PG="@firebase/ai",FG="@firebase/firestore-compat",MG="firebase",LG="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w="[DEFAULT]",BG={[Ew]:"fire-core",[dG]:"fire-core-compat",[pG]:"fire-analytics",[fG]:"fire-analytics-compat",[mG]:"fire-app-check",[gG]:"fire-app-check-compat",[bG]:"fire-auth",[xG]:"fire-auth-compat",[yG]:"fire-rtdb",[wG]:"fire-data-connect",[vG]:"fire-rtdb-compat",[CG]:"fire-fn",[IG]:"fire-fn-compat",[kG]:"fire-iid",[SG]:"fire-iid-compat",[_G]:"fire-fcm",[TG]:"fire-fcm-compat",[EG]:"fire-perf",[$G]:"fire-perf-compat",[NG]:"fire-rc",[RG]:"fire-rc-compat",[AG]:"fire-gcs",[DG]:"fire-gcs-compat",[OG]:"fire-fst",[FG]:"fire-fst-compat",[PG]:"fire-vertex","fire-js":"fire-js",[MG]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cm=new Map,zG=new Map,Nw=new Map;function C_(n,t){try{n.container.addComponent(t)}catch(e){_o.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function zh(n){const t=n.name;if(Nw.has(t))return _o.debug(`There were multiple attempts to register component ${t}.`),!1;Nw.set(t,n);for(const e of cm.values())C_(e,n);for(const e of zG.values())C_(e,n);return!0}function P2(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Ei(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WG={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ca=new dd("app","Firebase",WG);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VG{constructor(t,e,s){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Ll("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ca.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd=LG;function F2(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const s={name:$w,automaticDataCollectionEnabled:!0,...t},i=s.name;if(typeof i!="string"||!i)throw ca.create("bad-app-name",{appName:String(i)});if(e||(e=N2()),!e)throw ca.create("no-options");const r=cm.get(i);if(r){if(Ml(e,r.options)&&Ml(s,r.config))return r;throw ca.create("duplicate-app",{appName:i})}const o=new KH(i);for(const c of Nw.values())o.addComponent(c);const a=new VG(e,s,o);return cm.set(i,a),a}function UG(n=$w){const t=cm.get(n);if(!t&&n===$w&&N2())return F2();if(!t)throw ca.create("no-app",{appName:n});return t}function Tl(n,t,e){let s=BG[n]??n;e&&(s+=`-${e}`);const i=s.match(/\s|\//),r=t.match(/\s|\//);if(i||r){const o=[`Unable to register library "${s}" with version "${t}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&o.push("and"),r&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),_o.warn(o.join(" "));return}zh(new Ll(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HG="firebase-heartbeat-database",GG=1,Wh="firebase-heartbeat-store";let M0=null;function M2(){return M0||(M0=aG(HG,GG,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Wh)}catch(e){console.warn(e)}}}}).catch(n=>{throw ca.create("idb-open",{originalErrorMessage:n.message})})),M0}async function jG(n){try{const e=(await M2()).transaction(Wh),s=await e.objectStore(Wh).get(L2(n));return await e.done,s}catch(t){if(t instanceof Ca)_o.warn(t.message);else{const e=ca.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});_o.warn(e.message)}}}async function I_(n,t){try{const s=(await M2()).transaction(Wh,"readwrite");await s.objectStore(Wh).put(t,L2(n)),await s.done}catch(e){if(e instanceof Ca)_o.warn(e.message);else{const s=ca.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});_o.warn(s.message)}}}function L2(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qG=1024,KG=30;class XG{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new JG(e),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var t,e;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=k_();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>KG){const o=ZG(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){_o.warn(s)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=k_(),{heartbeatsToSend:s,unsentEntries:i}=YG(this._heartbeatsCache.heartbeats),r=E2(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return _o.warn(e),""}}}function k_(){return new Date().toISOString().substring(0,10)}function YG(n,t=qG){const e=[];let s=n.slice();for(const i of n){const r=e.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),S_(e)>t){r.dates.pop();break}}else if(e.push({agent:i.agent,dates:[i.date]}),S_(e)>t){e.pop();break}s=s.slice(1)}return{heartbeatsToSend:e,unsentEntries:s}}class JG{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return FH()?MH().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await jG(this.app);return e!=null&&e.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return I_(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return I_(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function S_(n){return E2(JSON.stringify({version:2,heartbeats:n})).length}function ZG(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let s=1;s<n.length;s++)n[s].date<e&&(e=n[s].date,t=s);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QG(n){zh(new Ll("platform-logger",t=>new uG(t),"PRIVATE")),zh(new Ll("heartbeat",t=>new XG(t),"PRIVATE")),Tl(Ew,v_,n),Tl(Ew,v_,"esm2020"),Tl("fire-js","")}QG("");function B2(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const t6=B2,z2=new dd("auth","Firebase",B2());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm=new A2("@firebase/auth");function e6(n,...t){lm.logLevel<=Ge.WARN&&lm.warn(`Auth (${pd}): ${n}`,...t)}function Wg(n,...t){lm.logLevel<=Ge.ERROR&&lm.error(`Auth (${pd}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(n,...t){throw qv(n,...t)}function er(n,...t){return qv(n,...t)}function jv(n,t,e){const s={...t6(),[t]:e};return new dd("auth","Firebase",s).create(t,{appName:n.name})}function ko(n){return jv(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function n6(n,t,e){const s=e;if(!(t instanceof s))throw s.name!==t.constructor.name&&Pi(n,"argument-error"),jv(n,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function qv(n,...t){if(typeof n!="string"){const e=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(e,...s)}return z2.create(n,...t)}function Ht(n,t,...e){if(!n)throw qv(t,...e)}function xo(n){const t="INTERNAL ASSERTION FAILED: "+n;throw Wg(t),new Error(t)}function To(n,t){n||xo(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rw(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function s6(){return __()==="http:"||__()==="https:"}function __(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i6(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(s6()||DH()||"connection"in navigator)?navigator.onLine:!0}function r6(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd{constructor(t,e){this.shortDelay=t,this.longDelay=e,To(e>t,"Short delay should be less than long delay!"),this.isMobile=RH()||OH()}get(){return i6()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kv(n,t){To(n.emulator,"Emulator should always be set here");const{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{static initialize(t,e,s){this.fetchImpl=t,e&&(this.headersImpl=e),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o6={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a6=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],c6=new gd(3e4,6e4);function Ao(n,t){return n.tenantId&&!t.tenantId?{...t,tenantId:n.tenantId}:t}async function zr(n,t,e,s,i={}){return V2(n,i,async()=>{let r={},o={};s&&(t==="GET"?o=s:r={body:JSON.stringify(s)});const a=fd({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const l={method:t,headers:c,...r};return AH()||(l.referrerPolicy="no-referrer"),n.emulatorConfig&&ob(n.emulatorConfig.host)&&(l.credentials="include"),W2.fetch()(await U2(n,n.config.apiHost,e,a),l)})}async function V2(n,t,e){n._canInitEmulator=!1;const s={...o6,...t};try{const i=new u6(n),r=await Promise.race([e(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw cg(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw cg(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw cg(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw cg(n,"user-disabled",o);const u=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw jv(n,u,l);Pi(n,u)}}catch(i){if(i instanceof Ca)throw i;Pi(n,"network-request-failed",{message:String(i)})}}async function md(n,t,e,s,i={}){const r=await zr(n,t,e,s,i);return"mfaPendingCredential"in r&&Pi(n,"multi-factor-auth-required",{_serverResponse:r}),r}async function U2(n,t,e,s){const i=`${t}${e}?${s}`,r=n,o=r.config.emulator?Kv(n.config,i):`${n.config.apiScheme}://${i}`;return a6.includes(e)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function l6(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class u6{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,s)=>{this.timer=setTimeout(()=>s(er(this.auth,"network-request-failed")),c6.get())})}}function cg(n,t,e){const s={appName:n.name};e.email&&(s.email=e.email),e.phoneNumber&&(s.phoneNumber=e.phoneNumber);const i=er(n,t,s);return i.customData._tokenResponse=e,i}function T_(n){return n!==void 0&&n.enterprise!==void 0}class h6{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return l6(e.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function d6(n,t){return zr(n,"GET","/v2/recaptchaConfig",Ao(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f6(n,t){return zr(n,"POST","/v1/accounts:delete",t)}async function um(n,t){return zr(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nh(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function p6(n,t=!1){const e=hr(n),s=await e.getIdToken(t),i=Xv(s);Ht(i&&i.exp&&i.auth_time&&i.iat,e.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Nh(L0(i.auth_time)),issuedAtTime:Nh(L0(i.iat)),expirationTime:Nh(L0(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function L0(n){return Number(n)*1e3}function Xv(n){const[t,e,s]=n.split(".");if(t===void 0||e===void 0||s===void 0)return Wg("JWT malformed, contained fewer than 3 sections"),null;try{const i=$2(e);return i?JSON.parse(i):(Wg("Failed to decode base64 JWT payload"),null)}catch(i){return Wg("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function E_(n){const t=Xv(n);return Ht(t,"internal-error"),Ht(typeof t.exp<"u","internal-error"),Ht(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bl(n,t,e=!1){if(e)return t;try{return await t}catch(s){throw s instanceof Ca&&g6(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function g6({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m6{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nh(this.lastLoginAt),this.creationTime=Nh(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hm(n){var h;const t=n.auth,e=await n.getIdToken(),s=await Bl(n,um(t,{idToken:e}));Ht(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const r=(h=i.providerUserInfo)!=null&&h.length?H2(i.providerUserInfo):[],o=x6(n.providerData,r),a=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(o!=null&&o.length),l=a?c:!1,u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Aw(i.createdAt,i.lastLoginAt),isAnonymous:l};Object.assign(n,u)}async function b6(n){const t=hr(n);await hm(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function x6(n,t){return[...n.filter(s=>!t.some(i=>i.providerId===s.providerId)),...t]}function H2(n){return n.map(({providerId:t,...e})=>({providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y6(n,t){const e=await V2(n,{},async()=>{const s=fd({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=n.config,o=await U2(n,i,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:s};return n.emulatorConfig&&ob(n.emulatorConfig.host)&&(c.credentials="include"),W2.fetch()(o,c)});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function w6(n,t){return zr(n,"POST","/v2/accounts:revokeToken",Ao(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class El{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ht(t.idToken,"internal-error"),Ht(typeof t.idToken<"u","internal-error"),Ht(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):E_(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Ht(t.length!==0,"internal-error");const e=E_(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(Ht(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:s,refreshToken:i,expiresIn:r}=await y6(t,e);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(t,e,s){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(t,e){const{refreshToken:s,accessToken:i,expirationTime:r}=e,o=new El;return s&&(Ht(typeof s=="string","internal-error",{appName:t}),o.refreshToken=s),i&&(Ht(typeof i=="string","internal-error",{appName:t}),o.accessToken=i),r&&(Ht(typeof r=="number","internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new El,this.toJSON())}_performRefresh(){return xo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(n,t){Ht(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class Ji{constructor({uid:t,auth:e,stsTokenManager:s,...i}){this.providerId="firebase",this.proactiveRefresh=new m6(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Aw(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(t){const e=await Bl(this,this.stsTokenManager.getToken(this.auth,t));return Ht(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return p6(this,t)}reload(){return b6(this)}_assign(t){this!==t&&(Ht(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>({...e})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Ji({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return e.metadata._copy(this.metadata),e}_onReload(t){Ht(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let s=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),s=!0),e&&await hm(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ei(this.auth.app))return Promise.reject(ko(this.auth));const t=await this.getIdToken();return await Bl(this,f6(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){const s=e.displayName??void 0,i=e.email??void 0,r=e.phoneNumber??void 0,o=e.photoURL??void 0,a=e.tenantId??void 0,c=e._redirectEventId??void 0,l=e.createdAt??void 0,u=e.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:g,providerData:m,stsTokenManager:x}=e;Ht(h&&x,t,"internal-error");const b=El.fromJSON(this.name,x);Ht(typeof h=="string",t,"internal-error"),Jo(s,t.name),Jo(i,t.name),Ht(typeof f=="boolean",t,"internal-error"),Ht(typeof g=="boolean",t,"internal-error"),Jo(r,t.name),Jo(o,t.name),Jo(a,t.name),Jo(c,t.name),Jo(l,t.name),Jo(u,t.name);const y=new Ji({uid:h,auth:t,email:i,emailVerified:f,displayName:s,isAnonymous:g,photoURL:o,phoneNumber:r,tenantId:a,stsTokenManager:b,createdAt:l,lastLoginAt:u});return m&&Array.isArray(m)&&(y.providerData=m.map(v=>({...v}))),c&&(y._redirectEventId=c),y}static async _fromIdTokenResponse(t,e,s=!1){const i=new El;i.updateFromServerResponse(e);const r=new Ji({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:s});return await hm(r),r}static async _fromGetAccountInfoResponse(t,e,s){const i=e.users[0];Ht(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?H2(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),a=new El;a.updateFromIdToken(s);const c=new Ji({uid:i.localId,auth:t,stsTokenManager:a,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Aw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(c,l),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $_=new Map;function yo(n){To(n instanceof Function,"Expected a class definition");let t=$_.get(n);return t?(To(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,$_.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}G2.type="NONE";const N_=G2;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vg(n,t,e){return`firebase:${n}:${t}:${e}`}class $l{constructor(t,e,s){this.persistence=t,this.auth=e,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=Vg(this.userKey,i.apiKey,r),this.fullPersistenceKey=Vg("persistence",i.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const e=await um(this.auth,{idToken:t}).catch(()=>{});return e?Ji._fromGetAccountInfoResponse(this.auth,e,t):null}return Ji._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,s="authUser"){if(!e.length)return new $l(yo(N_),t,s);const i=(await Promise.all(e.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let r=i[0]||yo(N_);const o=Vg(s,t.config.apiKey,t.name);let a=null;for(const l of e)try{const u=await l._get(o);if(u){let h;if(typeof u=="string"){const f=await um(t,{idToken:u}).catch(()=>{});if(!f)break;h=await Ji._fromGetAccountInfoResponse(t,f,u)}else h=Ji._fromJSON(t,u);l!==r&&(a=h),r=l;break}}catch{}const c=i.filter(l=>l._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new $l(r,t,s):(r=c[0],a&&await r._set(o,a.toJSON()),await Promise.all(e.map(async l=>{if(l!==r)try{await l._remove(o)}catch{}})),new $l(r,t,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R_(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(X2(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(j2(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(J2(t))return"Blackberry";if(Z2(t))return"Webos";if(q2(t))return"Safari";if((t.includes("chrome/")||K2(t))&&!t.includes("edge/"))return"Chrome";if(Y2(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(e);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function j2(n=As()){return/firefox\//i.test(n)}function q2(n=As()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function K2(n=As()){return/crios\//i.test(n)}function X2(n=As()){return/iemobile/i.test(n)}function Y2(n=As()){return/android/i.test(n)}function J2(n=As()){return/blackberry/i.test(n)}function Z2(n=As()){return/webos/i.test(n)}function Yv(n=As()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function v6(n=As()){var t;return Yv(n)&&!!((t=window.navigator)!=null&&t.standalone)}function C6(){return PH()&&document.documentMode===10}function Q2(n=As()){return Yv(n)||Y2(n)||Z2(n)||J2(n)||/windows phone/i.test(n)||X2(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tN(n,t=[]){let e;switch(n){case"Browser":e=R_(As());break;case"Worker":e=`${R_(As())}-${n}`;break;default:e=n}const s=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${pd}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const s=r=>new Promise((o,a)=>{try{const c=t(r);o(c)}catch(c){a(c)}});s.onAbort=e,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const s of this.queue)await s(t),s.onAbort&&e.push(s.onAbort)}catch(s){e.reverse();for(const i of e)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k6(n,t={}){return zr(n,"GET","/v2/passwordPolicy",Ao(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S6=6;class _6{constructor(t){var s;const e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??S6,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((s=t.allowedNonAlphanumericCharacters)==null?void 0:s.join(""))??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(e.meetsMinPasswordLength=t.length>=s),i&&(e.meetsMaxPasswordLength=t.length<=i)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let s;for(let i=0;i<t.length;i++)s=t.charAt(i),this.updatePasswordCharacterOptionsStatuses(e,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(t,e,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T6{constructor(t,e,s,i){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new A_(this),this.idTokenSubscription=new A_(this),this.beforeStateQueue=new I6(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=z2,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=yo(e)),this._initializationPromise=this.queue(async()=>{var s,i,r;if(!this._deleted&&(this.persistenceManager=await $l.create(this,t),(s=this._resolvePersistenceManagerAvailable)==null||s.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=((r=this.currentUser)==null?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await um(this,{idToken:t}),s=await Ji._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(s)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var r;if(Ei(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const e=await this.assertedPersistence.getCurrentUser();let s=e,i=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(r=this.redirectUser)==null?void 0:r._redirectEventId,a=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(t);(!o||o===a)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ht(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await hm(t)}catch(e){if((e==null?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=r6()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ei(this.app))return Promise.reject(ko(this));const e=t?hr(t):null;return e&&Ht(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Ht(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ei(this.app)?Promise.reject(ko(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ei(this.app)?Promise.reject(ko(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(yo(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await k6(this),e=new _6(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new dd("auth","Firebase",t())}onAuthStateChanged(t,e,s){return this.registerStateListener(this.authStateSubscription,t,e,s)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,s){return this.registerStateListener(this.idTokenSubscription,t,e,s)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const s=this.onAuthStateChanged(()=>{s(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(s.tenantId=this.tenantId),await w6(this,s)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)==null?void 0:t.toJSON()}}async _setRedirectUser(t,e){const s=await this.getOrInitRedirectPersistenceManager(e);return t===null?s.removeCurrentUser():s.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&yo(t)||this._popupRedirectResolver;Ht(e,this,"argument-error"),this.redirectPersistenceManager=await $l.create(this,[yo(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,s;return this._isInitialized&&await this.queue(async()=>{}),((e=this._currentUser)==null?void 0:e._redirectEventId)===t?this._currentUser:((s=this.redirectUser)==null?void 0:s._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=((e=this.currentUser)==null?void 0:e.uid)??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,s,i){if(this._deleted)return()=>{};const r=typeof e=="function"?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ht(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof e=="function"){const c=t.addObserver(e,s,i);return()=>{o=!0,c()}}else{const c=t.addObserver(e);return()=>{o=!0,c()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ht(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=tN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const e=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());e&&(t["X-Firebase-Client"]=e);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;if(Ei(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:e.getToken());return t!=null&&t.error&&e6(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Do(n){return hr(n)}class A_{constructor(t){this.auth=t,this.observer=null,this.addObserver=VH(e=>this.observer=e)}get next(){return Ht(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ab={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function E6(n){ab=n}function eN(n){return ab.loadJS(n)}function $6(){return ab.recaptchaEnterpriseScript}function N6(){return ab.gapiScript}function R6(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class A6{constructor(){this.enterprise=new D6}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class D6{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const O6="recaptcha-enterprise",nN="NO_RECAPTCHA";class P6{constructor(t){this.type=O6,this.auth=Do(t)}async verify(t="verify",e=!1){async function s(r){if(!e){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,a)=>{d6(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const l=new h6(c);return r.tenantId==null?r._agentRecaptchaConfig=l:r._tenantRecaptchaConfigs[r.tenantId]=l,o(l.siteKey)}}).catch(c=>{a(c)})})}function i(r,o,a){const c=window.grecaptcha;T_(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:t}).then(l=>{o(l)}).catch(()=>{o(nN)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new A6().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(a=>{if(!e&&T_(window.grecaptcha))i(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=$6();c.length!==0&&(c+=a),eN(c).then(()=>{i(a,r,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})}}async function ih(n,t,e,s=!1,i=!1){const r=new P6(n);let o;if(i)o=nN;else try{o=await r.verify(e)}catch{o=await r.verify(e,!0)}const a={...t};if(e==="mfaSmsEnrollment"||e==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,l=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function dm(n,t,e,s,i){var r,o;if(i==="EMAIL_PASSWORD_PROVIDER")if((r=n._getRecaptchaConfig())!=null&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await ih(n,t,e,e==="getOobCode");return s(n,a)}else return s(n,t).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${e} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await ih(n,t,e,e==="getOobCode");return s(n,c)}else return Promise.reject(a)});else if(i==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await ih(n,t,e);return s(n,a).catch(async c=>{var l;if(((l=n._getRecaptchaConfig())==null?void 0:l.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${e} flow.`);const u=await ih(n,t,e,!1,!0);return s(n,u)}return Promise.reject(c)})}else{const a=await ih(n,t,e,!1,!0);return s(n,a)}else return Promise.reject(i+" provider is not supported.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F6(n,t){const e=P2(n,"auth");if(e.isInitialized()){const i=e.getImmediate(),r=e.getOptions();if(Ml(r,t??{}))return i;Pi(i,"already-initialized")}return e.initialize({options:t})}function M6(n,t){const e=(t==null?void 0:t.persistence)||[],s=(Array.isArray(e)?e:[e]).map(yo);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(s,t==null?void 0:t.popupRedirectResolver)}function L6(n,t,e){const s=Do(n);Ht(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const i=!!(e!=null&&e.disableWarnings),r=sN(t),{host:o,port:a}=B6(t),c=a===null?"":`:${a}`,l={url:`${r}//${o}${c}/`},u=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){Ht(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),Ht(Ml(l,s.config.emulator)&&Ml(u,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=l,s.emulatorConfig=u,s.settings.appVerificationDisabledForTesting=!0,ob(o)?(TH(`${r}//${o}${c}`),NH("Auth",!0)):i||z6()}function sN(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function B6(n){const t=sN(n),e=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!e)return{host:"",port:null};const s=e[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:D_(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:D_(o)}}}function D_(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function z6(){function n(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return xo("not implemented")}_getIdTokenResponse(t){return xo("not implemented")}_linkToIdToken(t,e){return xo("not implemented")}_getReauthenticationResolver(t){return xo("not implemented")}}async function W6(n,t){return zr(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V6(n,t){return md(n,"POST","/v1/accounts:signInWithPassword",Ao(n,t))}async function iN(n,t){return zr(n,"POST","/v1/accounts:sendOobCode",Ao(n,t))}async function U6(n,t){return iN(n,t)}async function H6(n,t){return iN(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G6(n,t){return md(n,"POST","/v1/accounts:signInWithEmailLink",Ao(n,t))}async function j6(n,t){return md(n,"POST","/v1/accounts:signInWithEmailLink",Ao(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh extends Jv{constructor(t,e,s,i=null){super("password",s),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new Vh(t,e,"password")}static _fromEmailAndCode(t,e,s=null){return new Vh(t,e,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t;if(e!=null&&e.email&&(e!=null&&e.password)){if(e.signInMethod==="password")return this._fromEmailAndPassword(e.email,e.password);if(e.signInMethod==="emailLink")return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const e={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return dm(t,e,"signInWithPassword",V6,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return G6(t,{email:this._email,oobCode:this._password});default:Pi(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":const s={idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return dm(t,s,"signUpPassword",W6,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return j6(t,{idToken:e,email:this._email,oobCode:this._password});default:Pi(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nl(n,t){return md(n,"POST","/v1/accounts:signInWithIdp",Ao(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q6="http://localhost";class Cc extends Jv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Cc(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Pi("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:s,signInMethod:i,...r}=e;if(!s||!i)return null;const o=new Cc(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(t){const e=this.buildRequest();return Nl(t,e)}_linkToIdToken(t,e){const s=this.buildRequest();return s.idToken=e,Nl(t,s)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Nl(t,e)}buildRequest(){const t={requestUri:q6,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=fd(e)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K6(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function X6(n){const t=ph(gh(n)).link,e=t?ph(gh(t)).deep_link_id:null,s=ph(gh(n)).deep_link_id;return(s?ph(gh(s)).link:null)||s||e||t||n}class Zv{constructor(t){const e=ph(gh(t)),s=e.apiKey??null,i=e.oobCode??null,r=K6(e.mode??null);Ht(s&&i&&r,"argument-error"),this.apiKey=s,this.operation=r,this.code=i,this.continueUrl=e.continueUrl??null,this.languageCode=e.lang??null,this.tenantId=e.tenantId??null}static parseLink(t){const e=X6(t);try{return new Zv(e)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(){this.providerId=iu.PROVIDER_ID}static credential(t,e){return Vh._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const s=Zv.parseLink(e);return Ht(s,"argument-error"),Vh._fromEmailAndCode(t,s.code,s.tenantId)}}iu.PROVIDER_ID="password";iu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";iu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd extends Qv{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo extends bd{constructor(){super("facebook.com")}static credential(t){return Cc._fromParams({providerId:fo.PROVIDER_ID,signInMethod:fo.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return fo.credentialFromTaggedObject(t)}static credentialFromError(t){return fo.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return fo.credential(t.oauthAccessToken)}catch{return null}}}fo.FACEBOOK_SIGN_IN_METHOD="facebook.com";fo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po extends bd{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Cc._fromParams({providerId:po.PROVIDER_ID,signInMethod:po.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return po.credentialFromTaggedObject(t)}static credentialFromError(t){return po.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:s}=t;if(!e&&!s)return null;try{return po.credential(e,s)}catch{return null}}}po.GOOGLE_SIGN_IN_METHOD="google.com";po.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go extends bd{constructor(){super("github.com")}static credential(t){return Cc._fromParams({providerId:go.PROVIDER_ID,signInMethod:go.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return go.credentialFromTaggedObject(t)}static credentialFromError(t){return go.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return go.credential(t.oauthAccessToken)}catch{return null}}}go.GITHUB_SIGN_IN_METHOD="github.com";go.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo extends bd{constructor(){super("twitter.com")}static credential(t,e){return Cc._fromParams({providerId:mo.PROVIDER_ID,signInMethod:mo.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return mo.credentialFromTaggedObject(t)}static credentialFromError(t){return mo.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:s}=t;if(!e||!s)return null;try{return mo.credential(e,s)}catch{return null}}}mo.TWITTER_SIGN_IN_METHOD="twitter.com";mo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y6(n,t){return md(n,"POST","/v1/accounts:signUp",Ao(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,s,i=!1){const r=await Ji._fromIdTokenResponse(t,s,i),o=O_(s);return new Ic({user:r,providerId:o,_tokenResponse:s,operationType:e})}static async _forOperation(t,e,s){await t._updateTokensIfNecessary(s,!0);const i=O_(s);return new Ic({user:t,providerId:i,_tokenResponse:s,operationType:e})}}function O_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm extends Ca{constructor(t,e,s,i){super(e.code,e.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,fm.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(t,e,s,i){return new fm(t,e,s,i)}}function rN(n,t,e,s){return(t==="reauthenticate"?e._getReauthenticationResolver(n):e._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?fm._fromErrorAndOperation(n,r,t,s):r})}async function J6(n,t,e=!1){const s=await Bl(n,t._linkToIdToken(n.auth,await n.getIdToken()),e);return Ic._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z6(n,t,e=!1){const{auth:s}=n;if(Ei(s.app))return Promise.reject(ko(s));const i="reauthenticate";try{const r=await Bl(n,rN(s,i,t,n),e);Ht(r.idToken,s,"internal-error");const o=Xv(r.idToken);Ht(o,s,"internal-error");const{sub:a}=o;return Ht(n.uid===a,s,"user-mismatch"),Ic._forOperation(n,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Pi(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oN(n,t,e=!1){if(Ei(n.app))return Promise.reject(ko(n));const s="signIn",i=await rN(n,s,t),r=await Ic._fromIdTokenResponse(n,s,i);return e||await n._updateCurrentUser(r.user),r}async function Q6(n,t){return oN(Do(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aN(n,t,e){var s;Ht(((s=e.url)==null?void 0:s.length)>0,n,"invalid-continue-uri"),Ht(typeof e.dynamicLinkDomain>"u"||e.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),Ht(typeof e.linkDomain>"u"||e.linkDomain.length>0,n,"invalid-hosting-link-domain"),t.continueUrl=e.url,t.dynamicLinkDomain=e.dynamicLinkDomain,t.linkDomain=e.linkDomain,t.canHandleCodeInApp=e.handleCodeInApp,e.iOS&&(Ht(e.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),t.iOSBundleId=e.iOS.bundleId),e.android&&(Ht(e.android.packageName.length>0,n,"missing-android-pkg-name"),t.androidInstallApp=e.android.installApp,t.androidMinimumVersionCode=e.android.minimumVersion,t.androidPackageName=e.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cN(n){const t=Do(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function tj(n,t,e){const s=Do(n),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};e&&aN(s,i,e),await dm(s,i,"getOobCode",H6,"EMAIL_PASSWORD_PROVIDER")}async function ej(n,t,e){if(Ei(n.app))return Promise.reject(ko(n));const s=Do(n),o=await dm(s,{returnSecureToken:!0,email:t,password:e,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Y6,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&cN(n),c}),a=await Ic._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function nj(n,t,e){return Ei(n.app)?Promise.reject(ko(n)):Q6(hr(n),iu.credential(t,e)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&cN(n),s})}async function sj(n,t){const e=hr(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};t&&aN(e.auth,i,t);const{email:r}=await U6(e.auth,i);r!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ij(n,t){return zr(n,"POST","/v1/accounts:update",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rj(n,{displayName:t,photoURL:e}){if(t===void 0&&e===void 0)return;const s=hr(n),r={idToken:await s.getIdToken(),displayName:t,photoUrl:e,returnSecureToken:!0},o=await Bl(s,ij(s.auth,r));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function oj(n,t,e,s){return hr(n).onIdTokenChanged(t,e,s)}function aj(n,t,e){return hr(n).beforeAuthStateChanged(t,e)}function cj(n,t,e,s){return hr(n).onAuthStateChanged(t,e,s)}function lj(n){return hr(n).signOut()}const pm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(pm,"1"),this.storage.removeItem(pm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uj=1e3,hj=10;class uN extends lN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Q2(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const s=this.storage.getItem(e),i=this.localCache[e];s!==i&&t(e,i,s)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const s=t.key;e?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!e&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);C6()&&r!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,hj):i()}notifyListeners(t,e){this.localCache[t]=e;const s=this.listeners[t];if(s)for(const i of Array.from(s))i(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:s}),!0)})},uj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}uN.type="LOCAL";const dj=uN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN extends lN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}hN.type="SESSION";const dN=hN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fj(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(i=>i.isListeningto(t));if(e)return e;const s=new cb(t);return this.receivers.push(s),s}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:s,eventType:i,data:r}=e.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;e.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const a=Array.from(o).map(async l=>l(e.origin,r)),c=await fj(a);e.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}cb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t1(n="",t=10){let e="";for(let s=0;s<t;s++)e+=Math.floor(Math.random()*10);return n+e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pj{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((a,c)=>{const l=t1("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(h){const f=h;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(f.data.response);break;default:clearTimeout(u),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:e},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Er(){return window}function gj(n){Er().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fN(){return typeof Er().WorkerGlobalScope<"u"&&typeof Er().importScripts=="function"}async function mj(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function bj(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function xj(){return fN()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pN="firebaseLocalStorageDb",yj=1,gm="firebaseLocalStorage",gN="fbase_key";class xd{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function lb(n,t){return n.transaction([gm],t?"readwrite":"readonly").objectStore(gm)}function wj(){const n=indexedDB.deleteDatabase(pN);return new xd(n).toPromise()}function Dw(){const n=indexedDB.open(pN,yj);return new Promise((t,e)=>{n.addEventListener("error",()=>{e(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(gm,{keyPath:gN})}catch(i){e(i)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(gm)?t(s):(s.close(),await wj(),t(await Dw()))})})}async function P_(n,t,e){const s=lb(n,!0).put({[gN]:t,value:e});return new xd(s).toPromise()}async function vj(n,t){const e=lb(n,!1).get(t),s=await new xd(e).toPromise();return s===void 0?null:s.value}function F_(n,t){const e=lb(n,!0).delete(t);return new xd(e).toPromise()}const Cj=800,Ij=3;class mN{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Dw(),this.db)}async _withRetries(t){let e=0;for(;;)try{const s=await this._openDb();return await t(s)}catch(s){if(e++>Ij)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fN()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=cb._getInstance(xj()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){var e,s;if(this.activeServiceWorker=await mj(),!this.activeServiceWorker)return;this.sender=new pj(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&(e=t[0])!=null&&e.fulfilled&&(s=t[0])!=null&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||bj()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Dw();return await P_(t,pm,"1"),await F_(t,pm),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(s=>P_(s,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(s=>vj(s,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>F_(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(i=>{const r=lb(i,!1).getAll();return new xd(r).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],s=new Set;if(t.length!==0)for(const{fbase_key:i,value:r}of t)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),e.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),e.push(i));return e}notifyListeners(t,e){this.localCache[t]=e;const s=this.listeners[t];if(s)for(const i of Array.from(s))i(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Cj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}mN.type="LOCAL";const kj=mN;new gd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bN(n,t){return t?yo(t):(Ht(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1 extends Jv{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Nl(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Nl(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Nl(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Sj(n){return oN(n.auth,new e1(n),n.bypassAuthState)}function _j(n){const{auth:t,user:e}=n;return Ht(e,t,"internal-error"),Z6(e,new e1(n),n.bypassAuthState)}async function Tj(n){const{auth:t,user:e}=n;return Ht(e,t,"internal-error"),J6(e,new e1(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(t,e,s,i,r=!1){this.auth=t,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:s,postBody:i,tenantId:r,error:o,type:a}=t;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:e,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Sj;case"linkViaPopup":case"linkViaRedirect":return Tj;case"reauthViaPopup":case"reauthViaRedirect":return _j;default:Pi(this.auth,"internal-error")}}resolve(t){To(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){To(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ej=new gd(2e3,1e4);async function lg(n,t,e){if(Ei(n.app))return Promise.reject(er(n,"operation-not-supported-in-this-environment"));const s=Do(n);n6(n,t,Qv);const i=bN(s,e);return new hc(s,"signInViaPopup",t,i).executeNotNull()}class hc extends xN{constructor(t,e,s,i,r){super(t,e,i,r),this.provider=s,this.authWindow=null,this.pollId=null,hc.currentPopupAction&&hc.currentPopupAction.cancel(),hc.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ht(t,this.auth,"internal-error"),t}async onExecution(){To(this.filter.length===1,"Popup operations only handle one event");const t=t1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(er(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)==null?void 0:t.associatedEvent)||null}cancel(){this.reject(er(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,hc.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,s;if((s=(e=this.authWindow)==null?void 0:e.window)!=null&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(er(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Ej.get())};t()}}hc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j="pendingRedirect",Ug=new Map;class Nj extends xN{constructor(t,e,s=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,s),this.eventId=null}async execute(){let t=Ug.get(this.auth._key());if(!t){try{const s=await Rj(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(s)}catch(e){t=()=>Promise.reject(e)}Ug.set(this.auth._key(),t)}return this.bypassAuthState||Ug.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Rj(n,t){const e=Oj(t),s=Dj(n);if(!await s._isAvailable())return!1;const i=await s._get(e)==="true";return await s._remove(e),i}function Aj(n,t){Ug.set(n._key(),t)}function Dj(n){return yo(n._redirectPersistence)}function Oj(n){return Vg($j,n.config.apiKey,n.name)}async function Pj(n,t,e=!1){if(Ei(n.app))return Promise.reject(ko(n));const s=Do(n),i=bN(s,t),o=await new Nj(s,i,e).execute();return o&&!e&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,t)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj=10*60*1e3;class Mj{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(t,s)&&(e=!0,this.sendToConsumer(t,s),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Lj(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var s;if(t.error&&!yN(t)){const i=((s=t.error.code)==null?void 0:s.split("auth/")[1])||"internal-error";e.onError(er(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const s=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&s}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Fj&&this.cachedEventUids.clear(),this.cachedEventUids.has(M_(t))}saveEventToCache(t){this.cachedEventUids.add(M_(t)),this.lastProcessedEventTime=Date.now()}}function M_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function yN({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function Lj(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yN(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bj(n,t={}){return zr(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zj=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Wj=/^https?/;async function Vj(n){if(n.config.emulator)return;const{authorizedDomains:t}=await Bj(n);for(const e of t)try{if(Uj(e))return}catch{}Pi(n,"unauthorized-domain")}function Uj(n){const t=Rw(),{protocol:e,hostname:s}=new URL(t);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?e==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&o.hostname===s}if(!Wj.test(e))return!1;if(zj.test(n))return s===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hj=new gd(3e4,6e4);function L_(){const n=Er().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let e=0;e<n.CP.length;e++)n.CP[e]=null}}function Gj(n){return new Promise((t,e)=>{var i,r,o;function s(){L_(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{L_(),e(er(n,"network-request-failed"))},timeout:Hj.get()})}if((r=(i=Er().gapi)==null?void 0:i.iframes)!=null&&r.Iframe)t(gapi.iframes.getContext());else if((o=Er().gapi)!=null&&o.load)s();else{const a=R6("iframefcb");return Er()[a]=()=>{gapi.load?s():e(er(n,"network-request-failed"))},eN(`${N6()}?onload=${a}`).catch(c=>e(c))}}).catch(t=>{throw Hg=null,t})}let Hg=null;function jj(n){return Hg=Hg||Gj(n),Hg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qj=new gd(5e3,15e3),Kj="__/auth/iframe",Xj="emulator/auth/iframe",Yj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Jj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zj(n){const t=n.config;Ht(t.authDomain,n,"auth-domain-config-required");const e=t.emulator?Kv(t,Xj):`https://${n.config.authDomain}/${Kj}`,s={apiKey:t.apiKey,appName:n.name,v:pd},i=Jj.get(n.config.apiHost);i&&(s.eid=i);const r=n._getFrameworks();return r.length&&(s.fw=r.join(",")),`${e}?${fd(s).slice(1)}`}async function Qj(n){const t=await jj(n),e=Er().gapi;return Ht(e,n,"internal-error"),t.open({where:document.body,url:Zj(n),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yj,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=er(n,"network-request-failed"),a=Er().setTimeout(()=>{r(o)},qj.get());function c(){Er().clearTimeout(a),i(s)}s.ping(c).then(c,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},e5=500,n5=600,s5="_blank",i5="http://localhost";class B_{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function r5(n,t,e,s=e5,i=n5){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const c={...t5,width:s.toString(),height:i.toString(),top:r,left:o},l=As().toLowerCase();e&&(a=K2(l)?s5:e),j2(l)&&(t=t||i5,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[g,m])=>`${f}${g}=${m},`,"");if(v6(l)&&a!=="_self")return o5(t||"",a),new B_(null);const h=window.open(t||"",a,u);Ht(h,n,"popup-blocked");try{h.focus()}catch{}return new B_(h)}function o5(n,t){const e=document.createElement("a");e.href=n,e.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a5="__/auth/handler",c5="emulator/auth/handler",l5=encodeURIComponent("fac");async function z_(n,t,e,s,i,r){Ht(n.config.authDomain,n,"auth-domain-config-required"),Ht(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:e,redirectUrl:s,v:pd,eventId:i};if(t instanceof Qv){t.setDefaultLanguage(n.languageCode),o.providerId=t.providerId||"",WH(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[u,h]of Object.entries(r||{}))o[u]=h}if(t instanceof bd){const u=t.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const c=await n._getAppCheckToken(),l=c?`#${l5}=${encodeURIComponent(c)}`:"";return`${u5(n)}?${fd(a).slice(1)}${l}`}function u5({config:n}){return n.emulator?Kv(n,c5):`https://${n.authDomain}/${a5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B0="webStorageSupport";class h5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dN,this._completeRedirectFn=Pj,this._overrideRedirectResult=Aj}async _openPopup(t,e,s,i){var o;To((o=this.eventManagers[t._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const r=await z_(t,e,s,Rw(),i);return r5(t,r,t1())}async _openRedirect(t,e,s,i){await this._originValidation(t);const r=await z_(t,e,s,Rw(),i);return gj(r),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:i,promise:r}=this.eventManagers[e];return i?Promise.resolve(i):(To(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(t);return this.eventManagers[e]={promise:s},s.catch(()=>{delete this.eventManagers[e]}),s}async initAndGetManager(t){const e=await Qj(t),s=new Mj(t);return e.register("authEvent",i=>(Ht(i==null?void 0:i.authEvent,t,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:s},this.iframes[t._key()]=e,s}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(B0,{type:B0},i=>{var o;const r=(o=i==null?void 0:i[0])==null?void 0:o[B0];r!==void 0&&e(!!r),Pi(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=Vj(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return Q2()||q2()||Yv()}}const d5=h5;var W_="@firebase/auth",V_="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f5{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)==null?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(s=>{t((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Ht(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p5(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function g5(n){zh(new Ll("auth",(t,{options:e})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Ht(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tN(n)},l=new T6(s,i,r,c);return M6(l,e),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,s)=>{t.getProvider("auth-internal").initialize()})),zh(new Ll("auth-internal",t=>{const e=Do(t.getProvider("auth").getImmediate());return(s=>new f5(s))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Tl(W_,V_,p5(n)),Tl(W_,V_,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m5=5*60,b5=R2("authIdTokenMaxAge")||m5;let U_=null;const x5=n=>async t=>{const e=t&&await t.getIdTokenResult(),s=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(s&&s>b5)return;const i=e==null?void 0:e.token;U_!==i&&(U_=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function y5(n=UG()){const t=P2(n,"auth");if(t.isInitialized())return t.getImmediate();const e=F6(n,{popupRedirectResolver:d5,persistence:[kj,dj,dN]}),s=R2("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=x5(r.toString());aj(e,o,()=>o(e.currentUser)),oj(e,a=>o(a))}}const i=SH("auth");return i&&L6(e,`http://${i}`),e}function w5(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}E6({loadJS(n){return new Promise((t,e)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=t,s.onerror=i=>{const r=er("internal-error");r.customData=i,e(r)},s.type="text/javascript",s.charset="UTF-8",w5().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});g5("Browser");var v5="firebase",C5="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Tl(v5,C5,"app");const I5={apiKey:{}.VITE_FIREBASE_API_KEY,authDomain:{}.VITE_FIREBASE_AUTH_DOMAIN,projectId:{}.VITE_FIREBASE_PROJECT_ID,storageBucket:{}.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:{}.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:{}.VITE_FIREBASE_APP_ID},k5=F2(I5),ro=y5(k5),wN=new po,vN=new fo,S5=new mo,_5=new go;wN.setCustomParameters({prompt:"select_account"});vN.setCustomParameters({display:"popup"});class T5{constructor(){this.currentUser=null,this.authStateListeners=[],cj(ro,t=>{this.currentUser=t,this.notifyAuthStateListeners(t)})}onAuthStateChanged(t){this.authStateListeners.push(t),this.currentUser!==null&&t(this.currentUser)}notifyAuthStateListeners(t){this.authStateListeners.forEach(e=>e(t))}getCurrentUser(){return this.currentUser}isAuthenticated(){return this.currentUser!==null}async signInWithGoogle(){try{const t=await lg(ro,wN);return await this.handleAuthResult(t)}catch(t){throw console.error("Google sign-in error:",t),t}}async signInWithFacebook(){try{const t=await lg(ro,vN);return await this.handleAuthResult(t)}catch(t){throw console.error("Facebook sign-in error:",t),t}}async signInWithTwitter(){try{const t=await lg(ro,S5);return await this.handleAuthResult(t)}catch(t){throw console.error("Twitter sign-in error:",t),t}}async signInWithGitHub(){try{const t=await lg(ro,_5);return await this.handleAuthResult(t)}catch(t){throw console.error("GitHub sign-in error:",t),t}}async signInWithEmail(t,e){try{const s=await nj(ro,t,e);return await this.handleAuthResult(s)}catch(s){throw console.error("Email sign-in error:",s),s}}async createAccountWithEmail(t,e,s){try{const i=await ej(ro,t,e);return s&&await rj(i.user,{displayName:s}),await sj(i.user),await this.handleAuthResult(i)}catch(i){throw console.error("Account creation error:",i),i}}async signOut(){try{return await lj(ro),{success:!0}}catch(t){throw console.error("Sign out error:",t),t}}async sendPasswordReset(t){try{return await tj(ro,t),{success:!0}}catch(e){throw console.error("Password reset error:",e),e}}async handleAuthResult(t){const e=t.user,s=await e.getIdToken(),i=await fetch("/api/firebase/verify-token",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({idToken:s,provider:this.getProviderFromUser(e)})});if(!i.ok)throw new Error("Backend verification failed");const r=await i.json();return{user:{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified,provider:this.getProviderFromUser(e)},token:s,laravelUser:r.user}}getProviderFromUser(t){if(t.providerData&&t.providerData.length>0)switch(t.providerData[0].providerId){case"google.com":return"google";case"facebook.com":return"facebook";case"twitter.com":return"twitter";case"github.com":return"github";default:return"email"}return"email"}async getIdToken(){return this.currentUser?await this.currentUser.getIdToken():null}}const E5=new T5;/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function yd(n){return n+.5|0}const ta=(n,t,e)=>Math.max(Math.min(n,e),t);function mh(n){return ta(yd(n*2.55),0,255)}function la(n){return ta(yd(n*255),0,255)}function lo(n){return ta(yd(n/2.55)/100,0,1)}function H_(n){return ta(yd(n*100),0,100)}const Ci={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ow=[..."0123456789ABCDEF"],$5=n=>Ow[n&15],N5=n=>Ow[(n&240)>>4]+Ow[n&15],ug=n=>(n&240)>>4===(n&15),R5=n=>ug(n.r)&&ug(n.g)&&ug(n.b)&&ug(n.a);function A5(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&Ci[n[1]]*17,g:255&Ci[n[2]]*17,b:255&Ci[n[3]]*17,a:t===5?Ci[n[4]]*17:255}:(t===7||t===9)&&(e={r:Ci[n[1]]<<4|Ci[n[2]],g:Ci[n[3]]<<4|Ci[n[4]],b:Ci[n[5]]<<4|Ci[n[6]],a:t===9?Ci[n[7]]<<4|Ci[n[8]]:255})),e}const D5=(n,t)=>n<255?t(n):"";function O5(n){var t=R5(n)?$5:N5;return n?"#"+t(n.r)+t(n.g)+t(n.b)+D5(n.a,t):void 0}const P5=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function CN(n,t,e){const s=t*Math.min(e,1-e),i=(r,o=(r+n/30)%12)=>e-s*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function F5(n,t,e){const s=(i,r=(i+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[s(5),s(3),s(1)]}function M5(n,t,e){const s=CN(n,1,.5);let i;for(t+e>1&&(i=1/(t+e),t*=i,e*=i),i=0;i<3;i++)s[i]*=1-t-e,s[i]+=t;return s}function L5(n,t,e,s,i){return n===i?(t-e)/s+(t<e?6:0):t===i?(e-n)/s+2:(n-t)/s+4}function n1(n){const e=n.r/255,s=n.g/255,i=n.b/255,r=Math.max(e,s,i),o=Math.min(e,s,i),a=(r+o)/2;let c,l,u;return r!==o&&(u=r-o,l=a>.5?u/(2-r-o):u/(r+o),c=L5(e,s,i,u,r),c=c*60+.5),[c|0,l||0,a]}function s1(n,t,e,s){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,s)).map(la)}function i1(n,t,e){return s1(CN,n,t,e)}function B5(n,t,e){return s1(M5,n,t,e)}function z5(n,t,e){return s1(F5,n,t,e)}function IN(n){return(n%360+360)%360}function W5(n){const t=P5.exec(n);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?mh(+t[5]):la(+t[5]));const i=IN(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?s=B5(i,r,o):t[1]==="hsv"?s=z5(i,r,o):s=i1(i,r,o),{r:s[0],g:s[1],b:s[2],a:e}}function V5(n,t){var e=n1(n);e[0]=IN(e[0]+t),e=i1(e),n.r=e[0],n.g=e[1],n.b=e[2]}function U5(n){if(!n)return;const t=n1(n),e=t[0],s=H_(t[1]),i=H_(t[2]);return n.a<255?`hsla(${e}, ${s}%, ${i}%, ${lo(n.a)})`:`hsl(${e}, ${s}%, ${i}%)`}const G_={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},j_={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function H5(){const n={},t=Object.keys(j_),e=Object.keys(G_);let s,i,r,o,a;for(s=0;s<t.length;s++){for(o=a=t[s],i=0;i<e.length;i++)r=e[i],a=a.replace(r,G_[r]);r=parseInt(j_[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let hg;function G5(n){hg||(hg=H5(),hg.transparent=[0,0,0,0]);const t=hg[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const j5=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function q5(n){const t=j5.exec(n);let e=255,s,i,r;if(t){if(t[7]!==s){const o=+t[7];e=t[8]?mh(o):ta(o*255,0,255)}return s=+t[1],i=+t[3],r=+t[5],s=255&(t[2]?mh(s):ta(s,0,255)),i=255&(t[4]?mh(i):ta(i,0,255)),r=255&(t[6]?mh(r):ta(r,0,255)),{r:s,g:i,b:r,a:e}}}function K5(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${lo(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const z0=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,bl=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function X5(n,t,e){const s=bl(lo(n.r)),i=bl(lo(n.g)),r=bl(lo(n.b));return{r:la(z0(s+e*(bl(lo(t.r))-s))),g:la(z0(i+e*(bl(lo(t.g))-i))),b:la(z0(r+e*(bl(lo(t.b))-r))),a:n.a+e*(t.a-n.a)}}function dg(n,t,e){if(n){let s=n1(n);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=i1(s),n.r=s[0],n.g=s[1],n.b=s[2]}}function kN(n,t){return n&&Object.assign(t||{},n)}function q_(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=la(n[3]))):(t=kN(n,{r:0,g:0,b:0,a:1}),t.a=la(t.a)),t}function Y5(n){return n.charAt(0)==="r"?q5(n):W5(n)}class Uh{constructor(t){if(t instanceof Uh)return t;const e=typeof t;let s;e==="object"?s=q_(t):e==="string"&&(s=A5(t)||G5(t)||Y5(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=kN(this._rgb);return t&&(t.a=lo(t.a)),t}set rgb(t){this._rgb=q_(t)}rgbString(){return this._valid?K5(this._rgb):void 0}hexString(){return this._valid?O5(this._rgb):void 0}hslString(){return this._valid?U5(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,i=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,c=s.a-i.a,l=((a*c===-1?a:(a+c)/(1+a*c))+1)/2;r=1-l,s.r=255&l*s.r+r*i.r+.5,s.g=255&l*s.g+r*i.g+.5,s.b=255&l*s.b+r*i.b+.5,s.a=o*s.a+(1-o)*i.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=X5(this._rgb,t._rgb,e)),this}clone(){return new Uh(this.rgb)}alpha(t){return this._rgb.a=la(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=yd(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return dg(this._rgb,2,t),this}darken(t){return dg(this._rgb,2,-t),this}saturate(t){return dg(this._rgb,1,t),this}desaturate(t){return dg(this._rgb,1,-t),this}rotate(t){return V5(this._rgb,t),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function oo(){}const J5=(()=>{let n=0;return()=>n++})();function me(n){return n==null}function nn(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function we(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function pn(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function oi(n,t){return pn(n)?n:t}function te(n,t){return typeof n>"u"?t:n}const Z5=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,SN=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function Ze(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function ze(n,t,e,s){let i,r,o;if(nn(n))if(r=n.length,s)for(i=r-1;i>=0;i--)t.call(e,n[i],i);else for(i=0;i<r;i++)t.call(e,n[i],i);else if(we(n))for(o=Object.keys(n),r=o.length,i=0;i<r;i++)t.call(e,n[o[i]],o[i])}function mm(n,t){let e,s,i,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,s=n.length;e<s;++e)if(i=n[e],r=t[e],i.datasetIndex!==r.datasetIndex||i.index!==r.index)return!1;return!0}function bm(n){if(nn(n))return n.map(bm);if(we(n)){const t=Object.create(null),e=Object.keys(n),s=e.length;let i=0;for(;i<s;++i)t[e[i]]=bm(n[e[i]]);return t}return n}function _N(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function Q5(n,t,e,s){if(!_N(n))return;const i=t[n],r=e[n];we(i)&&we(r)?Hh(i,r,s):t[n]=bm(r)}function Hh(n,t,e){const s=nn(t)?t:[t],i=s.length;if(!we(n))return n;e=e||{};const r=e.merger||Q5;let o;for(let a=0;a<i;++a){if(o=s[a],!we(o))continue;const c=Object.keys(o);for(let l=0,u=c.length;l<u;++l)r(c[l],n,o,e)}return n}function Rh(n,t){return Hh(n,t,{merger:tq})}function tq(n,t,e){if(!_N(n))return;const s=t[n],i=e[n];we(s)&&we(i)?Rh(s,i):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=bm(i))}const K_={"":n=>n,x:n=>n.x,y:n=>n.y};function eq(n){const t=n.split("."),e=[];let s="";for(const i of t)s+=i,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function nq(n){const t=eq(n);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function pa(n,t){return(K_[t]||(K_[t]=nq(t)))(n)}function r1(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Gh=n=>typeof n<"u",ga=n=>typeof n=="function",X_=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function sq(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Re=Math.PI,sn=2*Re,iq=sn+Re,xm=Number.POSITIVE_INFINITY,rq=Re/180,Sn=Re/2,Ja=Re/4,Y_=Re*2/3,ea=Math.log10,$r=Math.sign;function Ah(n,t,e){return Math.abs(n-t)<e}function J_(n){const t=Math.round(n);n=Ah(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(ea(n))),s=n/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function oq(n){const t=[],e=Math.sqrt(n);let s;for(s=1;s<e;s++)n%s===0&&(t.push(s),t.push(n/s));return e===(e|0)&&t.push(e),t.sort((i,r)=>i-r).pop(),t}function aq(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function zl(n){return!aq(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function cq(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function TN(n,t,e){let s,i,r;for(s=0,i=n.length;s<i;s++)r=n[s][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function Zi(n){return n*(Re/180)}function o1(n){return n*(180/Re)}function Z_(n){if(!pn(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function EN(n,t){const e=t.x-n.x,s=t.y-n.y,i=Math.sqrt(e*e+s*s);let r=Math.atan2(s,e);return r<-.5*Re&&(r+=sn),{angle:r,distance:i}}function Pw(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function lq(n,t){return(n-t+iq)%sn-Re}function ps(n){return(n%sn+sn)%sn}function jh(n,t,e,s){const i=ps(n),r=ps(t),o=ps(e),a=ps(r-i),c=ps(o-i),l=ps(i-r),u=ps(i-o);return i===r||i===o||s&&r===o||a>c&&l<u}function Gn(n,t,e){return Math.max(t,Math.min(e,n))}function uq(n){return Gn(n,-32768,32767)}function wo(n,t,e,s=1e-6){return n>=Math.min(t,e)-s&&n<=Math.max(t,e)+s}function a1(n,t,e){e=e||(o=>n[o]<t);let s=n.length-1,i=0,r;for(;s-i>1;)r=i+s>>1,e(r)?i=r:s=r;return{lo:i,hi:s}}const vo=(n,t,e,s)=>a1(n,e,s?i=>{const r=n[i][t];return r<e||r===e&&n[i+1][t]===e}:i=>n[i][t]<e),hq=(n,t,e)=>a1(n,e,s=>n[s][t]>=e);function dq(n,t,e){let s=0,i=n.length;for(;s<i&&n[s]<t;)s++;for(;i>s&&n[i-1]>e;)i--;return s>0||i<n.length?n.slice(s,i):n}const $N=["push","pop","shift","splice","unshift"];function fq(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),$N.forEach(e=>{const s="_onData"+r1(e),i=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=i.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...r)}),o}})})}function Q_(n,t){const e=n._chartjs;if(!e)return;const s=e.listeners,i=s.indexOf(t);i!==-1&&s.splice(i,1),!(s.length>0)&&($N.forEach(r=>{delete n[r]}),delete n._chartjs)}function NN(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const RN=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function AN(n,t){let e=[],s=!1;return function(...i){e=i,s||(s=!0,RN.call(window,()=>{s=!1,n.apply(t,e)}))}}function pq(n,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(n,t,s)):n.apply(this,s),t}}const c1=n=>n==="start"?"left":n==="end"?"right":"center",hs=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,gq=(n,t,e,s)=>n===(s?"left":"right")?e:n==="center"?(t+e)/2:t;function DN(n,t,e){const s=t.length;let i=0,r=s;if(n._sorted){const{iScale:o,vScale:a,_parsed:c}=n,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,u=o.axis,{min:h,max:f,minDefined:g,maxDefined:m}=o.getUserBounds();if(g){if(i=Math.min(vo(c,u,h).lo,e?s:vo(t,u,o.getPixelForValue(h)).lo),l){const x=c.slice(0,i+1).reverse().findIndex(b=>!me(b[a.axis]));i-=Math.max(0,x)}i=Gn(i,0,s-1)}if(m){let x=Math.max(vo(c,o.axis,f,!0).hi+1,e?0:vo(t,u,o.getPixelForValue(f),!0).hi+1);if(l){const b=c.slice(x-1).findIndex(y=>!me(y[a.axis]));x+=Math.max(0,b)}r=Gn(x,i,s)-i}else r=s-i}return{start:i,count:r}}function ON(n){const{xScale:t,yScale:e,_scaleRanges:s}=n,i={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return n._scaleRanges=i,!0;const r=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,i),r}const fg=n=>n===0||n===1,tT=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*sn/e)),eT=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*sn/e)+1,Dh={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Sn)+1,easeOutSine:n=>Math.sin(n*Sn),easeInOutSine:n=>-.5*(Math.cos(Re*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>fg(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>fg(n)?n:tT(n,.075,.3),easeOutElastic:n=>fg(n)?n:eT(n,.075,.3),easeInOutElastic(n){return fg(n)?n:n<.5?.5*tT(n*2,.1125,.45):.5+.5*eT(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Dh.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Dh.easeInBounce(n*2)*.5:Dh.easeOutBounce(n*2-1)*.5+.5};function l1(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function nT(n){return l1(n)?n:new Uh(n)}function W0(n){return l1(n)?n:new Uh(n).saturate(.5).darken(.1).hexString()}const mq=["x","y","borderWidth","radius","tension"],bq=["color","borderColor","backgroundColor"];function xq(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:bq},numbers:{type:"number",properties:mq}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function yq(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const sT=new Map;function wq(n,t){t=t||{};const e=n+JSON.stringify(t);let s=sT.get(e);return s||(s=new Intl.NumberFormat(n,t),sT.set(e,s)),s}function wd(n,t,e){return wq(t,e).format(n)}const PN={values(n){return nn(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const s=this.chart.options.locale;let i,r=n;if(e.length>1){const l=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(l<1e-4||l>1e15)&&(i="scientific"),r=vq(n,e)}const o=ea(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(c,this.options.ticks.format),wd(n,s,c)},logarithmic(n,t,e){if(n===0)return"0";const s=e[t].significand||n/Math.pow(10,Math.floor(ea(n)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?PN.numeric.call(this,n,t,e):""}};function vq(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var ub={formatters:PN};function Cq(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:ub.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const kc=Object.create(null),Fw=Object.create(null);function Oh(n,t){if(!t)return n;const e=t.split(".");for(let s=0,i=e.length;s<i;++s){const r=e[s];n=n[r]||(n[r]=Object.create(null))}return n}function V0(n,t,e){return typeof t=="string"?Hh(Oh(n,t),e):Hh(Oh(n,""),t)}class Iq{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,i)=>W0(i.backgroundColor),this.hoverBorderColor=(s,i)=>W0(i.borderColor),this.hoverColor=(s,i)=>W0(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return V0(this,t,e)}get(t){return Oh(this,t)}describe(t,e){return V0(Fw,t,e)}override(t,e){return V0(kc,t,e)}route(t,e,s,i){const r=Oh(this,t),o=Oh(this,s),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const c=this[a],l=o[i];return we(c)?Object.assign({},l,c):te(c,l)},set(c){this[a]=c}}})}apply(t){t.forEach(e=>e(this))}}var cn=new Iq({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[xq,yq,Cq]);function kq(n){return!n||me(n.size)||me(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function ym(n,t,e,s,i){let r=t[i];return r||(r=t[i]=n.measureText(i).width,e.push(i)),r>s&&(s=r),s}function Sq(n,t,e,s){s=s||{};let i=s.data=s.data||{},r=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(i=s.data={},r=s.garbageCollect=[],s.font=t),n.save(),n.font=t;let o=0;const a=e.length;let c,l,u,h,f;for(c=0;c<a;c++)if(h=e[c],h!=null&&!nn(h))o=ym(n,i,r,o,h);else if(nn(h))for(l=0,u=h.length;l<u;l++)f=h[l],f!=null&&!nn(f)&&(o=ym(n,i,r,o,f));n.restore();const g=r.length/2;if(g>e.length){for(c=0;c<g;c++)delete i[r[c]];r.splice(0,g)}return o}function Za(n,t,e){const s=n.currentDevicePixelRatio,i=e!==0?Math.max(e/2,.5):0;return Math.round((t-i)*s)/s+i}function iT(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function Mw(n,t,e,s){FN(n,t,e,s,null)}function FN(n,t,e,s,i){let r,o,a,c,l,u,h,f;const g=t.pointStyle,m=t.rotation,x=t.radius;let b=(m||0)*rq;if(g&&typeof g=="object"&&(r=g.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,s),n.rotate(b),n.drawImage(g,-g.width/2,-g.height/2,g.width,g.height),n.restore();return}if(!(isNaN(x)||x<=0)){switch(n.beginPath(),g){default:i?n.ellipse(e,s,i/2,x,0,0,sn):n.arc(e,s,x,0,sn),n.closePath();break;case"triangle":u=i?i/2:x,n.moveTo(e+Math.sin(b)*u,s-Math.cos(b)*x),b+=Y_,n.lineTo(e+Math.sin(b)*u,s-Math.cos(b)*x),b+=Y_,n.lineTo(e+Math.sin(b)*u,s-Math.cos(b)*x),n.closePath();break;case"rectRounded":l=x*.516,c=x-l,o=Math.cos(b+Ja)*c,h=Math.cos(b+Ja)*(i?i/2-l:c),a=Math.sin(b+Ja)*c,f=Math.sin(b+Ja)*(i?i/2-l:c),n.arc(e-h,s-a,l,b-Re,b-Sn),n.arc(e+f,s-o,l,b-Sn,b),n.arc(e+h,s+a,l,b,b+Sn),n.arc(e-f,s+o,l,b+Sn,b+Re),n.closePath();break;case"rect":if(!m){c=Math.SQRT1_2*x,u=i?i/2:c,n.rect(e-u,s-c,2*u,2*c);break}b+=Ja;case"rectRot":h=Math.cos(b)*(i?i/2:x),o=Math.cos(b)*x,a=Math.sin(b)*x,f=Math.sin(b)*(i?i/2:x),n.moveTo(e-h,s-a),n.lineTo(e+f,s-o),n.lineTo(e+h,s+a),n.lineTo(e-f,s+o),n.closePath();break;case"crossRot":b+=Ja;case"cross":h=Math.cos(b)*(i?i/2:x),o=Math.cos(b)*x,a=Math.sin(b)*x,f=Math.sin(b)*(i?i/2:x),n.moveTo(e-h,s-a),n.lineTo(e+h,s+a),n.moveTo(e+f,s-o),n.lineTo(e-f,s+o);break;case"star":h=Math.cos(b)*(i?i/2:x),o=Math.cos(b)*x,a=Math.sin(b)*x,f=Math.sin(b)*(i?i/2:x),n.moveTo(e-h,s-a),n.lineTo(e+h,s+a),n.moveTo(e+f,s-o),n.lineTo(e-f,s+o),b+=Ja,h=Math.cos(b)*(i?i/2:x),o=Math.cos(b)*x,a=Math.sin(b)*x,f=Math.sin(b)*(i?i/2:x),n.moveTo(e-h,s-a),n.lineTo(e+h,s+a),n.moveTo(e+f,s-o),n.lineTo(e-f,s+o);break;case"line":o=i?i/2:Math.cos(b)*x,a=Math.sin(b)*x,n.moveTo(e-o,s-a),n.lineTo(e+o,s+a);break;case"dash":n.moveTo(e,s),n.lineTo(e+Math.cos(b)*(i?i/2:x),s+Math.sin(b)*x);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Co(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function hb(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function db(n){n.restore()}function _q(n,t,e,s,i){if(!t)return n.lineTo(e.x,e.y);if(i==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else i==="after"!=!!s?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function Tq(n,t,e,s){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function Eq(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),me(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function $q(n,t,e,s,i){if(i.strikethrough||i.underline){const r=n.measureText(s),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,c=e-r.actualBoundingBoxAscent,l=e+r.actualBoundingBoxDescent,u=i.strikethrough?(c+l)/2:l;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(o,u),n.lineTo(a,u),n.stroke()}}function Nq(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function Sc(n,t,e,s,i,r={}){const o=nn(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let c,l;for(n.save(),n.font=i.string,Eq(n,r),c=0;c<o.length;++c)l=o[c],r.backdrop&&Nq(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),me(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(l,e,s,r.maxWidth)),n.fillText(l,e,s,r.maxWidth),$q(n,e,s,l,r),s+=Number(i.lineHeight);n.restore()}function qh(n,t){const{x:e,y:s,w:i,h:r,radius:o}=t;n.arc(e+o.topLeft,s+o.topLeft,o.topLeft,1.5*Re,Re,!0),n.lineTo(e,s+r-o.bottomLeft),n.arc(e+o.bottomLeft,s+r-o.bottomLeft,o.bottomLeft,Re,Sn,!0),n.lineTo(e+i-o.bottomRight,s+r),n.arc(e+i-o.bottomRight,s+r-o.bottomRight,o.bottomRight,Sn,0,!0),n.lineTo(e+i,s+o.topRight),n.arc(e+i-o.topRight,s+o.topRight,o.topRight,0,-Sn,!0),n.lineTo(e+o.topLeft,s)}const Rq=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Aq=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Dq(n,t){const e=(""+n).match(Rq);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const Oq=n=>+n||0;function u1(n,t){const e={},s=we(t),i=s?Object.keys(t):t,r=we(n)?s?o=>te(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of i)e[o]=Oq(r(o));return e}function MN(n){return u1(n,{top:"y",right:"x",bottom:"y",left:"x"})}function mc(n){return u1(n,["topLeft","topRight","bottomLeft","bottomRight"])}function ws(n){const t=MN(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function zn(n,t){n=n||{},t=t||cn.font;let e=te(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=te(n.style,t.style);s&&!(""+s).match(Aq)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const i={family:te(n.family,t.family),lineHeight:Dq(te(n.lineHeight,t.lineHeight),e),size:e,style:s,weight:te(n.weight,t.weight),string:""};return i.string=kq(i),i}function bh(n,t,e,s){let i=!0,r,o,a;for(r=0,o=n.length;r<o;++r)if(a=n[r],a!==void 0&&(t!==void 0&&typeof a=="function"&&(a=a(t),i=!1),e!==void 0&&nn(a)&&(a=a[e%a.length],i=!1),a!==void 0))return s&&!i&&(s.cacheable=!1),a}function Pq(n,t,e){const{min:s,max:i}=n,r=SN(t,(i-s)/2),o=(a,c)=>e&&a===0?0:a+c;return{min:o(s,-Math.abs(r)),max:o(i,r)}}function Ia(n,t){return Object.assign(Object.create(n),t)}function h1(n,t=[""],e,s,i=()=>n[0]){const r=e||n;typeof s>"u"&&(s=WN("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:s,_getTarget:i,override:a=>h1([a,...n],t,r,s)};return new Proxy(o,{deleteProperty(a,c){return delete a[c],delete a._keys,delete n[0][c],!0},get(a,c){return BN(a,c,()=>Uq(c,t,n,a))},getOwnPropertyDescriptor(a,c){return Reflect.getOwnPropertyDescriptor(a._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,c){return oT(a).includes(c)},ownKeys(a){return oT(a)},set(a,c,l){const u=a._storage||(a._storage=i());return a[c]=u[c]=l,delete a._keys,!0}})}function Wl(n,t,e,s){const i={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:LN(n,s),setContext:r=>Wl(n,r,e,s),override:r=>Wl(n.override(r),t,e,s)};return new Proxy(i,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return BN(r,o,()=>Mq(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function LN(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:i=t.allKeys}=n;return{allKeys:i,scriptable:e,indexable:s,isScriptable:ga(e)?e:()=>e,isIndexable:ga(s)?s:()=>s}}const Fq=(n,t)=>n?n+r1(t):t,d1=(n,t)=>we(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function BN(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const s=e();return n[t]=s,s}function Mq(n,t,e){const{_proxy:s,_context:i,_subProxy:r,_descriptors:o}=n;let a=s[t];return ga(a)&&o.isScriptable(t)&&(a=Lq(t,a,n,e)),nn(a)&&a.length&&(a=Bq(t,a,n,o.isIndexable)),d1(t,a)&&(a=Wl(a,i,r&&r[t],o)),a}function Lq(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let c=t(r,o||s);return a.delete(n),d1(n,c)&&(c=f1(i._scopes,i,n,c)),c}function Bq(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&s(n))return t[r.index%t.length];if(we(t[0])){const c=t,l=i._scopes.filter(u=>u!==c);t=[];for(const u of c){const h=f1(l,i,n,u);t.push(Wl(h,r,o&&o[n],a))}}return t}function zN(n,t,e){return ga(n)?n(t,e):n}const zq=(n,t)=>n===!0?t:typeof n=="string"?pa(t,n):void 0;function Wq(n,t,e,s,i){for(const r of t){const o=zq(e,r);if(o){n.add(o);const a=zN(o._fallback,e,i);if(typeof a<"u"&&a!==e&&a!==s)return a}else if(o===!1&&typeof s<"u"&&e!==s)return null}return!1}function f1(n,t,e,s){const i=t._rootScopes,r=zN(t._fallback,e,s),o=[...n,...i],a=new Set;a.add(s);let c=rT(a,o,e,r||e,s);return c===null||typeof r<"u"&&r!==e&&(c=rT(a,o,r,c,s),c===null)?!1:h1(Array.from(a),[""],i,r,()=>Vq(t,e,s))}function rT(n,t,e,s,i){for(;e;)e=Wq(n,t,e,s,i);return e}function Vq(n,t,e){const s=n._getTarget();t in s||(s[t]={});const i=s[t];return nn(i)&&we(e)?e:i||{}}function Uq(n,t,e,s){let i;for(const r of t)if(i=WN(Fq(r,n),e),typeof i<"u")return d1(n,i)?f1(e,s,n,i):i}function WN(n,t){for(const e of t){if(!e)continue;const s=e[n];if(typeof s<"u")return s}}function oT(n){let t=n._keys;return t||(t=n._keys=Hq(n._scopes)),t}function Hq(n){const t=new Set;for(const e of n)for(const s of Object.keys(e).filter(i=>!i.startsWith("_")))t.add(s);return Array.from(t)}function VN(n,t,e,s){const{iScale:i}=n,{key:r="r"}=this._parsing,o=new Array(s);let a,c,l,u;for(a=0,c=s;a<c;++a)l=a+e,u=t[l],o[a]={r:i.parse(pa(u,r),l)};return o}const Gq=Number.EPSILON||1e-14,Vl=(n,t)=>t<n.length&&!n[t].skip&&n[t],UN=n=>n==="x"?"y":"x";function jq(n,t,e,s){const i=n.skip?t:n,r=t,o=e.skip?t:e,a=Pw(r,i),c=Pw(o,r);let l=a/(a+c),u=c/(a+c);l=isNaN(l)?0:l,u=isNaN(u)?0:u;const h=s*l,f=s*u;return{previous:{x:r.x-h*(o.x-i.x),y:r.y-h*(o.y-i.y)},next:{x:r.x+f*(o.x-i.x),y:r.y+f*(o.y-i.y)}}}function qq(n,t,e){const s=n.length;let i,r,o,a,c,l=Vl(n,0);for(let u=0;u<s-1;++u)if(c=l,l=Vl(n,u+1),!(!c||!l)){if(Ah(t[u],0,Gq)){e[u]=e[u+1]=0;continue}i=e[u]/t[u],r=e[u+1]/t[u],a=Math.pow(i,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[u]=i*o*t[u],e[u+1]=r*o*t[u])}}function Kq(n,t,e="x"){const s=UN(e),i=n.length;let r,o,a,c=Vl(n,0);for(let l=0;l<i;++l){if(o=a,a=c,c=Vl(n,l+1),!a)continue;const u=a[e],h=a[s];o&&(r=(u-o[e])/3,a[`cp1${e}`]=u-r,a[`cp1${s}`]=h-r*t[l]),c&&(r=(c[e]-u)/3,a[`cp2${e}`]=u+r,a[`cp2${s}`]=h+r*t[l])}}function Xq(n,t="x"){const e=UN(t),s=n.length,i=Array(s).fill(0),r=Array(s);let o,a,c,l=Vl(n,0);for(o=0;o<s;++o)if(a=c,c=l,l=Vl(n,o+1),!!c){if(l){const u=l[t]-c[t];i[o]=u!==0?(l[e]-c[e])/u:0}r[o]=a?l?$r(i[o-1])!==$r(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}qq(n,i,r),Kq(n,r,t)}function pg(n,t,e){return Math.max(Math.min(n,e),t)}function Yq(n,t){let e,s,i,r,o,a=Co(n[0],t);for(e=0,s=n.length;e<s;++e)o=r,r=a,a=e<s-1&&Co(n[e+1],t),r&&(i=n[e],o&&(i.cp1x=pg(i.cp1x,t.left,t.right),i.cp1y=pg(i.cp1y,t.top,t.bottom)),a&&(i.cp2x=pg(i.cp2x,t.left,t.right),i.cp2y=pg(i.cp2y,t.top,t.bottom)))}function Jq(n,t,e,s,i){let r,o,a,c;if(t.spanGaps&&(n=n.filter(l=>!l.skip)),t.cubicInterpolationMode==="monotone")Xq(n,i);else{let l=s?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],c=jq(l,a,n[Math.min(r+1,o-(s?0:1))%o],t.tension),a.cp1x=c.previous.x,a.cp1y=c.previous.y,a.cp2x=c.next.x,a.cp2y=c.next.y,l=a}t.capBezierPoints&&Yq(n,e)}function p1(){return typeof window<"u"&&typeof document<"u"}function g1(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function wm(n,t,e){let s;return typeof n=="string"?(s=parseInt(n,10),n.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=n,s}const fb=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function Zq(n,t){return fb(n).getPropertyValue(t)}const Qq=["top","right","bottom","left"];function bc(n,t,e){const s={};e=e?"-"+e:"";for(let i=0;i<4;i++){const r=Qq[i];s[r]=parseFloat(n[t+"-"+r+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const tK=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function eK(n,t){const e=n.touches,s=e&&e.length?e[0]:n,{offsetX:i,offsetY:r}=s;let o=!1,a,c;if(tK(i,r,n.target))a=i,c=r;else{const l=t.getBoundingClientRect();a=s.clientX-l.left,c=s.clientY-l.top,o=!0}return{x:a,y:c,box:o}}function ic(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:s}=t,i=fb(e),r=i.boxSizing==="border-box",o=bc(i,"padding"),a=bc(i,"border","width"),{x:c,y:l,box:u}=eK(n,e),h=o.left+(u&&a.left),f=o.top+(u&&a.top);let{width:g,height:m}=t;return r&&(g-=o.width+a.width,m-=o.height+a.height),{x:Math.round((c-h)/g*e.width/s),y:Math.round((l-f)/m*e.height/s)}}function nK(n,t,e){let s,i;if(t===void 0||e===void 0){const r=n&&g1(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=fb(r),c=bc(a,"border","width"),l=bc(a,"padding");t=o.width-l.width-c.width,e=o.height-l.height-c.height,s=wm(a.maxWidth,r,"clientWidth"),i=wm(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:s||xm,maxHeight:i||xm}}const gg=n=>Math.round(n*10)/10;function sK(n,t,e,s){const i=fb(n),r=bc(i,"margin"),o=wm(i.maxWidth,n,"clientWidth")||xm,a=wm(i.maxHeight,n,"clientHeight")||xm,c=nK(n,t,e);let{width:l,height:u}=c;if(i.boxSizing==="content-box"){const f=bc(i,"border","width"),g=bc(i,"padding");l-=g.width+f.width,u-=g.height+f.height}return l=Math.max(0,l-r.width),u=Math.max(0,s?l/s:u-r.height),l=gg(Math.min(l,o,c.maxWidth)),u=gg(Math.min(u,a,c.maxHeight)),l&&!u&&(u=gg(l/2)),(t!==void 0||e!==void 0)&&s&&c.height&&u>c.height&&(u=c.height,l=gg(Math.floor(u*s))),{width:l,height:u}}function aT(n,t,e){const s=t||1,i=Math.floor(n.height*s),r=Math.floor(n.width*s);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==s||o.height!==i||o.width!==r?(n.currentDevicePixelRatio=s,o.height=i,o.width=r,n.ctx.setTransform(s,0,0,s,0,0),!0):!1}const iK=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};p1()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n}();function cT(n,t){const e=Zq(n,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function rc(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function rK(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:s==="middle"?e<.5?n.y:t.y:s==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function oK(n,t,e,s){const i={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=rc(n,i,e),a=rc(i,r,e),c=rc(r,t,e),l=rc(o,a,e),u=rc(a,c,e);return rc(l,u,e)}const aK=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},cK=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function Rl(n,t,e){return n?aK(t,e):cK()}function HN(n,t){let e,s;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=s)}function GN(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function jN(n){return n==="angle"?{between:jh,compare:lq,normalize:ps}:{between:wo,compare:(t,e)=>t-e,normalize:t=>t}}function lT({start:n,end:t,count:e,loop:s,style:i}){return{start:n%e,end:t%e,loop:s&&(t-n+1)%e===0,style:i}}function lK(n,t,e){const{property:s,start:i,end:r}=e,{between:o,normalize:a}=jN(s),c=t.length;let{start:l,end:u,loop:h}=n,f,g;if(h){for(l+=c,u+=c,f=0,g=c;f<g&&o(a(t[l%c][s]),i,r);++f)l--,u--;l%=c,u%=c}return u<l&&(u+=c),{start:l,end:u,loop:h,style:n.style}}function qN(n,t,e){if(!e)return[n];const{property:s,start:i,end:r}=e,o=t.length,{compare:a,between:c,normalize:l}=jN(s),{start:u,end:h,loop:f,style:g}=lK(n,t,e),m=[];let x=!1,b=null,y,v,k;const I=()=>c(i,k,y)&&a(i,k)!==0,_=()=>a(r,y)===0||c(r,k,y),$=()=>x||I(),R=()=>!x||_();for(let A=u,F=u;A<=h;++A)v=t[A%o],!v.skip&&(y=l(v[s]),y!==k&&(x=c(y,i,r),b===null&&$()&&(b=a(y,i)===0?A:F),b!==null&&R()&&(m.push(lT({start:b,end:A,loop:f,count:o,style:g})),b=null),F=A,k=y));return b!==null&&m.push(lT({start:b,end:h,loop:f,count:o,style:g})),m}function KN(n,t){const e=[],s=n.segments;for(let i=0;i<s.length;i++){const r=qN(s[i],n.points,t);r.length&&e.push(...r)}return e}function uK(n,t,e,s){let i=0,r=t-1;if(e&&!s)for(;i<t&&!n[i].skip;)i++;for(;i<t&&n[i].skip;)i++;for(i%=t,e&&(r+=i);r>i&&n[r%t].skip;)r--;return r%=t,{start:i,end:r}}function hK(n,t,e,s){const i=n.length,r=[];let o=t,a=n[t],c;for(c=t+1;c<=e;++c){const l=n[c%i];l.skip||l.stop?a.skip||(s=!1,r.push({start:t%i,end:(c-1)%i,loop:s}),t=o=l.stop?c:null):(o=c,a.skip&&(t=c)),a=l}return o!==null&&r.push({start:t%i,end:o%i,loop:s}),r}function dK(n,t){const e=n.points,s=n.options.spanGaps,i=e.length;if(!i)return[];const r=!!n._loop,{start:o,end:a}=uK(e,i,r,s);if(s===!0)return uT(n,[{start:o,end:a,loop:r}],e,t);const c=a<o?a+i:a,l=!!n._fullLoop&&o===0&&a===i-1;return uT(n,hK(e,o,c,l),e,t)}function uT(n,t,e,s){return!s||!s.setContext||!e?t:fK(n,t,e,s)}function fK(n,t,e,s){const i=n._chart.getContext(),r=hT(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,c=e.length,l=[];let u=r,h=t[0].start,f=h;function g(m,x,b,y){const v=a?-1:1;if(m!==x){for(m+=c;e[m%c].skip;)m-=v;for(;e[x%c].skip;)x+=v;m%c!==x%c&&(l.push({start:m%c,end:x%c,loop:b,style:y}),u=y,h=x%c)}}for(const m of t){h=a?h:m.start;let x=e[h%c],b;for(f=h+1;f<=m.end;f++){const y=e[f%c];b=hT(s.setContext(Ia(i,{type:"segment",p0:x,p1:y,p0DataIndex:(f-1)%c,p1DataIndex:f%c,datasetIndex:o}))),pK(b,u)&&g(h,f-1,m.loop,u),x=y,u=b}h<f-1&&g(h,f-1,m.loop,u)}return l}function hT(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function pK(n,t){if(!t)return!1;const e=[],s=function(i,r){return l1(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,s)!==JSON.stringify(t,s)}function mg(n,t,e){return n.options.clip?n[e]:t[e]}function gK(n,t){const{xScale:e,yScale:s}=n;return e&&s?{left:mg(e,t,"left"),right:mg(e,t,"right"),top:mg(s,t,"top"),bottom:mg(s,t,"bottom")}:t}function XN(n,t){const e=t._clip;if(e.disabled)return!1;const s=gK(t,n.chartArea);return{left:e.left===!1?0:s.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:s.right+(e.right===!0?0:e.right),top:e.top===!1?0:s.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:s.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class mK{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,i){const r=e.listeners[i],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(s-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=RN.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const r=s.items;let o=r.length-1,a=!1,c;for(;o>=0;--o)c=r[o],c._active?(c._total>s.duration&&(s.duration=c._total),c.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(i.draw(),this._notify(i,s,t,"progress")),r.length||(s.running=!1,this._notify(i,s,t,"complete"),s.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,i)=>Math.max(s,i._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var ao=new mK;const dT="transparent",bK={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const s=nT(n||dT),i=s.valid&&nT(t||dT);return i&&i.valid?i.mix(s,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class xK{constructor(t,e,s,i){const r=e[s];i=bh([t.to,i,r,t.from]);const o=bh([t.from,r,i]);this._active=!0,this._fn=t.fn||bK[t.type||typeof o],this._easing=Dh[t.easing]||Dh.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const i=this._target[this._prop],r=s-this._start,o=this._duration-r;this._start=s,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=bh([t.to,e,i,t.from]),this._from=bh([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,i=this._prop,r=this._from,o=this._loop,a=this._to;let c;if(this._active=r!==a&&(o||e<s),!this._active){this._target[i]=a,this._notify(!0);return}if(e<0){this._target[i]=r;return}c=e/s%2,c=o&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[i]=this._fn(r,a,c)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][e]()}}class YN{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!we(t))return;const e=Object.keys(cn.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const r=t[i];if(!we(r))return;const o={};for(const a of e)o[a]=r[a];(nn(r.properties)&&r.properties||[i]).forEach(a=>{(a===i||!s.has(a))&&s.set(a,o)})})}_animateOptions(t,e){const s=e.options,i=wK(t,s);if(!i)return[];const r=this._createAnimations(i,s);return s.$shared&&yK(t.options.$animations,s).then(()=>{t.options=s},()=>{}),r}_createAnimations(t,e){const s=this._properties,i=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let c;for(c=o.length-1;c>=0;--c){const l=o[c];if(l.charAt(0)==="$")continue;if(l==="options"){i.push(...this._animateOptions(t,e));continue}const u=e[l];let h=r[l];const f=s.get(l);if(h)if(f&&h.active()){h.update(f,u,a);continue}else h.cancel();if(!f||!f.duration){t[l]=u;continue}r[l]=h=new xK(f,t,l,u),i.push(h)}return i}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return ao.add(this._chart,s),!0}}function yK(n,t){const e=[],s=Object.keys(t);for(let i=0;i<s.length;i++){const r=n[s[i]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function wK(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function fT(n,t){const e=n&&n.options||{},s=e.reverse,i=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:s?r:i,end:s?i:r}}function vK(n,t,e){if(e===!1)return!1;const s=fT(n,e),i=fT(t,e);return{top:i.end,right:s.end,bottom:i.start,left:s.start}}function CK(n){let t,e,s,i;return we(n)?(t=n.top,e=n.right,s=n.bottom,i=n.left):t=e=s=i=n,{top:t,right:e,bottom:s,left:i,disabled:n===!1}}function JN(n,t){const e=[],s=n._getSortedDatasetMetas(t);let i,r;for(i=0,r=s.length;i<r;++i)e.push(s[i].index);return e}function pT(n,t,e,s={}){const i=n.keys,r=s.mode==="single";let o,a,c,l;if(t===null)return;let u=!1;for(o=0,a=i.length;o<a;++o){if(c=+i[o],c===e){if(u=!0,s.all)continue;break}l=n.values[c],pn(l)&&(r||t===0||$r(t)===$r(l))&&(t+=l)}return!u&&!s.all?0:t}function IK(n,t){const{iScale:e,vScale:s}=t,i=e.axis==="x"?"x":"y",r=s.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let c,l,u;for(c=0,l=o.length;c<l;++c)u=o[c],a[c]={[i]:u,[r]:n[u]};return a}function U0(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function kK(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function SK(n){const{min:t,max:e,minDefined:s,maxDefined:i}=n.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:i?e:Number.POSITIVE_INFINITY}}function _K(n,t,e){const s=n[t]||(n[t]={});return s[e]||(s[e]={})}function gT(n,t,e,s){for(const i of t.getMatchingVisibleMetas(s).reverse()){const r=n[i.index];if(e&&r>0||!e&&r<0)return i.index}return null}function mT(n,t){const{chart:e,_cachedMeta:s}=n,i=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=s,c=r.axis,l=o.axis,u=kK(r,o,s),h=t.length;let f;for(let g=0;g<h;++g){const m=t[g],{[c]:x,[l]:b}=m,y=m._stacks||(m._stacks={});f=y[l]=_K(i,u,x),f[a]=b,f._top=gT(f,o,!0,s.type),f._bottom=gT(f,o,!1,s.type);const v=f._visualValues||(f._visualValues={});v[a]=b}}function H0(n,t){const e=n.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function TK(n,t){return Ia(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function EK(n,t,e){return Ia(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function rh(n,t){const e=n.controller.index,s=n.vScale&&n.vScale.axis;if(s){t=t||n._parsed;for(const i of t){const r=i._stacks;if(!r||r[s]===void 0||r[s][e]===void 0)return;delete r[s][e],r[s]._visualValues!==void 0&&r[s]._visualValues[e]!==void 0&&delete r[s]._visualValues[e]}}}const G0=n=>n==="reset"||n==="none",bT=(n,t)=>t?n:Object.assign({},n),$K=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:JN(e,!0),values:null};class nr{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=U0(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&rh(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),i=(h,f,g,m)=>h==="x"?f:h==="r"?m:g,r=e.xAxisID=te(s.xAxisID,H0(t,"x")),o=e.yAxisID=te(s.yAxisID,H0(t,"y")),a=e.rAxisID=te(s.rAxisID,H0(t,"r")),c=e.indexAxis,l=e.iAxisID=i(c,r,o,a),u=e.vAxisID=i(c,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Q_(this._data,this),t._stacked&&rh(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(we(e)){const i=this._cachedMeta;this._data=IK(e,i)}else if(s!==e){if(s){Q_(s,this);const i=this._cachedMeta;rh(i),i._parsed=[]}e&&Object.isExtensible(e)&&fq(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=U0(e.vScale,e),e.stack!==s.stack&&(i=!0,rh(e),e.stack=s.stack),this._resyncElements(t),(i||r!==e._stacked)&&(mT(this,e._parsed),e._stacked=U0(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:i}=this,{iScale:r,_stacked:o}=s,a=r.axis;let c=t===0&&e===i.length?!0:s._sorted,l=t>0&&s._parsed[t-1],u,h,f;if(this._parsing===!1)s._parsed=i,s._sorted=!0,f=i;else{nn(i[t])?f=this.parseArrayData(s,i,t,e):we(i[t])?f=this.parseObjectData(s,i,t,e):f=this.parsePrimitiveData(s,i,t,e);const g=()=>h[a]===null||l&&h[a]<l[a];for(u=0;u<e;++u)s._parsed[u+t]=h=f[u],c&&(g()&&(c=!1),l=h);s._sorted=c}o&&mT(this,f)}parsePrimitiveData(t,e,s,i){const{iScale:r,vScale:o}=t,a=r.axis,c=o.axis,l=r.getLabels(),u=r===o,h=new Array(i);let f,g,m;for(f=0,g=i;f<g;++f)m=f+s,h[f]={[a]:u||r.parse(l[m],m),[c]:o.parse(e[m],m)};return h}parseArrayData(t,e,s,i){const{xScale:r,yScale:o}=t,a=new Array(i);let c,l,u,h;for(c=0,l=i;c<l;++c)u=c+s,h=e[u],a[c]={x:r.parse(h[0],u),y:o.parse(h[1],u)};return a}parseObjectData(t,e,s,i){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,l=new Array(i);let u,h,f,g;for(u=0,h=i;u<h;++u)f=u+s,g=e[f],l[u]={x:r.parse(pa(g,a),f),y:o.parse(pa(g,c),f)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const i=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:JN(i,!0),values:e._stacks[t.axis]._visualValues};return pT(a,o,r.index,{mode:s})}updateRangeFromParsed(t,e,s,i){const r=s[e.axis];let o=r===null?NaN:r;const a=i&&s._stacks[e.axis];i&&a&&(i.values=a,o=pT(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const s=this._cachedMeta,i=s._parsed,r=s._sorted&&t===s.iScale,o=i.length,a=this._getOtherScale(t),c=$K(e,s,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:h}=SK(a);let f,g;function m(){g=i[f];const x=g[a.axis];return!pn(g[t.axis])||u>x||h<x}for(f=0;f<o&&!(!m()&&(this.updateRangeFromParsed(l,t,g,c),r));++f);if(r){for(f=o-1;f>=0;--f)if(!m()){this.updateRangeFromParsed(l,t,g,c);break}}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let i,r,o;for(i=0,r=e.length;i<r;++i)o=e[i][t.axis],pn(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:s?""+s.getLabelForValue(r[s.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=CK(te(this.options.clip,vK(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,i=s.data||[],r=e.chartArea,o=[],a=this._drawStart||0,c=this._drawCount||i.length-a,l=this.options.drawActiveElementsOnTop;let u;for(s.dataset&&s.dataset.draw(t,r,a,c),u=a;u<a+c;++u){const h=i[u];h.hidden||(h.active&&l?o.push(h):h.draw(t,r))}for(u=0;u<o.length;++u)o[u].draw(t,r)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=EK(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=TK(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=s,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const i=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],c=this.enableOptionSharing&&Gh(s);if(a)return bT(a,c);const l=this.chart.config,u=l.datasetElementScopeKeys(this._type,t),h=i?[`${t}Hover`,"hover",t,""]:[t,""],f=l.getOptionScopes(this.getDataset(),u),g=Object.keys(cn.elements[t]),m=()=>this.getContext(s,i,e),x=l.resolveNamedOptions(f,g,m,h);return x.$shared&&(x.$shared=c,r[o]=Object.freeze(bT(x,c))),x}_resolveAnimations(t,e,s){const i=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let c;if(i.options.animation!==!1){const u=this.chart.config,h=u.datasetAnimationScopeKeys(this._type,e),f=u.getOptionScopes(this.getDataset(),h);c=u.createResolver(f,this.getContext(t,s,e))}const l=new YN(i,c&&c.animations);return c&&c._cacheable&&(r[o]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||G0(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(s),o=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,s),{sharedOptions:r,includeOptions:o}}updateElement(t,e,s,i){G0(i)?Object.assign(t,s):this._resolveAnimations(e,i).update(t,s)}updateSharedOptions(t,e,s){t&&!G0(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,s,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[a,c,l]of this._syncList)this[a](c,l);this._syncList=[];const i=s.length,r=e.length,o=Math.min(r,i);o&&this.parse(0,o),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e,s=!0){const i=this._cachedMeta,r=i.data,o=t+e;let a;const c=l=>{for(l.length+=e,a=l.length-1;a>=o;a--)l[a]=l[a-e]};for(c(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&c(i._parsed),this.parse(t,e),s&&this.updateElements(r,t,e,"reset")}updateElements(t,e,s,i){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(t,e);s._stacked&&rh(s,i)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,i]=t;this[e](s,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}_t(nr,"defaults",{}),_t(nr,"datasetElementType",null),_t(nr,"dataElementType",null);function NK(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let s=[];for(let i=0,r=e.length;i<r;i++)s=s.concat(e[i].controller.getAllParsedValues(n));n._cache.$bar=NN(s.sort((i,r)=>i-r))}return n._cache.$bar}function RK(n){const t=n.iScale,e=NK(t,n.type);let s=t._length,i,r,o,a;const c=()=>{o===32767||o===-32768||(Gh(a)&&(s=Math.min(s,Math.abs(o-a)||s)),a=o)};for(i=0,r=e.length;i<r;++i)o=t.getPixelForValue(e[i]),c();for(a=void 0,i=0,r=t.ticks.length;i<r;++i)o=t.getPixelForTick(i),c();return s}function AK(n,t,e,s){const i=e.barThickness;let r,o;return me(i)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=i*s,o=1),{chunk:r/s,ratio:o,start:t.pixels[n]-r/2}}function DK(n,t,e,s){const i=t.pixels,r=i[n];let o=n>0?i[n-1]:null,a=n<i.length-1?i[n+1]:null;const c=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const l=r-(r-Math.min(o,a))/2*c;return{chunk:Math.abs(a-o)/2*c/s,ratio:e.barPercentage,start:l}}function OK(n,t,e,s){const i=e.parse(n[0],s),r=e.parse(n[1],s),o=Math.min(i,r),a=Math.max(i,r);let c=o,l=a;Math.abs(o)>Math.abs(a)&&(c=a,l=o),t[e.axis]=l,t._custom={barStart:c,barEnd:l,start:i,end:r,min:o,max:a}}function ZN(n,t,e,s){return nn(n)?OK(n,t,e,s):t[e.axis]=e.parse(n,s),t}function xT(n,t,e,s){const i=n.iScale,r=n.vScale,o=i.getLabels(),a=i===r,c=[];let l,u,h,f;for(l=e,u=e+s;l<u;++l)f=t[l],h={},h[i.axis]=a||i.parse(o[l],l),c.push(ZN(f,h,r,l));return c}function j0(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function PK(n,t,e){return n!==0?$r(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function FK(n){let t,e,s,i,r;return n.horizontal?(t=n.base>n.x,e="left",s="right"):(t=n.base<n.y,e="bottom",s="top"),t?(i="end",r="start"):(i="start",r="end"),{start:e,end:s,reverse:t,top:i,bottom:r}}function MK(n,t,e,s){let i=t.borderSkipped;const r={};if(!i){n.borderSkipped=r;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:c,top:l,bottom:u}=FK(n);i==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===s?i=l:(e._bottom||0)===s?i=u:(r[yT(u,o,a,c)]=!0,i=l)),r[yT(i,o,a,c)]=!0,n.borderSkipped=r}function yT(n,t,e,s){return s?(n=LK(n,t,e),n=wT(n,e,t)):n=wT(n,t,e),n}function LK(n,t,e){return n===t?e:n===e?t:n}function wT(n,t,e){return n==="start"?t:n==="end"?e:n}function BK(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class Gg extends nr{parsePrimitiveData(t,e,s,i){return xT(t,e,s,i)}parseArrayData(t,e,s,i){return xT(t,e,s,i)}parseObjectData(t,e,s,i){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,l=r.axis==="x"?a:c,u=o.axis==="x"?a:c,h=[];let f,g,m,x;for(f=s,g=s+i;f<g;++f)x=e[f],m={},m[r.axis]=r.parse(pa(x,l),f),h.push(ZN(pa(x,u),m,o,f));return h}updateRangeFromParsed(t,e,s,i){super.updateRangeFromParsed(t,e,s,i);const r=s._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:i}=e,r=this.getParsed(t),o=r._custom,a=j0(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+s.getLabelForValue(r[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,i){const r=i==="reset",{index:o,_cachedMeta:{vScale:a}}=this,c=a.getBasePixel(),l=a.isHorizontal(),u=this._getRuler(),{sharedOptions:h,includeOptions:f}=this._getSharedOptions(e,i);for(let g=e;g<e+s;g++){const m=this.getParsed(g),x=r||me(m[a.axis])?{base:c,head:c}:this._calculateBarValuePixels(g),b=this._calculateBarIndexPixels(g,u),y=(m._stacks||{})[a.axis],v={horizontal:l,base:x.base,enableBorderRadius:!y||j0(m._custom)||o===y._top||o===y._bottom,x:l?x.head:b.center,y:l?b.center:x.head,height:l?b.size:Math.abs(x.size),width:l?Math.abs(x.size):b.size};f&&(v.options=h||this.resolveDataElementOptions(g,t[g].active?"active":i));const k=v.options||t[g].options;MK(v,k,y,o),BK(v,k,u.ratio),this.updateElement(t[g],g,v,i)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),r=s.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),c=a&&a[s.axis],l=u=>{const h=u._parsed.find(g=>g[s.axis]===c),f=h&&h[u.vScale.axis];if(me(f)||isNaN(f))return!0};for(const u of i)if(!(e!==void 0&&l(u))&&((r===!1||o.indexOf(u.stack)===-1||r===void 0&&u.stack===void 0)&&o.push(u.stack),u.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(s=>t[s].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)t[te(this.chart.options.indexAxis==="x"?s.xAxisID:s.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,s){const i=this._getStacks(t,s),r=e!==void 0?i.indexOf(e):-1;return r===-1?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,i=[];let r,o;for(r=0,o=e.data.length;r<o;++r)i.push(s.getPixelForValue(this.getParsed(r)[s.axis],r));const a=t.barThickness;return{min:a||RK(e),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:i},options:{base:r,minBarLength:o}}=this,a=r||0,c=this.getParsed(t),l=c._custom,u=j0(l);let h=c[e.axis],f=0,g=s?this.applyStack(e,c,s):h,m,x;g!==h&&(f=g-h,g=h),u&&(h=l.barStart,g=l.barEnd-l.barStart,h!==0&&$r(h)!==$r(l.barEnd)&&(f=0),f+=h);const b=!me(r)&&!u?r:f;let y=e.getPixelForValue(b);if(this.chart.getDataVisibility(t)?m=e.getPixelForValue(f+g):m=y,x=m-y,Math.abs(x)<o){x=PK(x,e,a)*o,h===a&&(y-=x/2);const v=e.getPixelForDecimal(0),k=e.getPixelForDecimal(1),I=Math.min(v,k),_=Math.max(v,k);y=Math.max(Math.min(y,_),I),m=y+x,s&&!u&&(c._stacks[e.axis]._visualValues[i]=e.getValueForPixel(m)-e.getValueForPixel(y))}if(y===e.getPixelForValue(a)){const v=$r(x)*e.getLineWidthForValue(a)/2;y+=v,x-=v}return{size:x,base:y,head:m,center:m+x/2}}_calculateBarIndexPixels(t,e){const s=e.scale,i=this.options,r=i.skipNull,o=te(i.maxBarThickness,1/0);let a,c;const l=this._getAxisCount();if(e.grouped){const u=r?this._getStackCount(t):e.stackCount,h=i.barThickness==="flex"?DK(t,e,i,u*l):AK(t,e,i,u*l),f=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,g=this._getAxis().indexOf(te(f,this.getFirstScaleIdForIndexAxis())),m=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+g;a=h.start+h.chunk*m+h.chunk/2,c=Math.min(o,h.chunk*h.ratio)}else a=s.getPixelForValue(this.getParsed(t)[s.axis],t),c=Math.min(o,e.min*e.ratio);return{base:a-c/2,head:a+c/2,center:a,size:c}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,i=s.length;let r=0;for(;r<i;++r)this.getParsed(r)[e.axis]!==null&&!s[r].hidden&&s[r].draw(this._ctx)}}_t(Gg,"id","bar"),_t(Gg,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),_t(Gg,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class jg extends nr{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,i){const r=super.parsePrimitiveData(t,e,s,i);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+s).radius;return r}parseArrayData(t,e,s,i){const r=super.parseArrayData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=te(a[2],this.resolveDataElementOptions(o+s).radius)}return r}parseObjectData(t,e,s,i){const r=super.parseObjectData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=te(a&&a.r&&+a.r,this.resolveDataElementOptions(o+s).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),c=r.getLabelForValue(o.y),l=o._custom;return{label:s[t]||"",value:"("+a+", "+c+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:c,includeOptions:l}=this._getSharedOptions(e,i),u=o.axis,h=a.axis;for(let f=e;f<e+s;f++){const g=t[f],m=!r&&this.getParsed(f),x={},b=x[u]=r?o.getPixelForDecimal(.5):o.getPixelForValue(m[u]),y=x[h]=r?a.getBasePixel():a.getPixelForValue(m[h]);x.skip=isNaN(b)||isNaN(y),l&&(x.options=c||this.resolveDataElementOptions(f,g.active?"active":i),r&&(x.options.radius=0)),this.updateElement(g,f,x,i)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return e!=="active"&&(i.radius=0),i.radius+=te(s&&s._custom,r),i}}_t(jg,"id","bubble"),_t(jg,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),_t(jg,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function zK(n,t,e){let s=1,i=1,r=0,o=0;if(t<sn){const a=n,c=a+t,l=Math.cos(a),u=Math.sin(a),h=Math.cos(c),f=Math.sin(c),g=(k,I,_)=>jh(k,a,c,!0)?1:Math.max(I,I*e,_,_*e),m=(k,I,_)=>jh(k,a,c,!0)?-1:Math.min(I,I*e,_,_*e),x=g(0,l,h),b=g(Sn,u,f),y=m(Re,l,h),v=m(Re+Sn,u,f);s=(x-y)/2,i=(b-v)/2,r=-(x+y)/2,o=-(b+v)/2}return{ratioX:s,ratioY:i,offsetX:r,offsetY:o}}class dc extends nr{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=s;else{let r=c=>+s[c];if(we(s[t])){const{key:c="value"}=this._parsing;r=l=>+pa(s[l],c)}let o,a;for(o=t,a=t+e;o<a;++o)i._parsed[o]=r(o)}}_getRotation(){return Zi(this.options.rotation-90)}_getCircumference(){return Zi(this.options.circumference)}_getRotationExtents(){let t=sn,e=-sn;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,r=i._getRotation(),o=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,i=this._cachedMeta,r=i.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-o)/2,0),c=Math.min(Z5(this.options.cutout,a),1),l=this._getRingWeight(this.index),{circumference:u,rotation:h}=this._getRotationExtents(),{ratioX:f,ratioY:g,offsetX:m,offsetY:x}=zK(h,u,c),b=(s.width-o)/f,y=(s.height-o)/g,v=Math.max(Math.min(b,y)/2,0),k=SN(this.options.radius,v),I=Math.max(k*c,0),_=(k-I)/this._getVisibleDatasetWeightTotal();this.offsetX=m*k,this.offsetY=x*k,i.total=this.calculateTotal(),this.outerRadius=k-_*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-_*l,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const s=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||i._parsed[t]===null||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/sn)}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,a=o.chartArea,l=o.options.animation,u=(a.left+a.right)/2,h=(a.top+a.bottom)/2,f=r&&l.animateScale,g=f?0:this.innerRadius,m=f?0:this.outerRadius,{sharedOptions:x,includeOptions:b}=this._getSharedOptions(e,i);let y=this._getRotation(),v;for(v=0;v<e;++v)y+=this._circumference(v,r);for(v=e;v<e+s;++v){const k=this._circumference(v,r),I=t[v],_={x:u+this.offsetX,y:h+this.offsetY,startAngle:y,endAngle:y+k,circumference:k,outerRadius:m,innerRadius:g};b&&(_.options=x||this.resolveDataElementOptions(v,I.active?"active":i)),y+=k,this.updateElement(I,v,_,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,i;for(i=0;i<e.length;i++){const r=t._parsed[i];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(i)&&!e[i].hidden&&(s+=Math.abs(r))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?sn*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=wd(e._parsed[t],s.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const s=this.chart;let i,r,o,a,c;if(!t){for(i=0,r=s.data.datasets.length;i<r;++i)if(s.isDatasetVisible(i)){o=s.getDatasetMeta(i),t=o.data,a=o.controller;break}}if(!t)return 0;for(i=0,r=t.length;i<r;++i)c=a.resolveDataElementOptions(i),c.borderAlign!=="inner"&&(e=Math.max(e,c.borderWidth||0,c.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,i=t.length;s<i;++s){const r=this.resolveDataElementOptions(s);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(te(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}_t(dc,"id","doughnut"),_t(dc,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),_t(dc,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),_t(dc,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:i}}=t.legend.options;return e.labels.map((r,o)=>{const c=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:i,lineWidth:c.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class qg extends nr{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:i=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:c}=DN(e,i,o);this._drawStart=a,this._drawCount=c,ON(e)&&(a=0,c=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=i;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(s,void 0,{animated:!o,options:l},t),this.updateElements(i,a,c,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:c,_dataset:l}=this._cachedMeta,{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,i),f=o.axis,g=a.axis,{spanGaps:m,segment:x}=this.options,b=zl(m)?m:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||i==="none",v=e+s,k=t.length;let I=e>0&&this.getParsed(e-1);for(let _=0;_<k;++_){const $=t[_],R=y?$:{};if(_<e||_>=v){R.skip=!0;continue}const A=this.getParsed(_),F=me(A[g]),L=R[f]=o.getPixelForValue(A[f],_),V=R[g]=r||F?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,A,c):A[g],_);R.skip=isNaN(L)||isNaN(V)||F,R.stop=_>0&&Math.abs(A[f]-I[f])>b,x&&(R.parsed=A,R.raw=l.data[_]),h&&(R.options=u||this.resolveDataElementOptions(_,$.active?"active":i)),y||this.updateElement($,_,R,i),I=A}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return s;const r=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}_t(qg,"id","line"),_t(qg,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),_t(qg,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Ph extends nr{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=wd(e._parsed[t].r,s.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,s,i){return VN.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,i)=>{const r=this.getParsed(i).r;!isNaN(r)&&this.chart.getDataVisibility(i)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),o=Math.max(s.cutoutPercentage?r/100*s.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,c=o.options.animation,l=this._cachedMeta.rScale,u=l.xCenter,h=l.yCenter,f=l.getIndexAngle(0)-.5*Re;let g=f,m;const x=360/this.countVisibleElements();for(m=0;m<e;++m)g+=this._computeAngle(m,i,x);for(m=e;m<e+s;m++){const b=t[m];let y=g,v=g+this._computeAngle(m,i,x),k=o.getDataVisibility(m)?l.getDistanceFromCenterForValue(this.getParsed(m).r):0;g=v,r&&(c.animateScale&&(k=0),c.animateRotate&&(y=v=f));const I={x:u,y:h,innerRadius:0,outerRadius:k,startAngle:y,endAngle:v,options:this.resolveDataElementOptions(m,b.active?"active":i)};this.updateElement(b,m,I,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?Zi(this.resolveDataElementOptions(t,e).angle||s):0}}_t(Ph,"id","polarArea"),_t(Ph,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),_t(Ph,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:i}}=t.legend.options;return e.labels.map((r,o)=>{const c=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:i,lineWidth:c.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Lw extends dc{}_t(Lw,"id","pie"),_t(Lw,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Kg extends nr{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,i){return VN.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta,s=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(s.points=i,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===i.length,options:o};this.updateElement(s,void 0,a,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,s,i){const r=this._cachedMeta.rScale,o=i==="reset";for(let a=e;a<e+s;a++){const c=t[a],l=this.resolveDataElementOptions(a,c.active?"active":i),u=r.getPointPositionForValue(a,this.getParsed(a).r),h=o?r.xCenter:u.x,f=o?r.yCenter:u.y,g={x:h,y:f,angle:u.angle,skip:isNaN(h)||isNaN(f),options:l};this.updateElement(c,a,g,i)}}}_t(Kg,"id","radar"),_t(Kg,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),_t(Kg,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Xg extends nr{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),c=r.getLabelForValue(o.y);return{label:s[t]||"",value:"("+a+", "+c+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:o}=DN(e,s,i);if(this._drawStart=r,this._drawCount=o,ON(e)&&(r=0,o=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:c}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!c._decimated,a.points=s;const l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(a,void 0,{animated:!i,options:l},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:c,_dataset:l}=this._cachedMeta,u=this.resolveDataElementOptions(e,i),h=this.getSharedOptions(u),f=this.includeOptions(i,h),g=o.axis,m=a.axis,{spanGaps:x,segment:b}=this.options,y=zl(x)?x:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||r||i==="none";let k=e>0&&this.getParsed(e-1);for(let I=e;I<e+s;++I){const _=t[I],$=this.getParsed(I),R=v?_:{},A=me($[m]),F=R[g]=o.getPixelForValue($[g],I),L=R[m]=r||A?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,$,c):$[m],I);R.skip=isNaN(F)||isNaN(L)||A,R.stop=I>0&&Math.abs($[g]-k[g])>y,b&&(R.parsed=$,R.raw=l.data[I]),f&&(R.options=h||this.resolveDataElementOptions(I,_.active?"active":i)),v||this.updateElement(_,I,R,i),k=$}this.updateSharedOptions(h,i,u)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let c=e.length-1;c>=0;--c)a=Math.max(a,e[c].size(this.resolveDataElementOptions(c))/2);return a>0&&a}const s=t.dataset,i=s.options&&s.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,o)/2}}_t(Xg,"id","scatter"),_t(Xg,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),_t(Xg,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var WK=Object.freeze({__proto__:null,BarController:Gg,BubbleController:jg,DoughnutController:dc,LineController:qg,PieController:Lw,PolarAreaController:Ph,RadarController:Kg,ScatterController:Xg});function Qa(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class m1{constructor(t){_t(this,"options");this.options=t||{}}static override(t){Object.assign(m1.prototype,t)}init(){}formats(){return Qa()}parse(){return Qa()}format(){return Qa()}add(){return Qa()}diff(){return Qa()}startOf(){return Qa()}endOf(){return Qa()}}var VK={_date:m1};function UK(n,t,e,s){const{controller:i,data:r,_sorted:o}=n,a=i._cachedMeta.iScale,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const l=a._reversePixels?hq:vo;if(s){if(i._sharedOptions){const u=r[0],h=typeof u.getRange=="function"&&u.getRange(t);if(h){const f=l(r,t,e-h),g=l(r,t,e+h);return{lo:f.lo,hi:g.hi}}}}else{const u=l(r,t,e);if(c){const{vScale:h}=i._cachedMeta,{_parsed:f}=n,g=f.slice(0,u.lo+1).reverse().findIndex(x=>!me(x[h.axis]));u.lo-=Math.max(0,g);const m=f.slice(u.hi).findIndex(x=>!me(x[h.axis]));u.hi+=Math.max(0,m)}return u}}return{lo:0,hi:r.length-1}}function vd(n,t,e,s,i){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,c=r.length;a<c;++a){const{index:l,data:u}=r[a],{lo:h,hi:f}=UK(r[a],t,o,i);for(let g=h;g<=f;++g){const m=u[g];m.skip||s(m,l,g)}}}function HK(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(s,i){const r=t?Math.abs(s.x-i.x):0,o=e?Math.abs(s.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function q0(n,t,e,s,i){const r=[];return!i&&!n.isPointInArea(t)||vd(n,e,t,function(a,c,l){!i&&!Co(a,n.chartArea,0)||a.inRange(t.x,t.y,s)&&r.push({element:a,datasetIndex:c,index:l})},!0),r}function GK(n,t,e,s){let i=[];function r(o,a,c){const{startAngle:l,endAngle:u}=o.getProps(["startAngle","endAngle"],s),{angle:h}=EN(o,{x:t.x,y:t.y});jh(h,l,u)&&i.push({element:o,datasetIndex:a,index:c})}return vd(n,e,t,r),i}function jK(n,t,e,s,i,r){let o=[];const a=HK(e);let c=Number.POSITIVE_INFINITY;function l(u,h,f){const g=u.inRange(t.x,t.y,i);if(s&&!g)return;const m=u.getCenterPoint(i);if(!(!!r||n.isPointInArea(m))&&!g)return;const b=a(t,m);b<c?(o=[{element:u,datasetIndex:h,index:f}],c=b):b===c&&o.push({element:u,datasetIndex:h,index:f})}return vd(n,e,t,l),o}function K0(n,t,e,s,i,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!s?GK(n,t,e,i):jK(n,t,e,s,i,r)}function vT(n,t,e,s,i){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return vd(n,e,t,(c,l,u)=>{c[o]&&c[o](t[e],i)&&(r.push({element:c,datasetIndex:l,index:u}),a=a||c.inRange(t.x,t.y,i))}),s&&!a?[]:r}var qK={evaluateInteractionItems:vd,modes:{index(n,t,e,s){const i=ic(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?q0(n,i,r,s,o):K0(n,i,r,!1,s,o),c=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(l=>{const u=a[0].index,h=l.data[u];h&&!h.skip&&c.push({element:h,datasetIndex:l.index,index:u})}),c):[]},dataset(n,t,e,s){const i=ic(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?q0(n,i,r,s,o):K0(n,i,r,!1,s,o);if(a.length>0){const c=a[0].datasetIndex,l=n.getDatasetMeta(c).data;a=[];for(let u=0;u<l.length;++u)a.push({element:l[u],datasetIndex:c,index:u})}return a},point(n,t,e,s){const i=ic(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return q0(n,i,r,s,o)},nearest(n,t,e,s){const i=ic(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return K0(n,i,r,e.intersect,s,o)},x(n,t,e,s){const i=ic(t,n);return vT(n,i,"x",e.intersect,s)},y(n,t,e,s){const i=ic(t,n);return vT(n,i,"y",e.intersect,s)}}};const QN=["left","top","right","bottom"];function oh(n,t){return n.filter(e=>e.pos===t)}function CT(n,t){return n.filter(e=>QN.indexOf(e.pos)===-1&&e.box.axis===t)}function ah(n,t){return n.sort((e,s)=>{const i=t?s:e,r=t?e:s;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function KK(n){const t=[];let e,s,i,r,o,a;for(e=0,s=(n||[]).length;e<s;++e)i=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=i,t.push({index:e,box:i,pos:r,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&r+o,stackWeight:a});return t}function XK(n){const t={};for(const e of n){const{stack:s,pos:i,stackWeight:r}=e;if(!s||!QN.includes(i))continue;const o=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function YK(n,t){const e=XK(n),{vBoxMaxWidth:s,hBoxMaxHeight:i}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:c}=a.box,l=e[a.stack],u=l&&a.stackWeight/l.weight;a.horizontal?(a.width=u?u*s:c&&t.availableWidth,a.height=i):(a.width=s,a.height=u?u*i:c&&t.availableHeight)}return e}function JK(n){const t=KK(n),e=ah(t.filter(l=>l.box.fullSize),!0),s=ah(oh(t,"left"),!0),i=ah(oh(t,"right")),r=ah(oh(t,"top"),!0),o=ah(oh(t,"bottom")),a=CT(t,"x"),c=CT(t,"y");return{fullSize:e,leftAndTop:s.concat(r),rightAndBottom:i.concat(c).concat(o).concat(a),chartArea:oh(t,"chartArea"),vertical:s.concat(i).concat(c),horizontal:r.concat(o).concat(a)}}function IT(n,t,e,s){return Math.max(n[e],t[e])+Math.max(n[s],t[s])}function tR(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function ZK(n,t,e,s){const{pos:i,box:r}=e,o=n.maxPadding;if(!we(i)){e.size&&(n[i]-=e.size);const h=s[e.stack]||{size:0,count:1};h.size=Math.max(h.size,e.horizontal?r.height:r.width),e.size=h.size/h.count,n[i]+=e.size}r.getPadding&&tR(o,r.getPadding());const a=Math.max(0,t.outerWidth-IT(o,n,"left","right")),c=Math.max(0,t.outerHeight-IT(o,n,"top","bottom")),l=a!==n.w,u=c!==n.h;return n.w=a,n.h=c,e.horizontal?{same:l,other:u}:{same:u,other:l}}function QK(n){const t=n.maxPadding;function e(s){const i=Math.max(t[s]-n[s],0);return n[s]+=i,i}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function t8(n,t){const e=t.maxPadding;function s(i){const r={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return s(n?["left","right"]:["top","bottom"])}function xh(n,t,e,s){const i=[];let r,o,a,c,l,u;for(r=0,o=n.length,l=0;r<o;++r){a=n[r],c=a.box,c.update(a.width||t.w,a.height||t.h,t8(a.horizontal,t));const{same:h,other:f}=ZK(t,e,a,s);l|=h&&i.length,u=u||f,c.fullSize||i.push(a)}return l&&xh(i,t,e,s)||u}function bg(n,t,e,s,i){n.top=e,n.left=t,n.right=t+s,n.bottom=e+i,n.width=s,n.height=i}function kT(n,t,e,s){const i=e.padding;let{x:r,y:o}=t;for(const a of n){const c=a.box,l=s[a.stack]||{count:1,placed:0,weight:1},u=a.stackWeight/l.weight||1;if(a.horizontal){const h=t.w*u,f=l.size||c.height;Gh(l.start)&&(o=l.start),c.fullSize?bg(c,i.left,o,e.outerWidth-i.right-i.left,f):bg(c,t.left+l.placed,o,h,f),l.start=o,l.placed+=h,o=c.bottom}else{const h=t.h*u,f=l.size||c.width;Gh(l.start)&&(r=l.start),c.fullSize?bg(c,r,i.top,f,e.outerHeight-i.bottom-i.top):bg(c,r,t.top+l.placed,f,h),l.start=r,l.placed+=h,r=c.right}}t.x=r,t.y=o}var xs={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,s){if(!n)return;const i=ws(n.options.layout.padding),r=Math.max(t-i.width,0),o=Math.max(e-i.height,0),a=JK(n.boxes),c=a.vertical,l=a.horizontal;ze(n.boxes,x=>{typeof x.beforeLayout=="function"&&x.beforeLayout()});const u=c.reduce((x,b)=>b.box.options&&b.box.options.display===!1?x:x+1,0)||1,h=Object.freeze({outerWidth:t,outerHeight:e,padding:i,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/u,hBoxMaxHeight:o/2}),f=Object.assign({},i);tR(f,ws(s));const g=Object.assign({maxPadding:f,w:r,h:o,x:i.left,y:i.top},i),m=YK(c.concat(l),h);xh(a.fullSize,g,h,m),xh(c,g,h,m),xh(l,g,h,m)&&xh(c,g,h,m),QK(g),kT(a.leftAndTop,g,h,m),g.x+=g.w,g.y+=g.h,kT(a.rightAndBottom,g,h,m),n.chartArea={left:g.left,top:g.top,right:g.left+g.w,bottom:g.top+g.h,height:g.h,width:g.w},ze(a.chartArea,x=>{const b=x.box;Object.assign(b,n.chartArea),b.update(g.w,g.h,{left:0,top:0,right:0,bottom:0})})}};class eR{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,i){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):s)}}isAttached(t){return!0}updateConfig(t){}}class e8 extends eR{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Yg="$chartjs",n8={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ST=n=>n===null||n==="";function s8(n,t){const e=n.style,s=n.getAttribute("height"),i=n.getAttribute("width");if(n[Yg]={initial:{height:s,width:i,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",ST(i)){const r=cT(n,"width");r!==void 0&&(n.width=r)}if(ST(s))if(n.style.height==="")n.height=n.width/(t||2);else{const r=cT(n,"height");r!==void 0&&(n.height=r)}return n}const nR=iK?{passive:!0}:!1;function i8(n,t,e){n&&n.addEventListener(t,e,nR)}function r8(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,nR)}function o8(n,t){const e=n8[n.type]||n.type,{x:s,y:i}=ic(n,t);return{type:e,chart:t,native:n,x:s!==void 0?s:null,y:i!==void 0?i:null}}function vm(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function a8(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||vm(a.addedNodes,s),o=o&&!vm(a.removedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}function c8(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||vm(a.removedNodes,s),o=o&&!vm(a.addedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}const Kh=new Map;let _T=0;function sR(){const n=window.devicePixelRatio;n!==_T&&(_T=n,Kh.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function l8(n,t){Kh.size||window.addEventListener("resize",sR),Kh.set(n,t)}function u8(n){Kh.delete(n),Kh.size||window.removeEventListener("resize",sR)}function h8(n,t,e){const s=n.canvas,i=s&&g1(s);if(!i)return;const r=AN((a,c)=>{const l=i.clientWidth;e(a,c),l<i.clientWidth&&e()},window),o=new ResizeObserver(a=>{const c=a[0],l=c.contentRect.width,u=c.contentRect.height;l===0&&u===0||r(l,u)});return o.observe(i),l8(n,r),o}function X0(n,t,e){e&&e.disconnect(),t==="resize"&&u8(n)}function d8(n,t,e){const s=n.canvas,i=AN(r=>{n.ctx!==null&&e(o8(r,n))},n);return i8(s,t,i),i}class f8 extends eR{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(s8(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[Yg])return!1;const s=e[Yg].initial;["height","width"].forEach(r=>{const o=s[r];me(o)?e.removeAttribute(r):e.setAttribute(r,o)});const i=s.style||{};return Object.keys(i).forEach(r=>{e.style[r]=i[r]}),e.width=e.width,delete e[Yg],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),o={attach:a8,detach:c8,resize:h8}[e]||d8;i[e]=o(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),i=s[e];if(!i)return;({attach:X0,detach:X0,resize:X0}[e]||r8)(t,e,i),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,i){return sK(t,e,s,i)}isAttached(t){const e=t&&g1(t);return!!(e&&e.isConnected)}}function p8(n){return!p1()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?e8:f8}class or{constructor(){_t(this,"x");_t(this,"y");_t(this,"active",!1);_t(this,"options");_t(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return zl(this.x)&&zl(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const i={};return t.forEach(r=>{i[r]=s[r]&&s[r].active()?s[r]._to:this[r]}),i}}_t(or,"defaults",{}),_t(or,"defaultRoutes");function g8(n,t){const e=n.options.ticks,s=m8(n),i=Math.min(e.maxTicksLimit||s,s),r=e.major.enabled?x8(t):[],o=r.length,a=r[0],c=r[o-1],l=[];if(o>i)return y8(t,l,r,o/i),l;const u=b8(r,t,i);if(o>0){let h,f;const g=o>1?Math.round((c-a)/(o-1)):null;for(xg(t,l,u,me(g)?0:a-g,a),h=0,f=o-1;h<f;h++)xg(t,l,u,r[h],r[h+1]);return xg(t,l,u,c,me(g)?t.length:c+g),l}return xg(t,l,u),l}function m8(n){const t=n.options.offset,e=n._tickSize(),s=n._length/e+(t?0:1),i=n._maxLength/e;return Math.floor(Math.min(s,i))}function b8(n,t,e){const s=w8(n),i=t.length/e;if(!s)return Math.max(i,1);const r=oq(s);for(let o=0,a=r.length-1;o<a;o++){const c=r[o];if(c>i)return c}return Math.max(i,1)}function x8(n){const t=[];let e,s;for(e=0,s=n.length;e<s;e++)n[e].major&&t.push(e);return t}function y8(n,t,e,s){let i=0,r=e[0],o;for(s=Math.ceil(s),o=0;o<n.length;o++)o===r&&(t.push(n[o]),i++,r=e[i*s])}function xg(n,t,e,s,i){const r=te(s,0),o=Math.min(te(i,n.length),n.length);let a=0,c,l,u;for(e=Math.ceil(e),i&&(c=i-s,e=c/Math.floor(c/e)),u=r;u<0;)a++,u=Math.round(r+a*e);for(l=Math.max(r,0);l<o;l++)l===u&&(t.push(n[l]),a++,u=Math.round(r+a*e))}function w8(n){const t=n.length;let e,s;if(t<2)return!1;for(s=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==s)return!1;return s}const v8=n=>n==="left"?"right":n==="right"?"left":n,TT=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,ET=(n,t)=>Math.min(t||n,n);function $T(n,t){const e=[],s=n.length/t,i=n.length;let r=0;for(;r<i;r+=s)e.push(n[Math.floor(r)]);return e}function C8(n,t,e){const s=n.ticks.length,i=Math.min(t,s-1),r=n._startPixel,o=n._endPixel,a=1e-6;let c=n.getPixelForTick(i),l;if(!(e&&(s===1?l=Math.max(c-r,o-c):t===0?l=(n.getPixelForTick(1)-c)/2:l=(c-n.getPixelForTick(i-1))/2,c+=i<t?l:-l,c<r-a||c>o+a)))return c}function I8(n,t){ze(n,e=>{const s=e.gc,i=s.length/2;let r;if(i>t){for(r=0;r<i;++r)delete e.data[s[r]];s.splice(0,i)}})}function ch(n){return n.drawTicks?n.tickLength:0}function NT(n,t){if(!n.display)return 0;const e=zn(n.font,t),s=ws(n.padding);return(nn(n.text)?n.text.length:1)*e.lineHeight+s.height}function k8(n,t){return Ia(n,{scale:t,type:"scale"})}function S8(n,t,e){return Ia(n,{tick:e,index:t,type:"tick"})}function _8(n,t,e){let s=c1(n);return(e&&t!=="right"||!e&&t==="right")&&(s=v8(s)),s}function T8(n,t,e,s){const{top:i,left:r,bottom:o,right:a,chart:c}=n,{chartArea:l,scales:u}=c;let h=0,f,g,m;const x=o-i,b=a-r;if(n.isHorizontal()){if(g=hs(s,r,a),we(e)){const y=Object.keys(e)[0],v=e[y];m=u[y].getPixelForValue(v)+x-t}else e==="center"?m=(l.bottom+l.top)/2+x-t:m=TT(n,e,t);f=a-r}else{if(we(e)){const y=Object.keys(e)[0],v=e[y];g=u[y].getPixelForValue(v)-b+t}else e==="center"?g=(l.left+l.right)/2-b+t:g=TT(n,e,t);m=hs(s,o,i),h=e==="left"?-Sn:Sn}return{titleX:g,titleY:m,maxWidth:f,rotation:h}}class zc extends or{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:i}=this;return t=oi(t,Number.POSITIVE_INFINITY),e=oi(e,Number.NEGATIVE_INFINITY),s=oi(s,Number.POSITIVE_INFINITY),i=oi(i,Number.NEGATIVE_INFINITY),{min:oi(t,s),max:oi(e,i),minDefined:pn(t),maxDefined:pn(e)}}getMinMax(t){let{min:e,max:s,minDefined:i,maxDefined:r}=this.getUserBounds(),o;if(i&&r)return{min:e,max:s};const a=this.getMatchingVisibleMetas();for(let c=0,l=a.length;c<l;++c)o=a[c].controller.getMinMax(this,t),i||(e=Math.min(e,o.min)),r||(s=Math.max(s,o.max));return e=r&&e>s?s:e,s=i&&e>s?e:s,{min:oi(e,oi(s,e)),max:oi(s,oi(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ze(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:i,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Pq(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=a<this.ticks.length;this._convertTicksToLabels(c?$T(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=g8(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ze(this.options.afterUpdate,[this])}beforeSetDimensions(){Ze(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ze(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Ze(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ze(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,i,r;for(s=0,i=t.length;s<i;s++)r=t[s],r.label=Ze(e.callback,[r.value,s,t],this)}afterTickToLabelConversion(){Ze(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ze(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=ET(this.ticks.length,t.ticks.maxTicksLimit),i=e.minRotation||0,r=e.maxRotation;let o=i,a,c,l;if(!this._isVisible()||!e.display||i>=r||s<=1||!this.isHorizontal()){this.labelRotation=i;return}const u=this._getLabelSizes(),h=u.widest.width,f=u.highest.height,g=Gn(this.chart.width-h,0,this.maxWidth);a=t.offset?this.maxWidth/s:g/(s-1),h+6>a&&(a=g/(s-(t.offset?.5:1)),c=this.maxHeight-ch(t.grid)-e.padding-NT(t.title,this.chart.options.font),l=Math.sqrt(h*h+f*f),o=o1(Math.min(Math.asin(Gn((u.highest.height+6)/a,-1,1)),Math.asin(Gn(c/l,-1,1))-Math.asin(Gn(f/l,-1,1)))),o=Math.max(i,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){Ze(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ze(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:i,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const c=NT(i,e.options.font);if(a?(t.width=this.maxWidth,t.height=ch(r)+c):(t.height=this.maxHeight,t.width=ch(r)+c),s.display&&this.ticks.length){const{first:l,last:u,widest:h,highest:f}=this._getLabelSizes(),g=s.padding*2,m=Zi(this.labelRotation),x=Math.cos(m),b=Math.sin(m);if(a){const y=s.mirror?0:b*h.width+x*f.height;t.height=Math.min(this.maxHeight,t.height+y+g)}else{const y=s.mirror?0:x*h.width+b*f.height;t.width=Math.min(this.maxWidth,t.width+y+g)}this._calculatePadding(l,u,b,x)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,i){const{ticks:{align:r,padding:o},position:a}=this.options,c=this.labelRotation!==0,l=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,g=0;c?l?(f=i*t.width,g=s*e.height):(f=s*t.height,g=i*e.width):r==="start"?g=e.width:r==="end"?f=t.width:r!=="inner"&&(f=t.width/2,g=e.width/2),this.paddingLeft=Math.max((f-u+o)*this.width/(this.width-u),0),this.paddingRight=Math.max((g-h+o)*this.width/(this.width-h),0)}else{let u=e.height/2,h=t.height/2;r==="start"?(u=0,h=t.height):r==="end"&&(u=e.height,h=0),this.paddingTop=u+o,this.paddingBottom=h+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ze(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)me(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=$T(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:i,_longestTextCache:r}=this,o=[],a=[],c=Math.floor(e/ET(e,s));let l=0,u=0,h,f,g,m,x,b,y,v,k,I,_;for(h=0;h<e;h+=c){if(m=t[h].label,x=this._resolveTickFontOptions(h),i.font=b=x.string,y=r[b]=r[b]||{data:{},gc:[]},v=x.lineHeight,k=I=0,!me(m)&&!nn(m))k=ym(i,y.data,y.gc,k,m),I=v;else if(nn(m))for(f=0,g=m.length;f<g;++f)_=m[f],!me(_)&&!nn(_)&&(k=ym(i,y.data,y.gc,k,_),I+=v);o.push(k),a.push(I),l=Math.max(k,l),u=Math.max(I,u)}I8(r,e);const $=o.indexOf(l),R=a.indexOf(u),A=F=>({width:o[F]||0,height:a[F]||0});return{first:A(0),last:A(e-1),widest:A($),highest:A(R),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return uq(this._alignToPixels?Za(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=S8(this.getContext(),t,s))}return this.$context||(this.$context=k8(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Zi(this.labelRotation),s=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,c=r?r.highest.height+o:0;return this.isHorizontal()?c*s>a*i?a/s:c/i:c*i<a*s?c/s:a/i}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,i=this.options,{grid:r,position:o,border:a}=i,c=r.offset,l=this.isHorizontal(),h=this.ticks.length+(c?1:0),f=ch(r),g=[],m=a.setContext(this.getContext()),x=m.display?m.width:0,b=x/2,y=function(tt){return Za(s,tt,x)};let v,k,I,_,$,R,A,F,L,V,j,Z;if(o==="top")v=y(this.bottom),R=this.bottom-f,F=v-b,V=y(t.top)+b,Z=t.bottom;else if(o==="bottom")v=y(this.top),V=t.top,Z=y(t.bottom)-b,R=v+b,F=this.top+f;else if(o==="left")v=y(this.right),$=this.right-f,A=v-b,L=y(t.left)+b,j=t.right;else if(o==="right")v=y(this.left),L=t.left,j=y(t.right)-b,$=v+b,A=this.left+f;else if(e==="x"){if(o==="center")v=y((t.top+t.bottom)/2+.5);else if(we(o)){const tt=Object.keys(o)[0],it=o[tt];v=y(this.chart.scales[tt].getPixelForValue(it))}V=t.top,Z=t.bottom,R=v+b,F=R+f}else if(e==="y"){if(o==="center")v=y((t.left+t.right)/2);else if(we(o)){const tt=Object.keys(o)[0],it=o[tt];v=y(this.chart.scales[tt].getPixelForValue(it))}$=v-b,A=$-f,L=t.left,j=t.right}const et=te(i.ticks.maxTicksLimit,h),K=Math.max(1,Math.ceil(h/et));for(k=0;k<h;k+=K){const tt=this.getContext(k),it=r.setContext(tt),st=a.setContext(tt),ot=it.lineWidth,bt=it.color,ft=st.dash||[],yt=st.dashOffset,vt=it.tickWidth,St=it.tickColor,pt=it.tickBorderDash||[],Ct=it.tickBorderDashOffset;I=C8(this,k,c),I!==void 0&&(_=Za(s,I,ot),l?$=A=L=j=_:R=F=V=Z=_,g.push({tx1:$,ty1:R,tx2:A,ty2:F,x1:L,y1:V,x2:j,y2:Z,width:ot,color:bt,borderDash:ft,borderDashOffset:yt,tickWidth:vt,tickColor:St,tickBorderDash:pt,tickBorderDashOffset:Ct}))}return this._ticksLength=h,this._borderValue=v,g}_computeLabelItems(t){const e=this.axis,s=this.options,{position:i,ticks:r}=s,o=this.isHorizontal(),a=this.ticks,{align:c,crossAlign:l,padding:u,mirror:h}=r,f=ch(s.grid),g=f+u,m=h?-u:g,x=-Zi(this.labelRotation),b=[];let y,v,k,I,_,$,R,A,F,L,V,j,Z="middle";if(i==="top")$=this.bottom-m,R=this._getXAxisLabelAlignment();else if(i==="bottom")$=this.top+m,R=this._getXAxisLabelAlignment();else if(i==="left"){const K=this._getYAxisLabelAlignment(f);R=K.textAlign,_=K.x}else if(i==="right"){const K=this._getYAxisLabelAlignment(f);R=K.textAlign,_=K.x}else if(e==="x"){if(i==="center")$=(t.top+t.bottom)/2+g;else if(we(i)){const K=Object.keys(i)[0],tt=i[K];$=this.chart.scales[K].getPixelForValue(tt)+g}R=this._getXAxisLabelAlignment()}else if(e==="y"){if(i==="center")_=(t.left+t.right)/2-g;else if(we(i)){const K=Object.keys(i)[0],tt=i[K];_=this.chart.scales[K].getPixelForValue(tt)}R=this._getYAxisLabelAlignment(f).textAlign}e==="y"&&(c==="start"?Z="top":c==="end"&&(Z="bottom"));const et=this._getLabelSizes();for(y=0,v=a.length;y<v;++y){k=a[y],I=k.label;const K=r.setContext(this.getContext(y));A=this.getPixelForTick(y)+r.labelOffset,F=this._resolveTickFontOptions(y),L=F.lineHeight,V=nn(I)?I.length:1;const tt=V/2,it=K.color,st=K.textStrokeColor,ot=K.textStrokeWidth;let bt=R;o?(_=A,R==="inner"&&(y===v-1?bt=this.options.reverse?"left":"right":y===0?bt=this.options.reverse?"right":"left":bt="center"),i==="top"?l==="near"||x!==0?j=-V*L+L/2:l==="center"?j=-et.highest.height/2-tt*L+L:j=-et.highest.height+L/2:l==="near"||x!==0?j=L/2:l==="center"?j=et.highest.height/2-tt*L:j=et.highest.height-V*L,h&&(j*=-1),x!==0&&!K.showLabelBackdrop&&(_+=L/2*Math.sin(x))):($=A,j=(1-V)*L/2);let ft;if(K.showLabelBackdrop){const yt=ws(K.backdropPadding),vt=et.heights[y],St=et.widths[y];let pt=j-yt.top,Ct=0-yt.left;switch(Z){case"middle":pt-=vt/2;break;case"bottom":pt-=vt;break}switch(R){case"center":Ct-=St/2;break;case"right":Ct-=St;break;case"inner":y===v-1?Ct-=St:y>0&&(Ct-=St/2);break}ft={left:Ct,top:pt,width:St+yt.width,height:vt+yt.height,color:K.backdropColor}}b.push({label:I,font:F,textOffset:j,options:{rotation:x,color:it,strokeColor:st,strokeWidth:ot,textAlign:bt,textBaseline:Z,translation:[_,$],backdrop:ft}})}return b}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Zi(this.labelRotation))return t==="top"?"left":"right";let i="center";return e.align==="start"?i="left":e.align==="end"?i="right":e.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:i,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,c=o.widest.width;let l,u;return e==="left"?i?(u=this.right+r,s==="near"?l="left":s==="center"?(l="center",u+=c/2):(l="right",u+=c)):(u=this.right-a,s==="near"?l="right":s==="center"?(l="center",u-=c/2):(l="left",u=this.left)):e==="right"?i?(u=this.left+r,s==="near"?l="right":s==="center"?(l="center",u-=c/2):(l="left",u-=c)):(u=this.left+a,s==="near"?l="left":s==="center"?(l="center",u+=c/2):(l="right",u=this.right)):l="right",{textAlign:l,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:i,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,i,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex(r=>r.value===t);return i>=0?e.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(c,l,u)=>{!u.width||!u.color||(s.save(),s.lineWidth=u.width,s.strokeStyle=u.color,s.setLineDash(u.borderDash||[]),s.lineDashOffset=u.borderDashOffset,s.beginPath(),s.moveTo(c.x,c.y),s.lineTo(l.x,l.y),s.stroke(),s.restore())};if(e.display)for(r=0,o=i.length;r<o;++r){const c=i[r];e.drawOnChartArea&&a({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),e.drawTicks&&a({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:i}}=this,r=s.setContext(this.getContext()),o=s.display?r.width:0;if(!o)return;const a=i.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let l,u,h,f;this.isHorizontal()?(l=Za(t,this.left,o)-o/2,u=Za(t,this.right,a)+a/2,h=f=c):(h=Za(t,this.top,o)-o/2,f=Za(t,this.bottom,a)+a/2,l=u=c),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(l,h),e.lineTo(u,f),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,i=this._computeLabelArea();i&&hb(s,i);const r=this.getLabelItems(t);for(const o of r){const a=o.options,c=o.font,l=o.label,u=o.textOffset;Sc(s,l,0,u,c,a)}i&&db(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:i}}=this;if(!s.display)return;const r=zn(s.font),o=ws(s.padding),a=s.align;let c=r.lineHeight/2;e==="bottom"||e==="center"||we(e)?(c+=o.bottom,nn(s.text)&&(c+=r.lineHeight*(s.text.length-1))):c+=o.top;const{titleX:l,titleY:u,maxWidth:h,rotation:f}=T8(this,c,e,a);Sc(t,s.text,0,0,r,{color:s.color,maxWidth:h,rotation:f,textAlign:_8(a,e,i),textBaseline:"middle",translation:[l,u]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=te(t.grid&&t.grid.z,-1),i=te(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==zc.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:s,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[s]===this.id&&(!t||a.type===t)&&i.push(a)}return i}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return zn(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class yg{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;N8(e)&&(s=this.register(e));const i=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,E8(t,o,s),this.override&&cn.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,i=this.scope;s in e&&delete e[s],i&&s in cn[i]&&(delete cn[i][s],this.override&&delete kc[s])}}function E8(n,t,e){const s=Hh(Object.create(null),[e?cn.get(e):{},cn.get(t),n.defaults]);cn.set(t,s),n.defaultRoutes&&$8(t,n.defaultRoutes),n.descriptors&&cn.describe(t,n.descriptors)}function $8(n,t){Object.keys(t).forEach(e=>{const s=e.split("."),i=s.pop(),r=[n].concat(s).join("."),o=t[e].split("."),a=o.pop(),c=o.join(".");cn.route(r,i,c,a)})}function N8(n){return"id"in n&&"defaults"in n}class R8{constructor(){this.controllers=new yg(nr,"datasets",!0),this.elements=new yg(or,"elements"),this.plugins=new yg(Object,"plugins"),this.scales=new yg(zc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(i=>{const r=s||this._getRegistryForType(i);s||r.isForType(i)||r===this.plugins&&i.id?this._exec(t,r,i):ze(i,o=>{const a=s||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,s){const i=r1(t);Ze(s["before"+i],[],s),e[t](s),Ze(s["after"+i],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const i=e.get(t);if(i===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return i}}var vr=new R8;class A8{constructor(){this._init=[]}notify(t,e,s,i){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const r=i?this._descriptors(t).filter(i):this._descriptors(t),o=this._notify(r,t,e,s);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),o}_notify(t,e,s,i){i=i||{};for(const r of t){const o=r.plugin,a=o[s],c=[e,i,r.options];if(Ze(a,c,o)===!1&&i.cancelable)return!1}return!0}invalidate(){me(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,i=te(s.options&&s.options.plugins,{}),r=D8(s);return i===!1&&!e?[]:P8(t,r,i,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,i=(r,o)=>r.filter(a=>!o.some(c=>a.plugin.id===c.plugin.id));this._notify(i(e,s),t,"stop"),this._notify(i(s,e),t,"start")}}function D8(n){const t={},e=[],s=Object.keys(vr.plugins.items);for(let r=0;r<s.length;r++)e.push(vr.getPlugin(s[r]));const i=n.plugins||[];for(let r=0;r<i.length;r++){const o=i[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function O8(n,t){return!t&&n===!1?null:n===!0?{}:n}function P8(n,{plugins:t,localIds:e},s,i){const r=[],o=n.getContext();for(const a of t){const c=a.id,l=O8(s[c],i);l!==null&&r.push({plugin:a,options:F8(n.config,{plugin:a,local:e[c]},l,o)})}return r}function F8(n,{plugin:t,local:e},s,i){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(s,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Bw(n,t){const e=cn.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function M8(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function L8(n,t){return n===t?"_index_":"_value_"}function RT(n){if(n==="x"||n==="y"||n==="r")return n}function B8(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function zw(n,...t){if(RT(n))return n;for(const e of t){const s=e.axis||B8(e.position)||n.length>1&&RT(n[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function AT(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function z8(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===n||s.yAxisID===n);if(e.length)return AT(n,"x",e[0])||AT(n,"y",e[0])}return{}}function W8(n,t){const e=kc[n.type]||{scales:{}},s=t.scales||{},i=Bw(n.type,t),r=Object.create(null);return Object.keys(s).forEach(o=>{const a=s[o];if(!we(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const c=zw(o,a,z8(o,n),cn.scales[a.type]),l=L8(c,i),u=e.scales||{};r[o]=Rh(Object.create(null),[{axis:c},a,u[c],u[l]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,c=o.indexAxis||Bw(a,t),u=(kc[a]||{}).scales||{};Object.keys(u).forEach(h=>{const f=M8(h,c),g=o[f+"AxisID"]||f;r[g]=r[g]||Object.create(null),Rh(r[g],[{axis:f},s[g],u[h]])})}),Object.keys(r).forEach(o=>{const a=r[o];Rh(a,[cn.scales[a.type],cn.scale])}),r}function iR(n){const t=n.options||(n.options={});t.plugins=te(t.plugins,{}),t.scales=W8(n,t)}function rR(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function V8(n){return n=n||{},n.data=rR(n.data),iR(n),n}const DT=new Map,oR=new Set;function wg(n,t){let e=DT.get(n);return e||(e=t(),DT.set(n,e),oR.add(e)),e}const lh=(n,t,e)=>{const s=pa(t,e);s!==void 0&&n.add(s)};class U8{constructor(t){this._config=V8(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=rR(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),iR(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return wg(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return wg(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return wg(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return wg(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let i=s.get(t);return(!i||e)&&(i=new Map,s.set(t,i)),i}getOptionScopes(t,e,s){const{options:i,type:r}=this,o=this._cachedScopes(t,s),a=o.get(e);if(a)return a;const c=new Set;e.forEach(u=>{t&&(c.add(t),u.forEach(h=>lh(c,t,h))),u.forEach(h=>lh(c,i,h)),u.forEach(h=>lh(c,kc[r]||{},h)),u.forEach(h=>lh(c,cn,h)),u.forEach(h=>lh(c,Fw,h))});const l=Array.from(c);return l.length===0&&l.push(Object.create(null)),oR.has(e)&&o.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,kc[e]||{},cn.datasets[e]||{},{type:e},cn,Fw]}resolveNamedOptions(t,e,s,i=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=OT(this._resolverCache,t,i);let c=o;if(G8(o,e)){r.$shared=!1,s=ga(s)?s():s;const l=this.createResolver(t,s,a);c=Wl(o,s,l)}for(const l of e)r[l]=c[l];return r}createResolver(t,e,s=[""],i){const{resolver:r}=OT(this._resolverCache,t,s);return we(e)?Wl(r,e,void 0,i):r}}function OT(n,t,e){let s=n.get(t);s||(s=new Map,n.set(t,s));const i=e.join();let r=s.get(i);return r||(r={resolver:h1(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},s.set(i,r)),r}const H8=n=>we(n)&&Object.getOwnPropertyNames(n).some(t=>ga(n[t]));function G8(n,t){const{isScriptable:e,isIndexable:s}=LN(n);for(const i of t){const r=e(i),o=s(i),a=(o||r)&&n[i];if(r&&(ga(a)||H8(a))||o&&nn(a))return!0}return!1}var j8="4.5.0";const q8=["top","bottom","left","right","chartArea"];function PT(n,t){return n==="top"||n==="bottom"||q8.indexOf(n)===-1&&t==="x"}function FT(n,t){return function(e,s){return e[n]===s[n]?e[t]-s[t]:e[n]-s[n]}}function MT(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),Ze(e&&e.onComplete,[n],t)}function K8(n){const t=n.chart,e=t.options.animation;Ze(e&&e.onProgress,[n],t)}function aR(n){return p1()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Jg={},LT=n=>{const t=aR(n);return Object.values(Jg).filter(e=>e.canvas===t).pop()};function X8(n,t,e){const s=Object.keys(n);for(const i of s){const r=+i;if(r>=t){const o=n[i];delete n[i],(e>0||r>t)&&(n[r+e]=o)}}}function Y8(n,t,e,s){return!e||n.type==="mouseout"?null:s?t:n}class uo{static register(...t){vr.add(...t),BT()}static unregister(...t){vr.remove(...t),BT()}constructor(t,e){const s=this.config=new U8(e),i=aR(t),r=LT(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||p8(i)),this.platform.updateConfig(s);const a=this.platform.acquireContext(i,o.aspectRatio),c=a&&a.canvas,l=c&&c.height,u=c&&c.width;if(this.id=J5(),this.ctx=a,this.canvas=c,this.width=u,this.height=l,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new A8,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=pq(h=>this.update(h),o.resizeDelay||0),this._dataChanges=[],Jg[this.id]=this,!a||!c){console.error("Failed to create chart: can't acquire context from the given item");return}ao.listen(this,"complete",MT),ao.listen(this,"progress",K8),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:i,_aspectRatio:r}=this;return me(t)?e&&r?r:i?s/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return vr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():aT(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return iT(this.canvas,this.ctx),this}stop(){return ao.stop(this),this}resize(t,e){ao.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,i=this.canvas,r=s.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,t,e,r),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,aT(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),Ze(s.onResize,[this,o],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};ze(e,(s,i)=>{s.id=i})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,i=Object.keys(s).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],c=zw(o,a),l=c==="r",u=c==="x";return{options:a,dposition:l?"chartArea":u?"bottom":"left",dtype:l?"radialLinear":u?"category":"linear"}}))),ze(r,o=>{const a=o.options,c=a.id,l=zw(c,a),u=te(a.type,o.dtype);(a.position===void 0||PT(a.position,l)!==PT(o.dposition))&&(a.position=o.dposition),i[c]=!0;let h=null;if(c in s&&s[c].type===u)h=s[c];else{const f=vr.getScale(u);h=new f({id:c,type:u,ctx:this.ctx,chart:this}),s[h.id]=h}h.init(a,t)}),ze(i,(o,a)=>{o||delete s[a]}),ze(s,o=>{xs.configure(this,o,o.options),xs.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((i,r)=>i.index-r.index),s>e){for(let i=e;i<s;++i)this._destroyDatasetMeta(i);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(FT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,i)=>{e.filter(r=>r===s._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=e.length;s<i;s++){const r=e[s];let o=this.getDatasetMeta(s);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=a,o.indexAxis=r.indexAxis||Bw(a,this.options),o.order=r.order||0,o.index=s,o.label=""+r.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const c=vr.getController(a),{datasetElementType:l,dataElementType:u}=cn.datasets[a];Object.assign(c,{dataElementType:vr.getElement(u),datasetElementType:l&&vr.getElement(l)}),o.controller=new c(this,s),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){ze(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let l=0,u=this.data.datasets.length;l<u;l++){const{controller:h}=this.getDatasetMeta(l),f=!i&&r.indexOf(h)===-1;h.buildOrUpdateElements(f),o=Math.max(+h.getMaxOverflow(),o)}o=this._minPadding=s.layout.autoPadding?o:0,this._updateLayout(o),i||ze(r,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(FT("z","_idx"));const{_active:a,_lastEvent:c}=this;c?this._eventHandler(c,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){ze(this.scales,t=>{xs.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!X_(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:r}of e){const o=s==="_removeElements"?-r:r;X8(t,i,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),i=s(0);for(let r=1;r<e;r++)if(!X_(i,s(r)))return;return Array.from(i).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;xs.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],ze(this.boxes,i=>{s&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,r)=>{i._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,ga(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),i={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(s.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ao.has(this)?this.attached&&!ao.running(this)&&ao.start(this):(this.draw(),MT({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(s,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let i,r;for(i=0,r=e.length;i<r;++i){const o=e[i];(!t||o.visible)&&s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s={meta:t,index:t.index,cancelable:!0},i=XN(this,t);this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(i&&hb(e,i),t.controller.draw(),i&&db(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return Co(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,i){const r=qK.modes[e];return typeof r=="function"?r(this,t,s,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let i=s.filter(r=>r&&r._dataset===e).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=Ia(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const i=s?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,i);Gh(e)?(r.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),o.update(r,{visible:s}),this.update(a=>a.datasetIndex===t?i:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),ao.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),iT(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Jg[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},i=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};ze(this.options.events,r=>s(r,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(c,l)=>{e.addEventListener(this,c,l),t[c]=l},i=(c,l)=>{t[c]&&(e.removeEventListener(this,c,l),delete t[c])},r=(c,l)=>{this.canvas&&this.resize(c,l)};let o;const a=()=>{i("attach",a),this.attached=!0,this.resize(),s("resize",r),s("detach",o)};o=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),s("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){ze(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},ze(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const i=s?"set":"remove";let r,o,a,c;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),a=0,c=t.length;a<c;++a){o=t[a];const l=o&&this.getDatasetMeta(o.datasetIndex).controller;l&&l[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!mm(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const i=this.options.hover,r=(c,l)=>c.filter(u=>!l.some(h=>u.datasetIndex===h.datasetIndex&&u.index===h.index)),o=r(e,t),a=s?t:r(t,e);o.length&&this.updateHoverStyle(o,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,i)===!1)return;const r=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(r||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:i=[],options:r}=this,o=e,a=this._getActiveElements(t,i,s,o),c=sq(t),l=Y8(t,this._lastEvent,s,c);s&&(this._lastEvent=null,Ze(r.onHover,[t,a,this],this),c&&Ze(r.onClick,[t,a,this],this));const u=!mm(a,i);return(u||e)&&(this._active=a,this._updateHoverStyles(a,i,e)),this._lastEvent=l,u}_getActiveElements(t,e,s,i){if(t.type==="mouseout")return[];if(!s)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}_t(uo,"defaults",cn),_t(uo,"instances",Jg),_t(uo,"overrides",kc),_t(uo,"registry",vr),_t(uo,"version",j8),_t(uo,"getChart",LT);function BT(){return ze(uo.instances,n=>n._plugins.invalidate())}function J8(n,t,e){const{startAngle:s,x:i,y:r,outerRadius:o,innerRadius:a,options:c}=t,{borderWidth:l,borderJoinStyle:u}=c,h=Math.min(l/o,ps(s-e));if(n.beginPath(),n.arc(i,r,o-l/2,s+h/2,e-h/2),a>0){const f=Math.min(l/a,ps(s-e));n.arc(i,r,a+l/2,e-f/2,s+f/2,!0)}else{const f=Math.min(l/2,o*ps(s-e));if(u==="round")n.arc(i,r,f,e-Re/2,s+Re/2,!0);else if(u==="bevel"){const g=2*f*f,m=-g*Math.cos(e+Re/2)+i,x=-g*Math.sin(e+Re/2)+r,b=g*Math.cos(s+Re/2)+i,y=g*Math.sin(s+Re/2)+r;n.lineTo(m,x),n.lineTo(b,y)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function Z8(n,t,e){const{startAngle:s,pixelMargin:i,x:r,y:o,outerRadius:a,innerRadius:c}=t;let l=i/a;n.beginPath(),n.arc(r,o,a,s-l,e+l),c>i?(l=i/c,n.arc(r,o,c,e+l,s-l,!0)):n.arc(r,o,i,e+Sn,s-Sn),n.closePath(),n.clip()}function Q8(n){return u1(n,["outerStart","outerEnd","innerStart","innerEnd"])}function tX(n,t,e,s){const i=Q8(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,s*t/2),a=c=>{const l=(e-Math.min(r,c))*s/2;return Gn(c,0,Math.min(r,l))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:Gn(i.innerStart,0,o),innerEnd:Gn(i.innerEnd,0,o)}}function xl(n,t,e,s){return{x:e+n*Math.cos(t),y:s+n*Math.sin(t)}}function Cm(n,t,e,s,i,r){const{x:o,y:a,startAngle:c,pixelMargin:l,innerRadius:u}=t,h=Math.max(t.outerRadius+s+e-l,0),f=u>0?u+s+e+l:0;let g=0;const m=i-c;if(s){const K=u>0?u-s:0,tt=h>0?h-s:0,it=(K+tt)/2,st=it!==0?m*it/(it+s):m;g=(m-st)/2}const x=Math.max(.001,m*h-e/Re)/h,b=(m-x)/2,y=c+b+g,v=i-b-g,{outerStart:k,outerEnd:I,innerStart:_,innerEnd:$}=tX(t,f,h,v-y),R=h-k,A=h-I,F=y+k/R,L=v-I/A,V=f+_,j=f+$,Z=y+_/V,et=v-$/j;if(n.beginPath(),r){const K=(F+L)/2;if(n.arc(o,a,h,F,K),n.arc(o,a,h,K,L),I>0){const ot=xl(A,L,o,a);n.arc(ot.x,ot.y,I,L,v+Sn)}const tt=xl(j,v,o,a);if(n.lineTo(tt.x,tt.y),$>0){const ot=xl(j,et,o,a);n.arc(ot.x,ot.y,$,v+Sn,et+Math.PI)}const it=(v-$/f+(y+_/f))/2;if(n.arc(o,a,f,v-$/f,it,!0),n.arc(o,a,f,it,y+_/f,!0),_>0){const ot=xl(V,Z,o,a);n.arc(ot.x,ot.y,_,Z+Math.PI,y-Sn)}const st=xl(R,y,o,a);if(n.lineTo(st.x,st.y),k>0){const ot=xl(R,F,o,a);n.arc(ot.x,ot.y,k,y-Sn,F)}}else{n.moveTo(o,a);const K=Math.cos(F)*h+o,tt=Math.sin(F)*h+a;n.lineTo(K,tt);const it=Math.cos(L)*h+o,st=Math.sin(L)*h+a;n.lineTo(it,st)}n.closePath()}function eX(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a}=t;let c=t.endAngle;if(r){Cm(n,t,e,s,c,i);for(let l=0;l<r;++l)n.fill();isNaN(a)||(c=o+(a%sn||sn))}return Cm(n,t,e,s,c,i),n.fill(),c}function nX(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a,options:c}=t,{borderWidth:l,borderJoinStyle:u,borderDash:h,borderDashOffset:f,borderRadius:g}=c,m=c.borderAlign==="inner";if(!l)return;n.setLineDash(h||[]),n.lineDashOffset=f,m?(n.lineWidth=l*2,n.lineJoin=u||"round"):(n.lineWidth=l,n.lineJoin=u||"bevel");let x=t.endAngle;if(r){Cm(n,t,e,s,x,i);for(let b=0;b<r;++b)n.stroke();isNaN(a)||(x=o+(a%sn||sn))}m&&Z8(n,t,x),c.selfJoin&&x-o>=Re&&g===0&&u!=="miter"&&J8(n,t,x),r||(Cm(n,t,e,s,x,i),n.stroke())}class yh extends or{constructor(e){super();_t(this,"circumference");_t(this,"endAngle");_t(this,"fullCircles");_t(this,"innerRadius");_t(this,"outerRadius");_t(this,"pixelMargin");_t(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.getProps(["x","y"],i),{angle:o,distance:a}=EN(r,{x:e,y:s}),{startAngle:c,endAngle:l,innerRadius:u,outerRadius:h,circumference:f}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),g=(this.options.spacing+this.options.borderWidth)/2,m=te(f,l-c),x=jh(o,c,l)&&c!==l,b=m>=sn||x,y=wo(a,u+g,h+g);return b&&y}getCenterPoint(e){const{x:s,y:i,startAngle:r,endAngle:o,innerRadius:a,outerRadius:c}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:l,spacing:u}=this.options,h=(r+o)/2,f=(a+c+u+l)/2;return{x:s+Math.cos(h)*f,y:i+Math.sin(h)*f}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:i}=this,r=(s.offset||0)/4,o=(s.spacing||0)/2,a=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=i>sn?Math.floor(i/sn):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const c=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(c)*r,Math.sin(c)*r);const l=1-Math.sin(Math.min(Re,i||0)),u=r*l;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,eX(e,this,u,o,a),nX(e,this,u,o,a),e.restore()}}_t(yh,"id","arc"),_t(yh,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),_t(yh,"defaultRoutes",{backgroundColor:"backgroundColor"}),_t(yh,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function cR(n,t,e=t){n.lineCap=te(e.borderCapStyle,t.borderCapStyle),n.setLineDash(te(e.borderDash,t.borderDash)),n.lineDashOffset=te(e.borderDashOffset,t.borderDashOffset),n.lineJoin=te(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=te(e.borderWidth,t.borderWidth),n.strokeStyle=te(e.borderColor,t.borderColor)}function sX(n,t,e){n.lineTo(e.x,e.y)}function iX(n){return n.stepped?_q:n.tension||n.cubicInterpolationMode==="monotone"?Tq:sX}function lR(n,t,e={}){const s=n.length,{start:i=0,end:r=s-1}=e,{start:o,end:a}=t,c=Math.max(i,o),l=Math.min(r,a),u=i<o&&r<o||i>a&&r>a;return{count:s,start:c,loop:t.loop,ilen:l<c&&!u?s+l-c:l-c}}function rX(n,t,e,s){const{points:i,options:r}=t,{count:o,start:a,loop:c,ilen:l}=lR(i,e,s),u=iX(r);let{move:h=!0,reverse:f}=s||{},g,m,x;for(g=0;g<=l;++g)m=i[(a+(f?l-g:g))%o],!m.skip&&(h?(n.moveTo(m.x,m.y),h=!1):u(n,x,m,f,r.stepped),x=m);return c&&(m=i[(a+(f?l:0))%o],u(n,x,m,f,r.stepped)),!!c}function oX(n,t,e,s){const i=t.points,{count:r,start:o,ilen:a}=lR(i,e,s),{move:c=!0,reverse:l}=s||{};let u=0,h=0,f,g,m,x,b,y;const v=I=>(o+(l?a-I:I))%r,k=()=>{x!==b&&(n.lineTo(u,b),n.lineTo(u,x),n.lineTo(u,y))};for(c&&(g=i[v(0)],n.moveTo(g.x,g.y)),f=0;f<=a;++f){if(g=i[v(f)],g.skip)continue;const I=g.x,_=g.y,$=I|0;$===m?(_<x?x=_:_>b&&(b=_),u=(h*u+I)/++h):(k(),n.lineTo(I,_),m=$,h=0,x=b=_),y=_}k()}function Ww(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?oX:rX}function aX(n){return n.stepped?rK:n.tension||n.cubicInterpolationMode==="monotone"?oK:rc}function cX(n,t,e,s){let i=t._path;i||(i=t._path=new Path2D,t.path(i,e,s)&&i.closePath()),cR(n,t.options),n.stroke(i)}function lX(n,t,e,s){const{segments:i,options:r}=t,o=Ww(t);for(const a of i)cR(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+s-1})&&n.closePath(),n.stroke()}const uX=typeof Path2D=="function";function hX(n,t,e,s){uX&&!t.options.segment?cX(n,t,e,s):lX(n,t,e,s)}class na extends or{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;Jq(this._points,s,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=dK(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,i=t[e],r=this.points,o=KN(this,{property:e,start:i,end:i});if(!o.length)return;const a=[],c=aX(s);let l,u;for(l=0,u=o.length;l<u;++l){const{start:h,end:f}=o[l],g=r[h],m=r[f];if(g===m){a.push(g);continue}const x=Math.abs((i-g[e])/(m[e]-g[e])),b=c(g,m,x,s.stepped);b[e]=t[e],a.push(b)}return a.length===1?a[0]:a}pathSegment(t,e,s){return Ww(this)(t,this,e,s)}path(t,e,s){const i=this.segments,r=Ww(this);let o=this._loop;e=e||0,s=s||this.points.length-e;for(const a of i)o&=r(t,this,a,{start:e,end:e+s-1});return!!o}draw(t,e,s,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),hX(t,this,s,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}_t(na,"id","line"),_t(na,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),_t(na,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),_t(na,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function zT(n,t,e,s){const i=n.options,{[e]:r}=n.getProps([e],s);return Math.abs(t-r)<i.radius+i.hitRadius}class Zg extends or{constructor(e){super();_t(this,"parsed");_t(this,"skip");_t(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.options,{x:o,y:a}=this.getProps(["x","y"],i);return Math.pow(e-o,2)+Math.pow(s-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,s){return zT(this,e,"x",s)}inYRange(e,s){return zT(this,e,"y",s)}getCenterPoint(e){const{x:s,y:i}=this.getProps(["x","y"],e);return{x:s,y:i}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const i=s&&e.borderWidth||0;return(s+i)*2}draw(e,s){const i=this.options;this.skip||i.radius<.1||!Co(this,s,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,Mw(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}_t(Zg,"id","point"),_t(Zg,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),_t(Zg,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function uR(n,t){const{x:e,y:s,base:i,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,c,l,u,h;return n.horizontal?(h=o/2,a=Math.min(e,i),c=Math.max(e,i),l=s-h,u=s+h):(h=r/2,a=e-h,c=e+h,l=Math.min(s,i),u=Math.max(s,i)),{left:a,top:l,right:c,bottom:u}}function sa(n,t,e,s){return n?0:Gn(t,e,s)}function dX(n,t,e){const s=n.options.borderWidth,i=n.borderSkipped,r=MN(s);return{t:sa(i.top,r.top,0,e),r:sa(i.right,r.right,0,t),b:sa(i.bottom,r.bottom,0,e),l:sa(i.left,r.left,0,t)}}function fX(n,t,e){const{enableBorderRadius:s}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,r=mc(i),o=Math.min(t,e),a=n.borderSkipped,c=s||we(i);return{topLeft:sa(!c||a.top||a.left,r.topLeft,0,o),topRight:sa(!c||a.top||a.right,r.topRight,0,o),bottomLeft:sa(!c||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:sa(!c||a.bottom||a.right,r.bottomRight,0,o)}}function pX(n){const t=uR(n),e=t.right-t.left,s=t.bottom-t.top,i=dX(n,e/2,s/2),r=fX(n,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:r},inner:{x:t.left+i.l,y:t.top+i.t,w:e-i.l-i.r,h:s-i.t-i.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,r.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(i.b,i.r))}}}}function Y0(n,t,e,s){const i=t===null,r=e===null,a=n&&!(i&&r)&&uR(n,s);return a&&(i||wo(t,a.left,a.right))&&(r||wo(e,a.top,a.bottom))}function gX(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function mX(n,t){n.rect(t.x,t.y,t.w,t.h)}function J0(n,t,e={}){const s=n.x!==e.x?-t:0,i=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-s,o=(n.y+n.h!==e.y+e.h?t:0)-i;return{x:n.x+s,y:n.y+i,w:n.w+r,h:n.h+o,radius:n.radius}}class Qg extends or{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:i}}=this,{inner:r,outer:o}=pX(this),a=gX(o.radius)?qh:mX;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,J0(o,e,r)),t.clip(),a(t,J0(r,-e,o)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),a(t,J0(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,s){return Y0(this,t,e,s)}inXRange(t,e){return Y0(this,t,null,e)}inYRange(t,e){return Y0(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?s:(s+i)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}_t(Qg,"id","bar"),_t(Qg,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),_t(Qg,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var bX=Object.freeze({__proto__:null,ArcElement:yh,BarElement:Qg,LineElement:na,PointElement:Zg});const Vw=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],WT=Vw.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function hR(n){return Vw[n%Vw.length]}function dR(n){return WT[n%WT.length]}function xX(n,t){return n.borderColor=hR(t),n.backgroundColor=dR(t),++t}function yX(n,t){return n.backgroundColor=n.data.map(()=>hR(t++)),t}function wX(n,t){return n.backgroundColor=n.data.map(()=>dR(t++)),t}function vX(n){let t=0;return(e,s)=>{const i=n.getDatasetMeta(s).controller;i instanceof dc?t=yX(e,t):i instanceof Ph?t=wX(e,t):i&&(t=xX(e,t))}}function VT(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function CX(n){return n&&(n.borderColor||n.backgroundColor)}function IX(){return cn.borderColor!=="rgba(0,0,0,0.1)"||cn.backgroundColor!=="rgba(0,0,0,0.1)"}var kX={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:s},options:i}=n.config,{elements:r}=i,o=VT(s)||CX(i)||r&&VT(r)||IX();if(!e.forceOverride&&o)return;const a=vX(n);s.forEach(a)}};function SX(n,t,e,s,i){const r=i.samples||s;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let c=0;const l=t+e-1;let u=t,h,f,g,m,x;for(o[c++]=n[u],h=0;h<r-2;h++){let b=0,y=0,v;const k=Math.floor((h+1)*a)+1+t,I=Math.min(Math.floor((h+2)*a)+1,e)+t,_=I-k;for(v=k;v<I;v++)b+=n[v].x,y+=n[v].y;b/=_,y/=_;const $=Math.floor(h*a)+1+t,R=Math.min(Math.floor((h+1)*a)+1,e)+t,{x:A,y:F}=n[u];for(g=m=-1,v=$;v<R;v++)m=.5*Math.abs((A-b)*(n[v].y-F)-(A-n[v].x)*(y-F)),m>g&&(g=m,f=n[v],x=v);o[c++]=f,u=x}return o[c++]=n[l],o}function _X(n,t,e,s){let i=0,r=0,o,a,c,l,u,h,f,g,m,x;const b=[],y=t+e-1,v=n[t].x,I=n[y].x-v;for(o=t;o<t+e;++o){a=n[o],c=(a.x-v)/I*s,l=a.y;const _=c|0;if(_===u)l<m?(m=l,h=o):l>x&&(x=l,f=o),i=(r*i+a.x)/++r;else{const $=o-1;if(!me(h)&&!me(f)){const R=Math.min(h,f),A=Math.max(h,f);R!==g&&R!==$&&b.push({...n[R],x:i}),A!==g&&A!==$&&b.push({...n[A],x:i})}o>0&&$!==g&&b.push(n[$]),b.push(a),u=_,r=0,m=x=l,h=f=g=o}}return b}function fR(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function UT(n){n.data.datasets.forEach(t=>{fR(t)})}function TX(n,t){const e=t.length;let s=0,i;const{iScale:r}=n,{min:o,max:a,minDefined:c,maxDefined:l}=r.getUserBounds();return c&&(s=Gn(vo(t,r.axis,o).lo,0,e-1)),l?i=Gn(vo(t,r.axis,a).hi+1,s,e)-s:i=e-s,{start:s,count:i}}var EX={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){UT(n);return}const s=n.width;n.data.datasets.forEach((i,r)=>{const{_data:o,indexAxis:a}=i,c=n.getDatasetMeta(r),l=o||i.data;if(bh([a,n.options.indexAxis])==="y"||!c.controller.supportsDecimation)return;const u=n.scales[c.xAxisID];if(u.type!=="linear"&&u.type!=="time"||n.options.parsing)return;let{start:h,count:f}=TX(c,l);const g=e.threshold||4*s;if(f<=g){fR(i);return}me(o)&&(i._data=l,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(x){this._data=x}}));let m;switch(e.algorithm){case"lttb":m=SX(l,h,f,s,e);break;case"min-max":m=_X(l,h,f,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}i._decimated=m})},destroy(n){UT(n)}};function $X(n,t,e){const s=n.segments,i=n.points,r=t.points,o=[];for(const a of s){let{start:c,end:l}=a;l=pb(c,l,i);const u=Uw(e,i[c],i[l],a.loop);if(!t.segments){o.push({source:a,target:u,start:i[c],end:i[l]});continue}const h=KN(t,u);for(const f of h){const g=Uw(e,r[f.start],r[f.end],f.loop),m=qN(a,i,g);for(const x of m)o.push({source:x,target:f,start:{[e]:HT(u,g,"start",Math.max)},end:{[e]:HT(u,g,"end",Math.min)}})}}return o}function Uw(n,t,e,s){if(s)return;let i=t[n],r=e[n];return n==="angle"&&(i=ps(i),r=ps(r)),{property:n,start:i,end:r}}function NX(n,t){const{x:e=null,y:s=null}=n||{},i=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=pb(o,a,i);const c=i[o],l=i[a];s!==null?(r.push({x:c.x,y:s}),r.push({x:l.x,y:s})):e!==null&&(r.push({x:e,y:c.y}),r.push({x:e,y:l.y}))}),r}function pb(n,t,e){for(;t>n;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function HT(n,t,e,s){return n&&t?s(n[e],t[e]):n?n[e]:t?t[e]:0}function pR(n,t){let e=[],s=!1;return nn(n)?(s=!0,e=n):e=NX(n,t),e.length?new na({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function GT(n){return n&&n.fill!==!1}function RX(n,t,e){let i=n[t].fill;const r=[t];let o;if(!e)return i;for(;i!==!1&&r.indexOf(i)===-1;){if(!pn(i))return i;if(o=n[i],!o)return!1;if(o.visible)return i;r.push(i),i=o.fill}return!1}function AX(n,t,e){const s=FX(n);if(we(s))return isNaN(s.value)?!1:s;let i=parseFloat(s);return pn(i)&&Math.floor(i)===i?DX(s[0],t,i,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function DX(n,t,e,s){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function OX(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:we(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function PX(n,t,e){let s;return n==="start"?s=e:n==="end"?s=t.options.reverse?t.min:t.max:we(n)?s=n.value:s=t.getBaseValue(),s}function FX(n){const t=n.options,e=t.fill;let s=te(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function MX(n){const{scale:t,index:e,line:s}=n,i=[],r=s.segments,o=s.points,a=LX(t,e);a.push(pR({x:null,y:t.bottom},s));for(let c=0;c<r.length;c++){const l=r[c];for(let u=l.start;u<=l.end;u++)BX(i,o[u],a)}return new na({points:i,options:{}})}function LX(n,t){const e=[],s=n.getMatchingVisibleMetas("line");for(let i=0;i<s.length;i++){const r=s[i];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function BX(n,t,e){const s=[];for(let i=0;i<e.length;i++){const r=e[i],{first:o,last:a,point:c}=zX(r,t,"x");if(!(!c||o&&a)){if(o)s.unshift(c);else if(n.push(c),!a)break}}n.push(...s)}function zX(n,t,e){const s=n.interpolate(t,e);if(!s)return{};const i=s[e],r=n.segments,o=n.points;let a=!1,c=!1;for(let l=0;l<r.length;l++){const u=r[l],h=o[u.start][e],f=o[u.end][e];if(wo(i,h,f)){a=i===h,c=i===f;break}}return{first:a,last:c,point:s}}class gR{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:i,y:r,radius:o}=this;return e=e||{start:0,end:sn},t.arc(i,r,o,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:i}=this,r=t.angle;return{x:e+Math.cos(r)*i,y:s+Math.sin(r)*i,angle:r}}}function WX(n){const{chart:t,fill:e,line:s}=n;if(pn(e))return VX(t,e);if(e==="stack")return MX(n);if(e==="shape")return!0;const i=UX(n);return i instanceof gR?i:pR(i,s)}function VX(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function UX(n){return(n.scale||{}).getPointPositionForValue?GX(n):HX(n)}function HX(n){const{scale:t={},fill:e}=n,s=OX(e,t);if(pn(s)){const i=t.isHorizontal();return{x:i?s:null,y:i?null:s}}return null}function GX(n){const{scale:t,fill:e}=n,s=t.options,i=t.getLabels().length,r=s.reverse?t.max:t.min,o=PX(e,t,r),a=[];if(s.grid.circular){const c=t.getPointPositionForValue(0,r);return new gR({x:c.x,y:c.y,radius:t.getDistanceFromCenterForValue(o)})}for(let c=0;c<i;++c)a.push(t.getPointPositionForValue(c,o));return a}function Z0(n,t,e){const s=WX(t),{chart:i,index:r,line:o,scale:a,axis:c}=t,l=o.options,u=l.fill,h=l.backgroundColor,{above:f=h,below:g=h}=u||{},m=i.getDatasetMeta(r),x=XN(i,m);s&&o.points.length&&(hb(n,e),jX(n,{line:o,target:s,above:f,below:g,area:e,scale:a,axis:c,clip:x}),db(n))}function jX(n,t){const{line:e,target:s,above:i,below:r,area:o,scale:a,clip:c}=t,l=e._loop?"angle":t.axis;n.save();let u=r;r!==i&&(l==="x"?(jT(n,s,o.top),Q0(n,{line:e,target:s,color:i,scale:a,property:l,clip:c}),n.restore(),n.save(),jT(n,s,o.bottom)):l==="y"&&(qT(n,s,o.left),Q0(n,{line:e,target:s,color:r,scale:a,property:l,clip:c}),n.restore(),n.save(),qT(n,s,o.right),u=i)),Q0(n,{line:e,target:s,color:u,scale:a,property:l,clip:c}),n.restore()}function jT(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:c,end:l}=a,u=i[c],h=i[pb(c,l,i)];r?(n.moveTo(u.x,u.y),r=!1):(n.lineTo(u.x,e),n.lineTo(u.x,u.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(h.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function qT(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:c,end:l}=a,u=i[c],h=i[pb(c,l,i)];r?(n.moveTo(u.x,u.y),r=!1):(n.lineTo(e,u.y),n.lineTo(u.x,u.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,h.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function Q0(n,t){const{line:e,target:s,property:i,color:r,scale:o,clip:a}=t,c=$X(e,s,i);for(const{source:l,target:u,start:h,end:f}of c){const{style:{backgroundColor:g=r}={}}=l,m=s!==!0;n.save(),n.fillStyle=g,qX(n,o,a,m&&Uw(i,h,f)),n.beginPath();const x=!!e.pathSegment(n,l);let b;if(m){x?n.closePath():KT(n,s,f,i);const y=!!s.pathSegment(n,u,{move:x,reverse:!0});b=x&&y,b||KT(n,s,h,i)}n.closePath(),n.fill(b?"evenodd":"nonzero"),n.restore()}}function qX(n,t,e,s){const i=t.chart.chartArea,{property:r,start:o,end:a}=s||{};if(r==="x"||r==="y"){let c,l,u,h;r==="x"?(c=o,l=i.top,u=a,h=i.bottom):(c=i.left,l=o,u=i.right,h=a),n.beginPath(),e&&(c=Math.max(c,e.left),u=Math.min(u,e.right),l=Math.max(l,e.top),h=Math.min(h,e.bottom)),n.rect(c,l,u-c,h-l),n.clip()}}function KT(n,t,e,s){const i=t.interpolate(e,s);i&&n.lineTo(i.x,i.y)}var KX={id:"filler",afterDatasetsUpdate(n,t,e){const s=(n.data.datasets||[]).length,i=[];let r,o,a,c;for(o=0;o<s;++o)r=n.getDatasetMeta(o),a=r.dataset,c=null,a&&a.options&&a instanceof na&&(c={visible:n.isDatasetVisible(o),index:o,fill:AX(a,o,s),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=c,i.push(c);for(o=0;o<s;++o)c=i[o],!(!c||c.fill===!1)&&(c.fill=RX(i,o,e.propagate))},beforeDraw(n,t,e){const s=e.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=i.length-1;o>=0;--o){const a=i[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),s&&a.fill&&Z0(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=n.getSortedVisibleDatasetMetas();for(let i=s.length-1;i>=0;--i){const r=s[i].$filler;GT(r)&&Z0(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const s=t.meta.$filler;!GT(s)||e.drawTime!=="beforeDatasetDraw"||Z0(n.ctx,s,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const XT=(n,t)=>{let{boxHeight:e=t,boxWidth:s=t}=n;return n.usePointStyle&&(e=Math.min(e,t),s=n.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},XX=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class YT extends or{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=Ze(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,i)=>t.sort(s,i,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,i=zn(s.font),r=i.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:c}=XT(s,r);let l,u;e.font=i.string,this.isHorizontal()?(l=this.maxWidth,u=this._fitRows(o,r,a,c)+10):(u=this.maxHeight,l=this._fitCols(o,i,a,c)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(u,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,i){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],l=this.lineWidths=[0],u=i+a;let h=t;r.textAlign="left",r.textBaseline="middle";let f=-1,g=-u;return this.legendItems.forEach((m,x)=>{const b=s+e/2+r.measureText(m.text).width;(x===0||l[l.length-1]+b+2*a>o)&&(h+=u,l[l.length-(x>0?0:1)]=0,g+=u,f++),c[x]={left:0,top:g,row:f,width:b,height:i},l[l.length-1]+=b+a}),h}_fitCols(t,e,s,i){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],l=this.columnSizes=[],u=o-t;let h=a,f=0,g=0,m=0,x=0;return this.legendItems.forEach((b,y)=>{const{itemWidth:v,itemHeight:k}=YX(s,e,r,b,i);y>0&&g+k+2*a>u&&(h+=f+a,l.push({width:f,height:g}),m+=f+a,x++,f=g=0),c[y]={left:m,top:g,col:x,width:v,height:k},f=Math.max(f,v),g+=k+a}),h+=f,l.push({width:f,height:g}),h}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:i},rtl:r}}=this,o=Rl(r,this.left,this.width);if(this.isHorizontal()){let a=0,c=hs(s,this.left+i,this.right-this.lineWidths[a]);for(const l of e)a!==l.row&&(a=l.row,c=hs(s,this.left+i,this.right-this.lineWidths[a])),l.top+=this.top+t+i,l.left=o.leftForLtr(o.x(c),l.width),c+=l.width+i}else{let a=0,c=hs(s,this.top+t+i,this.bottom-this.columnSizes[a].height);for(const l of e)l.col!==a&&(a=l.col,c=hs(s,this.top+t+i,this.bottom-this.columnSizes[a].height)),l.top=c,l.left+=this.left+i,l.left=o.leftForLtr(o.x(l.left),l.width),c+=l.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;hb(t,this),this._draw(),db(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:i}=this,{align:r,labels:o}=t,a=cn.color,c=Rl(t.rtl,this.left,this.width),l=zn(o.font),{padding:u}=o,h=l.size,f=h/2;let g;this.drawTitle(),i.textAlign=c.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:m,boxHeight:x,itemHeight:b}=XT(o,h),y=function($,R,A){if(isNaN(m)||m<=0||isNaN(x)||x<0)return;i.save();const F=te(A.lineWidth,1);if(i.fillStyle=te(A.fillStyle,a),i.lineCap=te(A.lineCap,"butt"),i.lineDashOffset=te(A.lineDashOffset,0),i.lineJoin=te(A.lineJoin,"miter"),i.lineWidth=F,i.strokeStyle=te(A.strokeStyle,a),i.setLineDash(te(A.lineDash,[])),o.usePointStyle){const L={radius:x*Math.SQRT2/2,pointStyle:A.pointStyle,rotation:A.rotation,borderWidth:F},V=c.xPlus($,m/2),j=R+f;FN(i,L,V,j,o.pointStyleWidth&&m)}else{const L=R+Math.max((h-x)/2,0),V=c.leftForLtr($,m),j=mc(A.borderRadius);i.beginPath(),Object.values(j).some(Z=>Z!==0)?qh(i,{x:V,y:L,w:m,h:x,radius:j}):i.rect(V,L,m,x),i.fill(),F!==0&&i.stroke()}i.restore()},v=function($,R,A){Sc(i,A.text,$,R+b/2,l,{strikethrough:A.hidden,textAlign:c.textAlign(A.textAlign)})},k=this.isHorizontal(),I=this._computeTitleHeight();k?g={x:hs(r,this.left+u,this.right-s[0]),y:this.top+u+I,line:0}:g={x:this.left+u,y:hs(r,this.top+I+u,this.bottom-e[0].height),line:0},HN(this.ctx,t.textDirection);const _=b+u;this.legendItems.forEach(($,R)=>{i.strokeStyle=$.fontColor,i.fillStyle=$.fontColor;const A=i.measureText($.text).width,F=c.textAlign($.textAlign||($.textAlign=o.textAlign)),L=m+f+A;let V=g.x,j=g.y;c.setWidth(this.width),k?R>0&&V+L+u>this.right&&(j=g.y+=_,g.line++,V=g.x=hs(r,this.left+u,this.right-s[g.line])):R>0&&j+_>this.bottom&&(V=g.x=V+e[g.line].width+u,g.line++,j=g.y=hs(r,this.top+I+u,this.bottom-e[g.line].height));const Z=c.x(V);if(y(Z,j,$),V=gq(F,V+m+f,k?V+L:this.right,t.rtl),v(c.x(V),j,$),k)g.x+=L+u;else if(typeof $.text!="string"){const et=l.lineHeight;g.y+=mR($,et)+u}else g.y+=_}),GN(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=zn(e.font),i=ws(e.padding);if(!e.display)return;const r=Rl(t.rtl,this.left,this.width),o=this.ctx,a=e.position,c=s.size/2,l=i.top+c;let u,h=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),u=this.top+l,h=hs(t.align,h,this.right-f);else{const m=this.columnSizes.reduce((x,b)=>Math.max(x,b.height),0);u=l+hs(t.align,this.top,this.bottom-m-t.labels.padding-this._computeTitleHeight())}const g=hs(a,h,h+f);o.textAlign=r.textAlign(c1(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=s.string,Sc(o,e.text,g,u,s)}_computeTitleHeight(){const t=this.options.title,e=zn(t.font),s=ws(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,i,r;if(wo(t,this.left,this.right)&&wo(e,this.top,this.bottom)){for(r=this.legendHitBoxes,s=0;s<r.length;++s)if(i=r[s],wo(t,i.left,i.left+i.width)&&wo(e,i.top,i.top+i.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!QX(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const i=this._hoveredItem,r=XX(i,s);i&&!r&&Ze(e.onLeave,[t,i,this],this),this._hoveredItem=s,s&&!r&&Ze(e.onHover,[t,s,this],this)}else s&&Ze(e.onClick,[t,s,this],this)}}function YX(n,t,e,s,i){const r=JX(s,n,t,e),o=ZX(i,s,t.lineHeight);return{itemWidth:r,itemHeight:o}}function JX(n,t,e,s){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+s.measureText(i).width}function ZX(n,t,e){let s=n;return typeof t.text!="string"&&(s=mR(t,e)),s}function mR(n,t){const e=n.text?n.text.length:0;return t*e}function QX(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var t7={id:"legend",_element:YT,start(n,t,e){const s=n.legend=new YT({ctx:n.ctx,options:e,chart:n});xs.configure(n,s,e),xs.addBox(n,s)},stop(n){xs.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const s=n.legend;xs.configure(n,s,e),s.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const s=t.datasetIndex,i=e.chart;i.isDatasetVisible(s)?(i.hide(s),t.hidden=!0):(i.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(c=>{const l=c.controller.getStyle(e?0:void 0),u=ws(l.borderWidth);return{text:t[c.index].label,fillStyle:l.backgroundColor,fontColor:r,hidden:!c.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:l.borderColor,pointStyle:s||l.pointStyle,rotation:l.rotation,textAlign:i||l.textAlign,borderRadius:o&&(a||l.borderRadius),datasetIndex:c.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class b1 extends or{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const i=nn(s.text)?s.text.length:1;this._padding=ws(s.padding);const r=i*zn(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:i,right:r,options:o}=this,a=o.align;let c=0,l,u,h;return this.isHorizontal()?(u=hs(a,s,r),h=e+t,l=r-s):(o.position==="left"?(u=s+t,h=hs(a,i,e),c=Re*-.5):(u=r-t,h=hs(a,e,i),c=Re*.5),l=i-e),{titleX:u,titleY:h,maxWidth:l,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=zn(e.font),r=s.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:c,rotation:l}=this._drawArgs(r);Sc(t,e.text,0,0,s,{color:e.color,maxWidth:c,rotation:l,textAlign:c1(e.align),textBaseline:"middle",translation:[o,a]})}}function e7(n,t){const e=new b1({ctx:n.ctx,options:t,chart:n});xs.configure(n,e,t),xs.addBox(n,e),n.titleBlock=e}var n7={id:"title",_element:b1,start(n,t,e){e7(n,e)},stop(n){const t=n.titleBlock;xs.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const s=n.titleBlock;xs.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const vg=new WeakMap;var s7={id:"subtitle",start(n,t,e){const s=new b1({ctx:n.ctx,options:e,chart:n});xs.configure(n,s,e),xs.addBox(n,s),vg.set(n,s)},stop(n){xs.removeBox(n,vg.get(n)),vg.delete(n)},beforeUpdate(n,t,e){const s=vg.get(n);xs.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const wh={average(n){if(!n.length)return!1;let t,e,s=new Set,i=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const c=a.tooltipPosition();s.add(c.x),i+=c.y,++r}}return r===0||s.size===0?!1:{x:[...s].reduce((a,c)=>a+c)/s.size,y:i/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,s=t.y,i=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const c=n[r].element;if(c&&c.hasValue()){const l=c.getCenterPoint(),u=Pw(t,l);u<i&&(i=u,a=c)}}if(a){const c=a.tooltipPosition();e=c.x,s=c.y}return{x:e,y:s}}};function wr(n,t){return t&&(nn(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function co(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function i7(n,t){const{element:e,datasetIndex:s,index:i}=t,r=n.getDatasetMeta(s).controller,{label:o,value:a}=r.getLabelAndValue(i);return{chart:n,label:o,parsed:r.getParsed(i),raw:n.data.datasets[s].data[i],formattedValue:a,dataset:r.getDataset(),dataIndex:i,datasetIndex:s,element:e}}function JT(n,t){const e=n.chart.ctx,{body:s,footer:i,title:r}=n,{boxWidth:o,boxHeight:a}=t,c=zn(t.bodyFont),l=zn(t.titleFont),u=zn(t.footerFont),h=r.length,f=i.length,g=s.length,m=ws(t.padding);let x=m.height,b=0,y=s.reduce((I,_)=>I+_.before.length+_.lines.length+_.after.length,0);if(y+=n.beforeBody.length+n.afterBody.length,h&&(x+=h*l.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),y){const I=t.displayColors?Math.max(a,c.lineHeight):c.lineHeight;x+=g*I+(y-g)*c.lineHeight+(y-1)*t.bodySpacing}f&&(x+=t.footerMarginTop+f*u.lineHeight+(f-1)*t.footerSpacing);let v=0;const k=function(I){b=Math.max(b,e.measureText(I).width+v)};return e.save(),e.font=l.string,ze(n.title,k),e.font=c.string,ze(n.beforeBody.concat(n.afterBody),k),v=t.displayColors?o+2+t.boxPadding:0,ze(s,I=>{ze(I.before,k),ze(I.lines,k),ze(I.after,k)}),v=0,e.font=u.string,ze(n.footer,k),e.restore(),b+=m.width,{width:b,height:x}}function r7(n,t){const{y:e,height:s}=t;return e<s/2?"top":e>n.height-s/2?"bottom":"center"}function o7(n,t,e,s){const{x:i,width:r}=s,o=e.caretSize+e.caretPadding;if(n==="left"&&i+r+o>t.width||n==="right"&&i-r-o<0)return!0}function a7(n,t,e,s){const{x:i,width:r}=e,{width:o,chartArea:{left:a,right:c}}=n;let l="center";return s==="center"?l=i<=(a+c)/2?"left":"right":i<=r/2?l="left":i>=o-r/2&&(l="right"),o7(l,n,t,e)&&(l="center"),l}function ZT(n,t,e){const s=e.yAlign||t.yAlign||r7(n,e);return{xAlign:e.xAlign||t.xAlign||a7(n,t,e,s),yAlign:s}}function c7(n,t){let{x:e,width:s}=n;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function l7(n,t,e){let{y:s,height:i}=n;return t==="top"?s+=e:t==="bottom"?s-=i+e:s-=i/2,s}function QT(n,t,e,s){const{caretSize:i,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:c}=e,l=i+r,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=mc(o);let m=c7(t,a);const x=l7(t,c,l);return c==="center"?a==="left"?m+=l:a==="right"&&(m-=l):a==="left"?m-=Math.max(u,f)+i:a==="right"&&(m+=Math.max(h,g)+i),{x:Gn(m,0,s.width-t.width),y:Gn(x,0,s.height-t.height)}}function Cg(n,t,e){const s=ws(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-s.right:n.x+s.left}function tE(n){return wr([],co(n))}function u7(n,t,e){return Ia(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function eE(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const bR={beforeTitle:oo,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:oo,beforeBody:oo,beforeLabel:oo,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return me(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:oo,afterBody:oo,beforeFooter:oo,footer:oo,afterFooter:oo};function Ws(n,t,e,s){const i=n[t].call(e,s);return typeof i>"u"?bR[t].call(e,s):i}class Hw extends or{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&e.options.animation&&s.animations,r=new YN(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=u7(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,i=Ws(s,"beforeTitle",this,t),r=Ws(s,"title",this,t),o=Ws(s,"afterTitle",this,t);let a=[];return a=wr(a,co(i)),a=wr(a,co(r)),a=wr(a,co(o)),a}getBeforeBody(t,e){return tE(Ws(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,i=[];return ze(t,r=>{const o={before:[],lines:[],after:[]},a=eE(s,r);wr(o.before,co(Ws(a,"beforeLabel",this,r))),wr(o.lines,Ws(a,"label",this,r)),wr(o.after,co(Ws(a,"afterLabel",this,r))),i.push(o)}),i}getAfterBody(t,e){return tE(Ws(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,i=Ws(s,"beforeFooter",this,t),r=Ws(s,"footer",this,t),o=Ws(s,"afterFooter",this,t);let a=[];return a=wr(a,co(i)),a=wr(a,co(r)),a=wr(a,co(o)),a}_createItems(t){const e=this._active,s=this.chart.data,i=[],r=[],o=[];let a=[],c,l;for(c=0,l=e.length;c<l;++c)a.push(i7(this.chart,e[c]));return t.filter&&(a=a.filter((u,h,f)=>t.filter(u,h,f,s))),t.itemSort&&(a=a.sort((u,h)=>t.itemSort(u,h,s))),ze(a,u=>{const h=eE(t.callbacks,u);i.push(Ws(h,"labelColor",this,u)),r.push(Ws(h,"labelPointStyle",this,u)),o.push(Ws(h,"labelTextColor",this,u))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const s=this.options.setContext(this.getContext()),i=this._active;let r,o=[];if(!i.length)this.opacity!==0&&(r={opacity:0});else{const a=wh[s.position].call(this,i,this._eventPosition);o=this._createItems(s),this.title=this.getTitle(o,s),this.beforeBody=this.getBeforeBody(o,s),this.body=this.getBody(o,s),this.afterBody=this.getAfterBody(o,s),this.footer=this.getFooter(o,s);const c=this._size=JT(this,s),l=Object.assign({},a,c),u=ZT(this.chart,s,l),h=QT(s,l,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,r={opacity:1,x:h.x,y:h.y,width:c.width,height:c.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,i){const r=this.getCaretPosition(t,s,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,s){const{xAlign:i,yAlign:r}=this,{caretSize:o,cornerRadius:a}=s,{topLeft:c,topRight:l,bottomLeft:u,bottomRight:h}=mc(a),{x:f,y:g}=t,{width:m,height:x}=e;let b,y,v,k,I,_;return r==="center"?(I=g+x/2,i==="left"?(b=f,y=b-o,k=I+o,_=I-o):(b=f+m,y=b+o,k=I-o,_=I+o),v=b):(i==="left"?y=f+Math.max(c,u)+o:i==="right"?y=f+m-Math.max(l,h)-o:y=this.caretX,r==="top"?(k=g,I=k-o,b=y-o,v=y+o):(k=g+x,I=k+o,b=y+o,v=y-o),_=k),{x1:b,x2:y,x3:v,y1:k,y2:I,y3:_}}drawTitle(t,e,s){const i=this.title,r=i.length;let o,a,c;if(r){const l=Rl(s.rtl,this.x,this.width);for(t.x=Cg(this,s.titleAlign,s),e.textAlign=l.textAlign(s.titleAlign),e.textBaseline="middle",o=zn(s.titleFont),a=s.titleSpacing,e.fillStyle=s.titleColor,e.font=o.string,c=0;c<r;++c)e.fillText(i[c],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,c+1===r&&(t.y+=s.titleMarginBottom-a)}}_drawColorBox(t,e,s,i,r){const o=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:c,boxWidth:l}=r,u=zn(r.bodyFont),h=Cg(this,"left",r),f=i.x(h),g=c<u.lineHeight?(u.lineHeight-c)/2:0,m=e.y+g;if(r.usePointStyle){const x={radius:Math.min(l,c)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},b=i.leftForLtr(f,l)+l/2,y=m+c/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Mw(t,x,b,y),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Mw(t,x,b,y)}else{t.lineWidth=we(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const x=i.leftForLtr(f,l),b=i.leftForLtr(i.xPlus(f,1),l-2),y=mc(o.borderRadius);Object.values(y).some(v=>v!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,qh(t,{x,y:m,w:l,h:c,radius:y}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),qh(t,{x:b,y:m+1,w:l-2,h:c-2,radius:y}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(x,m,l,c),t.strokeRect(x,m,l,c),t.fillStyle=o.backgroundColor,t.fillRect(b,m+1,l-2,c-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:i}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:c,boxWidth:l,boxPadding:u}=s,h=zn(s.bodyFont);let f=h.lineHeight,g=0;const m=Rl(s.rtl,this.x,this.width),x=function(A){e.fillText(A,m.x(t.x+g),t.y+f/2),t.y+=f+r},b=m.textAlign(o);let y,v,k,I,_,$,R;for(e.textAlign=o,e.textBaseline="middle",e.font=h.string,t.x=Cg(this,b,s),e.fillStyle=s.bodyColor,ze(this.beforeBody,x),g=a&&b!=="right"?o==="center"?l/2+u:l+2+u:0,I=0,$=i.length;I<$;++I){for(y=i[I],v=this.labelTextColors[I],e.fillStyle=v,ze(y.before,x),k=y.lines,a&&k.length&&(this._drawColorBox(e,t,I,m,s),f=Math.max(h.lineHeight,c)),_=0,R=k.length;_<R;++_)x(k[_]),f=h.lineHeight;ze(y.after,x)}g=0,f=h.lineHeight,ze(this.afterBody,x),t.y-=r}drawFooter(t,e,s){const i=this.footer,r=i.length;let o,a;if(r){const c=Rl(s.rtl,this.x,this.width);for(t.x=Cg(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=c.textAlign(s.footerAlign),e.textBaseline="middle",o=zn(s.footerFont),e.fillStyle=s.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(i[a],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+s.footerSpacing}}drawBackground(t,e,s,i){const{xAlign:r,yAlign:o}=this,{x:a,y:c}=t,{width:l,height:u}=s,{topLeft:h,topRight:f,bottomLeft:g,bottomRight:m}=mc(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(a+h,c),o==="top"&&this.drawCaret(t,e,s,i),e.lineTo(a+l-f,c),e.quadraticCurveTo(a+l,c,a+l,c+f),o==="center"&&r==="right"&&this.drawCaret(t,e,s,i),e.lineTo(a+l,c+u-m),e.quadraticCurveTo(a+l,c+u,a+l-m,c+u),o==="bottom"&&this.drawCaret(t,e,s,i),e.lineTo(a+g,c+u),e.quadraticCurveTo(a,c+u,a,c+u-g),o==="center"&&r==="left"&&this.drawCaret(t,e,s,i),e.lineTo(a,c+h),e.quadraticCurveTo(a,c,a+h,c),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,i=s&&s.x,r=s&&s.y;if(i||r){const o=wh[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=JT(this,t),c=Object.assign({},o,this._size),l=ZT(e,t,c),u=QT(t,c,l,e);(i._to!==u.x||r._to!==u.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const o=ws(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=s,this.drawBackground(r,t,i,e),HN(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),GN(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,i=t.map(({datasetIndex:a,index:c})=>{const l=this.chart.getDatasetMeta(a);if(!l)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:l.data[c],index:c}}),r=!mm(s,i),o=this._positionChanged(i,e);(r||o)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,s),a=this._positionChanged(o,t),c=e||!mm(o,r)||a;return c&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),c}_getActiveElements(t,e,s,i){const r=this.options;if(t.type==="mouseout")return[];if(!i)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,s);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:s,caretY:i,options:r}=this,o=wh[r.position].call(this,t,e);return o!==!1&&(s!==o.x||i!==o.y)}}_t(Hw,"positioners",wh);var h7={id:"tooltip",_element:Hw,positioners:wh,afterInit(n,t,e){e&&(n.tooltip=new Hw({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:bR},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},d7=Object.freeze({__proto__:null,Colors:kX,Decimation:EX,Filler:KX,Legend:t7,SubTitle:s7,Title:n7,Tooltip:h7});const f7=(n,t,e,s)=>(typeof t=="string"?(e=n.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function p7(n,t,e,s){const i=n.indexOf(t);if(i===-1)return f7(n,t,e,s);const r=n.lastIndexOf(t);return i!==r?e:i}const g7=(n,t)=>n===null?null:Gn(Math.round(n),0,t);function nE(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class Gw extends zc{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:i,label:r}of e)s[i]===r&&s.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(me(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:p7(s,t,te(e,t),this._addedLabels),g7(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,i=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=t;o<=e;o++)i.push({value:o});return i}getLabelForValue(t){return nE.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}_t(Gw,"id","category"),_t(Gw,"defaults",{ticks:{callback:nE}});function m7(n,t){const e=[],{bounds:i,step:r,min:o,max:a,precision:c,count:l,maxTicks:u,maxDigits:h,includeBounds:f}=n,g=r||1,m=u-1,{min:x,max:b}=t,y=!me(o),v=!me(a),k=!me(l),I=(b-x)/(h+1);let _=J_((b-x)/m/g)*g,$,R,A,F;if(_<1e-14&&!y&&!v)return[{value:x},{value:b}];F=Math.ceil(b/_)-Math.floor(x/_),F>m&&(_=J_(F*_/m/g)*g),me(c)||($=Math.pow(10,c),_=Math.ceil(_*$)/$),i==="ticks"?(R=Math.floor(x/_)*_,A=Math.ceil(b/_)*_):(R=x,A=b),y&&v&&r&&cq((a-o)/r,_/1e3)?(F=Math.round(Math.min((a-o)/_,u)),_=(a-o)/F,R=o,A=a):k?(R=y?o:R,A=v?a:A,F=l-1,_=(A-R)/F):(F=(A-R)/_,Ah(F,Math.round(F),_/1e3)?F=Math.round(F):F=Math.ceil(F));const L=Math.max(Z_(_),Z_(R));$=Math.pow(10,me(c)?L:c),R=Math.round(R*$)/$,A=Math.round(A*$)/$;let V=0;for(y&&(f&&R!==o?(e.push({value:o}),R<o&&V++,Ah(Math.round((R+V*_)*$)/$,o,sE(o,I,n))&&V++):R<o&&V++);V<F;++V){const j=Math.round((R+V*_)*$)/$;if(v&&j>a)break;e.push({value:j})}return v&&f&&A!==a?e.length&&Ah(e[e.length-1].value,a,sE(a,I,n))?e[e.length-1].value=a:e.push({value:a}):(!v||A===a)&&e.push({value:A}),e}function sE(n,t,{horizontal:e,minRotation:s}){const i=Zi(s),r=(e?Math.sin(i):Math.cos(i))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class Im extends zc{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return me(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:i,max:r}=this;const o=c=>i=e?i:c,a=c=>r=s?r:c;if(t){const c=$r(i),l=$r(r);c<0&&l<0?a(0):c>0&&l>0&&o(0)}if(i===r){let c=r===0?1:Math.abs(r*.05);a(r+c),t||o(i-c)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,i;return s?(i=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),e=e||11),e&&(i=Math.min(e,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=m7(i,r);return t.bounds==="ticks"&&TN(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const i=(s-e)/Math.max(t.length-1,1)/2;e-=i,s+=i}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return wd(t,this.chart.options.locale,this.options.ticks.format)}}class jw extends Im{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=pn(t)?t:0,this.max=pn(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=Zi(this.options.ticks.minRotation),i=(t?Math.sin(s):Math.cos(s))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}_t(jw,"id","linear"),_t(jw,"defaults",{ticks:{callback:ub.formatters.numeric}});const Xh=n=>Math.floor(ea(n)),tc=(n,t)=>Math.pow(10,Xh(n)+t);function iE(n){return n/Math.pow(10,Xh(n))===1}function rE(n,t,e){const s=Math.pow(10,e),i=Math.floor(n/s);return Math.ceil(t/s)-i}function b7(n,t){const e=t-n;let s=Xh(e);for(;rE(n,t,s)>10;)s++;for(;rE(n,t,s)<10;)s--;return Math.min(s,Xh(n))}function x7(n,{min:t,max:e}){t=oi(n.min,t);const s=[],i=Xh(t);let r=b7(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),c=i>r?Math.pow(10,i):0,l=Math.round((t-c)*o)/o,u=Math.floor((t-c)/a/10)*a*10;let h=Math.floor((l-u)/Math.pow(10,r)),f=oi(n.min,Math.round((c+u+h*Math.pow(10,r))*o)/o);for(;f<e;)s.push({value:f,major:iE(f),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(r++,h=2,o=r>=0?1:o),f=Math.round((c+u+h*Math.pow(10,r))*o)/o;const g=oi(n.max,f);return s.push({value:g,major:iE(g),significand:h}),s}class qw extends zc{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=Im.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return pn(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=pn(t)?Math.max(0,t):null,this.max=pn(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!pn(this._userMin)&&(this.min=t===tc(this.min,0)?tc(this.min,-1):tc(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,i=this.max;const r=a=>s=t?s:a,o=a=>i=e?i:a;s===i&&(s<=0?(r(1),o(10)):(r(tc(s,-1)),o(tc(i,1)))),s<=0&&r(tc(i,-1)),i<=0&&o(tc(s,1)),this.min=s,this.max=i}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=x7(e,this);return t.bounds==="ticks"&&TN(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":wd(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=ea(t),this._valueRange=ea(this.max)-ea(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(ea(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}_t(qw,"id","logarithmic"),_t(qw,"defaults",{ticks:{callback:ub.formatters.logarithmic,major:{enabled:!0}}});function Kw(n){const t=n.ticks;if(t.display&&n.display){const e=ws(t.backdropPadding);return te(t.font&&t.font.size,cn.font.size)+e.height}return 0}function y7(n,t,e){return e=nn(e)?e:[e],{w:Sq(n,t.string,e),h:e.length*t.lineHeight}}function oE(n,t,e,s,i){return n===s||n===i?{start:t-e/2,end:t+e/2}:n<s||n>i?{start:t-e,end:t}:{start:t,end:t+e}}function w7(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),s=[],i=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?Re/r:0;for(let c=0;c<r;c++){const l=o.setContext(n.getPointLabelContext(c));i[c]=l.padding;const u=n.getPointPosition(c,n.drawingArea+i[c],a),h=zn(l.font),f=y7(n.ctx,h,n._pointLabels[c]);s[c]=f;const g=ps(n.getIndexAngle(c)+a),m=Math.round(o1(g)),x=oE(m,u.x,f.w,0,180),b=oE(m,u.y,f.h,90,270);v7(e,t,g,x,b)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=k7(n,s,i)}function v7(n,t,e,s,i){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,c=0;s.start<t.l?(a=(t.l-s.start)/r,n.l=Math.min(n.l,t.l-a)):s.end>t.r&&(a=(s.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),i.start<t.t?(c=(t.t-i.start)/o,n.t=Math.min(n.t,t.t-c)):i.end>t.b&&(c=(i.end-t.b)/o,n.b=Math.max(n.b,t.b+c))}function C7(n,t,e){const s=n.drawingArea,{extra:i,additionalAngle:r,padding:o,size:a}=e,c=n.getPointPosition(t,s+i+o,r),l=Math.round(o1(ps(c.angle+Sn))),u=T7(c.y,a.h,l),h=S7(l),f=_7(c.x,a.w,h);return{visible:!0,x:c.x,y:u,textAlign:h,left:f,top:u,right:f+a.w,bottom:u+a.h}}function I7(n,t){if(!t)return!0;const{left:e,top:s,right:i,bottom:r}=n;return!(Co({x:e,y:s},t)||Co({x:e,y:r},t)||Co({x:i,y:s},t)||Co({x:i,y:r},t))}function k7(n,t,e){const s=[],i=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,c={extra:Kw(r)/2,additionalAngle:o?Re/i:0};let l;for(let u=0;u<i;u++){c.padding=e[u],c.size=t[u];const h=C7(n,u,c);s.push(h),a==="auto"&&(h.visible=I7(h,l),h.visible&&(l=h))}return s}function S7(n){return n===0||n===180?"center":n<180?"left":"right"}function _7(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function T7(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function E7(n,t,e){const{left:s,top:i,right:r,bottom:o}=e,{backdropColor:a}=t;if(!me(a)){const c=mc(t.borderRadius),l=ws(t.backdropPadding);n.fillStyle=a;const u=s-l.left,h=i-l.top,f=r-s+l.width,g=o-i+l.height;Object.values(c).some(m=>m!==0)?(n.beginPath(),qh(n,{x:u,y:h,w:f,h:g,radius:c}),n.fill()):n.fillRect(u,h,f,g)}}function $7(n,t){const{ctx:e,options:{pointLabels:s}}=n;for(let i=t-1;i>=0;i--){const r=n._pointLabelItems[i];if(!r.visible)continue;const o=s.setContext(n.getPointLabelContext(i));E7(e,o,r);const a=zn(o.font),{x:c,y:l,textAlign:u}=r;Sc(e,n._pointLabels[i],c,l+a.lineHeight/2,a,{color:o.color,textAlign:u,textBaseline:"middle"})}}function xR(n,t,e,s){const{ctx:i}=n;if(e)i.arc(n.xCenter,n.yCenter,t,0,sn);else{let r=n.getPointPosition(0,t);i.moveTo(r.x,r.y);for(let o=1;o<s;o++)r=n.getPointPosition(o,t),i.lineTo(r.x,r.y)}}function N7(n,t,e,s,i){const r=n.ctx,o=t.circular,{color:a,lineWidth:c}=t;!o&&!s||!a||!c||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=c,r.setLineDash(i.dash||[]),r.lineDashOffset=i.dashOffset,r.beginPath(),xR(n,e,o,s),r.closePath(),r.stroke(),r.restore())}function R7(n,t,e){return Ia(n,{label:e,index:t,type:"pointLabel"})}class vh extends Im{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=ws(Kw(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=pn(t)&&!isNaN(t)?t:0,this.max=pn(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Kw(this.options))}generateTickLabels(t){Im.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const i=Ze(this.options.pointLabels.callback,[e,s],this);return i||i===0?i:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?w7(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,i))}getIndexAngle(t){const e=sn/(this._pointLabels.length||1),s=this.options.startAngle||0;return ps(t*e+Zi(s))}getDistanceFromCenterForValue(t){if(me(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(me(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return R7(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const i=this.getIndexAngle(t)-Sn+s;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:s,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),xR(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:i,border:r}=e,o=this._pointLabels.length;let a,c,l;if(e.pointLabels.display&&$7(this,o),i.display&&this.ticks.forEach((u,h)=>{if(h!==0||h===0&&this.min<0){c=this.getDistanceFromCenterForValue(u.value);const f=this.getContext(h),g=i.setContext(f),m=r.setContext(f);N7(this,g,c,o,m)}}),s.display){for(t.save(),a=o-1;a>=0;a--){const u=s.setContext(this.getPointLabelContext(a)),{color:h,lineWidth:f}=u;!f||!h||(t.lineWidth=f,t.strokeStyle=h,t.setLineDash(u.borderDash),t.lineDashOffset=u.borderDashOffset,c=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),l=this.getPointPosition(a,c),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const i=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,c)=>{if(c===0&&this.min>=0&&!e.reverse)return;const l=s.setContext(this.getContext(c)),u=zn(l.font);if(r=this.getDistanceFromCenterForValue(this.ticks[c].value),l.showLabelBackdrop){t.font=u.string,o=t.measureText(a.label).width,t.fillStyle=l.backdropColor;const h=ws(l.backdropPadding);t.fillRect(-o/2-h.left,-r-u.size/2-h.top,o+h.width,u.size+h.height)}Sc(t,a.label,0,-r,u,{color:l.color,strokeColor:l.textStrokeColor,strokeWidth:l.textStrokeWidth})}),t.restore()}drawTitle(){}}_t(vh,"id","radialLinear"),_t(vh,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:ub.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),_t(vh,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),_t(vh,"descriptors",{angleLines:{_fallback:"grid"}});const gb={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Us=Object.keys(gb);function aE(n,t){return n-t}function cE(n,t){if(me(t))return null;const e=n._adapter,{parser:s,round:i,isoWeekday:r}=n._parseOpts;let o=t;return typeof s=="function"&&(o=s(o)),pn(o)||(o=typeof s=="string"?e.parse(o,s):e.parse(o)),o===null?null:(i&&(o=i==="week"&&(zl(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,i)),+o)}function lE(n,t,e,s){const i=Us.length;for(let r=Us.indexOf(n);r<i-1;++r){const o=gb[Us[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=s)return Us[r]}return Us[i-1]}function A7(n,t,e,s,i){for(let r=Us.length-1;r>=Us.indexOf(e);r--){const o=Us[r];if(gb[o].common&&n._adapter.diff(i,s,o)>=t-1)return o}return Us[e?Us.indexOf(e):0]}function D7(n){for(let t=Us.indexOf(n)+1,e=Us.length;t<e;++t)if(gb[Us[t]].common)return Us[t]}function uE(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:s,hi:i}=a1(e,t),r=e[s]>=t?e[s]:e[i];n[r]=!0}}function O7(n,t,e,s){const i=n._adapter,r=+i.startOf(t[0].value,s),o=t[t.length-1].value;let a,c;for(a=r;a<=o;a=+i.add(a,1,s))c=e[a],c>=0&&(t[c].major=!0);return t}function hE(n,t,e){const s=[],i={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],i[a]=o,s.push({value:a,major:!1});return r===0||!e?s:O7(n,s,i,e)}class Yh extends zc{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),i=this._adapter=new VK._date(t.adapters.date);i.init(e),Rh(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:cE(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:i,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function c(l){!o&&!isNaN(l.min)&&(i=Math.min(i,l.min)),!a&&!isNaN(l.max)&&(r=Math.max(r,l.max))}(!o||!a)&&(c(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&c(this.getMinMax(!1))),i=pn(i)&&!isNaN(i)?i:+e.startOf(Date.now(),s),r=pn(r)&&!isNaN(r)?r:+e.endOf(Date.now(),s)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,i=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,o=this.max,a=dq(i,r,o);return this._unit=e.unit||(s.autoSkip?lE(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):A7(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:D7(this._unit),this.initOffsets(i),t.reverse&&a.reverse(),hE(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,i,r;this.options.offset&&t.length&&(i=this.getDecimalForValue(t[0]),t.length===1?e=1-i:e=(this.getDecimalForValue(t[1])-i)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?s=r:s=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=Gn(e,0,o),s=Gn(s,0,o),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,i=this.options,r=i.time,o=r.unit||lE(r.minUnit,e,s,this._getLabelCapacity(e)),a=te(i.ticks.stepSize,1),c=o==="week"?r.isoWeekday:!1,l=zl(c)||c===!0,u={};let h=e,f,g;if(l&&(h=+t.startOf(h,"isoWeek",c)),h=+t.startOf(h,l?"day":o),t.diff(s,e,o)>1e5*a)throw new Error(e+" and "+s+" are too far apart with stepSize of "+a+" "+o);const m=i.ticks.source==="data"&&this.getDataTimestamps();for(f=h,g=0;f<s;f=+t.add(f,a,o),g++)uE(u,f,m);return(f===s||i.bounds==="ticks"||g===1)&&uE(u,f,m),Object.keys(u).sort(aE).map(x=>+x)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,r=this._unit,o=e||i[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,s,i){const r=this.options,o=r.ticks.callback;if(o)return Ze(o,[t,e,s],this);const a=r.time.displayFormats,c=this._unit,l=this._majorUnit,u=c&&a[c],h=l&&a[l],f=s[e],g=l&&h&&f&&f.major;return this._adapter.format(t,i||(g?h:u))}generateTickLabels(t){let e,s,i;for(e=0,s=t.length;e<s;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,i=Zi(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),o=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:s*r+a*o,h:s*o+a*r}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,i=s[e.unit]||s.millisecond,r=this._tickFormatFunction(t,0,hE(this,[t],this._majorUnit),i),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,s=i.length;e<s;++e)t=t.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const i=this.getLabels();for(e=0,s=i.length;e<s;++e)t.push(cE(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return NN(t.sort(aE))}}_t(Yh,"id","time"),_t(Yh,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ig(n,t,e){let s=0,i=n.length-1,r,o,a,c;e?(t>=n[s].pos&&t<=n[i].pos&&({lo:s,hi:i}=vo(n,"pos",t)),{pos:r,time:a}=n[s],{pos:o,time:c}=n[i]):(t>=n[s].time&&t<=n[i].time&&({lo:s,hi:i}=vo(n,"time",t)),{time:r,pos:a}=n[s],{time:o,pos:c}=n[i]);const l=o-r;return l?a+(c-a)*(t-r)/l:a}class Xw extends Yh{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Ig(e,this.min),this._tableRange=Ig(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,i=[],r=[];let o,a,c,l,u;for(o=0,a=t.length;o<a;++o)l=t[o],l>=e&&l<=s&&i.push(l);if(i.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(o=0,a=i.length;o<a;++o)u=i[o+1],c=i[o-1],l=i[o],Math.round((u+c)/2)!==l&&r.push({time:l,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((i,r)=>i-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(Ig(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return Ig(this._table,s*this._tableRange+this._minPos,!0)}}_t(Xw,"id","timeseries"),_t(Xw,"defaults",Yh.defaults);var P7=Object.freeze({__proto__:null,CategoryScale:Gw,LinearScale:jw,LogarithmicScale:qw,RadialLinearScale:vh,TimeScale:Yh,TimeSeriesScale:Xw});const F7=[WK,bX,d7,P7];uo.register(...F7);function M7(n){var t,e,s=n.length;if(s===1)t=0,e=n[0][1];else{for(var i=0,r=0,o=0,a=0,c,l,u,h=0;h<s;h++)c=n[h],l=c[0],u=c[1],i+=l,r+=u,o+=l*l,a+=l*u;t=(s*a-i*r)/(s*o-i*i),e=r/s-t*i/s}return{m:t,b:e}}function L7(n){if(n.length===0)return 0;var t=n[0],e=0,s;if(typeof t!="number")return Number.NaN;for(var i=1;i<n.length;i++){if(typeof n[i]!="number")return Number.NaN;s=t+n[i],Math.abs(t)>=Math.abs(n[i])?e+=t-s+n[i]:e+=n[i]-s+t,t=s}return t+e}function Cl(n){if(n.length===0)throw new Error("mean requires at least one data point");return L7(n)/n.length}function B7(n,t){var e=Cl(n),s=0,i,r;if(t===2)for(r=0;r<n.length;r++)i=n[r]-e,s+=i*i;else for(r=0;r<n.length;r++)s+=Math.pow(n[r]-e,t);return s}function z7(n){if(n.length===0)throw new Error("variance requires at least one data point");return B7(n,2)/n.length}class x1{constructor(){this.charts={},this.isInitialized=!1}async initialize(){if(!this.isInitialized)try{console.log("Admin Predictive Analytics initialized"),this.isInitialized=!0}catch(t){console.error("Failed to initialize analytics:",t)}}generateSampleData(t,e="upward"){const s=[],i=[];for(let r=0;r<t;r++){const o=r;let a;switch(e){case"upward":a=o*.5+Math.random()*10+50;break;case"downward":a=-o*.3+Math.random()*10+100;break;case"seasonal":a=Math.sin(o*.1)*20+o*.2+Math.random()*5+50;break;default:a=Math.random()*100}s.push(a),i.push(`Day ${r+1}`)}return{data:s,labels:i}}predictLinearRegression(t,e=7){if(t.length<2)return[];const s=t.map((a,c)=>c),i=t,r=M7(s.map((a,c)=>[a,i[c]])),o=[];for(let a=0;a<e;a++){const c=t.length+a,l=r.m*c+r.b;o.push(Math.max(0,l))}return o}predictMovingAverage(t,e=7,s=7){if(t.length<s)return[];const i=[],r=t.slice(-s),o=Cl(r),a=this.calculateTrend(t);for(let c=0;c<e;c++){const l=o+a*(c+1);i.push(Math.max(0,l))}return i}calculateTrend(t){if(t.length<2)return 0;const e=t.slice(0,Math.floor(t.length/2)),s=t.slice(Math.floor(t.length/2)),i=Cl(e);return(Cl(s)-i)/e.length}generateInsights(t,e,s){const i=Cl(t),r=i>e?"increasing":"decreasing",o=((i-e)/e*100).toFixed(1);return{trend:r,changePercent:Math.abs(o),recommendation:this.getRecommendation(r,o,s),confidence:this.calculateConfidence(t)}}getRecommendation(t,e,s){if(t==="increasing"){if(s==="revenue")return"Consider scaling up operations to capitalize on growth";if(s==="users")return"Prepare infrastructure for increased user load"}else{if(s==="revenue")return"Review pricing strategy and user engagement";if(s==="users")return"Focus on user retention and acquisition campaigns"}return"Monitor trends closely and adjust strategy accordingly"}calculateConfidence(t){const e=Cl(t),s=z7(t),r=Math.sqrt(s)/e;return Math.max(0,Math.min(100,(1-r)*100))}createChart(t,e,s,i="line"){const r=document.getElementById(t);if(!r)return;const o={type:i,data:{labels:e.labels,datasets:[{label:"Historical Data",data:e.historical,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.1},{label:"Predictions",data:e.predictions,borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderDash:[5,5],tension:.1}]},options:{responsive:!0,plugins:{title:{display:!0,text:s},legend:{display:!0}},scales:{y:{beginAtZero:!0}}}};this.charts[t]&&this.charts[t].destroy(),this.charts[t]=new uo(r,o)}async runPredictions(t){this.isInitialized||await this.initialize();try{const e=this.predictLinearRegression(t.revenue||[],7),s=this.predictMovingAverage(t.users||[],7),i=this.predictLinearRegression(t.payments||[],7);return{revenue:{predictions:e,insights:this.generateInsights(e,t.revenue[t.revenue.length-1]||0,"revenue")},users:{predictions:s,insights:this.generateInsights(s,t.users[t.users.length-1]||0,"users")},payments:{predictions:i,insights:this.generateInsights(i,t.payments[t.payments.length-1]||0,"payments")}}}catch(e){return console.error("Error running predictions:",e),null}}}window.AdminPredictiveAnalytics=x1;console.log("AdminPredictiveAnalytics class loaded:",typeof x1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=1e-7,V7=1e-4;class yR{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class y1{refCount(t){return Vs("refCount")}incRef(t){return Vs("incRef")}timerAvailable(){return!0}time(t){return Vs("time")}read(t){return Vs("read")}readSync(t){return Vs("readSync")}readToGPU(t,e){return Vs("readToGPU")}numDataIds(){return Vs("numDataIds")}disposeData(t,e){return Vs("disposeData")}write(t,e,s){return Vs("write")}move(t,e,s,i,r){return Vs("move")}createTensorFromGPUData(t,e,s){return Vs("createTensorFromGPUData")}memory(){return Vs("memory")}floatPrecision(){return Vs("floatPrecision")}epsilon(){return this.floatPrecision()===32?W7:V7}dispose(){return Vs("dispose")}}function Vs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n){let t=n.length,e=0;for(;t>0;)e=Math.random()*t|0,t--,Il(n,t,e)}function _c(n,t,e){return Math.max(n,Math.min(t,e))}function w1(n){return n%2===0?n:n+1}function Il(n,t,e){const s=n[t];n[t]=n[e],n[e]=s}function H7(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function P(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function v1(n,t,e=""){P(De(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function wR(n){P(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ut(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function De(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Ul(n){return n%1===0}function Yw(n){const t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function Al(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function dE(n,t=i=>0,e,s){return new Promise((i,r)=>{let o=0;const a=()=>{if(n()){i();return}o++;const c=t(o);if(e!=null&&o>=e){r();return}s!=null?s(a,c):setTimeout(a,c)};a()})}function vR(n,t){let e=1,s=-1;for(let r=0;r<n.length;++r)if(n[r]>=0)e*=n[r];else if(n[r]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${r}`);s=r}else if(n[r]<0)throw Error(`Shapes can not be < 0. Found ${n[r]} at dim ${r}`);if(s===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);const i=n.slice();return i[s]=t/e,i}function le(n,t){const e=t.length;return n=n==null?t.map((s,i)=>i):[].concat(n),P(n.every(s=>s>=-e&&s<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),P(n.every(s=>Ul(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?e+s:s)}function ka(n,t){const e=[],s=[],i=t!=null&&Array.isArray(t)&&t.length===0,r=t==null||i?null:le(t,n).sort();let o=0;for(let a=0;a<n.length;++a){if(r!=null){if(r[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(r[o]==null||r[o]>a)&&n[a]===1&&(e.push(n[a]),s.push(a)),r[o]<=a&&o++}n[a]!==1&&(e.push(n[a]),s.push(a))}return{newShape:e,keptDims:s}}function es(n,t){return gn(n,t)}function gn(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function G7(n,t){for(let e=0;e<n.length;e++){const s=n[e];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function j7(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function CR(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function km(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function q7(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function Cd(n){return typeof n=="string"||n instanceof String}function K7(n){return typeof n=="boolean"}function Jw(n){return typeof n=="number"}function ru(n){return Array.isArray(n)?ru(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Jw(n)?"float32":Cd(n)?"string":K7(n)?"bool":"float32"}function Zw(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Qw(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function Wt(n){const t=n.length;if(t<2)return[];const e=new Array(t-1);e[t-2]=n[t-1];for(let s=t-3;s>=0;--s)e[s]=e[s+1]*n[s+1];return e}function IR(n,t,e,s=!1){const i=new Array;if(t.length===1){const r=t[0]*(s?2:1);for(let o=0;o<r;o++)i[o]=e[n+o]}else{const r=t[0],o=t.slice(1),a=o.reduce((c,l)=>c*l)*(s?2:1);for(let c=0;c<r;c++)i[c]=IR(n+c*a,o,e,s)}return i}function sr(n,t,e=!1){if(n.length===0)return t[0];const s=n.reduce((i,r)=>i*r)*(e?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}${e?" for a complex tensor":""}.`);return IR(0,n,t,e)}function X7(n,t){if(Array.isArray(n))return n;if(t==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(t==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${t}`)}function C1(n,t){const e=ns(n,t);for(let s=0;s<e.length;s++)e[s]=1;return e}function ns(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function kR(n,t){const e=n.reduce((s,i)=>s*i,1);if(t==null||t==="float32")return sr(n,new Float32Array(e));if(t==="int32")return sr(n,new Int32Array(e));if(t==="bool")return sr(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function Oo(n){n.forEach(t=>{P(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Nr(n,t,e){if(t===0)return 0;if(t===1)return n[0];let s=n[n.length-1];for(let i=0;i<n.length-1;++i)s+=e[i]*n[i];return s}function ou(n,t,e){if(t===0)return[];if(t===1)return[n];const s=new Array(t);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(n/e[i]),n-=s[i]*e[i];return s[s.length-1]=n,s}function I1(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fE="tfjsflags";class Y7{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=J7,this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&(rt().getBool("IS_TEST")||rt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,s){if(this.flagRegistry[t]={evaluationFn:e,setHook:s},this.urlFlags[t]!=null){const i=this.urlFlags[t];rt().getBool("IS_TEST")||rt().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${i}.`),this.set(t,i)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(I1(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);fE in t&&t[fE].split(",").forEach(s=>{const[i,r]=s.split(":");this.urlFlags[i]=Q7(i,r)})}}function J7(n){const t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...s)=>(Z7(t,s[0],s[1]),s.join("="))),t}function Z7(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function Q7(n,t){const e=t.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:t}function rt(){return SR}let SR=null;function tY(n){SR=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let tw;function _R(){if(tw==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");tw=n}return tw}function eY(){const n=_R();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function k1(n,t){const e=eY();if(e.has(n))return e.get(n);{const s=t();return e.set(n,s),e.get(n)}}const mb="Abs",Id="Acos",kd="Acosh",au="Add",S1="AddN",_1="All",T1="Any",bb="ArgMax",xb="ArgMin",Sd="Asin",_d="Asinh",Td="Atan",Ed="Atanh",$d="Atan2",yb="AvgPool",E1="AvgPoolGrad",wb="AvgPool3D",$1="AvgPool3DGrad",vb="BatchMatMul",Cb="BatchToSpaceND",N1="Bincount",R1="BitwiseAnd",nY="BroadcastTo",TR="BroadcastArgs",Nd="Cast",Rd="Ceil",Ad="ClipByValue",A1="Complex",Ib="ComplexAbs",kb="Concat",Sb="Conv2D",D1="Conv2DBackpropFilter",_b="Conv2DBackpropInput",Tb="Conv3D",O1="Conv3DBackpropFilterV2",P1="Conv3DBackpropInputV2",Dd="Cos",Od="Cosh",F1="Cumprod",Eb="Cumsum",M1="CropAndResize",L1="DenseBincount",B1="DepthToSpace",$b="DepthwiseConv2dNative",z1="DepthwiseConv2dNativeBackpropFilter",W1="DepthwiseConv2dNativeBackpropInput",ER="Diag",Nb="Dilation2D",tv="Dilation2DBackpropInput",ev="Dilation2DBackpropFilter",sY="Draw",Pd="RealDiv",V1="Einsum",Fd="Elu",U1="EluGrad",Md="Erf",Rb="Equal",Ld="Exp",Ab="ExpandDims",Bd="Expm1",H1="FFT",G1="Fill",j1="FlipLeftRight",zd="Floor",Wd="FloorDiv",Db="FusedBatchNorm",Ob="GatherV2",$R="GatherNd",Pb="Greater",Vd="GreaterEqual",Ud="Identity",q1="IFFT",K1="Imag",Hd="IsFinite",Gd="IsInf",jd="IsNan",Fb="LeakyRelu",Mb="Less",Lb="LessEqual",NR="LinSpace",qd="Log",Kd="Log1p",Bb="LogicalAnd",zb="LogicalNot",Wb="LogicalOr",iY="LogSoftmax",Vb="LRN",X1="LRNGrad",Ub="Max",Xd="Maximum",Hb="MaxPool",Y1="MaxPoolGrad",Gb="MaxPool3D",J1="MaxPool3DGrad",RR="MaxPoolWithArgmax",jb="Mean",qb="Min",Yd="Minimum",Kb="MirrorPad",Jd="Mod",AR="Multinomial",Zd="Multiply",Xb="Neg",Yb="NotEqual",Z1="NonMaxSuppressionV3",Q1="NonMaxSuppressionV4",tC="NonMaxSuppressionV5",Jb="OnesLike",Zb="OneHot",Qb="Pack",tx="PadV2",Qd="Pow",ex="Prelu",nx="Prod",DR="RaggedGather",OR="RaggedRange",PR="RaggedTensorToTensor",eC="Range",nC="Real",tf="Reciprocal",ef="Relu",sx="Reshape",ix="ResizeNearestNeighbor",sC="ResizeNearestNeighborGrad",rx="ResizeBilinear",iC="ResizeBilinearGrad",nf="Relu6",ox="Reverse",sf="Round",rf="Rsqrt",FR="ScatterNd",MR="TensorScatterUpdate",LR="SearchSorted",ax="Select",of="Selu",cx="Slice",af="Sin",cf="Sinh",lf="Sign",uf="Sigmoid",hf="Softplus",df="Sqrt",lx="Sum",ux="SpaceToBatchND",hx="SplitV",dx="Softmax",BR="SparseFillEmptyRows",zR="SparseReshape",WR="SparseSegmentMean",VR="SparseSegmentSum",UR="SparseToDense",ff="SquaredDifference",rC="Square",oC="StaticRegexReplace",aC="StridedSlice",HR="StringNGrams",GR="StringSplit",jR="StringToHashBucketFast",pf="Sub",gf="Tan",mf="Tanh",bf="Tile",cC="TopK",lC="Transform",Dl="Transpose",uC="Unique",fx="Unpack",px="UnsortedSegmentSum",gx="ZerosLike",xf="Step",rY="FromPixels",hC="RotateWithOffset",Sm="_FusedMatMul",_m="FusedConv2D",qR="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ai(...n){rt().getBool("IS_TEST")||rt().getBool("PROD")||console.warn(...n)}function oY(...n){rt().getBool("IS_TEST")||rt().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tm=k1("kernelRegistry",()=>new Map),nv=k1("gradRegistry",()=>new Map);function pE(n,t){const e=XR(n,t);return Tm.get(e)}function gE(n){return nv.get(n)}function mE(n){const t=Tm.entries(),e=[];for(;;){const{done:s,value:i}=t.next();if(s)break;const[r,o]=i,[a]=r.split("_");a===n&&e.push(o)}return e}function KR(n){const{kernelName:t,backendName:e}=n,s=XR(t,e);Tm.has(s)&&ai(`The kernel '${t}' for backend '${e}' is already registered`),Tm.set(s,n)}function aY(n){const{kernelName:t}=n;nv.has(t)&&rt().getBool("DEBUG")&&ai(`Overriding the gradient for '${t}'`),nv.set(t,n)}function XR(n,t){return`${t}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YR(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var JR=tn,Ni=null;try{Ni=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tn(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}tn.prototype.__isLong__;Object.defineProperty(tn.prototype,"__isLong__",{value:!0});function Qs(n){return(n&&n.__isLong__)===!0}tn.isLong=Qs;var bE={},xE={};function Wc(n,t){var e,s,i;return t?(n>>>=0,(i=0<=n&&n<256)&&(s=xE[n],s)?s:(e=en(n,(n|0)<0?-1:0,!0),i&&(xE[n]=e),e)):(n|=0,(i=-128<=n&&n<128)&&(s=bE[n],s)?s:(e=en(n,n<0?-1:0,!1),i&&(bE[n]=e),e))}tn.fromInt=Wc;function Ri(n,t){if(isNaN(n))return t?fc:Ai;if(t){if(n<0)return fc;if(n>=ZR)return eA}else{if(n<=-wE)return Gs;if(n+1>=wE)return tA}return n<0?Ri(-n,t).neg():en(n%Hl|0,n/Hl|0,t)}tn.fromNumber=Ri;function en(n,t,e){return new tn(n,t,e)}tn.fromBits=en;var Em=Math.pow;function dC(n,t,e){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ai;if(typeof t=="number"?(e=t,t=!1):t=!!t,e=e||10,e<2||36<e)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return dC(n.substring(1),t,e).neg();for(var i=Ri(Em(e,8)),r=Ai,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),c=parseInt(n.substring(o,o+a),e);if(a<8){var l=Ri(Em(e,a));r=r.mul(l).add(Ri(c))}else r=r.mul(i),r=r.add(Ri(c))}return r.unsigned=t,r}tn.fromString=dC;function dr(n,t){return typeof n=="number"?Ri(n,t):typeof n=="string"?dC(n,t):en(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}tn.fromValue=dr;var yE=65536,cY=1<<24,Hl=yE*yE,ZR=Hl*Hl,wE=ZR/2,vE=Wc(cY),Ai=Wc(0);tn.ZERO=Ai;var fc=Wc(0,!0);tn.UZERO=fc;var _l=Wc(1);tn.ONE=_l;var QR=Wc(1,!0);tn.UONE=QR;var sv=Wc(-1);tn.NEG_ONE=sv;var tA=en(-1,2147483647,!1);tn.MAX_VALUE=tA;var eA=en(-1,-1,!0);tn.MAX_UNSIGNED_VALUE=eA;var Gs=en(0,-2147483648,!1);tn.MIN_VALUE=Gs;var Et=tn.prototype;Et.toInt=function(){return this.unsigned?this.low>>>0:this.low};Et.toNumber=function(){return this.unsigned?(this.high>>>0)*Hl+(this.low>>>0):this.high*Hl+(this.low>>>0)};Et.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Gs)){var e=Ri(t),s=this.div(e),i=s.mul(e).sub(this);return s.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var r=Ri(Em(t,6),this.unsigned),o=this,a="";;){var c=o.div(r),l=o.sub(c.mul(r)).toInt()>>>0,u=l.toString(t);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};Et.getHighBits=function(){return this.high};Et.getHighBitsUnsigned=function(){return this.high>>>0};Et.getLowBits=function(){return this.low};Et.getLowBitsUnsigned=function(){return this.low>>>0};Et.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Gs)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1};Et.isZero=function(){return this.high===0&&this.low===0};Et.eqz=Et.isZero;Et.isNegative=function(){return!this.unsigned&&this.high<0};Et.isPositive=function(){return this.unsigned||this.high>=0};Et.isOdd=function(){return(this.low&1)===1};Et.isEven=function(){return(this.low&1)===0};Et.equals=function(t){return Qs(t)||(t=dr(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};Et.eq=Et.equals;Et.notEquals=function(t){return!this.eq(t)};Et.neq=Et.notEquals;Et.ne=Et.notEquals;Et.lessThan=function(t){return this.comp(t)<0};Et.lt=Et.lessThan;Et.lessThanOrEqual=function(t){return this.comp(t)<=0};Et.lte=Et.lessThanOrEqual;Et.le=Et.lessThanOrEqual;Et.greaterThan=function(t){return this.comp(t)>0};Et.gt=Et.greaterThan;Et.greaterThanOrEqual=function(t){return this.comp(t)>=0};Et.gte=Et.greaterThanOrEqual;Et.ge=Et.greaterThanOrEqual;Et.compare=function(t){if(Qs(t)||(t=dr(t)),this.eq(t))return 0;var e=this.isNegative(),s=t.isNegative();return e&&!s?-1:!e&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};Et.comp=Et.compare;Et.negate=function(){return!this.unsigned&&this.eq(Gs)?Gs:this.not().add(_l)};Et.neg=Et.negate;Et.add=function(t){Qs(t)||(t=dr(t));var e=this.high>>>16,s=this.high&65535,i=this.low>>>16,r=this.low&65535,o=t.high>>>16,a=t.high&65535,c=t.low>>>16,l=t.low&65535,u=0,h=0,f=0,g=0;return g+=r+l,f+=g>>>16,g&=65535,f+=i+c,h+=f>>>16,f&=65535,h+=s+a,u+=h>>>16,h&=65535,u+=e+o,u&=65535,en(f<<16|g,u<<16|h,this.unsigned)};Et.subtract=function(t){return Qs(t)||(t=dr(t)),this.add(t.neg())};Et.sub=Et.subtract;Et.multiply=function(t){if(this.isZero())return Ai;if(Qs(t)||(t=dr(t)),Ni){var e=Ni.mul(this.low,this.high,t.low,t.high);return en(e,Ni.get_high(),this.unsigned)}if(t.isZero())return Ai;if(this.eq(Gs))return t.isOdd()?Gs:Ai;if(t.eq(Gs))return this.isOdd()?Gs:Ai;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(vE)&&t.lt(vE))return Ri(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,a=t.high>>>16,c=t.high&65535,l=t.low>>>16,u=t.low&65535,h=0,f=0,g=0,m=0;return m+=o*u,g+=m>>>16,m&=65535,g+=r*u,f+=g>>>16,g&=65535,g+=o*l,f+=g>>>16,g&=65535,f+=i*u,h+=f>>>16,f&=65535,f+=r*l,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=s*u+i*l+r*c+o*a,h&=65535,en(g<<16|m,h<<16|f,this.unsigned)};Et.mul=Et.multiply;Et.divide=function(t){if(Qs(t)||(t=dr(t)),t.isZero())throw Error("division by zero");if(Ni){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Ni.div_u:Ni.div_s)(this.low,this.high,t.low,t.high);return en(e,Ni.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?fc:Ai;var s,i,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return fc;if(t.gt(this.shru(1)))return QR;r=fc}else{if(this.eq(Gs)){if(t.eq(_l)||t.eq(sv))return Gs;if(t.eq(Gs))return _l;var o=this.shr(1);return s=o.div(t).shl(1),s.eq(Ai)?t.isNegative()?_l:sv:(i=this.sub(t.mul(s)),r=s.add(i.div(t)),r)}else if(t.eq(Gs))return this.unsigned?fc:Ai;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Ai}for(i=this;i.gte(t);){s=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:Em(2,a-48),l=Ri(s),u=l.mul(t);u.isNegative()||u.gt(i);)s-=c,l=Ri(s,this.unsigned),u=l.mul(t);l.isZero()&&(l=_l),r=r.add(l),i=i.sub(u)}return r};Et.div=Et.divide;Et.modulo=function(t){if(Qs(t)||(t=dr(t)),Ni){var e=(this.unsigned?Ni.rem_u:Ni.rem_s)(this.low,this.high,t.low,t.high);return en(e,Ni.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};Et.mod=Et.modulo;Et.rem=Et.modulo;Et.not=function(){return en(~this.low,~this.high,this.unsigned)};Et.and=function(t){return Qs(t)||(t=dr(t)),en(this.low&t.low,this.high&t.high,this.unsigned)};Et.or=function(t){return Qs(t)||(t=dr(t)),en(this.low|t.low,this.high|t.high,this.unsigned)};Et.xor=function(t){return Qs(t)||(t=dr(t)),en(this.low^t.low,this.high^t.high,this.unsigned)};Et.shiftLeft=function(t){return Qs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?en(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):en(0,this.low<<t-32,this.unsigned)};Et.shl=Et.shiftLeft;Et.shiftRight=function(t){return Qs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?en(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):en(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};Et.shr=Et.shiftRight;Et.shiftRightUnsigned=function(t){if(Qs(t)&&(t=t.toInt()),t&=63,t===0)return this;var e=this.high;if(t<32){var s=this.low;return en(s>>>t|e<<32-t,e>>>t,this.unsigned)}else return t===32?en(e,0,this.unsigned):en(e>>>t-32,0,this.unsigned)};Et.shru=Et.shiftRightUnsigned;Et.shr_u=Et.shiftRightUnsigned;Et.toSigned=function(){return this.unsigned?en(this.low,this.high,!1):this};Et.toUnsigned=function(){return this.unsigned?this:en(this.low,this.high,!0)};Et.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};Et.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};Et.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};tn.fromBytes=function(t,e,s){return s?tn.fromBytesLE(t,e):tn.fromBytesBE(t,e)};tn.fromBytesLE=function(t,e){return new tn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};tn.fromBytesBE=function(t,e){return new tn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const nA=y2(JR),lY=CU({__proto__:null,default:nA},[JR]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ac=nA||lY;function mx(n){return ac.fromString(n,!0,16)}const sA=mx("c3a5c85c97cb3127"),oc=mx("b492b66fbe98f273"),gs=mx("9ae16a3b2f90404f");function iv(n){return n.xor(n.shru(47))}function iA(n,t,e){const s=n.slice(t,t+e);return ac.fromBytes(Array.from(s),!0,!0)}function je(n,t){return iA(n,t,8)}function CE(n,t){return iA(n,t,4)}function Ln(n,t){return t===0?n:n.shru(t).or(n.shl(64-t))}function ua(n,t,e=mx("9ddfea08eb382d69")){let s=n.xor(t).mul(e);s=s.xor(s.shru(47));let i=t.xor(s).mul(e);return i=i.xor(i.shru(47)),i=i.mul(e),i}function uY(n,t,e,s,i,r){i=i.add(n),r=Ln(r.add(i).add(s),21);const o=i;return i=i.add(t),i=i.add(e),r=r.add(Ln(i,44)),[i.add(s),r.add(o)]}function kg(n,t,e,s){return uY(je(n,t),je(n,t+8),je(n,t+16),je(n,t+24),e,s)}function hY(n,t=n.length){if(t>=8){const e=gs.add(t*2),s=je(n,0).add(gs),i=je(n,t-8),r=Ln(i,37).mul(e).add(s),o=Ln(s,25).add(i).mul(e);return ua(r,o,e)}if(t>=4){const e=gs.add(t*2),s=CE(n,0);return ua(s.shl(3).add(t),CE(n,t-4),e)}if(t>0){const e=n[0],s=n[t>>1],i=n[t-1],r=e+(s<<8),o=t+(i<<2);return iv(gs.mul(r).xor(sA.mul(o))).mul(gs)}return gs}function dY(n,t=n.length){const e=gs.add(t*2),s=je(n,0).mul(oc),i=je(n,8),r=je(n,t-8).mul(e),o=je(n,t-16).mul(gs);return ua(Ln(s.add(i),43).add(Ln(r,30)).add(o),s.add(Ln(i.add(gs),18)).add(r),e)}function fY(n,t=n.length){const e=gs.add(t*2),s=je(n,0).mul(gs),i=je(n,8),r=je(n,t-8).mul(e),o=je(n,t-16).mul(gs),a=Ln(s.add(i),43).add(Ln(r,30)).add(o),c=ua(a,s.add(Ln(i.add(gs),18)).add(r),e),l=je(n,16).mul(e),u=je(n,24),h=a.add(je(n,t-32)).mul(e),f=c.add(je(n,t-24)).mul(e);return ua(Ln(l.add(u),43).add(Ln(h,30)).add(f),l.add(Ln(u.add(s),18)).add(h),e)}function pY(n,t=n.length){const e=ac.fromNumber(81,!0);if(t<=32)return t<=16?hY(n,t):dY(n,t);if(t<=64)return fY(n,t);let s=e,i=e.mul(oc).add(113),r=iv(i.mul(gs).add(113)).mul(gs),o=[ac.UZERO,ac.UZERO],a=[ac.UZERO,ac.UZERO];s=s.mul(gs).add(je(n,0));let c=0;const l=(t-1>>6)*64,u=l+(t-1&63)-63;do s=Ln(s.add(i).add(o[0]).add(je(n,c+8)),37).mul(oc),i=Ln(i.add(o[1]).add(je(n,c+48)),42).mul(oc),s=s.xor(a[1]),i=i.add(o[0]).add(je(n,c+40)),r=Ln(r.add(a[0]),33).mul(oc),o=kg(n,c,o[1].mul(oc),s.add(a[0])),a=kg(n,c+32,r.add(a[1]),i.add(je(n,c+16))),[r,s]=[s,r],c+=64;while(c!==l);const h=oc.add(r.and(255).shl(1));return c=u,a[0]=a[0].add(t-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Ln(s.add(i).add(o[0]).add(je(n,c+8)),37).mul(h),i=Ln(i.add(o[1]).add(je(n,c+48)),42).mul(h),s=s.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(je(n,c+40))),r=Ln(r.add(a[0]),33).mul(h),o=kg(n,c,o[1].mul(h),s.add(a[0])),a=kg(n,c+32,r.add(a[1]),i.add(je(n,c+16))),[r,s]=[s,r],ua(ua(o[0],a[0],h).add(iv(i).mul(sA)).add(r),ua(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(n,t){return t==="string"?ha(n):Vc([n],t)}function gY(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function Vc(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Tc(n)),rt().getBool("DEBUG")&&G7(n,t),gY(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){const e=new Uint8Array(n.length);for(let s=0;s<e.length;++s)Math.round(n[s])!==0&&(e[s]=1);return e}else throw new Error(`Unknown data type ${t}`)}function Es(){return rt().platform.now()}function ha(n,t="utf-8"){return t=t||"utf-8",rt().platform.encode(n,t)}function ma(n,t="utf-8"){return t=t||"utf-8",rt().platform.decode(n,t)}function Fi(n){return rt().platform.isTypedArray!=null?rt().platform.isTypedArray(n):YR(n)}function Tc(n,t=[],e=!1){if(t==null&&(t=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||I1(n)||n==null||Fi(n)&&e)t.push(n);else if(Array.isArray(n)||Fi(n))for(let s=0;s<n.length;++s)Tc(n[s],t,e);else{let s=-1;for(const i of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(i)&&(s=Math.max(s,Number(i)));for(let i=0;i<=s;i++)Tc(n[i],t,e)}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mY{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new xY)}profileKernel(t,e,s){let i;const r=()=>{i=s()};let o;const a=Es();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(r);else{r();for(const l of i)l.dataSync();o=Promise.resolve({kernelMs:Es()-a})}if(rt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<i.length;l++){const u=i[l];u.data().then(h=>{bY(h,u.dtype,t)})}return{kernelName:t,outputs:i,inputs:e,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:e,outputs:s,timeMs:i,inputs:r,extraInfo:o}=t;s.forEach(a=>{Promise.all([a.data(),i,o]).then(c=>{this.logger.logKernelProfile(e,a,c[0],c[1],r,c[2])})})}}function bY(n,t,e){if(t!=="float32")return!1;for(let s=0;s<n.length;s++){const i=n[s];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${e}'`),!0}return!1}class xY{logKernelProfile(t,e,s,i,r,o){const a=typeof i=="number"?Al(`${i}ms`,9):i.error,c=Al(t,25),l=e.rank,u=e.size,h=Al(e.shape.toString(),14);let f="";for(const g in r){const m=r[g];if(m!=null){const x=m.shape||e.shape,b=x.length;f+=`${g}: ${b}D ${b>0?x:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${u}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(n,t,e){const s={},i={};for(let c=0;c<t.length;c++)s[t[c].id]=!0;for(let c=0;c<n.length;c++){const l=n[c],u=l.inputs;for(const h in u){const f=u[h];let g=!1;for(let m=0;m<t.length;m++)if(s[f.id]){l.outputs.forEach(x=>s[x.id]=!0),g=!0,i[l.id]=!0;break}if(g)break}}const r={};r[e.id]=!0;const o={};for(let c=n.length-1;c>=0;c--){const l=n[c],u=l.inputs;for(let h=0;h<l.outputs.length;h++)if(r[l.outputs[h].id]){for(const f in u)r[u[f].id]=!0,o[l.id]=!0;break}}const a=[];for(let c=0;c<n.length;c++){const l=n[c];if(i[l.id]&&o[l.id]){const u={};for(const f in l.inputs){const g=l.inputs[f];s[g.id]&&(u[f]=g)}const h=Object.assign({},l);h.inputs=u,h.outputs=l.outputs,a.push(h)}}return a}function wY(n,t,e,s){for(let i=t.length-1;i>=0;i--){const r=t[i],o=[];if(r.outputs.forEach(c=>{const l=n[c.id];l!=null?o.push(l):o.push(null)}),r.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${r.kernelName}.`);const a=r.gradient(o);for(const c in r.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=e(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const u=r.inputs[c];if(!De(l.shape,u.shape))throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${u.shape}'`);if(n[u.id]==null)n[u.id]=l;else{const h=n[u.id];n[u.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IE=20,uh=3,ew=7;function vY(n,t,e,s){const i=Wt(t),r=CY(n,t,e,i),o=t.length,a=tm(n,t,e,i,r),c=["Tensor"];return s&&(c.push(`  dtype: ${e}`),c.push(`  rank: ${o}`),c.push(`  shape: [${t}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function CY(n,t,e,s){const i=ut(t),r=s[s.length-1],o=new Array(r).fill(0),a=t.length,c=e==="complex64"?Ih(n):n;if(a>1)for(let l=0;l<i/r;l++){const u=l*r;for(let h=0;h<r;h++)o[h]=Math.max(o[h],Ch(c[u+h],0,e).length)}return o}function Ch(n,t,e){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(ew))} + ${parseFloat(n[1].toFixed(ew))}j`:Cd(n)?s=`'${n}'`:e==="bool"?s=rA(n):s=parseFloat(n.toFixed(ew)).toString(),Al(s,t)}function rA(n){return n===0?"false":"true"}function tm(n,t,e,s,i,r=!0){const o=e==="complex64"?2:1,a=t[0],c=t.length;if(c===0){if(e==="complex64"){const x=Ih(n);return[Ch(x[0],0,e)]}return e==="bool"?[rA(n[0])]:[n[0].toString()]}if(c===1){if(a>IE){const b=uh*o;let y=Array.from(n.slice(0,b)),v=Array.from(n.slice((a-uh)*o,a*o));return e==="complex64"&&(y=Ih(y),v=Ih(v)),["["+y.map((k,I)=>Ch(k,i[I],e)).join(", ")+", ..., "+v.map((k,I)=>Ch(k,i[a-uh+I],e)).join(", ")+"]"]}return["["+(e==="complex64"?Ih(n):Array.from(n)).map((b,y)=>Ch(b,i[y],e)).join(", ")+"]"]}const l=t.slice(1),u=s.slice(1),h=s[0]*o,f=[];if(a>IE){for(let x=0;x<uh;x++){const b=x*h,y=b+h;f.push(...tm(n.slice(b,y),l,e,u,i,!1))}f.push("...");for(let x=a-uh;x<a;x++){const b=x*h,y=b+h;f.push(...tm(n.slice(b,y),l,e,u,i,x===a-1))}}else for(let x=0;x<a;x++){const b=x*h,y=b+h;f.push(...tm(n.slice(b,y),l,e,u,i,x===a-1))}const g=c===2?",":"";f[0]="["+(a>0?f[0]+g:"");for(let x=1;x<f.length-1;x++)f[x]=" "+f[x]+g;let m=`,
`;for(let x=2;x<c;x++)m+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(r?"":m),f}function Ih(n){const t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jn{constructor(t,e,s){if(this.dtype=e,this.shape=t.slice(),this.size=ut(t),s!=null){const i=s.length;P(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||gn(e,this.size),this.strides=Wt(t)}set(t,...e){e.length===0&&(e=[0]),P(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);const s=this.locToIndex(e);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(const i of t){if(i<0||i>=this.shape[e]){const r=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(r)}e++}let s=t[t.length-1];for(let i=0;i<t.length-1;++i)s+=this.strides[i]*t[i];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let s=0;s<t.length-1;++s)e+=this.strides[s]*t[s];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const e=new Array(this.shape.length);for(let s=0;s<e.length-1;++s)e[s]=Math.floor(t/this.strides[s]),t-=e[s]*this.strides[s];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return Xi().makeTensor(this.values,this.shape,this.dtype)}}let Xi=null,kl=null;function IY(n){Xi=n}function kY(n){kl=n}class Tn{constructor(t,e,s,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=ut(t),this.strides=Wt(t),this.dataId=s,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return kl.buffer(this.shape,this.dtype,t)}bufferSync(){return kl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return sr(this.shape,t,this.dtype==="complex64")}arraySync(){return sr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=Xi().read(this.dataId);if(this.dtype==="string"){const e=await t;try{return e.map(s=>ma(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),Xi().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=Xi().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>ma(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await Xi().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Xi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return kl.print(this,t)}clone(){return this.throwIfDisposed(),kl.clone(this)}toString(t=!1){const e=this.dataSync();return vY(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),kl.cast(this,t)}variable(t=!0,e,s){return this.throwIfDisposed(),Xi().makeVariable(this,t,e,s)}}Object.defineProperty(Tn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ct(){return k1("Tensor",()=>Tn)}ct();class $m extends Tn{constructor(t,e,s,i){super(t.shape,t.dtype,t.dataId,i),this.trainable=e,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!De(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Xi().disposeTensor(this),this.dataId=t.dataId,Xi().incRef(this,null)}dispose(){Xi().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty($m,Symbol.hasInstance,{value:n=>n instanceof Tn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kE;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(kE||(kE={}));var rv;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(rv||(rv={}));var ov;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(ov||(ov={}));var av;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(av||(av={}));var cv;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(cv||(cv={}));const SY={float32:av,int32:rv,bool:ov,complex64:cv};function Ks(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return SY[n][t]}function fC(n){return Ks(n,"int32")}function oA(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function aA(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bn(n,t){if(n.dtype===t.dtype)return[n,t];const e=Ks(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function cA(n){const t=[];return lA(n,t,new Set),t}function lA(n,t,e){if(n==null)return;if(n instanceof Tn){t.push(n);return}if(!_Y(n))return;const s=n;for(const i in s){const r=s[i];e.has(r)||(e.add(r),lA(r,t,e))}}function _Y(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nw(n){return n.kernelName!=null}class SE{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Gl{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new SE}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:e}=this.initializeBackend(t);if(e)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,s=1){return t in this.registryFactory?(ai(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:e,asyncInit:s}=this.initializeBackend(t);if(!(s?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new mY(this.backendInstance),!0}setupRegisteredKernels(){mE(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){mE(t).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[t])})}initializeBackend(t){const e=this.registryFactory[t];if(e==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const s=e.factory();if(s&&!(s instanceof y1)&&typeof s.then=="function"){const i=++this.pendingBackendInitId,r=s.then(o=>i<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,ai(`Initialization of backend ${t} failed`),ai(o.stack||o.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}else return this.registry[t]=s,{success:!0,asyncInit:!1}}catch(s){return ai(`Initialization of backend ${t} failed`),ai(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e],{success:i,asyncInit:r}=this.initializeBackend(s);if(r||i)return{name:s,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const s=this.state.tensorInfo.get(e),i=s.backend,r=this.readSync(e),o=i.refCount(e);i.disposeData(e,!0),s.backend=t,t.move(e,r,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let s=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}let i;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(i),()=>(i=e(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(t,e,s){t();try{const i=s();return e(),i}catch(i){throw e(),i}}nextTensorId(){return Gl.nextTensorId++}nextVariableId(){return Gl.nextVariableId++}clone(t){const e=q.runKernel(Ud,{x:t}),s={x:t},i=o=>({x:()=>{const a="float32",c={x:o},l={dtype:a};return q.runKernel(Nd,c,l)}}),r=[];return this.addTapeNode(this.state.activeScope.name,s,[e],i,r,{}),e}runKernel(t,e,s){if(this.backendName==null&&this.backend,!(pE(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,s){const i=this.backend.numDataIds();let r=0;s.forEach(c=>{r+=c.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-e-r-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let e,s=[];const i=this.isTapeOn(),r=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=nw(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(nw(t)){const{kernelName:m,inputs:x,attrs:b}=t;this.backendName==null&&this.backend;const y=pE(m,this.backendName);P(y!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{const v=this.backend.numDataIds();c=y.kernelFunc({inputs:x,attrs:b,backend:this.backend});const k=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,v,k);const I=k.map(_=>_.rank!=null?_:this.makeTensorFromTensorInfo(_));if(i){const _=this.getTensorsForGradient(m,x,I);s=this.saveTensorsForBackwardMode(_)}return I}}else{const{forwardFunc:m}=t,x=b=>{i&&(s=b.map(y=>this.keep(this.clone(y))))};a=()=>{const b=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,x));const y=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,b,y),y}}const{inputs:u,attrs:h}=t,f=nw(t)?null:t.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?e=a():(g=this.profiler.profileKernel(l,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),e=g.outputs)}),i&&this.addTapeNode(l,u,e,f,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(m=>u[m]!=null?u[m].shape:null),outputShapes:e.map(m=>m.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(c)?e:e[0]}saveTensorsForBackwardMode(t){return t.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(t,e,s){const i=gE(t);if(i!=null){const r=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(P(Array.isArray(e),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(e).map(l=>e[l])):a=r.map(l=>e[l]);const c=s.filter((l,u)=>o[u]);return a.concat(c)}return[]}makeTensor(t,e,s,i){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",i=i||this.backend;let r=t;s==="string"&&Cd(t[0])&&(r=t.map(c=>ha(c)));const o=i.write(r,e,s),a=new Tn(e,s,o,this.nextTensorId());if(this.trackTensor(a,i),s==="string"){const c=this.state.tensorInfo.get(o),l=q7(r);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(t,e,s,i){s=s||"float32";const r={dataId:t,shape:e,dtype:s};return this.makeTensorFromTensorInfo(r,i)}makeTensorFromTensorInfo(t,e){const{dataId:s,shape:i,dtype:r}=t,o=new Tn(i,r,s,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,s,i){s=s||this.nextVariableId().toString(),i!=null&&i!==t.dtype&&(t=t.cast(i));const r=new $m(t,e,s,this.nextTensorId());if(this.state.registeredVariables[r.name]!=null)throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(t,e){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*km(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof $m||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const s=t.size*km(t.dtype);this.state.numBytes-=s}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,e,s,i,r,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:s,saved:r},c=gE(t);c!=null&&(i=c.gradFunc),i!=null&&(a.gradient=l=>(l=l.map((u,h)=>{if(u==null){const f=s[h],g=ns(f.size,f.dtype);return this.makeTensor(g,f.shape,f.dtype)}return u}),i(l.length>1?l:l[0],r,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=cA(t),s=new Set(e.map(r=>r.id));for(let r=0;r<this.state.activeScope.track.length;r++){const o=this.state.activeScope.track[r];!o.kept&&!s.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(r=>{!r.kept&&r.scopeId===i.id&&this.track(r)})}gradients(t,e,s,i=!1){if(P(e.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));P(r instanceof Tn,()=>"The result y returned by f() must be a tensor.");const o=yY(this.state.activeTape,e,r);if(!i&&o.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[r.id]=s??TY(r.shape),wY(a,o,l=>this.tidy(l),EY);const c=e.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const u of l.saved)u.dispose()}),this.state.activeTape=null),{value:r,grads:c}})}customGrad(t){return P(Zw(t),()=>"The f passed in customGrad(f) must be a function."),(...e)=>{P(e.every(a=>a instanceof Tn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const i={};e.forEach((a,c)=>{i[c]=a});const r=(a,c)=>(s=t(...e,c),P(s.value instanceof Tn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),P(Zw(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,c)=>{const l=s.gradFunc(a,c),u=Array.isArray(l)?l:[l];P(u.length===e.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),P(u.every(f=>f instanceof Tn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((f,g)=>{h[g]=()=>f}),h};return this.runKernelFunc({forwardFunc:r,backwardsFunc:o,inputs:i})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=Es(),s=await this.backend.time(t);return s.wallMs=Es()-e,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new SE;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Gl.nextTensorId=0;Gl.nextVariableId=0;function TY(n){const t=C1(ut(n),"float32");return q.makeTensor(t,n,"float32")}function uA(){const n=_R();if(n._tfengine==null){const t=new Y7(n);n._tfengine=new Gl(t)}return tY(n._tfengine.ENV),IY(()=>n._tfengine),n._tfengine}const q=uA();function EY(n,t){const e={a:n,b:t};return q.runKernel(au,e)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(){return typeof navigator<"u"&&navigator!=null}function hA(n){if(n||$Y()){if(n||(n=navigator),n.product==="ReactNative")return!0;const t=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!t){const e=n;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function dA(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=rt();Ds.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ds.registerFlag("IS_BROWSER",()=>dA());Ds.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ds.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ds.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ds.registerFlag("PROD",()=>!1);Ds.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ds.getBool("DEBUG"));Ds.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ds.registerFlag("IS_TEST",()=>!1);Ds.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ds.getBool("DEBUG"));Ds.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ds.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ds.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bx(n,t){let e=n;if(Fi(n))return t==="string"?[]:[n.length];if(oA(n)){const i=n.channels||"RGBA";return[n.height,n.width*i.length]}else if(aA(n))return[n.buffer.size/(t==null?4:km(t))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(e)||Fi(e)&&t!=="string";)s.push(e.length),e=e[0];return Array.isArray(n)&&rt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&fA(n,s,[]),s}function fA(n,t,e){if(e=e||[],!Array.isArray(n)&&!Fi(n)){P(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}P(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),P(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);const s=t.slice(1);for(let i=0;i<n.length;++i)fA(n[i],s,e.concat(i))}function _E(n,t,e,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${s}' must be ${n} tensor, but got ${t} tensor`)}}function W(n,t,e,s="numeric"){if(n instanceof ct())return _E(s,n.dtype,t,e),n;let i=ru(n);if(i!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),_E(s,i,t,e),n==null||!Fi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const c=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${c}'`)}const r=bx(n,i);!Fi(n)&&!Array.isArray(n)&&(n=[n]);const a=i!=="string"?Vc(n,i):Tc(n,[],!0);return q.makeTensor(a,r,i)}function pA(n,t,e,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((r,o)=>W(r,`${t}[${o}]`,e,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NY="__op";function J(n){const t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0];const s=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+NY;const i=(...r)=>{q.startScope(e);try{const o=s(...r);return I1(o)&&console.error("Cannot return a Promise inside of tidy."),q.endScope(o),o}catch(o){throw q.endScope(null),o}};return Object.defineProperty(i,"name",{value:e,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(n,t){const e=W(n,"real","complex"),s=W(t,"imag","complex");v1(e.shape,s.shape,`real and imag shapes, ${e.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:e,imag:s};return q.runKernel(A1,i)}const jl=J({complex_:RY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xx(n,t,e,s){if(s==null)s=ru(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(aA(n)||oA(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return q.backend.createTensorFromGPUData(n,t||e,s)}if(!Fi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Oo(t);const i=ut(t),r=ut(e);P(i===r,()=>`Based on the provided shape, [${t}], the tensor should have ${i} values but has ${r}`);for(let o=0;o<e.length;++o){const a=e[o],c=o===e.length-1?a!==ut(t.slice(o)):!0;P(e[o]===t[o]||!c,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!Fi(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=s!=="string"?Vc(n,s):Tc(n,[],!0),q.makeTensor(n,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gA(n,t,e){const s=bx(n,e);return xx(n,t,s,e)}class cu{static join(t){return new cu(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(s=>Fi(s)?s.buffer:s),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let s=0;s<t.length;s++){const i=t[s];s!==t.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const r=e+i.byteLength;this.shards.push({buffer:i,start:e,end:r}),e=r}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),e=Math.min(this.byteLength,e),e<=t)return new ArrayBuffer(0);const s=this.findShardForByte(t);if(s===-1)throw new Error(`Could not find start shard for byte ${t}`);const i=e-t,r=new ArrayBuffer(i),o=new Uint8Array(r);let a=0;for(let c=s;c<this.shards.length;c++){const l=this.shards[c],h=t+a-l.start,f=a,m=Math.min(e,l.end)-l.start,x=new Uint8Array(l.buffer,h,m-h);if(o.set(x,f),a+=x.length,e<l.end)break}return r}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(i){return t<i.start?-1:t>=i.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=AY(this.shards,e);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function AY(n,t){let e=0,s=n.length;for(;e<=s;){const i=Math.floor((s-e)/2)+e,r=t(n[i]);if(r===0)return i;r<0?s=i:e=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cr(){return q}function lv(){return q.memory()}function nt(n,t){return q.tidy(n,t)}function fe(n){cA(n).forEach(e=>e.dispose())}function Rr(n){return q.keep(n)}function mA(n,t,e=1){return q.registerBackend(n,t,e)}function DY(){return q.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TE=4;async function EE(n,t){const e=[],s=[],i=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<i.length;++o){const a=i[o],c=Array.isArray(n)?n[o].tensor:n[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);const l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const u=new Promise(async h=>{const f=await c.bytes(),g=f.reduce((b,y)=>b+y.length,0)+TE*f.length,m=new Uint8Array(g);let x=0;for(let b=0;b<f.length;b++){const y=f[b],v=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(v,x),x+=TE,m.set(y,x),x+=y.length}h(m)});s.push(u)}else s.push(c.data());t!=null&&(l.group=t),e.push(l)}const r=await Promise.all(s);return{data:OY(r),specs:e}}function OY(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0;const e=[];n.forEach(r=>{if(t+=r.byteLength,e.push(r.byteLength===r.buffer.byteLength?r:new r.constructor(r)),!(r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${r.constructor.name}`)});const s=new Uint8Array(t);let i=0;return e.forEach(r=>{s.set(new Uint8Array(r.buffer),i),i+=r.byteLength}),s.buffer}const pC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $E(n){return pC?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function PY(n){if(pC)return Buffer.from(n).toString("base64");const t=new Uint8Array(n);let e="";for(let s=0,i=t.length;s<i;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function FY(n){if(pC){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const t=atob(n),e=new Uint8Array(t.length);for(let s=0;s<t.length;++s)e.set([t.charCodeAt(s)],s);return e.buffer}function MY(n){return cu.join(n)}function bA(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:$E(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:$E(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new cu(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ds{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return ds.instance==null&&(ds.instance=new ds),ds.instance}static registerSaveRouter(t){ds.getInstance().saveRouters.push(t)}static registerLoadRouter(t){ds.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return ds.getHandlers(t,"save")}static getLoadHandlers(t,e){return ds.getHandlers(t,"load",e)}static getHandlers(t,e,s){const i=[];return(e==="load"?ds.getInstance().loadRouters:ds.getInstance().saveRouters).forEach(o=>{const a=o(t,s);a!==null&&i.push(a)}),i}}const LY=n=>ds.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uv="tensorflowjs",hv=1,pc="models_store",ia="model_info_store";function xA(){if(!rt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function dv(n){const t=n.result;t.createObjectStore(pc,{keyPath:"modelPath"}),t.createObjectStore(ia,{keyPath:"modelPath"})}class Ec{constructor(t){if(this.indexedDB=xA(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise((s,i)=>{const r=this.indexedDB.open(uv,hv);r.onupgradeneeded=()=>dv(r),r.onsuccess=()=>{const o=r.result;if(e==null){const a=o.transaction(pc,"readonly"),l=a.objectStore(pc).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=u=>(o.close(),i(l.error)),a.oncomplete=()=>o.close()}else{e.weightData=cu.join(e.weightData);const a=bA(e),c=o.transaction(ia,"readwrite");let l=c.objectStore(ia),u;try{u=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return i(f)}let h;u.onsuccess=()=>{h=o.transaction(pc,"readwrite");const f=h.objectStore(pc);let g;try{g=f.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:a})}catch(m){return i(m)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=m=>{l=c.objectStore(ia);const x=l.delete(this.modelPath);x.onsuccess=()=>(o.close(),i(g.error)),x.onerror=b=>(o.close(),i(g.error))}},u.onerror=f=>(o.close(),i(u.error)),c.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},r.onerror=o=>i(r.error)})}}Ec.URL_SCHEME="indexeddb://";const yA=n=>rt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ec.URL_SCHEME)?BY(n.slice(Ec.URL_SCHEME.length)):null;ds.registerSaveRouter(yA);ds.registerLoadRouter(yA);function BY(n){return new Ec(n)}function zY(n){return n.startsWith(Ec.URL_SCHEME)?n.slice(Ec.URL_SCHEME.length):n}class WY{constructor(){this.indexedDB=xA()}async listModels(){return new Promise((t,e)=>{const s=this.indexedDB.open(uv,hv);s.onupgradeneeded=()=>dv(s),s.onsuccess=()=>{const i=s.result,r=i.transaction(ia,"readonly"),a=r.objectStore(ia).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;t(c)},a.onerror=c=>(i.close(),e(a.error)),r.oncomplete=()=>i.close()},s.onerror=i=>e(s.error)})}async removeModel(t){return t=zY(t),new Promise((e,s)=>{const i=this.indexedDB.open(uv,hv);i.onupgradeneeded=()=>dv(i),i.onsuccess=()=>{const r=i.result,o=r.transaction(ia,"readwrite"),a=o.objectStore(ia),c=a.get(t);let l;c.onsuccess=()=>{if(c.result==null)return r.close(),s(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const u=a.delete(t),h=()=>{l=r.transaction(pc,"readwrite");const g=l.objectStore(pc).delete(t);g.onsuccess=()=>e(c.result.modelArtifactsInfo),g.onerror=m=>s(c.error)};u.onsuccess=h,u.onerror=f=>(h(),r.close(),s(c.error))}},c.onerror=u=>(r.close(),s(c.error)),o.oncomplete=()=>{l==null?r.close():l.oncomplete=()=>r.close()}},i.onerror=r=>s(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bo="/",Sl="tensorflowjs_models",wA="info",VY="model_topology",UY="weight_specs",HY="weight_data",GY="model_metadata";function vA(n){return{info:[Sl,n,wA].join(bo),topology:[Sl,n,VY].join(bo),weightSpecs:[Sl,n,UY].join(bo),weightData:[Sl,n,HY].join(bo),modelMetadata:[Sl,n,GY].join(bo)}}function CA(n){for(const t of Object.values(n))window.localStorage.removeItem(t)}function jY(n){const t=n.split(bo);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join(bo)}function qY(n){return n.startsWith($c.URL_SCHEME)?n.slice($c.URL_SCHEME.length):n}class $c{constructor(t){if(!rt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=vA(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),i=bA(t),r=cu.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,PY(r));const o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}}catch{throw CA(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=s;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=i;const r=this.LS.getItem(this.keys.modelMetadata);if(r!=null){const a=JSON.parse(r);e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,a.signature!=null&&(e.signature=a.signature),a.userDefinedMetadata!=null&&(e.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(e.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(e.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(e.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=FY(o),e}}$c.URL_SCHEME="localstorage://";const IA=n=>rt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith($c.URL_SCHEME)?KY(n.slice($c.URL_SCHEME.length)):null;ds.registerSaveRouter(IA);ds.registerLoadRouter(IA);function KY(n){return new $c(n)}class XY{constructor(){P(rt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),P(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},e=Sl+bo,s=bo+wA;for(let i=0;i<this.LS.length;++i){const r=this.LS.key(i);if(r.startsWith(e)&&r.endsWith(s)){const o=jY(r);t[o]=JSON.parse(this.LS.getItem(r))}}return t}async removeModel(t){t=qY(t);const e=vA(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);const s=JSON.parse(this.LS.getItem(e.info));return CA(e),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NE="://";class Ir{constructor(){this.managers={}}static getInstance(){return Ir.instance==null&&(Ir.instance=new Ir),Ir.instance}static registerManager(t,e){P(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(NE)&&(t=t.slice(0,t.indexOf(NE))),P(t.length>0,()=>"scheme must not be an empty string.");const s=Ir.getInstance();P(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=e}static getManager(t){const e=Ir.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Ir.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YY{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){if(typeof window>"u"||!rt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,e);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const i=this.functionRefs[s.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return YR(t)}}if(rt().get("IS_BROWSER")){rt().setPlatform("browser",new YY);try{Ir.registerManager($c.URL_SCHEME,new XY)}catch{}try{Ir.registerManager(Ec.URL_SCHEME,new WY)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY={importFetch:()=>require("node-fetch")};let sw;class ZY{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return rt().global.fetch!=null?rt().global.fetch(t,e):(sw==null&&(sw=JY.importFetch()),sw(t,e))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}rt().get("IS_NODE")&&!rt().get("IS_BROWSER")&&rt().setPlatform("node",new ZY);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ce(n,t="float32",e){return t=t||"float32",Oo(n),new jn(n,t,e)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(n,t){const e=W(n,"x","cast");if(!j7(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:e},i={dtype:t};return q.runKernel(Nd,s,i)}const Rt=J({cast_:QY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9(n){const e={x:W(n,"x","clone","string_or_numeric")};return q.runKernel(Ud,e)}const xc=J({clone_:t9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(n,t=!1){console.log(n.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */uA();const n9={buffer:ce,cast:Rt,clone:xc,print:e9};kY(n9);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9(n,t){let e=W(n,"a","add"),s=W(t,"b","add");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel(au,i)}const It=J({add_:s9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(n,t){let e=W(n,"a","floorDiv"),s=W(t,"b","floorDiv");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel(Wd,i)}const kA=J({floorDiv_:i9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r9(n,t){let e=W(n,"a","div"),s=W(t,"b","div");if([e,s]=bn(e,s),e.dtype==="int32"&&s.dtype==="int32")return kA(e,s);const i={a:e,b:s},r={};return q.runKernel(Pd,i,r)}const Ut=J({div_:r9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o9(n,t){let e=W(n,"a","mul"),s=W(t,"b","mul");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel(Zd,i)}const G=J({mul_:o9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a9(n){const t=W(n,"x","abs");if(t.dtype==="complex64"){const e={x:t};return q.runKernel(Ib,e)}else{const e={x:t};return q.runKernel(mb,e)}}const fs=J({abs_:a9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(n){const e={x:W(n,"x","acos")};return q.runKernel(Id,e)}const l9=J({acos_:c9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u9(n){const e={x:W(n,"x","acosh")};return q.runKernel(kd,e)}const h9=J({acosh_:u9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(n,t=null,e=!1){const i={x:W(n,"x","all","bool")},r={axis:t,keepDims:e};return q.runKernel(_1,i,r)}const SA=J({all_:d9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(n,t=null,e=!1){const i={x:W(n,"x","any","bool")},r={axis:t,keepDims:e};return q.runKernel(T1,i,r)}const fv=J({any_:f9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9(n,t=0){const s={x:W(n,"x","argMax")},i={axis:t};return q.runKernel(bb,s,i)}const Jh=J({argMax_:p9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(n,t=0){const s={x:W(n,"x","argMin")},i={axis:t};return q.runKernel(xb,s,i)}const m9=J({argMin_:g9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9(n){const e={x:W(n,"x","asin")};return q.runKernel(Sd,e)}const x9=J({asin_:b9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y9(n){const e={x:W(n,"x","asinh")};return q.runKernel(_d,e)}const w9=J({asinh_:y9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(n){const e={x:W(n,"x","atan")};return q.runKernel(Td,e)}const C9=J({atan_:v9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I9(n,t){let e=W(n,"a","atan2"),s=W(t,"b","atan2");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel($d,i)}const k9=J({atan2_:I9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(n){const e={x:W(n,"x","atanh")};return q.runKernel(Ed,e)}const _9=J({atanh_:S9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yf(n,t,e,s,i="NHWC",r){const o=n[3],a=[...t,o],c=Fo(i);return Xn(n,a,e,r,s,null,null,c)}function Li(n,t,e,s,i,r,o="channelsLast"){const[a,c]=Zh(t);let l;if(o==="channelsLast")l=[a,c,n[3],n[3]];else if(o==="channelsFirst")l=[a,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Xn(n,l,e,s,i,r,!1,o)}function Po(n,t,e,s,i,r,o="NDHWC"){const[a,c,l]=pv(t);let u,h;if(o==="NDHWC")h="channelsLast",u=[a,c,l,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",u=[a,c,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return _a(n,u,e,s,i,!1,h,r)}function Xn(n,t,e,s,i,r,o=!1,a="channelsLast"){let[c,l,u,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,u,h]=n;else if(a==="channelsFirst")[c,h,l,u]=n;else throw new Error(`Unknown dataFormat ${a}`);const[f,g,,m]=t,[x,b]=Zh(e),[y,v]=Zh(s),k=Ol(f,y),I=Ol(g,v),{padInfo:_,outHeight:$,outWidth:R}=$9(i,l,u,x,b,k,I,r,a),A=o?m*h:m;let F;return a==="channelsFirst"?F=[c,A,$,R]:a==="channelsLast"&&(F=[c,$,R,A]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:u,inChannels:h,outHeight:$,outWidth:R,outChannels:A,padInfo:_,strideHeight:x,strideWidth:b,filterHeight:f,filterWidth:g,effectiveFilterHeight:k,effectiveFilterWidth:I,dilationHeight:y,dilationWidth:v,inShape:n,outShape:F,filterShape:t}}function _a(n,t,e,s,i,r=!1,o="channelsLast",a){let[c,l,u,h,f]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[c,l,u,h,f]=n;else if(o==="channelsFirst")[c,f,l,u,h]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,m,x,,b]=t,[y,v,k]=pv(e),[I,_,$]=pv(s),R=Ol(g,I),A=Ol(m,_),F=Ol(x,$),{padInfo:L,outDepth:V,outHeight:j,outWidth:Z}=N9(i,l,u,h,y,v,k,R,A,F,a),et=r?b*f:b;let K;return o==="channelsFirst"?K=[c,et,V,j,Z]:o==="channelsLast"&&(K=[c,V,j,Z,et]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:u,inWidth:h,inChannels:f,outDepth:V,outHeight:j,outWidth:Z,outChannels:et,padInfo:L,strideDepth:y,strideHeight:v,strideWidth:k,filterDepth:g,filterHeight:m,filterWidth:x,effectiveFilterDepth:R,effectiveFilterHeight:A,effectiveFilterWidth:F,dilationDepth:I,dilationHeight:_,dilationWidth:$,inShape:n,outShape:K,filterShape:t}}function T9(n,t,e,s,i){s==null&&(s=gC(n,t,e));const r=n[0],o=n[1],a=Qh((r-t+2*s)/e+1,i),c=Qh((o-t+2*s)/e+1,i);return[a,c]}function E9(n,t,e,s,i,r){i==null&&(i=gC(n,t[0],s[0]));const o=[0,0,0,e];for(let a=0;a<3;a++)n[a]+2*i>=t[a]&&(o[a]=Qh((n[a]-t[a]+2*i)/s[a]+1,r));return o}function gC(n,t,e,s=1){const i=Ol(t,s);return Math.floor((n[0]*(e-1)-e+i)/2)}function Zh(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function pv(n){return typeof n=="number"?[n,n,n]:n}function Ol(n,t){return t<=1?n:n+(n-1)*(t-1)}function $9(n,t,e,s,i,r,o,a,c){let l,u,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=T9([t,e],r,s,n,a);u=g[0],h=g[1]}else if(n==="same"){u=Math.ceil(t/s),h=Math.ceil(e/i);const f=Math.max(0,(u-1)*s+r-t),g=Math.max(0,(h-1)*i+o-e),m=Math.floor(f/2),x=f-m,b=Math.floor(g/2),y=g-b;l={top:m,bottom:x,left:b,right:y,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-r+1)/s),h=Math.ceil((e-o+1)/i);else if(typeof n=="object"){const f=c==="channelsLast"?n[1][0]:n[2][0],g=c==="channelsLast"?n[1][1]:n[2][1],m=c==="channelsLast"?n[2][0]:n[3][0],x=c==="channelsLast"?n[2][1]:n[3][1];l={top:f,bottom:g,left:m,right:x,type:f===0&&g===0&&m===0&&x===0?"VALID":"EXPLICIT"},u=Qh((t-r+f+g)/s+1,a),h=Qh((e-o+m+x)/i+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:u,outWidth:h}}function N9(n,t,e,s,i,r,o,a,c,l,u){let h,f,g,m;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=E9([t,e,s,1],[a,c,l],1,[i,r,o],n,u);f=b[0],g=b[1],m=b[2]}else if(n==="same"){f=Math.ceil(t/i),g=Math.ceil(e/r),m=Math.ceil(s/o);const x=(f-1)*i+a-t,b=(g-1)*r+c-e,y=(m-1)*o+l-s,v=Math.floor(x/2),k=x-v,I=Math.floor(b/2),_=b-I,$=Math.floor(y/2),R=y-$;h={top:I,bottom:_,left:$,right:R,front:v,back:k,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:f,outHeight:g,outWidth:m}}function Qh(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function Nc(n){const[t,e,s]=Zh(n);return t===1&&e===1&&s===1}function is(n,t){return Nc(n)||Nc(t)}function Rc(n){return Zh(n).every(t=>t>0)}function Fo(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Ps(n,t,e){if(e!=null){if(typeof t=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);if(typeof t=="number")P(Ul(t),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);else if(typeof t=="object")t.forEach(s=>{s.forEach(i=>{P(Ul(i),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${i}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(n,t){const s={x:W(n,"x","reshape","string_or_numeric")},i={shape:t};return q.runKernel(sx,s,i)}const Y=J({reshape_:R9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(n,t,e,s,i){const r=W(n,"x","avgPool","float32"),o=1;P(is(e,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`);let a=r,c=!1;r.rank===3&&(c=!0,a=Y(r,[1,r.shape[0],r.shape[1],r.shape[2]])),P(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ps("avgPool",s,i);const l={x:a},u={filterSize:t,strides:e,pad:s,dimRoundingMode:i};let h=q.runKernel(yb,l,u);return h=Rt(h,r.dtype),c?Y(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const mC=J({avgPool_:A9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(n,t,e,s,i,r="NDHWC"){const o=W(n,"x","avgPool3d","float32");let a=o,c=!1;o.rank===4&&(c=!0,a=Y(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),P(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),P(r==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),P(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),Ps("avgPool3d",s,i);const l={x:a},u={filterSize:t,strides:e,pad:s,dimRoundingMode:i,dataFormat:r};let h=q.runKernel(wb,l,u);return h=Rt(h,a.dtype),c?Y(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const O9=J({avgPool3d_:D9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(n,t=0){P(n.length>=1,()=>"Pass at least one tensor to concat");const e=pA(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(r=>{if(r.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${r.dtype}. `)}),e.length===1)return xc(e[0]);const s=e,i={axis:t};return q.runKernel(kb,s,i)}const Rs=J({concat_:P9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F9(n,t,e=!1,s=!1){let i=W(n,"a","matMul"),r=W(t,"b","matMul");[i,r]=bn(i,r);const o={a:i,b:r},a={transposeA:e,transposeB:s};return q.runKernel(vb,o,a)}const Ne=J({matMul_:F9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M9(n){const e={x:W(n,"x","sigmoid","float32")};return q.runKernel(uf,e)}const lu=J({sigmoid_:M9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(n,t,e){const s=W(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const i={x:s},r={begin:t,size:e};return q.runKernel(cx,i,r)}const qe=J({slice_:L9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B9(n){const e={x:W(n,"x","tanh","float32")};return q.runKernel(mf,e)}const yx=J({tanh_:B9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(n,t,e){const s=W(n,"x","batchToSpaceND"),i=t.reduce((a,c)=>a*c);P(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),P(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),P(s.shape[0]%i===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`);const r={x:s},o={blockShape:t,crops:e};return q.runKernel(Cb,r,o)}const bC=J({batchToSpaceND_:z9});function W9(n){let t;return n.rank===0||n.rank===1?t=Y(n,[1,1,1,n.size]):n.rank===2?t=Y(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=Y(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(n,t,e,s,i,r){r==null&&(r=.001);const o=W(n,"x","batchNorm"),a=W(t,"mean","batchNorm"),c=W(e,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let u;s!=null&&(u=W(s,"offset","batchNorm")),P(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),P(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),P(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:W9(o),scale:l,offset:u,mean:a,variance:c},g={varianceEpsilon:r},m=q.runKernel(Db,f,g);return Y(m,o.shape)}const wx=J({batchNorm_:V9});function U9(n,t,e,s,i,r){const o=W(n,"x","batchNorm"),a=W(t,"mean","batchNorm"),c=W(e,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let u;return s!=null&&(u=W(s,"offset","batchNorm")),P(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),P(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),P(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&P(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&P(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),wx(o,a,c,u,l,r)}const H9=J({batchNorm2d_:U9});function G9(n,t,e,s,i,r){const o=W(n,"x","batchNorm"),a=W(t,"mean","batchNorm"),c=W(e,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let u;return s!=null&&(u=W(s,"offset","batchNorm")),P(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),P(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),P(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&P(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&P(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),wx(o,a,c,u,l,r)}const j9=J({batchNorm3d_:G9});function q9(n,t,e,s,i,r){const o=W(n,"x","batchNorm"),a=W(t,"mean","batchNorm"),c=W(e,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let u;return s!=null&&(u=W(s,"offset","batchNorm")),P(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),P(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),P(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&P(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&P(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),wx(o,a,c,u,l,r)}const K9=J({batchNorm4d_:q9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(n,t,e){const s=W(n,"x","bincount"),i=W(t,"weights","bincount");P(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),P(e>=0,()=>`size must be non-negative, but got ${e}.`),P(i.size===s.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${i.shape}.`);const r={x:s,weights:i},o={size:e};return q.runKernel(N1,r,o)}const Y9=J({bincount_:X9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9(n,t){let e=W(n,"broadcastTo","x");const s=e.shape;if(Oo(t),t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){const l=e.shape.slice();for(;l.length<t.length;)l.unshift(1);e=Y(e,l)}const i=e.shape,r=Array.from(t);for(let l=t.length-1;l>=0;l--)if(i[l]===t[l])r[l]=1;else if(e.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(r.map((l,u)=>l>1?u:-1).filter(l=>l>=0).length===0)return xc(e);const a={x:e},c={reps:r};return q.runKernel(bf,a,c)}const Fh=J({broadcastTo_:J9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z9(n){const e={x:W(n,"x","ceil","float32")};return q.runKernel(Rd,e)}const Q9=J({ceil_:Z9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vx(n,t,e){Oo(n),e=e||ru(t);const s={shape:n,value:t,dtype:e};return q.runKernel(G1,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tJ(n,t,e){const s=W(n,"x","clipByValue");if(P(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`),t===e)return vx(s.shape,t,s.dtype);const i={x:s},r={clipValueMin:t,clipValueMax:e};return q.runKernel(Ad,i,r)}const ui=J({clipByValue_:tJ});function eJ(n){return Rs(n,0)}const nJ=J({concat1d_:eJ});function sJ(n,t){return Rs(n,t)}const iJ=J({concat2d_:sJ});function rJ(n,t){return Rs(n,t)}const oJ=J({concat3d_:rJ});function aJ(n,t){return Rs(n,t)}const cJ=J({concat4d_:aJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(n,t,e,s,i="NHWC",r=[1,1],o){const a=W(n,"x","conv2d","float32"),c=W(t,"filter","conv2d","float32");let l=a,u=!1;a.rank===3&&(u=!0,l=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),P(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),P(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),Ps("conv2d",s,o);const h=i==="NHWC"?l.shape[3]:l.shape[1];P(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),P(is(e,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${r}'`),P(Rc(r),()=>"Error in conv2D: Dilated rates should be larger than 0."),P(Rc(e),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:l,filter:c},g={strides:e,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},m=q.runKernel(Sb,f,g);return u?Y(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Ac=J({conv2d_:lJ});function uJ(n,t,e,s,i="NWC",r=1,o){const a=W(n,"x","conv1d"),c=W(t,"filter","conv1d");let l=a,u=!1;a.rank===2&&(u=!0,l=Y(a,[1,a.shape[0],a.shape[1]])),P(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),P(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),Ps("conv1d",s,o),P(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),P(is(e,r),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${r}'`),P(Rc(r),()=>"Error in conv1D: Dilated rates should be larger than 0."),P(Rc(e),()=>"Error in conv1D: Stride should be larger than 0."),P(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const h=Y(c,[1,c.shape[0],c.shape[1],c.shape[2]]),f=Y(l,[l.shape[0],1,l.shape[1],l.shape[2]]),b=Ac(f,h,[1,e],s,"NHWC",[1,r],o);return u?Y(b,[b.shape[2],b.shape[3]]):Y(b,[b.shape[0],b.shape[2],b.shape[3]])}const _A=J({conv1d_:uJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(n,t,e,s,i,r="NHWC",o){P(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let a=n,c=t,l=!1;t.rank===3&&(l=!0,c=Y(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,n[0],n[1],n[2]]),P(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),P(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),P(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);const u=r==="NHWC"?a[3]:a[1],h=r==="NHWC"?c.shape[3]:c.shape[1];P(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),P(h===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${e.shape[3]}.`),Ps("conv2dDerInput",i,o);const f={dy:c,filter:e},g={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,inputShape:a},m=q.runKernel(_b,f,g);return l?Y(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const xC=J({conv2DBackpropInput_:hJ});function dJ(n,t,e,s,i,r){const o=W(n,"x","conv2dTranspose"),a=W(t,"filter","conv2dTranspose");return xC(e,o,a,s,i,"NHWC",r)}const TA=J({conv2dTranspose_:dJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fJ(n,t,e,s,i="NDHWC",r=[1,1,1]){const o=W(n,"x","conv3d"),a=W(t,"filter","conv3d");let c=o,l=!1;o.rank===4&&(l=!0,c=Y(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),P(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),P(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),P(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),P(is(e,r),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${r}'`),P(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),P(Rc(r),()=>"Error in conv3D: Dilated rates should be larger than 0."),P(Rc(e),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:c,filter:a},h={strides:e,pad:s,dataFormat:i,dilations:r},f=q.runKernel(Tb,u,h);return l?Y(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const pJ=J({conv3d_:fJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(n,t,e,s,i){P(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let r=n,o=t,a=!1;t.rank===4&&(a=!0,o=Y(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),r=[1,n[0],n[1],n[2],n[3]]);const c=r[4],l=o.shape[4];P(r.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${r.length}.`),P(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),P(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),P(c===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${e.shape[3]}.`),P(l===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${e.shape[4]}.`);const u={dy:o,filter:e},h={pad:i,strides:s,inputShape:r},f=q.runKernel(P1,u,h);return a?Y(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const EA=J({conv3DBackpropInput_:gJ});function mJ(n,t,e,s,i){const r=W(n,"x","conv3dTranspose"),o=W(t,"filter","conv3dTranspose");return EA(e,r,o,s,i)}const bJ=J({conv3dTranspose_:mJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xJ(n){const e={x:W(n,"x","cos","float32")};return q.runKernel(Dd,e)}const yC=J({cos_:xJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yJ(n){const e={x:W(n,"x","cosh","float32")};return q.runKernel(Od,e)}const $A=J({cosh_:yJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wJ(n,t=0,e=!1,s=!1){const r={x:W(n,"x","cumprod")},o={axis:t,exclusive:e,reverse:s};return q.runKernel(F1,r,o)}const gv=J({cumprod_:wJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vJ(n,t=0,e=!1,s=!1){const r={x:W(n,"x","cumsum")},o={axis:t,exclusive:e,reverse:s};return q.runKernel(Eb,r,o)}const NA=J({cumsum_:vJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CJ(n,t,e,s=!1){const i=W(n,"x","denseBincount"),r=W(t,"weights","denseBincount");P(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),P(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),P(e>=0,()=>`size must be non-negative, but got ${e}.`),P(r.size===i.size||r.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${r.shape}.`);const o={x:i,weights:r},a={size:e,binaryOutput:s};return q.runKernel(L1,o,a)}const RE=J({denseBincount_:CJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IJ(n,t,e="NHWC"){const s=W(n,"x","depthToSpace","float32"),i=e==="NHWC"?s.shape[1]:s.shape[2],r=e==="NHWC"?s.shape[2]:s.shape[3],o=e==="NHWC"?s.shape[3]:s.shape[1];P(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),P(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t}  for depthToSpace with input shape
    ${s.shape}`),P(r*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${t} for depthToSpace with input shape
        ${s.shape}`),P(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},c={blockSize:t,dataFormat:e};return q.runKernel(B1,a,c)}const kJ=J({depthToSpace_:IJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SJ(n,t,e,s,i="NHWC",r=[1,1],o){const a=W(n,"x","depthwiseConv2d","float32"),c=W(t,"filter","depthwiseConv2d","float32");let l=a,u=!1;a.rank===3&&(u=!0,l=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),P(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),P(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=i==="NHWC"?l.shape[3]:l.shape[1];P(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),Ps("depthwiseConv2d",s,o);const f={x:l,filter:c},g={strides:e,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},m=q.runKernel($b,f,g);return u?Y(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const wC=J({depthwiseConv2d_:SJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _J(n,t,e,s,i=[1,1],r="NHWC"){const o=W(n,"x","dilation2d"),a=W(t,"filter","dilation2d");P(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),P(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),P(r==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${r}`);let c=o,l=!1;o.rank===3&&(c=Y(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),P(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);const u={x:c,filter:a},h={strides:e,pad:s,dilations:i},f=q.runKernel(Nb,u,h);return l?Y(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const TJ=J({dilation2d_:_J});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ql(n,t){const e=n.length,s=[];for(let i=0;i<e;i++){const r=e-1-i,o=n[r]||1;(t[t.length-1-i]||1)>1&&o===1&&s.unshift(r)}return s}function Dn(n,t){const e=[];for(let s=0;s<t.length;s++){const i=n[n.length-s-1],r=t.length-s-1,o=t[r];(i==null||i===1&&o>1)&&e.unshift(r)}return e}function ee(n,t){const e=Math.max(n.length,t.length),s=new Array(e);for(let i=0;i<e;i++){let r=n[n.length-i-1];r==null&&(r=1);let o=t[t.length-i-1];if(o==null&&(o=1),r===1)s[e-i-1]=o;else if(o===1)s[e-i-1]=r;else if(r!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(a)}else s[e-i-1]=r}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EJ(n,t){let e=W(n,"a","equal","string_or_numeric"),s=W(t,"b","equal","string_or_numeric");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Rb,i)}const Pr=J({equal_:EJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $J(n,t,e){const s=W(t,"a","where"),i=W(e,"b","where"),r=W(n,"condition","where","bool"),o=ee(ee(r.shape,s.shape),i.shape),a=Fh(r,o),c=Fh(s,o),l=Fh(i,o),u={condition:a,t:c,e:l};return q.runKernel(ax,u)}const ys=J({where_:$J});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NJ(n){const e={x:W(n,"x","zerosLike")};return q.runKernel(gx,e)}const ke=J({zerosLike_:NJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RJ(n,t){let e=W(n,"a","div"),s=W(t,"b","div");[e,s]=bn(e,s);const i=Ut(e,s),r=ke(i),o=Pr(s,r);return ys(o,r,i)}const AJ=J({divNoNan_:RJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DJ(n,t){const e=W(n,"t1","dot"),s=W(t,"t2","dot");P((e.rank===1||e.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${s.rank}.`);const i=e.rank===1?e.size:e.shape[1],r=s.rank===1?s.size:s.shape[0];if(P(i===r,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${r}.`),e.rank===1&&s.rank===1){const o=Y(e,[1,-1]),a=Y(s,[-1,1]),c=Ne(o,a);return Y(c,[])}else if(e.rank===1&&s.rank===2){const o=Y(e,[1,-1]),a=Y(s,[s.shape[0],s.shape[1]]),c=Ne(o,a);return Y(c,[c.size])}else if(e.rank===2&&s.rank===1){const o=Y(s,[-1,1]),a=Ne(e,o);return Y(a,[a.size])}else{const o=Y(s,[s.shape[0],s.shape[1]]);return Ne(e,o)}}const OJ=J({dot_:DJ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PJ(n,...t){const e=t.map((i,r)=>W(i,`tensors${r}`,"einsum")),s={equation:n};return q.runKernel(V1,e,s)}const hh=J({einsum_:PJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FJ(n){const e={x:W(n,"x","elu","float32")};return q.runKernel(Fd,e)}const Cx=J({elu_:FJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(n){let t=W(n,"x","erf");P(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=Rt(t,"float32"));const e={x:t};return q.runKernel(Md,e)}const RA=J({erf_:MJ});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vC(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function AA(n,t,e){const s=n.length+t.length,i=[];let r=0,o=0;for(let a=0;a<s;a++)e.indexOf(a)===-1?i.push(n[r++]):i.push(t[o++]);return i}function Vn(n,t){const e=[],s=n.length;for(let r=0;r<s;r++)t.indexOf(r)===-1&&e.push(n[r]);const i=t.map(r=>n[r]);return[e,i]}function _n(n,t){const e=t.map(s=>1);return AA(n,e,t)}function Yn(n,t,e){P(vC(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function un(n,t){if(vC(n,t))return null;const e=[];for(let s=0;s<t;++s)n.indexOf(s)===-1&&e.push(s);return n.forEach(s=>e.push(s)),e}function Ta(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function xn(n,t){const e=[];for(let s=t-n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(n,t=null,e=!1){const i={x:W(n,"x","max")},r={reductionIndices:t,keepDims:e};return q.runKernel(Ub,i,r)}const ir=J({max_:LJ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BJ(n,t=null,e=!1){const i={x:W(n,"x","min")},r={axis:t,keepDims:e};return q.runKernel(qb,i,r)}const Nm=J({min_:BJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(n,t){let e=W(n,"base","pow"),s=W(t,"exp","pow");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel(Qd,i)}const Dc=J({pow_:zJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ae(n,t){if((Fi(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Fi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xx(n,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(n){const e={x:W(n,"x","sqrt","float32")};return q.runKernel(df,e)}const ss=J({sqrt_:WJ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(n){const t=W(n,"x","square"),e={};return q.runKernel("Square",{x:t},e)}const Qe=J({square_:VJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UJ(n,t=null,e=!1){let s=W(n,"x","sum");s.dtype==="bool"&&(s=Rt(s,"int32"));const i={x:s},r={axis:t,keepDims:e};return q.runKernel(lx,i,r)}const Vt=J({sum_:UJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(n,t="euclidean",e=null,s=!1){n=W(n,"x","norm");const i=DA(n,t,e);let r=i.shape;if(s){const o=le(e,n.shape);r=_n(i.shape,o)}return Y(i,r)}function DA(n,t,e=null){if(n.rank===0)return fs(n);if(n.rank!==1&&e===null)return DA(Y(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return Vt(fs(n),e);if(t===1/0)return ir(fs(n),e);if(t===-1/0)return Nm(fs(n),e);if(t==="euclidean"||t===2)return ss(Vt(Dc(fs(n),Ae(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return ir(Vt(fs(n),e[0]),e[1]-1);if(t===1/0)return ir(Vt(fs(n),e[1]),e[0]);if(t===-1/0)return Nm(Vt(fs(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return ss(Vt(Qe(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}const Ix=J({norm_:HJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GJ(n,t=null,e=!1){return Ix(n,"euclidean",t,e)}const jJ=J({euclideanNorm_:GJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qJ(n){const e={x:W(n,"x","exp")};return q.runKernel(Ld,e)}const Fr=J({exp_:qJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KJ(n,t=0){const e=W(n,"x","expandDims","string_or_numeric");P(t<=e.rank,()=>"Axis must be <= rank of the tensor");const s={input:e},i={dim:t};return q.runKernel(Ab,s,i)}const $s=J({expandDims_:KJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(n){const e={x:W(n,"x","expm1")};return q.runKernel(Bd,e)}const YJ=J({expm1_:XJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JJ(n,t){const e=W(n,"x","tile","string_or_numeric");P(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);const s={x:e},i={reps:t};return q.runKernel(bf,s,i)}const Qi=J({tile_:JJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZJ(n,t,e,s="float32"){t==null&&(t=n);const i=ce([n,t],s),r=n<=t?n:t;for(let a=0;a<r;++a)i.set(1,a,a);const o=Y(i.toTensor(),[n,t]);if(e==null)return o;if(e.length===1)return Qi($s(o,0),[e[0],1,1]);if(e.length===2)return Qi($s($s(o,0),0),[e[0],e[1],1,1]);if(e.length===3)return Qi($s($s($s(o,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}const OA=J({eye_:ZJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QJ(n){const e={x:W(n,"x","floor","float32")};return q.runKernel(zd,e)}const kx=J({floor_:QJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tZ(n,t,e=0,s=0){const i=W(n,"x","gather"),r=W(t,"indices","gather","int32"),o={x:i,indices:r},a={axis:e,batchDims:s};return q.runKernel(Ob,o,a)}const CC=J({gather_:tZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZ(n,t){let e=W(n,"a","greater","string_or_numeric"),s=W(t,"b","greater","string_or_numeric");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Pb,i)}const hi=J({greater_:eZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(n,t){let e=W(n,"a","greaterEqual","string_or_numeric"),s=W(t,"b","greaterEqual","string_or_numeric");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Vd,i)}const Uc=J({greaterEqual_:nZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(n){const e={input:W(n,"input","imag")};return q.runKernel(K1,e)}const IC=J({imag_:sZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iZ(n){const e={x:W(n,"x","isFinite")};return q.runKernel(Hd,e)}const rZ=J({isFinite_:iZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oZ(n){const e={x:W(n,"x","isInf")};return q.runKernel(Gd,e)}const aZ=J({isInf_:oZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cZ(n){const e={x:W(n,"x","isNaN")};return q.runKernel(jd,e)}const lZ=J({isNaN_:cZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(n,t=.2){const s={x:W(n,"x","leakyRelu")},i={alpha:t};return q.runKernel(Fb,s,i)}const kC=J({leakyRelu_:uZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(n,t){let e=W(n,"a","less","string_or_numeric"),s=W(t,"b","less","string_or_numeric");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Mb,i)}const Rm=J({less_:hZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dZ(n,t){let e=W(n,"a","lessEqual","string_or_numeric"),s=W(t,"b","lessEqual","string_or_numeric");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Lb,i)}const uu=J({lessEqual_:dZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(n,t=5,e=1,s=1,i=.5){const r=W(n,"x","localResponseNormalization");P(r.rank===4||r.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${r.rank}.`),P(Ul(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=r,a=!1;r.rank===3&&(a=!0,o=Y(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const c={x:o},l={depthRadius:t,bias:e,alpha:s,beta:i},u=q.runKernel(Vb,c,l);return a?Y(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const pZ=J({localResponseNormalization_:fZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(n){const e={x:W(n,"x","log","float32")};return q.runKernel(qd,e)}const Mr=J({log_:gZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(n){const e={x:W(n,"x","log1p")};return q.runKernel(Kd,e)}const PA=J({log1p_:mZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(n,t){P(Zw(n),()=>"The f passed in variableGrads(f) must be a function"),P(t==null||Array.isArray(t)&&t.every(l=>l instanceof $m),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const e=t!=null;if(!e){t=[];for(const l in q.registeredVariables)t.push(q.registeredVariables[l])}const s=e?t.filter(l=>!l.trainable):null,i=t.length;t=t.filter(l=>l.trainable),P(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const r=!0,{value:o,grads:a}=q.gradients(n,t,null,r);P(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),P(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const c={};return t.forEach((l,u)=>{a[u]!=null&&(c[l.name]=a[u])}),s!=null&&s.forEach(l=>c[l.name]=null),{value:o,grads:c}}function Kl(n){return q.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xZ(n){const e={x:W(n,"x","neg")};return q.runKernel(Xb,e)}const mn=J({neg_:xZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(n){const e={x:W(n,"x","softplus")};return q.runKernel(hf,e)}const wf=J({softplus_:yZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(n){const t=W(n,"x","logSigmoid");return Kl(s=>({value:mn(wf(mn(s))),gradFunc:o=>G(o,lu(mn(s)))}))(t)}const vZ=J({logSigmoid_:wZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(n,t){let e=W(n,"a","sub"),s=W(t,"b","sub");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel(pf,i)}const jt=J({sub_:CZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IZ(n,t=-1){const e=W(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return Kl((i,r)=>{const a=ir(i,t,!0),c=jt(i,a),l=jt(Rt(c,"float32"),Mr(Vt(Fr(c),t,!0)));return r([l]),{value:l,gradFunc:(h,f)=>{const[g]=f,m=!0,x=Fr(g);return jt(h,G(Vt(h,t,m),x))}}})(e)}const FA=J({logSoftmax_:IZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kZ(n,t=null,e=!1){const s=W(n,"x","logSumExp"),i=le(t,s.shape),r=ir(s,i,!0),o=jt(s,r),a=Fr(o),c=Vt(a,i),l=Mr(c),u=It(Y(r,l.shape),l);if(e){const h=_n(u.shape,i);return Y(u,h)}return u}const MA=J({logSumExp_:kZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(n,t){const e=W(n,"a","logicalAnd","bool"),s=W(t,"b","logicalAnd","bool");ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Bb,i)}const Eo=J({logicalAnd_:SZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(n){const e={x:W(n,"x","logicalNot","bool")};return q.runKernel(zb,e)}const SC=J({logicalNot_:_Z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TZ(n,t){const e=W(n,"a","logicalOr","bool"),s=W(t,"b","logicalOr","bool");ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Wb,i)}const LA=J({logicalOr_:TZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZ(n,t){const e=W(n,"a","logicalXor","bool"),s=W(t,"b","logicalXor","bool");return ee(e.shape,s.shape),Eo(LA(n,t),SC(Eo(n,t)))}const $Z=J({logicalXor_:EZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(n,t,e,s,i){const r=W(n,"x","maxPool"),o=1;let a=r,c=!1;r.rank===3&&(c=!0,a=Y(r,[1,r.shape[0],r.shape[1],r.shape[2]])),P(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),P(is(e,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`),Ps("maxPool",s,i);const l={x:a},u={filterSize:t,strides:e,pad:s,dimRoundingMode:i},h=q.runKernel(Hb,l,u);return c?Y(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const _C=J({maxPool_:NZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(n,t=[1,1,1],e,s,i,r="NDHWC"){const o=W(n,"x","maxPool3d");let a=o,c=!1;o.rank===4&&(c=!0,a=Y(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),P(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),P(r==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),Ps("maxPool3d",s,i);const l={x:a},u={filterSize:t,strides:e,pad:s,dimRoundingMode:i,dataFormat:r},h=q.runKernel(Gb,l,u);return c?Y(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const AZ=J({maxPool3d_:RZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(n,t){let e=W(n,"a","maximum"),s=W(t,"b","maximum");[e,s]=bn(e,s),e.dtype==="bool"&&(e=Rt(e,"int32"),s=Rt(s,"int32")),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Xd,i)}const Ea=J({maximum_:DZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(n,t=null,e=!1){const i={x:W(n,"x","mean")},r={axis:t,keepDims:e};return q.runKernel(jb,i,r)}const kn=J({mean_:OZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bn(n,t="float32"){if(Oo(n),t==="complex64"){const s=Bn(n,"float32"),i=Bn(n,"float32");return jl(s,i)}const e=ns(ut(n),t);return q.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(n,t="float32"){if(Oo(n),t==="complex64"){const s=$a(n,"float32"),i=Bn(n,"float32");return jl(s,i)}const e=C1(ut(n),t);return q.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(n,t){let e=W(n,"a","minimum"),s=W(t,"b","minimum");[e,s]=bn(e,s),e.dtype==="bool"&&(e=Rt(e,"int32"),s=Rt(s,"int32")),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Yd,i)}const td=J({minimum_:PZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(n,t,e){P(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);const s=W(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");P(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);const i=e==="reflect"?1:0;for(let a=0;a<s.rank;a++)P(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),P(t[a][0]>=0&&t[a][0]<=s.shape[a]-i&&t[a][1]>=0&&t[a][1]<=s.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-i} or less than 0 for input of shape ${s.shape}`);const r={paddings:t,mode:e},o={x:s};return q.runKernel(Kb,o,r)}const MZ=J({mirrorPad_:FZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LZ(n,t){let e=W(n,"a","mod"),s=W(t,"b","mod");[e,s]=bn(e,s);const i={a:e,b:s};return q.runKernel(Jd,i)}const BZ=J({mod_:LZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(n,t=null,e=!1){n=W(n,"x","moments");const s=le(t,n.shape),i=kn(n,s,e);let r=i.shape;e||(r=_n(i.shape,s));const o=Qe(jt(Rt(n,"float32"),Y(i,r))),a=kn(o,s,e);return{mean:i,variance:a}}const TC=J({moments_:zZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(n,t){let e=W(n,"a","notEqual","string_or_numeric"),s=W(t,"b","notEqual","string_or_numeric");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s};return q.runKernel(Yb,i)}const Am=J({notEqual_:WZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(n,t,e=1,s=0,i="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:W(n,"indices","oneHot","int32")},a={dtype:i,depth:t,onValue:e,offValue:s};return q.runKernel(Zb,o,a)}const BA=J({oneHot_:VZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(n){const e={x:W(n,"x","onesLike")};return q.runKernel(Jb,e)}const Mi=J({onesLike_:UZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(n,t,e=0){const s=W(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:t,constantValue:e},r={x:s};return q.runKernel(tx,r,i)}const EC=J({pad_:HZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(n,t,e){const s=W(n,"x","spaceToBatchND");P(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),P(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),P(s.shape.reduce((o,a,c)=>c>0&&c<=t.length?o&&(a+e[c-1][0]+e[c-1][1])%t[c-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);const i={x:s},r={blockShape:t,paddings:e};return q.runKernel(ux,i,r)}const $C=J({spaceToBatchND_:GZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jZ(n,t,e,s,i,r,o){i==null&&(i=[1,1]),r==null&&(r=1),s===0&&(s="valid");const a=W(n,"x","maxPool");let c=a,l=!1;a.rank===3&&(l=!0,c=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),P(is(r,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`);const u=Li(c.shape,t,r,i,s),h=[u.dilationHeight,u.dilationWidth];let f;s==="same"?f=KZ([u.filterHeight,u.filterWidth],h):f=[[0,0],[0,0]];const g=h[0]===1&&h[1]===1,[m,x]=qZ([u.inHeight,u.inWidth],h,f),b=g?s:"valid",y=g?c:$C(c,h,m),k=(e==="avg"?()=>mC(y,t,r,b,o):()=>_C(y,t,r,b,o))(),I=g?k:bC(k,h,x);return l?Y(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function qZ(n,t,e){const s=e.map(u=>u[0]),i=e.map(u=>u[1]),r=n.concat(s,i),o=t.map((u,h)=>(u-r[h]%u)%u),a=i.map((u,h)=>u+o[h]),c=t.map((u,h)=>[s[h],a[h]]),l=t.map((u,h)=>[0,o[h]]);return[c,l]}function KZ(n,t){const s=n.map((o,a)=>o+(o-1)*(t[a]-1)).map(o=>o-1),i=s.map(o=>Math.floor(o/2)),r=s.map((o,a)=>o-i[a]);return s.map((o,a)=>[i[a],r[a]])}const XZ=J({pool_:jZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(n,t){const e=W(n,"x","prelu"),s=W(t,"alpha","prelu"),i={x:e,alpha:s};return q.runKernel(ex,i)}const NC=J({prelu_:YZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JZ(n,t=null,e=!1){let s=W(n,"x","prod");s.dtype==="bool"&&(s=Rt(s,"int32"));const i={x:s},r={axis:t,keepDims:e};return q.runKernel(nx,i,r)}const ZZ=J({prod_:JZ});var RC={exports:{}};RC.exports;(function(n){(function(t,e,s){function i(c){var l=this,u=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(c),l.s0<0&&(l.s0+=1),l.s1-=u(c),l.s1<0&&(l.s1+=1),l.s2-=u(c),l.s2<0&&(l.s2+=1),u=null}function r(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function o(c,l){var u=new i(c),h=l&&l.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&r(h,u),f.state=function(){return r(u,{})}),f}function a(){var c=4022871197,l=function(u){u=String(u);for(var h=0;h<u.length;h++){c+=u.charCodeAt(h);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(Ti,n,!1)})(RC);var QZ=RC.exports,AC={exports:{}};AC.exports;(function(n){(function(t,e,s){function i(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},a===(a|0)?c.x=a:l+=a;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,c.next()}function r(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function o(a,c){var l=new i(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,m=(f+g)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&r(u,l),h.state=function(){return r(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(Ti,n,!1)})(AC);var tQ=AC.exports,DC={exports:{}};DC.exports;(function(n){(function(t,e,s){function i(a){var c=this,l="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,u==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function r(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function o(a,c){var l=new i(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,m=(f+g)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&r(u,l),h.state=function(){return r(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(Ti,n,!1)})(DC);var eQ=DC.exports,OC={exports:{}};OC.exports;(function(n){(function(t,e,s){function i(a){var c=this;c.next=function(){var u=c.x,h=c.i,f,g;return f=u[h],f^=f>>>7,g=f^f<<24,f=u[h+1&7],g^=f^f>>>10,f=u[h+3&7],g^=f^f>>>3,f=u[h+4&7],g^=f^f<<7,f=u[h+7&7],f=f^f<<13,g^=f^f<<9,u[h]=g,c.i=h+1&7,g};function l(u,h){var f,g=[];if(h===(h|0))g[0]=h;else for(h=""+h,f=0;f<h.length;++f)g[f&7]=g[f&7]<<15^h.charCodeAt(f)+g[f+1&7]<<13;for(;g.length<8;)g.push(0);for(f=0;f<8&&g[f]===0;++f);for(f==8?g[7]=-1:g[f],u.x=g,u.i=0,f=256;f>0;--f)u.next()}l(c,a)}function r(a,c){return c.x=a.x.slice(),c.i=a.i,c}function o(a,c){a==null&&(a=+new Date);var l=new i(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,m=(f+g)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,u&&(u.x&&r(u,l),h.state=function(){return r(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(Ti,n,!1)})(OC);var nQ=OC.exports,PC={exports:{}};PC.exports;(function(n){(function(t,e,s){function i(a){var c=this;c.next=function(){var u=c.w,h=c.X,f=c.i,g,m;return c.w=u=u+1640531527|0,m=h[f+34&127],g=h[f=f+1&127],m^=m<<13,g^=g<<17,m^=m>>>15,g^=g>>>12,m=h[f]=m^g,c.i=f,m+(u^u>>>16)|0};function l(u,h){var f,g,m,x,b,y=[],v=128;for(h===(h|0)?(g=h,h=null):(h=h+"\0",g=0,v=Math.max(v,h.length)),m=0,x=-32;x<v;++x)h&&(g^=h.charCodeAt((x+32)%h.length)),x===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,x>=0&&(b=b+1640531527|0,f=y[x&127]^=g+b,m=f==0?m+1:0);for(m>=128&&(y[(h&&h.length||0)&127]=-1),m=127,x=4*128;x>0;--x)g=y[m+34&127],f=y[m=m+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,y[m]=g^f;u.w=b,u.X=y,u.i=m}l(c,a)}function r(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function o(a,c){a==null&&(a=+new Date);var l=new i(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,m=(f+g)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,u&&(u.X&&r(u,l),h.state=function(){return r(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(Ti,n,!1)})(PC);var sQ=PC.exports,FC={exports:{}};FC.exports;(function(n){(function(t,e,s){function i(a){var c=this,l="";c.next=function(){var h=c.b,f=c.c,g=c.d,m=c.a;return h=h<<25^h>>>7^f,f=f-g|0,g=g<<24^g>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^f,c.c=f=f-g|0,c.d=g<<16^f>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var u=0;u<l.length+20;u++)c.b^=l.charCodeAt(u)|0,c.next()}function r(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function o(a,c){var l=new i(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,g=(l.next()>>>0)/4294967296,m=(f+g)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&r(u,l),h.state=function(){return r(l,{})}),h}e&&e.exports?e.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(Ti,n,!1)})(FC);var iQ=FC.exports,zA={exports:{}};const rQ={},oQ=Object.freeze(Object.defineProperty({__proto__:null,default:rQ},Symbol.toStringTag,{value:"Module"})),aQ=sH(oQ);(function(n){(function(t,e,s){var i=256,r=6,o=52,a="random",c=s.pow(i,r),l=s.pow(2,o),u=l*2,h=i-1,f;function g(I,_,$){var R=[];_=_==!0?{entropy:!0}:_||{};var A=y(b(_.entropy?[I,k(e)]:I??v(),3),R),F=new m(R),L=function(){for(var V=F.g(r),j=c,Z=0;V<l;)V=(V+Z)*i,j*=i,Z=F.g(1);for(;V>=u;)V/=2,j/=2,Z>>>=1;return(V+Z)/j};return L.int32=function(){return F.g(4)|0},L.quick=function(){return F.g(4)/4294967296},L.double=L,y(k(F.S),e),(_.pass||$||function(V,j,Z,et){return et&&(et.S&&x(et,F),V.state=function(){return x(F,{})}),Z?(s[a]=V,j):V})(L,A,"global"in _?_.global:this==s,_.state)}function m(I){var _,$=I.length,R=this,A=0,F=R.i=R.j=0,L=R.S=[];for($||(I=[$++]);A<i;)L[A]=A++;for(A=0;A<i;A++)L[A]=L[F=h&F+I[A%$]+(_=L[A])],L[F]=_;(R.g=function(V){for(var j,Z=0,et=R.i,K=R.j,tt=R.S;V--;)j=tt[et=h&et+1],Z=Z*i+tt[h&(tt[et]=tt[K=h&K+j])+(tt[K]=j)];return R.i=et,R.j=K,Z})(i)}function x(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function b(I,_){var $=[],R=typeof I,A;if(_&&R=="object")for(A in I)try{$.push(b(I[A],_-1))}catch{}return $.length?$:R=="string"?I:I+"\0"}function y(I,_){for(var $=I+"",R,A=0;A<$.length;)_[h&A]=h&(R^=_[h&A]*19)+$.charCodeAt(A++);return k(_)}function v(){try{var I;return f&&(I=f.randomBytes)?I=I(i):(I=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(I)),k(I)}catch{var _=t.navigator,$=_&&_.plugins;return[+new Date,t,$,t.screen,k(e)]}}function k(I){return String.fromCharCode.apply(0,I)}if(y(s.random(),e),n.exports){n.exports=g;try{f=aQ}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:Ti,[],Math)})(zA);var cQ=zA.exports,lQ=QZ,uQ=tQ,hQ=eQ,dQ=nQ,fQ=sQ,pQ=iQ,Hc=cQ;Hc.alea=lQ;Hc.xor128=uQ;Hc.xorwow=hQ;Hc.xorshift7=dQ;Hc.xor4096=fQ;Hc.tychei=pQ;var MC=Hc;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WA{constructor(t,e,s,i,r){this.mean=t,this.stdDev=e,this.dtype=s,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=r||Math.random();this.random=MC.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let t,e,s=!1;for(;!s;){let i,r,o;do i=2*this.random()-1,r=2*this.random()-1,o=i*i+r*r;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*a,e=this.mean+this.stdDev*r*a,(!this.truncated||this.isValidTruncated(t))&&(s=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class gQ{constructor(t=0,e=1,s,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=s,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=MC.alea(i)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(n,t=0,e=1,s,i){if(Oo(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const r=new WA(t,e,s,!1,i),o=ce(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const bQ=J({randomNormal_:mQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(n,t=0,e=1,s="float32",i){Oo(n);const r=ce(n,s),o=new gQ(t,e,null,i);for(let a=0;a<r.values.length;a++)r.values[a]=o.nextValue();return r.toTensor()}const vf=J({randomUniform_:xQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ed(n,t,e=1,s="float32"){if(e===0)throw new Error("Cannot have a step of zero");const i={start:n,stop:t,step:e,dtype:s};return q.runKernel(eC,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(n){const e={input:W(n,"input","real")};return q.runKernel(nC,e)}const Dm=J({real_:yQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(n){const e={x:W(n,"x","reciprocal")};return q.runKernel(tf,e)}const vQ=J({reciprocal_:wQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CQ(n){const e={x:W(n,"x","relu")};return q.runKernel(ef,e)}const Gc=J({relu_:CQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(n){const e={x:W(n,"x","relu6")};return q.runKernel(nf,e)}const VA=J({relu6_:IQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n,t){const s={x:W(n,"x","reverse")},i={dims:t};return q.runKernel(ox,s,i)}const Oc=J({reverse_:kQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(n){const e={x:W(n,"x","round")};return q.runKernel(sf,e)}const UA=J({round_:SQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n){const e={x:W(n,"x","rsqrt","float32")};return q.runKernel(rf,e)}const HA=J({rsqrt_:_Q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n){const e={x:W(n,"x","selu")};return q.runKernel(of,e)}const GA=J({selu_:TQ});function EQ(n,t,e,s,i,r=[1,1],o="NHWC"){const a=W(n,"x","separableConv2d"),c=W(t,"depthwiseFilter","separableConv2d"),l=W(e,"pointwiseFilter","separableConv2d");let u=a,h=!1;if(a.rank===3&&(h=!0,u=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");P(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),P(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),P(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),P(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),P(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const f=c.shape[2],g=c.shape[3];P(l.shape[2]===f*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*g}, but got ${l.shape[2]}.`);const m=wC(u,c,s,i,o,r),b=Ac(m,l,1,"valid",o);return h?Y(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const jA=J({separableConv2d_:EQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(n){const e={x:W(n,"x","sign")};return q.runKernel(lf,e)}const NQ=J({sign_:$Q});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(n){const e={x:W(n,"x","sin","float32")};return q.runKernel(af,e)}const qA=J({sin_:RQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(n){const e={x:W(n,"x","sinh")};return q.runKernel(cf,e)}const KA=J({sinh_:AQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(n,t,e){const s=W(n,"x","slice1d");return P(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),qe(s,[t],[e])}const LC=J({slice1d_:DQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(n,t,e){const s=W(n,"x","slice2d");return P(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),qe(s,t,e)}const XA=J({slice2d_:OQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(n,t,e){const s=W(n,"x","slice3d");return P(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),qe(s,t,e)}const BC=J({slice3d_:PQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n,t,e){const s=W(n,"x","slice4d");return P(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),qe(s,t,e)}const Om=J({slice4d_:FQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(n,t=-1){const e=W(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);const s={logits:e},i={dim:t};return q.runKernel(dx,s,i)}const zC=J({softmax_:MQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LQ(n){P(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const t={input:n};return q.runKernel(H1,t)}const YA=J({fft_:LQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(n){P(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const t={input:n};return q.runKernel(q1,t)}const mv=J({ifft_:BQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zQ(n){const t=n.shape[n.shape.length-1],e=n.size/t;let s;if(t<=2){const i=Y(n,[e,t]);s=mv(i)}else{const i=[e,2*(t-1)],r=Y(Dm(n),[e,t]),o=Y(IC(n),[e,t]),a=Oc(qe(r,[0,1],[e,t-2]),1),c=G(Oc(qe(o,[0,1],[e,t-2]),1),Ae(-1)),l=Rs([r,a],1),u=Rs([o,c],1),h=Y(jl(l,u),[i[0],i[1]]);s=mv(h)}if(s=Dm(s),n.rank===3&&n.shape[0]!==0){const i=s,r=n.shape[0];s=Y(s,[r,s.shape[0]/r,s.shape[1]]),i.dispose()}return s}const WQ=J({irfft_:zQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(n,t,e=0){const i={x:W(n,"x","split")},r={numOrSizeSplits:t,axis:e};return q.runKernel(hx,i,r)}const li=J({split_:VQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UQ(n,t){P(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1];const s=n.size/e;let i;if(t!=null&&t<e){const m=n.shape.map(b=>0),x=n.shape.map(b=>b);x[n.shape.length-1]=t,i=qe(n,m,x),e=t}else if(t!=null&&t>e){const m=n.shape.map(x=>x);m[n.shape.length-1]=t-e,i=Rs([n,Bn(m)],n.shape.length-1),e=t}else i=n;const r=ke(i),o=Y(jl(i,r),[s,e]),a=YA(o),c=Math.floor(e/2)+1,l=Dm(a),u=IC(a),h=li(l,[c,e-c],l.shape.length-1),f=li(u,[c,e-c],u.shape.length-1),g=i.shape.slice();return g[i.shape.length-1]=c,Y(jl(h[0],f[0]),g)}const HQ=J({rfft_:UQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(n,t){let e=W(n,"a","squaredDifference"),s=W(t,"b","squaredDifference");[e,s]=bn(e,s),ee(e.shape,s.shape);const i={a:e,b:s},r={};return q.runKernel(ff,i,r)}const jQ=J({squaredDifference_:GQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(n,t){const e=W(n,"x","squeeze","string_or_numeric");return Y(e,ka(e.shape,t).newShape)}const Cf=J({squeeze_:qQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KQ(n,t=0){const e=pA(n,"tensors","stack","string_or_numeric");P(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&P(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");const s=e,i={axis:t};return q.runKernel(Qb,s,i)}const $o=J({stack_:KQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(n,t=0){const s={x:W(n,"x","step")},i={alpha:t};return q.runKernel(xf,s,i)}const If=J({step_:XQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(n,t,e,s,i=0,r=0,o=0,a=0,c=0){const u={x:W(n,"x","stridedSlice","string_or_numeric")},h={begin:t,end:e,strides:s,beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:c};return q.runKernel(aC,u,h)}const JQ=J({stridedSlice_:YQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZQ(n){const e={x:W(n,"x","tan","float32")};return q.runKernel(gf,e)}const QQ=J({tan_:ZQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n,t){wR(n);const e=bx(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xx(n,null,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qo(n,t,e){if(wR(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=bx(n,e);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xx(n,t,s,e)}function JA(n,t,e){const s=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,r=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${i}.`;if(e.rank<i)throw new Error(r+` update.rank < ${i}. `);if(n.length<s+(e.rank-i))throw new Error(r+` Output shape length < ${s+(e.rank-i)}`);if(e.rank!==i+n.length-s)throw new Error(r+` update.rank != ${i+n.length-s}`);for(let o=0;o<i;++o)if(e.shape[o]!==t.shape[o])throw new Error(r+` updates.shape[${o}] (${e.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<e.rank-i;++o)if(e.shape[o+i]!==n[o+s])throw new Error(r+` updates.shape[${o+i}] (${e.shape[o+i]}) != shape[${o+i}] (${n[o+i]})`)}function ttt(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}JA(e,t,n)}function jc(n,t,e){const s=t.shape.length,i=s>1?t.shape[s-1]:1,r=e.length;let o=1;for(let h=i;h<r;++h)o*=e[h];const a=i<1?1:i,c=ut(t.shape)/a,l=[...Wt(e.slice(0,i)),1],u=ut(e);return{sliceRank:i,numUpdates:c,sliceSize:o,strides:l,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ett(n,t=1,e=!0){const s=W(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${t}`);const r={x:s},o={k:t,sorted:e},[a,c]=q.runKernel(cC,r,o);return{values:a,indices:c}}const ntt=J({topk_:ett});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function stt(n,t=0,e=1,s,i){if(Oo(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const r=new WA(t,e,s,!0,i),o=ce(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const ZA=J({truncatedNormal_:stt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function itt(n,t=0){const e=W(n,"x","unique","string_or_numeric");P(e.rank>0,()=>"The input tensor must be at least 1D");const s={x:e},i={axis:t},[r,o]=q.runKernel(uC,s,i);return{values:r,indices:o}}const rtt=J({unique_:itt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ott(n,t,e){const s=W(n,"x","unsortedSegmentSum"),i=W(t,"segmentIds","unsortedSegmentSum","int32");P(Ul(e),()=>"numSegments must be of dtype int");const r={x:s,segmentIds:i},o={numSegments:e};return q.runKernel(px,r,o)}const QA=J({unsortedSegmentSum_:ott});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function att(n,t=0){const e=W(n,"x","unstack","string_or_numeric");P(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);const s={value:e},i={axis:t};return q.runKernel(fx,s,i)}const Pc=J({unstack_:att});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ctt(n,t=!0,e,s){return q.makeVariable(n,t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tD(n,t){const e=[];for(let r=0;r<t.length;r++)t[r]&&e.push(r);const s=ce(n,"int32"),i=ce([e.length,n.length],"int32");for(let r=0;r<e.length;r++){const o=s.indexToLoc(e[r]),a=r*n.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ltt(n,t,e){const s=W(n,"x","transpose");if(t==null&&(t=s.shape.map((o,a)=>a).reverse()),P(s.rank===t.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${t}.`),t.forEach(o=>{P(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${t}`)}),s.rank<=1)return s.clone();const i={x:s},r={perm:t};return s.dtype==="complex64"?nt(()=>{let o=Dm(s),a=IC(s);return o=q.runKernel(Dl,{x:o},r),a=q.runKernel(Dl,{x:a},r),e&&(a=mn(a)),jl(o,a)}):q.runKernel(Dl,i,r)}const Ie=J({transpose_:ltt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function utt(n,t){if(t==null)return n.shape.slice();if(De(n.shape,t))return t;if(n.shape.length===t.length){const e=[];for(let s=0;s<n.shape.length;s++)t[s]==null&&n.shape[s]!=null?e.push(n.shape[s]):e.push(t[s]);return e}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function htt(n,t,e,s){const i=W(n,"x","dropout");if(P(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),P(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof Tn?i.clone():i;const r=utt(i,e),o=1-t,a=Ut(kx(It(vf(r,0,1,"float32",s),o)),o);return G(i,a)}const dtt=J({dropout_:htt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ftt(n,t,e,s,i,r="NHWC",o){let a=n;n.rank===3&&(a=Y(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=t;c.rank===3&&(c=Y(t,[1,t.shape[0],t.shape[1],t.shape[2]])),P(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),P(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),P(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);const l=r==="NHWC"?a.shape[3]:a.shape[1],u=r==="NHWC"?c.shape[3]:c.shape[1];P(l===e[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${e[2]}.`),P(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),Ps("conv2dDerFilter",i,o);const h={x:a,dy:c},f={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,filterShape:e};return q.runKernel(D1,h,f)}const WC=J({conv2DBackpropFilter_:ftt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VC(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return G(n,If(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function UC(n,t){let e=t;const s=Dn(n.shape,t.shape);return s.length>0&&(e=Vt(e,s)),Y(e,n.shape)}function HC(n,t,e,s){if(t==="linear")return n;if(t==="relu")return Gc(n);if(t==="elu")return Cx(n);if(t==="relu6")return VA(n);if(t==="prelu")return NC(n,e);if(t==="leakyrelu")return kC(n,s);if(t==="sigmoid")return lu(n);throw new Error(`Unknown fused activation ${t}.`)}const GC=(n,t)=>!(n>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ptt({x:n,filter:t,strides:e,pad:s,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:o,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:u}){if(c=c||"linear",GC(q.state.gradientDepth,c)===!1){P(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=Ac(n,t,e,s,i,r,o);return a!=null&&($=It($,a)),HC($,c,l,u)}const h=W(n,"x","conv2d","float32"),f=W(t,"filter","conv2d","float32");let g=h,m=!1;h.rank===3&&(m=!0,g=Y(h,[1,h.shape[0],h.shape[1],h.shape[2]])),P(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),P(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),Ps("fused conv2d",s,o);const x=i==="NHWC"?g.shape[3]:g.shape[1];P(f.shape[2]===x,()=>`Error in conv2d: depth of input (${x}) must match input depth for filter ${f.shape[2]}.`),P(is(e,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${r}'`);const b=Xn(g.shape,f.shape,e,r,s,o);let y;a!=null&&(y=W(a,"bias","fused conv2d"),[y]=bn(y,h),i==="NHWC"?ee(b.outShape,y.shape):(P(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),P(y.shape.length===0||y.shape[0]===b.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let v;if(l!=null){const $=l.shape;if(P($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)P($[0]===1||$[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${b.outChannels}).`);else if($.length===3)try{ee($,b.outShape)}catch{const A=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(A)}v=W(l,"prelu weights","fused conv2d")}const k=($,R)=>{P(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[A,F,L,V]=R,j=VC($,L,c);P(Nc(r),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const Z=xC(F.shape,j,A,e,s),et=WC(F,j,A.shape,e,s),K=[Z,et];if(V!=null){const tt=UC(V,j);K.push(tt)}return K},I={x:g,filter:f,bias:y,preluActivationWeights:v},_={strides:e,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o,activation:c,leakyreluAlpha:u};return a==null?Kl((R,A,F)=>{let L=q.runKernel(_m,I,_);return F([A,R,L]),m&&(L=Y(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:k}})(g,f):Kl((R,A,F,L)=>{let V=q.runKernel(_m,I,_);return L([A,R,V,F]),m&&(V=Y(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:k}})(g,f,y)}const gtt=J({fusedConv2d_:ptt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mtt(n,t,e,s,i,r=[1,1],o){let a=n;n.rank===3&&(a=Y(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=t;c.rank===3&&(c=Y(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:a,dy:c},u={strides:s,pad:i,dimRoundingMode:o,dilations:r,filterShape:e};return q.runKernel(z1,l,u)}const btt=J({depthwiseConv2dNativeBackpropFilter_:mtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xtt(n,t,e,s,i,r=[1,1],o){let a=t,c=!1;t.rank===3&&(c=!0,a=Y(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:a,filter:e},u={strides:s,pad:i,dimRoundingMode:o,dilations:r,inputShape:n},h=q.runKernel(W1,l,u);return c?Y(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const ytt=J({depthwiseConv2dNativeBackpropInput_:xtt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wtt({a:n,b:t,transposeA:e=!1,transposeB:s=!1,bias:i,activation:r="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(GC(q.state.gradientDepth,r)===!1){let V=Ne(n,t,e,s);return i!=null&&(V=It(V,i)),HC(V,r,o,a)}let c=W(n,"a","fused matMul"),l=W(t,"b","fused matMul");[c,l]=bn(c,l);const u=e?c.shape[c.rank-2]:c.shape[c.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],f=e?c.shape[c.rank-1]:c.shape[c.rank-2],g=s?l.shape[l.rank-2]:l.shape[l.rank-1],m=c.shape.slice(0,-2),x=l.shape.slice(0,-2),b=ut(m),y=ut(x);P(u===h,()=>`Error in fused matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${e} and transposeB=${s} must match.`);const k=ee(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([f,g]),I=e?Y(c,[b,u,f]):Y(c,[b,f,u]),_=s?Y(l,[y,g,h]):Y(l,[y,h,g]);let $;i!=null&&($=W(i,"bias","fused matMul"),[$]=bn($,c),ee(k,$.shape));let R;o!=null&&(R=W(o,"prelu weights","fused matMul"));const A=(V,j)=>{const[Z,et,K,tt]=j,it=VC(Y(V,K.shape),K,r);let st,ot;if(!e&&!s?(st=Ne(it,et,!1,!0),ot=Ne(Z,it,!0,!1)):!e&&s?(st=Ne(it,et,!1,!1),ot=Ne(it,Z,!0,!1)):e&&!s?(st=Ne(et,it,!1,!0),ot=Ne(Z,it,!1,!1)):(st=Ne(et,it,!0,!0),ot=Ne(it,Z,!0,!0)),i!=null){const bt=UC(tt,it);return[st,ot,bt]}else return[st,ot]},F={a:I,b:_,bias:$,preluActivationWeights:R},L={transposeA:e,transposeB:s,activation:r,leakyreluAlpha:a};return i==null?Kl((j,Z,et)=>{const K=q.runKernel(Sm,F,L);return et([j,Z,K]),{value:Y(K,k),gradFunc:A}})(I,_):Kl((j,Z,et,K)=>{const tt=q.runKernel(Sm,F,L);return K([j,Z,tt,et]),{value:Y(tt,k),gradFunc:A}})(I,_,$)}const AE=J({fusedMatMul_:wtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vtt(n,t,e,s,i="bilinear",r=0){const o=W(n,"image","cropAndResize"),a=W(t,"boxes","cropAndResize","float32"),c=W(e,"boxInd","cropAndResize","int32"),l=a.shape[0];P(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),P(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),P(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),P(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),P(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),P(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const u={image:o,boxes:a,boxInd:c},h={method:i,extrapolationValue:r,cropSize:s};return q.runKernel(M1,u,h)}const Ctt=J({cropAndResize_:vtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Itt(n){const t=W(n,"image","flipLeftRight","float32");P(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const e={image:t};return q.runKernel(j1,e,{})}const ktt=J({flipLeftRight_:Itt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Stt(n){const t=W(n,"image","grayscaleToRGB"),e=t.rank-1,s=t.shape[e];P(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),P(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const i=new Array(t.rank);return i.fill(1,0,e),i[e]=3,Qi(t,i)}const _tt=J({grayscaleToRGB_:Stt});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ttt(n){const t=W(n,"image","RGBToGrayscale"),e=t.rank-1,s=t.shape[e];P(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),P(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const i=t.dtype,r=Rt(t,"float32"),o=js([.2989,.587,.114]);let a;switch(t.rank){case 2:a=hh("ij,j->i",r,o);break;case 3:a=hh("ijk,k->ij",r,o);break;case 4:a=hh("ijkl,l->ijk",r,o);break;case 5:a=hh("ijklm,m->ijkl",r,o);break;case 6:a=hh("ijklmn,n->ijklm",r,o);break;default:throw new Error("Not a valid tensor rank.")}return a=$s(a,-1),Rt(a,i)}const Ett=J({rgbToGrayscale_:Ttt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $tt(n,t,e=0,s=.5){const i=W(n,"image","rotateWithOffset","float32");P(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const r={image:i},o={radians:t,fillValue:e,center:s};return q.runKernel(hC,r,o)}const Ntt=J({rotateWithOffset_:$tt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hu(n,t,e,s,i,r){s==null&&(s=.5),i==null&&(i=Number.NEGATIVE_INFINITY),r==null&&(r=0);const o=n.shape[0];return e=Math.min(e,o),P(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),P(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),P(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),P(t.rank===1,()=>"scores must be a 1D tensor"),P(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),P(0<=r&&r<=1,()=>`softNmsSigma must be in [0, 1], but was '${r}'`),{maxOutputSize:e,iouThreshold:s,scoreThreshold:i,softNmsSigma:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rtt(n,t,e,s=.5,i=Number.NEGATIVE_INFINITY){const r=W(n,"boxes","nonMaxSuppression","float32"),o=W(t,"scores","nonMaxSuppression","float32"),a=hu(r,o,e,s,i);e=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const c={maxOutputSize:e,iouThreshold:s,scoreThreshold:i};return q.runKernel(Z1,{boxes:r,scores:o},c)}const Att=J({nonMaxSuppression_:Rtt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dtt(n,t,e){const s=Ott(n,t,e),i=s<0?-(s+1):s;n.splice(i,0,t)}function Ott(n,t,e){return Ftt(n,t,e||Ptt)}function Ptt(n,t){return n>t?1:n<t?-1:0}function Ftt(n,t,e){let s=0,i=n.length,r=0,o=!1;for(;s<i;){r=s+(i-s>>>1);const a=e(t,n[r]);a>0?s=r+1:(i=r,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jC(n,t,e,s,i){return XC(n,t,e,s,i,0)}function qC(n,t,e,s,i,r){return XC(n,t,e,s,i,0,!1,r,!0)}function KC(n,t,e,s,i,r){return XC(n,t,e,s,i,r,!0)}function XC(n,t,e,s,i,r,o=!1,a=!1,c=!1){const l=[];for(let b=0;b<t.length;b++)t[b]>i&&l.push({score:t[b],boxIndex:b,suppressBeginIndex:0});l.sort(DE);const u=r>0?-.5/r:0,h=[],f=[];for(;h.length<e&&l.length>0;){const b=l.pop(),{score:y,boxIndex:v,suppressBeginIndex:k}=b;if(y<i)break;let I=!1;for(let _=h.length-1;_>=k;--_){const $=Mtt(n,v,h[_]);if($>=s){I=!0;break}if(b.score=b.score*Ltt(s,u,$),b.score<=i)break}b.suppressBeginIndex=h.length,I||(b.score===y?(h.push(v),f.push(b.score)):b.score>i&&Dtt(l,b,DE))}const g=h.length,m=e-g;a&&m>0&&(h.push(...new Array(m).fill(0)),f.push(...new Array(m).fill(0)));const x={selectedIndices:h};return o&&(x.selectedScores=f),c&&(x.validOutputs=g),x}function Mtt(n,t,e){const s=n.subarray(t*4,t*4+4),i=n.subarray(e*4,e*4+4),r=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),l=Math.min(i[0],i[2]),u=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),g=(a-r)*(c-o),m=(h-l)*(f-u);if(g<=0||m<=0)return 0;const x=Math.max(r,l),b=Math.max(o,u),y=Math.min(a,h),v=Math.min(c,f),k=Math.max(y-x,0)*Math.max(v-b,0);return k/(g+m-k)}function Ltt(n,t,e){const s=Math.exp(t*e*e);return e<=n?s:0}function DE(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Btt(n,t,e,s=.5,i=Number.NEGATIVE_INFINITY){const r=W(n,"boxes","nonMaxSuppressionAsync"),o=W(t,"scores","nonMaxSuppressionAsync"),a=hu(r,o,e,s,i);e=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const c=await Promise.all([r.data(),o.data()]),l=c[0],u=c[1],{selectedIndices:h}=jC(l,u,e,s,i);return r!==n&&r.dispose(),o!==t&&o.dispose(),js(h,"int32")}const ztt=Btt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wtt(n,t,e,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=W(n,"boxes","nonMaxSuppression"),a=W(t,"scores","nonMaxSuppression"),c=hu(o,a,e,s,i,r);e=c.maxOutputSize,s=c.iouThreshold,i=c.scoreThreshold,r=c.softNmsSigma;const l={boxes:o,scores:a},u={maxOutputSize:e,iouThreshold:s,scoreThreshold:i,softNmsSigma:r},h=q.runKernel(tC,l,u);return{selectedIndices:h[0],selectedScores:h[1]}}const Vtt=J({nonMaxSuppressionWithScore_:Wtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Utt(n,t,e,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=W(n,"boxes","nonMaxSuppressionAsync"),a=W(t,"scores","nonMaxSuppressionAsync"),c=hu(o,a,e,s,i,r);e=c.maxOutputSize,s=c.iouThreshold,i=c.scoreThreshold,r=c.softNmsSigma;const l=await Promise.all([o.data(),a.data()]),u=l[0],h=l[1],{selectedIndices:f,selectedScores:g}=KC(u,h,e,s,i,r);return o!==n&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:js(f,"int32"),selectedScores:js(g)}}const Htt=Utt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gtt(n,t,e,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=W(n,"boxes","nonMaxSuppression"),a=W(t,"scores","nonMaxSuppression"),c=hu(o,a,e,s,i,null),l=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,f={boxes:o,scores:a},g={maxOutputSize:l,iouThreshold:u,scoreThreshold:h,padToMaxOutputSize:r},m=q.runKernel(Q1,f,g);return{selectedIndices:m[0],validOutputs:m[1]}}const jtt=J({nonMaxSuppressionPadded_:Gtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qtt(n,t,e,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=W(n,"boxes","nonMaxSuppressionAsync"),a=W(t,"scores","nonMaxSuppressionAsync"),c=hu(o,a,e,s,i,null),l=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,[f,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:m,validOutputs:x}=qC(f,g,l,u,h,r);return o!==n&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:js(m,"int32"),validOutputs:Ae(x,"int32")}}const Ktt=qtt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xtt(n,t,e=!1,s=!1){const i=W(n,"images","resizeBilinear");P(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),P(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),P(s===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let r=i,o=!1;i.rank===3&&(o=!0,r=Y(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:r},c={alignCorners:e,halfPixelCenters:s,size:t},l=q.runKernel(rx,a,c);return o?Y(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const eD=J({resizeBilinear_:Xtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ytt(n,t,e=!1,s=!1){const i=W(n,"images","resizeNearestNeighbor");P(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),P(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),P(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),P(s===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let r=i,o=!1;i.rank===3&&(o=!0,r=Y(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:r},c={alignCorners:e,halfPixelCenters:s,size:t},l=q.runKernel(ix,a,c);return o?Y(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const nD=J({resizeNearestNeighbor_:Ytt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jtt(n,t="binary",e=!1,s=.5){const i=W(n,"image","threshold"),r=.2989,o=.587,a=.114,c=i.shape[0]*i.shape[1];let l=G(js([s]),255),u,h,f,g;if(P(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),P(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),P(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),P(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),i.shape[2]===3){[u,h,f]=li(i,[1,1,1],-1);const b=G(u,r),y=G(h,o),v=G(f,a);g=It(It(b,y),v)}else g=n;if(t==="otsu"){const b=Y9(Rt(UA(g),"int32"),gA([]),256);l=Ztt(b,c)}const m=e?uu(g,l):hi(g,l);return Rt(G(m,255),"int32")}function Ztt(n,t){let e=js([-1]),s=js([0]),i=js([0]),r,o,a,c,l,u;for(let h=0;h<n.size-1;h++){r=qe(n,0,h+1),o=qe(n,h+1),l=Ut(Vt(r),t),u=Ut(Vt(o),t);const f=Vt(G(r,ed(0,r.size)));a=Ut(f,Vt(r));const g=vx(o.shape,r.size),m=It(ed(0,o.size),g),x=G(o,m);c=Ut(Vt(x),Vt(o));const b=jt(a,c),y=jt(a,c),v=G(l,u);i=G(G(v,b),y);const k=hi(i,s);s=ys(k,i,s),e=ys(k,js([h]),e)}return e}const Qtt=J({threshold_:Jtt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tet(n,t,e="nearest",s="constant",i=0,r){const o=W(n,"image","transform","float32"),a=W(t,"transforms","transform","float32");P(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),P(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),P(r==null||r.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${r}.`);const c={image:o,transforms:a},l={interpolation:e,fillMode:s,fillValue:i,outputShape:r};return q.runKernel(lC,c,l)}const eet=J({transform_:tet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function net(n,t,e){const s=W(n,"a","bandPart");P(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const i=s.shape,[r,o]=s.shape.slice(-2);let a,c;typeof t=="number"?(P(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),P(t<=r,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${r}).`),a=W(t<0?r:t,"numLower","bandPart")):(P(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ys(Rm(t,0),r,td(t,r))),typeof e=="number"?(P(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),P(e<=o,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${o}).`),c=W(e<0?o:e,"numUpper","bandPart")):(P(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=ys(Rm(e,0),o,td(e,o)));const l=Y(ed(0,r,1,"int32"),[-1,1]),u=ed(0,o,1,"int32"),h=jt(l,u),f=Eo(uu(h,a),Uc(h,mn(c))),g=Bn([r,o],s.dtype);return Y($o(Pc(Y(s,[-1,r,o])).map(m=>ys(f,m,g))),i)}const set=J({bandPart_:net});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iet(n){let t;if(Array.isArray(n)){t=!1,P(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=n[0].shape[0];for(let r=1;r<n.length;++r)P(n[r].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[r].shape[0]} vs. ${i})`)}else t=!0,n=li(n,n.shape[0],0).map(i=>Cf(i,[0]));P(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const e=[],s=n;for(let i=0;i<n.length;++i)e.push(q.tidy(()=>{let r=s[i];if(i>0)for(let o=0;o<i;++o){const a=G(Vt(G(e[o],r)),e[o]);r=jt(r,a)}return Ut(r,Ix(r,"euclidean"))}));return t?$o(e,0):e}const ret=J({gramSchmidt_:iet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oet(n,t=!1){if(P(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return OE(n,t);{const e=n.shape.slice(0,n.shape.length-2).reduce((c,l)=>c*l),s=Pc(Y(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],r=[];s.forEach(c=>{const[l,u]=OE(c,t);i.push(l),r.push(u)});const o=Y($o(i,0),n.shape),a=Y($o(r,0),n.shape);return[o,a]}}function OE(n,t=!1){return q.tidy(()=>{P(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const e=n.shape[0],s=n.shape[1];let i=OA(e),r=xc(n);const o=Qo([[1]],[1,1]);let a=xc(o);const c=e>=s?s:e;for(let l=0;l<c;++l){const u=r,h=a,f=i;[a,r,i]=q.tidy(()=>{const g=qe(r,[l,l],[e-l,1]),m=Ix(g),x=qe(r,[l,l],[1,1]),b=ys(hi(x,0),Qo([[-1]]),Qo([[1]])),y=jt(x,G(b,m)),v=Ut(g,y);v.shape[0]===1?a=xc(o):a=Rs([o,qe(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);const k=mn(Ut(Ne(b,y),m)),I=qe(r,[l,0],[e-l,s]),_=G(k,a),$=Ie(a);if(l===0)r=jt(I,Ne(_,Ne($,I)));else{const F=jt(I,Ne(_,Ne($,I)));r=Rs([qe(r,[0,0],[l,s]),F],0)}const R=Ie(_),A=qe(i,[0,l],[e,i.shape[1]-l]);if(l===0)i=jt(A,Ne(Ne(A,a),R));else{const F=jt(A,Ne(Ne(A,a),R));i=Rs([qe(i,[0,0],[e,l]),F],1)}return[a,r,i]}),fe([u,h,f])}return!t&&e>s&&(i=qe(i,[0,0],[e,s]),r=qe(r,[0,0],[s,s])),[i,r]})}const aet=J({qr_:oet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Io={flipLeftRight:ktt,grayscaleToRGB:_tt,resizeNearestNeighbor:nD,resizeBilinear:eD,rgbToGrayscale:Ett,rotateWithOffset:Ntt,cropAndResize:Ctt,nonMaxSuppression:Att,nonMaxSuppressionAsync:ztt,nonMaxSuppressionWithScore:Vtt,nonMaxSuppressionWithScoreAsync:Htt,nonMaxSuppressionPadded:jtt,nonMaxSuppressionPaddedAsync:Ktt,threshold:Qtt,transform:eet},cet={bandPart:set,gramSchmidt:ret,qr:aet};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uet=new Map,het=new Map;class du{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class $i{constructor(){this.classNameMap={}}static getMap(){return $i.instance==null&&($i.instance=new $i),$i.instance}static register(t){$i.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function xt(n,t,e){P(n.className!=null,()=>"Class being registered does not have the static className property defined."),P(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),P(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof e>"u"&&(e=n.className);const s=e,i=t+">"+s;return $i.register(n),uet.set(i,n),het.set(n,i),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Na extends du{minimize(t,e=!1,s){const{value:i,grads:r}=this.computeGradients(t,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:r[a.name]}));this.applyGradients(o)}else this.applyGradients(r);return fe(r),e?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return bZ(t,e)}dispose(){this.iterations_!=null&&fe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ae(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Na,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sD extends Na{static get className(){return"Adadelta"}constructor(t,e,s=null){super(),this.learningRate=t,this.rho=e,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=q.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const r=q.registeredVariables[s],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accum_grad`,variable:nt(()=>ke(r).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${s}/accum_var`,variable:nt(()=>ke(r).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[s];if(a==null)return;const c=this.accumulatedGrads[i].variable,l=this.accumulatedUpdates[i].variable;nt(()=>{const u=It(G(c,this.rho),G(Qe(a),1-this.rho)),h=G(Ut(ss(It(l,this.epsilon)),ss(It(c,this.epsilon))),a),f=It(G(l,this.rho),G(Qe(h),1-this.rho));c.assign(u),l.assign(f);const g=It(G(h,-this.learningRate),r);r.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(fe(this.accumulatedGrads.map(t=>t.variable)),fe(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=t.length/2,s=!1;this.accumulatedGrads=t.slice(0,e).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedUpdates=t.slice(e,e*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iD extends Na{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const r=q.registeredVariables[s];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accumulator`,variable:nt(()=>vx(r.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(t)?t[i].tensor:t[s];if(o==null)return;const a=this.accumulatedGrads[i].variable;nt(()=>{const c=It(a,Qe(o));a.assign(c);const l=It(G(Ut(o,ss(It(c,q.backend.epsilon()))),-this.learningRate),r);r.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&fe(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulatedGrads=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rD extends Na{static get className(){return"Adam"}constructor(t,e,s,i=null){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],nt(()=>{this.accBeta1=Ae(e).variable(),this.accBeta2=Ae(s).variable()}),i==null&&(this.epsilon=q.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);nt(()=>{const s=jt(1,this.accBeta1),i=jt(1,this.accBeta2);e.forEach((r,o)=>{const a=q.registeredVariables[r],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${r}/m`,variable:nt(()=>ke(a).variable(c))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${r}/v`,variable:nt(()=>ke(a).variable(c))});const l=Array.isArray(t)?t[o].tensor:t[r];if(l==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,f=It(G(u,this.beta1),G(l,1-this.beta1)),g=It(G(h,this.beta2),G(Qe(l),1-this.beta2)),m=Ut(f,s),x=Ut(g,i);u.assign(f),h.assign(g);const b=It(G(Ut(m,It(ss(x),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(G(this.accBeta1,this.beta1)),this.accBeta2.assign(G(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&fe(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&fe(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t),nt(()=>{this.accBeta1.assign(Dc(this.beta1,this.iterations_+1)),this.accBeta2.assign(Dc(this.beta2,this.iterations_+1))});const e=t.length/2,s=!1;this.accumulatedFirstMoment=t.slice(0,e).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedSecondMoment=t.slice(e,e*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oD extends Na{static get className(){return"Adamax"}constructor(t,e,s,i=null,r=0){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=i,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],nt(()=>{this.iteration=Ae(0).variable(),this.accBeta1=Ae(e).variable()}),i==null&&(this.epsilon=q.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);nt(()=>{const s=jt(1,this.accBeta1),i=Ut(-this.learningRate,It(G(this.iteration,this.decay),1));e.forEach((r,o)=>{const a=q.registeredVariables[r],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${r}/m`,variable:ke(a).variable(c)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${r}/v`,variable:ke(a).variable(c)});const l=Array.isArray(t)?t[o].tensor:t[r];if(l==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,f=It(G(u,this.beta1),G(l,1-this.beta1)),g=G(h,this.beta2),m=fs(l),x=Ea(g,m);u.assign(f),h.assign(x);const b=It(G(Ut(i,s),Ut(f,It(x,this.epsilon))),a);a.assign(b)}),this.iteration.assign(It(this.iteration,1)),this.accBeta1.assign(G(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&fe(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&fe(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YC extends Na{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const r=Array.isArray(t)?t[i].tensor:t[s];if(r==null)return;const o=q.registeredVariables[s];nt(()=>{const a=It(G(this.c,r),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Rr(Ae(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aD extends YC{static get className(){return"Momentum"}constructor(t,e,s=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=s,this.accumulations=[],this.m=Ae(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const r=q.registeredVariables[s];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${s}/momentum`,variable:nt(()=>ke(r).variable(!1))});const o=this.accumulations[i].variable,a=Array.isArray(t)?t[i].tensor:t[s];a!=null&&nt(()=>{let c;const l=It(G(this.m,o),a);this.useNesterov?c=It(G(this.c,It(a,G(l,this.m))),r):c=It(G(this.c,l),r),o.assign(l),r.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&fe(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulations=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cD extends Na{static get className(){return"RMSProp"}constructor(t,e=.9,s=0,i=null,r=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=s,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,i==null&&(this.epsilon=q.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,i)=>{const r=q.registeredVariables[s],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${s}/rms`,variable:nt(()=>ke(r).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${s}/momentum`,variable:nt(()=>ke(r).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${s}/mg`,variable:nt(()=>ke(r).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[s];if(a==null)return;const c=this.accumulatedMeanSquares[i].variable,l=this.accumulatedMoments[i].variable;nt(()=>{const u=It(G(c,this.decay),G(Qe(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[i].variable,f=It(G(h,this.decay),G(a,1-this.decay)),g=Ut(G(a,this.learningRate),ss(jt(u,It(Qe(f),this.epsilon)))),m=It(G(l,this.momentum),g);c.assign(u),h.assign(f),l.assign(m);const x=jt(r,m);r.assign(x)}else{const h=It(G(c,this.decay),G(Qe(a),1-this.decay)),f=It(G(l,this.momentum),Ut(G(a,this.learningRate),ss(It(h,this.epsilon))));c.assign(h),l.assign(f);const g=jt(r,f);r.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&fe(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&fe(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&fe(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,e).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedMoments=t.slice(e,e*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(e*2,e*3).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const det=[sD,iD,rD,oD,aD,cD,YC];function fet(){for(const n of det)xt(n)}function JC(n,t){const e=n.shape.length,s=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${e}`);if(ut(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const i=t.shape,r=i[i.length-1];let o=1;for(let h=0;h<i.length-1;++h)o*=i[h];const a=n.shape,c=i.slice();c.pop();let l=1;for(let h=r;h<e;++h)l*=a[h],c.push(a[h]);const u=[...Wt(n.shape).map(h=>h/l),1].slice(0,r);return[c,o,l,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bv=-2,pet=-1;function ZC(n,t,e){const s=n.shape.length;P(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),P(s===e.length,()=>`Error in slice${s}D: Length of size ${e} must match the rank of the array (${s}).`);for(let i=0;i<s;++i)P(t[i]+e[i]<=n.shape[i],()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${t[i]+e[i]}) would overflow input.shape[${i}] (${n.shape[i]})`)}function get(n){const t=[];let e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function QC(n,t,e){const s=[];for(let i=0;i<n.length;i++)s[i]=Math.ceil((t[i]-n[i])/e[i]);return s}function lD(n,t,e,s){const i=[...n];for(let r=i.length;r<s.length;r++)i.push(1);for(let r=0;r<e;r++)r===0?i[t]=1:(i.splice(t,0,1),i.pop());return i}function uD(n,t,e){return e<=n?e:e-(t-1)}function hD(n,t){const e=[];for(let s=0;s<n;s++)e.push(t+s);return e}function met(n,t,e,s,i,r,o,a,c){const l=n.length;let u=new Array(l),h=new Array(l),f=new Array(l);if(t.length&&e>0){const g=t[0],m=e+1;u=dD(o,g,m,s,n),h=fD(a,g,m,i,n),f=lD(r,g,m,n)}else for(let g=0;g<l;g++)u[g]=gD(o,s,r,n,g,c),h[g]=mD(a,i,r,n,g,c),f[g]=pD(r,g,c);return{begin:u,end:h,strides:f}}function dD(n,t,e,s,i){const r=[...i],o=hD(e,t);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=0;else{const c=uD(t,e,a);let l=s[c];n&1<<c&&(l=0),r[a]=l}return r}function fD(n,t,e,s,i){const r=[...i],o=hD(e,t);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=Number.MAX_SAFE_INTEGER;else{const c=uD(t,e,a);let l=s[c];n&1<<c&&(l=Number.MAX_SAFE_INTEGER),r[a]=l}for(let a=0;a<r.length;a++){const c=i[a];r[a]<0&&(r[a]+=c),r[a]=_c(0,r[a],i[a])}return r}function pD(n,t,e){let s=n[t];return(e&1<<t||s==null)&&(s=1),s}function gD(n,t,e,s,i,r){let o=t[i];const a=e[i]||1;(n&1<<i||r&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const c=s[i];return o<0&&(o+=c),o=_c(0,o,c-1),o}function mD(n,t,e,s,i,r){let o=t[i];const a=e[i]||1;(n&1<<i||r&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const c=s[i];return o<0&&(o+=c),a>0?o=_c(0,o,c):o=_c(-1,o,c-1),o}function tI(n,t,e){let s=e.length;for(let i=0;i<e.length;i++)if(e[i]>1){s=i;break}for(let i=s+1;i<e.length;i++)if(t[i]>0||e[i]!==n[i])return!1;return!0}function eI(n,t){let e=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)e+=n[s]*t[s];return e}function Sx(n,t,e){let s;const i=n.shape.length;typeof t=="number"?s=[t,...new Array(i-1).fill(0)]:t.length<i?s=t.concat(new Array(i-t.length).fill(0)):s=t.slice(),s.forEach(o=>{P(o!==-1,()=>"slice() does not support negative begin indexing.")});let r;return e==null?r=new Array(i).fill(-1):typeof e=="number"?r=[e,...new Array(i-1).fill(-1)]:e.length<i?r=e.concat(new Array(i-e.length).fill(-1)):r=e,r=r.map((o,a)=>o>=0?o:(P(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,r]}function nI(n,t,e,s,i,r,o,a,c){let l;if(s==null?(l=new Array(t.length),l.fill(1)):l=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:e.slice(),strides:l.slice(),beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:c};for(let k=0;k<h.dims;k++)u&&1<<k&a&&h.numAddAxisAfterEllipsis++,1<<k&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};bet(h,f);let g=!0,m=!0,x=!0;const b=[],y=[];for(let k=0;k<n.length;++k){if(f.strides[k]===0)throw Error(`strides[${k}] must be non-zero`);const I=!!(f.shrinkAxisMask&1<<k),_=n[k];if(_===-1){b.push(I?1:-1);continue}const $=[f.beginMask&1<<k,f.endMask&1<<k],R=[f.strides[k]>0?0:-1,f.strides[k]>0?_:_-1];if(I&&f.strides[k]<=0)throw Error("only stride 1 allowed on non-range indexing.");x=x&&f.strides[k]===1;const A=!!(f.beginMask&1<<k&&f.endMask&1<<k);if(f.beginValid&&f.endValid){if(I){const j=f.begin[k]<0?_+f.begin[k]:f.begin[k];if(f.begin[k]=j,f.end[k]=f.begin[k]+1,j<0||j>=_)throw Error(`slice index ${f.begin[k]} of dimension ${k} out of bounds.`)}else f.begin[k]=PE(f.begin[k],0,f.strides[k],_,$,R),f.end[k]=PE(f.end[k],1,f.strides[k],_,$,R);const V=f.strides[k]===1&&f.begin[k]===0&&f.end[k]===_;g=g&&V,m=m&&(k===0&&f.strides[k]===1||V)}else g=g&&f.strides[k]===1&&A,m=m&&(k===0&&f.strides[k]===1||A);let F,L=!1;if(f.beginValid&&f.endValid?(F=f.end[k]-f.begin[k],L=!0):I?(F=1,L=!0):A&&_>=0&&(f.strides[k]<0?F=-_:F=_,L=!0),L){let V;F===0||F<0!=f.strides[k]<0?V=0:V=Math.trunc(F/f.strides[k])+(F%f.strides[k]!==0?1:0),b.push(V)}else b.push(-1)}for(let k=0;k<f.finalShapeGatherIndices.length;++k){const I=f.finalShapeGatherIndices[k];I>=0?y.push(b[I]):I===bv&&y.push(1)}return{finalShapeSparse:y.filter((k,I)=>f.finalShapeGatherIndices[I]!==bv),finalShape:y,isIdentity:g,sliceDim0:m,isSimpleSlice:x,begin:f.begin,end:f.end,strides:f.strides}}function bet(n,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let e=0;t.beginValid=n.begin!=null,t.endValid=n.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const i=Math.min(t.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,t.dims);for(;e<i;e++)t.begin[e]=0,t.end[e]=0,t.strides[e]=1,t.beginMask|=1<<e,t.endMask|=1<<e,t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[e]=s}else if(1<<s&n.newAxisMask)t.finalShapeGatherIndices.push(bv),t.finalShapeGatherIndicesSparse.push(-1);else{if(e===t.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${t.dims} dims, ${t.begin.length}.`);n.begin!=null&&(t.begin[e]=n.begin[s]),n.end!=null&&(t.end[e]=n.end[s]),t.strides[e]=n.strides[s],n.beginMask&1<<s&&(t.beginMask|=1<<e),n.endMask&1<<s&&(t.endMask|=1<<e),n.shrinkAxisMask&1<<s?(t.finalShapeGatherIndices.push(pet),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<e):(t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(s)),t.inputShapeGatherIndicesSparse[e]=s,e++}}function PE(n,t,e,s,i,r){if(i[t])return e>0?r[t]:r[t+1&1];{const o=n<0?s+n:n;return o<r[0]?r[0]:o>r[1]?r[1]:o}}const xet=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:ZC,computeFlatOffset:eI,computeOutShape:QC,getNormalizedAxes:met,isSliceContinous:tI,maskToAxes:get,parseSliceParams:Sx,sliceInfo:nI,startForAxis:gD,startIndicesWithElidedDims:dD,stopForAxis:mD,stopIndicesWithElidedDims:fD,stridesForAxis:pD,stridesWithElidedDims:lD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yet{static sgd(t){return new YC(t)}static momentum(t,e,s=!1){return new aD(t,e,s)}static rmsprop(t,e=.9,s=0,i=null,r=!1){return new cD(t,e,s,i,r)}static adam(t=.001,e=.9,s=.999,i=null){return new rD(t,e,s,i)}static adadelta(t=.001,e=.95,s=null){return new sD(t,e,s)}static adamax(t=.002,e=.9,s=.999,i=null,r=0){return new oD(t,e,s,i,r)}static adagrad(t,e=.1){return new iD(t,e)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yl=yet;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wet=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();function bD(){return new Promise(n=>wet(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sI(n,t){const e=n[0].length;n.forEach((i,r)=>{P(i.length===e,()=>`Error in concat${e}D: rank of tensors[${r}] must be the same as the rank of the rest (${e})`)}),P(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);const s=n[0];n.forEach((i,r)=>{for(let o=0;o<e;o++)P(o===t||i[o]===s[o],()=>`Error in concat${e}D: Shape of tensors[${r}] (${i}) does not match the shape of the rest (${s}) along the non-concatenated axis ${r}.`)})}function Ar(n,t){const e=n[0].slice();for(let s=1;s<n.length;s++)e[t]+=n[s][t];return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yi;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Yi||(Yi={}));function xD(n,t,e){let s=new Array;if(e==null&&t==null)return s;if(t==null)for(;s.length<n+e.length;)s.push(-1);else s=t.slice();if(e==null)return s;if(n+e.length!==s.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${n+e.length}, but shape.rank = ${s.length}`);for(let i=1;i<e.length;++i){const r=e[i],o=s[s.length-e.length+i],a=s[o];if(r>=0)if(a>=0){if(a!==r)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${i+n}] = ${r} but shape[${i+n}] = ${a}`)}else s[o]=r}return s}function yD(n){const t={FIRST_DIM_SIZE:Yi.FIRST_DIM_SIZE,VALUE_ROWIDS:Yi.VALUE_ROWIDS,ROW_LENGTHS:Yi.ROW_LENGTHS,ROW_SPLITS:Yi.ROW_SPLITS,ROW_LIMITS:Yi.ROW_LIMITS,ROW_STARTS:Yi.ROW_STARTS},e=[];for(const s of n)if(s in t)e.push(t[s]);else break;return e}function wD(n){return n.length===0?0:n[0]===Yi.FIRST_DIM_SIZE?n.length-1:n.length}function vD(n,t){if(n==null||t==null)return;const e=n.length,s=t.length;if(e>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${s})`);for(let i=0;i<Math.min(e,s-1);++i){const r=n[i],o=t[i+1];if(r>=0&&o>=0&&r!==1&&r!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${i-n.length}] = ${r} but ragged tensor input.flatValues.shape[${i-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iI=30;function _x(n){return n<=iI?n:Qw(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rI(n,t,e){const s=e*(typeof n=="number"?n:n[0]),i=t*(typeof n=="number"?n:n[1]);return[s,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kf(n,t,e,s=!0){let i=[];if(s)i=i.concat(t.slice(0)),i.push(n[0]/e),i=i.concat(n.slice(1));else{i=i.concat(n[0]);const r=t.length;for(let o=0;o<r;++o)i=i.concat([n[o+1]/t[o],t[o]]);i=i.concat(n.slice(r+1))}return i}function Sf(n,t,e=!0){const s=[];if(e){s.push(t);for(let i=t+1;i<n;++i)i<=2*t?(s.push(i),s.push(i-(t+1))):s.push(i)}else{const i=[],r=[];for(let o=1;o<n;++o)o>=t*2+1||o%2===1?r.push(o):i.push(o);s.push(...i),s.push(0),s.push(...r)}return s}function _f(n,t,e,s=!0){const i=[];s?i.push(n[0]/e):i.push(n[0]*e);for(let r=1;r<n.length;++r)r<=t.length?s?i.push(t[r-1]*n[r]):i.push(n[r]/t[r-1]):i.push(n[r]);return i}function oI(n,t){const e=[0];for(let s=0;s<t;++s)e.push(n[s][0]);return e}function aI(n,t,e){const s=n.slice(0,1);for(let i=0;i<e;++i)s.push(n[i+1]-t[i][0]-t[i][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tx=1.7580993408473768,Ex=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cI=.3275911,lI=.254829592,uI=-.284496736,hI=1.421413741,dI=-1.453152027,fI=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function No(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);const e=new Float32Array(n.length*2);for(let s=0;s<e.length;s+=2)e[s]=n[s/2],e[s+1]=t[s/2];return e}function CD(n){const t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)t[s/2]=n[s],e[s/2]=n[s+1];return{real:t,imag:e}}function ID(n){const t=Math.ceil(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let i=0;i<n.length;i+=4)e[Math.floor(i/4)]=n[i],s[Math.floor(i/4)]=n[i+1];return{real:e,imag:s}}function kD(n){const t=Math.floor(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let i=2;i<n.length;i+=4)e[Math.floor(i/4)]=n[i],s[Math.floor(i/4)]=n[i+1];return{real:e,imag:s}}function pI(n,t){const e=n[t*2],s=n[t*2+1];return{real:e,imag:s}}function SD(n,t,e,s){n[s*2]=t,n[s*2+1]=e}function _D(n,t){const e=new Float32Array(n/2),s=new Float32Array(n/2);for(let i=0;i<Math.ceil(n/2);i++){const r=(t?2:-2)*Math.PI*(i/n);e[i]=Math.cos(r),s[i]=Math.sin(r)}return{real:e,imag:s}}function TD(n,t,e){const s=(e?2:-2)*Math.PI*(n/t),i=Math.cos(s),r=Math.sin(s);return{real:i,imag:r}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iw="->",vet=/->/g,FE=",",ME="...";function gI(n,t){n=n.replace(/\s/g,"");const e=(n.length-n.replace(vet,"").length)/iw.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${iw}").`);const[s,i]=n.split(iw);P(s.indexOf(ME)===-1,()=>`The ellipsis notation ("${ME}") is not supported yet.`);const r=s.split(FE),o=r.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<i.length;++f){const g=i[f];if(!r.some(m=>m.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let f=0;f<s.length;++f){const g=s[f];a.indexOf(g)===-1&&g!==FE&&a.push(g)}const c=new Array(r.length);for(let f=0;f<o;++f){if(new Set(r[f].split("")).size!==r[f].length)throw new Error(`Found duplicate axes in input component ${r[f]}. Support for duplicate axes in input is not implemented yet.`);c[f]=[];for(let g=0;g<r[f].length;++g)c[f].push(a.indexOf(r[f][g]))}const l=a.length,u=i.length,h=[];for(let f=u;f<l;++f)h.push(f);return{allDims:a,summedDims:h,idDims:c}}function mI(n,t){let e=new Array(n);e.fill(-1);for(let i=0;i<t.length;++i)e[t[i]]=i;const s=[];for(let i=0;i<n;++i)e[i]===-1&&s.push(i);return e=e.filter(i=>i!==-1),{permutationIndices:e,expandDims:s}}function bI(n,t,e){const s=new Array(n);for(let i=0;i<e.length;++i){const r=e[i].shape;for(let o=0;o<t[i].length;++o)s[t[i][o]]===void 0?s[t[i][o]]=r[o]:P(s[t[i][o]]===r[o],()=>`Expected dimension ${s[t[i][o]]} at axis ${o} of input shaped ${JSON.stringify(r)}, but got dimension ${r[o]}`)}}function xI(n,t){const e=n,s=[];let i=0;n.length===0&&e.push(-1),i=n.length+1;for(let o=0;o<i;++o)s.push([]);const r=[];for(let o=0;o<e.length;++o){const a=e[o],c=Cet(t,a);for(const l of c)r.indexOf(l)===-1&&(s[o].push(l),r.push(l))}return{path:e,steps:s}}function yI(n){return n.every((t,e)=>t===e)}function Cet(n,t){const e=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(t)!==-1||t===-1)&&e.push(s);return e}function wI(n,t,e=0){let s=[];if(typeof t=="number")P(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(n.shape[e]/t);else{const i=t.reduce((o,a)=>(a===-1&&(o+=1),o),0);P(i<=1,()=>"There should be only one negative value in split array.");const r=t.indexOf(-1);if(r!==-1){const o=t.reduce((a,c)=>c>0?a+c:a);t[r]=n.shape[e]-o}P(n.shape[e]===t.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function $D(n,t){return`indices(${n}, 0) is invalid: ${t} < 0`}function ND(n,t,e){return`indices(${n}, 0) is invalid: ${t} >= ${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,t){return`only one output dimension may be -1, not both ${n} and ${t}`}function AD(n,t){return`size ${n} must be non-negative, not ${t}`}function DD(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function OD(n,t){const e=ut(n),s=ut(t);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${t}`}function PD(n,t){const e=ut(n),s=ut(t);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(){return"segment ids must be >= 0"}function FD(){return"segment ids are not increasing"}function MD(n,t){return`Segment id ${n} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function LD(n,t,e){return`Bad: indices[${n}] == ${t} out of range [0, ${e})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BD(n,t){let e=!1,s;for(n<=iI?(s=n,e=!0):s=Qw(n,Math.floor(Math.sqrt(n)));!e;)s>t||s===n?e=!0:s=Qw(n,s+1);return s}function zD(n,t,e){const s=[],i=n.length;for(let r=0;r<i;r++)r!==t?s.push(n[r]):s.push(e);return s}function vI(n,t,e,s){const i=t.shape.length,r=n.shape.length;if(s!==0&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>r)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${r}).`);if(e<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${e}).`);for(let h=0;h<s;++h)if(n.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);const o=n.shape[e],a=[];let c=1,l=1,u=1;for(let h=0;h<s;++h)a.push(n.shape[h]),c*=n.shape[h];for(let h=s;h<e;h++)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<i;h++)a.push(t.shape[h]);for(let h=e+1;h<r;h++)a.push(n.shape[h]),u*=n.shape[h];return{batchSize:c,sliceSize:u,outerSize:l,dimSize:o,outputShape:a}}const Iet=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:vI,computeOutShape:zD,segOpComputeOptimalWindowSize:BD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ro(n){try{return n.map(t=>ma(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function WD(n){return n.map(t=>ha(t))}const ket=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:lI,ERF_A2:uI,ERF_A3:hI,ERF_A4:dI,ERF_A5:fI,ERF_P:cI,PARALLELIZE_THRESHOLD:iI,get RowPartitionType(){return Yi},SELU_SCALE:Ex,SELU_SCALEALPHA:Tx,applyActivation:HC,assertAndGetBroadcastShape:ee,assertAxesAreInnerMostDims:Yn,assertParamsConsistent:sI,assignToTypedArray:SD,axesAreInnerMostDims:vC,calculateShapes:jc,checkEinsumDimSizes:bI,checkPadOnDimRoundingMode:Ps,combineLocations:AA,combineRaggedTensorToTensorShapes:xD,complexWithEvenIndex:ID,complexWithOddIndex:kD,computeConv2DInfo:Xn,computeConv3DInfo:_a,computeDefaultPad:gC,computeDilation2DInfo:yf,computeOptimalWindowSize:_x,computeOutAndReduceShapes:Vn,computeOutShape:Ar,computePool2DInfo:Li,computePool3DInfo:Po,convertConv2DDataFormat:Fo,decodeEinsumEquation:gI,eitherStridesOrDilationsAreOne:is,expandShapeToKeepDim:_n,exponent:TD,exponents:_D,fromStringArrayToUint8:WD,fromUint8ToStringArray:Ro,getAxesPermutation:un,getBroadcastDims:ql,getComplexWithIndex:pI,getEinsumComputePath:xI,getEinsumPermutation:mI,getFusedBiasGradient:UC,getFusedDyActivation:VC,getImageCenter:rI,getInnerMostAxes:xn,getPermuted:Sf,getRaggedRank:wD,getReductionAxes:Dn,getReshaped:kf,getReshapedPermuted:_f,getRowPartitionTypesHelper:yD,getSliceBeginCoords:oI,getSliceSize:aI,getSparseFillEmptyRowsIndicesDenseShapeMismatch:ED,getSparseFillEmptyRowsNegativeIndexErrorMessage:$D,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:ND,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:DD,getSparseReshapeInputOutputMismatchErrorMessage:PD,getSparseReshapeInputOutputMultipleErrorMessage:OD,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:RD,getSparseReshapeNegativeOutputDimErrorMessage:AD,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:LD,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:xv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:FD,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:MD,getUndoAxesPermutation:Ta,isIdentityPermutation:yI,log:oY,mergeRealAndImagArrays:No,prepareAndValidate:JC,prepareSplitSize:wI,segment_util:Iet,shouldFuse:GC,slice_util:xet,splitRealAndImagArrays:CD,stridesOrDilationsArePositive:Rc,tupleValuesAreOne:Nc,upcastType:Ks,validateDefaultValueShape:vD,validateInput:ttt,validateUpdateShape:JA,warn:ai},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fet();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD={kernelName:mb,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,If(Rt(e,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _et={kernelName:Id,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Qe(Rt(e,"float32")),i=ss(jt(Ae(1),s));return mn(Ut(n,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tet={kernelName:kd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=ss(jt(Qe(Rt(e,"float32")),1));return Ut(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eet={kernelName:au,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{let a=n;const c=Dn(e.shape,i);return c.length>0&&(a=Vt(a,c)),Y(a,e.shape)},b:()=>{let a=n;const c=Dn(s.shape,i);return c.length>0&&(a=Vt(a,c)),Y(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $et={kernelName:S1,saveAllInputs:!0,gradFunc:(n,t)=>{const e={};return t.forEach((s,i)=>{e[i]=()=>n.clone()}),e}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Net={kernelName:bb,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ke(e)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ret={kernelName:xb,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ke(e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aet={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,ss(jt(Ae(1),Qe(Rt(e,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Det={kernelName:_d,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=ss(It(Ae(1),Qe(Rt(e,"float32"))));return Ut(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oet={kernelName:$d,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{const a=It(Qe(e),Qe(s));let c=G(n,Ut(s,a));const l=Dn(e.shape,i);return l.length>0&&(c=Vt(c,l)),Y(c,e.shape)},b:()=>{const a=It(Qe(e),Qe(s));let c=mn(G(n,Ut(e,a)));const l=Dn(s.shape,i);return l.length>0&&(c=Vt(c,l)),Y(c,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pet={kernelName:Td,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,It(Qe(Rt(e,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fet={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,jt(Ae(1),Qe(Rt(e,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Met(n,t,e,s,i,r){const o=W(n,"dy","avgPool3dGrad"),a=W(t,"input","avgPool3dGrad");let c=o,l=a,u=!1;a.rank===4&&(u=!0,c=Y(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=Y(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),P(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),P(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Ps("avgPool3dGrad",i,r);const h={dy:c,input:l},f={filterSize:e,strides:s,pad:i,dimRoundingMode:r},g=q.runKernel($1,h,f);return u?Y(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const Let=J({avgPool3dGrad_:Met});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bet={kernelName:wb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:i,strides:r,pad:o,dimRoundingMode:a}=e;return{x:()=>Let(n,s,i,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zet(n,t,e,s,i){const r=W(n,"dy","avgPoolGrad"),o=W(t,"input","avgPoolGrad");P(o.rank===r.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${r.rank})`);let a=o,c=r,l=!1;o.rank===3&&(l=!0,a=Y(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=Y(r,[1,r.shape[0],r.shape[1],r.shape[2]])),P(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),P(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:c,input:a},h={filterSize:e,strides:s,pad:i},f=q.runKernel(E1,u,h);return l?Y(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Wet=J({avgPoolGrad_:zet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vet={kernelName:yb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:i,strides:r,pad:o}=e;return{x:()=>Wet(n,s,i,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uet={kernelName:vb,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{const[s,i]=t,{transposeA:r,transposeB:o}=e;return!r&&!o?{a:()=>Ne(n,i,!1,!0),b:()=>Ne(s,n,!0,!1)}:!r&&o?{a:()=>Ne(n,i,!1,!1),b:()=>Ne(n,s,!0,!1)}:r&&!o?{a:()=>Ne(i,n,!1,!0),b:()=>Ne(s,n,!1,!1)}:{a:()=>Ne(i,n,!0,!0),b:()=>Ne(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Het={kernelName:Cb,gradFunc:(n,t,e)=>{const{blockShape:s,crops:i}=e;return{x:()=>$C(n,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Get={kernelName:nY,gradFunc:(n,t,e)=>{const s=e,i=s.inputShape,r=s.shape,o=Array.from(r);for(let c=i.length-1;c>=0;c--)if(i[c]===r[c])o[c]=1;else if(i[c]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${r}].`);const a=[];for(let c=0;c<o.length;c++)o[c]>1&&a.push(c);return{x:()=>Vt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jet={kernelName:Nd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qet={kernelName:Rd,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ket={kernelName:Ad,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{clipValueMin:i,clipValueMax:r}=e;return{x:()=>ys(Eo(Uc(s,i),uu(s,r)),n,ke(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xet={kernelName:Ib,inputsToSave:["x"],gradFunc:VD.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yet={kernelName:kb,saveAllInputs:!0,gradFunc:(n,t,e)=>{const s=t.map(c=>c.shape),{axis:i}=e,r=le(i,t[0].shape)[0],o=s.map(c=>c[r]);return li(n,o,r).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jet={kernelName:Sb,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,i]=t,{dilations:r,strides:o,pad:a,dataFormat:c}=e;return P(Nc(r),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`),{x:()=>xC(s.shape,n,i,o,a,c),filter:()=>WC(s,n,i.shape,o,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zet={kernelName:_b,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{const[s,i]=t,{strides:r,pad:o,dataFormat:a,dimRoundingMode:c}=e;return{dy:()=>Ac(n,i,r,o,a,1,c),filter:()=>WC(n,s,i.shape,r,o,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qet(n,t,e,s,i){let r=n;n.rank===4&&(r=Y(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=t;o.rank===4&&(o=Y(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),P(r.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${r.shape}.`),P(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),P(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),P(r.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${r.shape[4]}) must match input depth in filter (${e[3]}.`),P(o.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${e[4]}).`);const a={x:r,dy:o},c={strides:s,pad:i,filterShape:e};return q.runKernel(O1,a,c)}const tnt=J({conv3DBackpropFilter_:Qet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ent={kernelName:Tb,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:i,pad:r}=e;P(Nc(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=t;return{x:()=>EA(o.shape,n,a,i,r),filter:()=>tnt(o,n,a.shape,i,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nnt={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(mn(qA(Rt(e,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const snt={kernelName:Od,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(KA(Rt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const int={kernelName:Eb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:i,exclusive:r,reverse:o}=e;return{x:()=>{const a=un([i],s.rank);let c=NA(n,i,r,!o);return a!=null&&(c=Ie(c,a)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rnt={kernelName:$b,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:i,pad:r,dimRoundingMode:o}=e,a=s??[1,1];P(Nc(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[c,l]=t;return P(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),P(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),P(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),P(is(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),Ps("depthwiseConv2d",r,o),{x:()=>ytt(c.shape,n,l,i,r,a,o),filter:()=>btt(c,n,l.shape,i,r,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ont={kernelName:Nb,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,i]=t,r={x:s,filter:i,dy:n},o={x:s,filter:i,dy:n};return{x:()=>q.runKernel(tv,r,e),filter:()=>q.runKernel(ev,o,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ant={kernelName:Fd,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t,s={dy:n,y:e};return{x:()=>q.runKernel(U1,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cnt={kernelName:Md,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=G(Fr(mn(Qe(e))),2/Math.sqrt(Math.PI));return{x:()=>G(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lnt={kernelName:Ld,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const unt={kernelName:Ab,inputsToSave:["input"],gradFunc:(n,t)=>{const[e]=t;return{input:()=>Y(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hnt={kernelName:Bd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,Fr(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dnt={kernelName:zd,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fnt={kernelName:Wd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{const a=Ut(n,Rt(s,"float32")),c=Dn(e.shape,i);return c.length>0?Y(Vt(a,c),e.shape):a},b:()=>{let a=G(n,Rt(e,"float32"));const c=Dn(s.shape,i);c.length>0&&(a=Y(Vt(a,c),s.shape));const l=Qe(s);return mn(Ut(a,Rt(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pnt={kernelName:Db,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{const{varianceEpsilon:s}=e,[i,r,o,a]=t,c=a??Ae(1),l=Dn(r.shape,i.shape),u=[];if(r.rank===1){for(let I=0;I<i.shape.length-1;++I)u.push(i.shape[I]);u.push(1)}const h=jt(i,r),f=G(n,c),g=HA(It(o,Ae(s))),m=G(G(G(g,g),g),Ae(-.5));return{x:()=>r.rank===1?Y(G(G(n,Qi(Y(g,[1,1,1,r.shape[0]]),u)),c),i.shape):Y(G(G(n,g),c),i.shape),mean:()=>{let I=G(G(g,Ae(-1)),f);return r.rank===1&&(I=Vt(I,l)),Y(I,r.shape)},variance:()=>{let I=G(G(m,h),f);return r.rank===1&&(I=Vt(I,l)),Y(I,r.shape)},scale:()=>{const I=G(h,g);let _=G(n,I);return r.rank===1&&(_=Vt(_,l)),Y(_,r.shape)},offset:()=>{let I=n;return r.rank===1&&(I=Vt(I,l)),Y(I,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gnt={kernelName:Ob,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{const[s,i]=t,{axis:r,batchDims:o}=e,a=le(r,s.shape)[0],c=(l,u,h)=>()=>{const f=l.shape,g=u.size,m=f.slice(0,a),x=m.length,b=f.slice(r,f.length).slice(1),y=b.length,v=LE(0,x),k=LE(x+1,x+1+y),I=BE([m,[g],b]),_=Y(h,I),$=Y(u,[g]),R=BE([[x],v,k]),A=Ie(_,R);let F=QA(A,$,l.shape[a]);const L=Ta(R);return F=Ie(F,L),F};if(o===1){const l=s.shape[0],u=s.split(l,0);return{x:()=>$o(u.map((g,m)=>c(g,i.slice(m,1),n.slice(m,1))())).reshape(s.shape),indices:()=>i}}else return{x:c(s,i,n),indices:()=>i}}};function LE(n,t){const e=[];for(let s=n;s<t;++s)e.push(s);return e}function BE(n){const t=[];for(let e=0;e<n.length;++e)for(let s=0;s<n[e].length;++s)t.push(n[e][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mnt={kernelName:Vd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>ke(e),b:()=>ke(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bnt={kernelName:Ud,gradFunc:n=>({x:()=>Rt(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xnt={kernelName:Hd,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ynt={kernelName:Gd,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wnt={kernelName:jd,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vnt={kernelName:Fb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{alpha:i}=e,r=hi(s,0);return{x:()=>ys(r,n,G(n,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cnt={kernelName:Kd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,It(e,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Int={kernelName:qd,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,Rt(e,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const knt={kernelName:iY,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{axis:i}=e;return{logits:()=>{const o=Fr(s);return jt(n,G(Vt(n,i,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Snt(n,t,e,s=5,i=1,r=1,o=.5){const a={x:n,y:t,dy:e},c={depthRadius:s,bias:i,alpha:r,beta:o};return q.runKernel(X1,a,c)}const _nt=J({localResponseNormalizationBackprop_:Snt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tnt={kernelName:Vb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,i]=t,{depthRadius:r,bias:o,alpha:a,beta:c}=e;return{x:()=>_nt(s,i,n,r,o,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UD(n,t,e,s){return t.rank<e.rank&&(t=Y(t,_n(t.shape,s))),n.rank<e.rank&&(n=Y(n,_n(n.shape,s))),{x:()=>G(n,Rt(Pr(e,t),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zE={kernelName:Ub,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{reductionIndices:i}=s,r=t[0],o=t[1],a=le(i,r.shape),c=UD(n,o,r,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ent={kernelName:Xd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>G(n,Rt(Uc(e,s),"float32")),b:()=>G(n,Rt(Rm(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $nt(n,t,e,s,i,r,o){const a=W(n,"dy","maxPool3dGrad"),c=W(t,"input","maxPool3dGrad"),l=W(e,"output","maxPool3dGrad");let u=a,h=c,f=l,g=!1;c.rank===4&&(g=!0,u=Y(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=Y(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=Y(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),P(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),P(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),P(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),Ps("maxPool3dGrad",r,o);const m={dy:u,input:h,output:f},x={filterSize:s,strides:i,pad:r,dimRoundingMode:o},b=q.runKernel(J1,m,x);return g?Y(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const Nnt=J({maxPool3dGrad_:$nt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rnt={kernelName:Gb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,i]=t,{filterSize:r,strides:o,pad:a,dimRoundingMode:c}=e;return{x:()=>Nnt(n,s,i,r,o,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ant(n,t,e,s,i,r,o){const a=W(n,"dy","maxPoolGrad"),c=W(t,"input","maxPoolGrad"),l=W(e,"output","maxPoolGrad");P(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),P(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),P(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),Ps("maxPoolGrad",r,o);const u={dy:a,input:c,output:l},h={filterSize:s,strides:i,pad:r,dimRoundingMode:o};return q.runKernel(Y1,u,h)}const Dnt=J({maxPoolGrad_:Ant});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ont={kernelName:Hb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,i]=t,{filterSize:r,strides:o,pad:a}=e;return{x:()=>Dnt(n,s,i,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pnt={kernelName:jb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:i}=e,r=le(i,s.shape),a=Vn(s.shape,r)[1],c=ut(a);return{x:()=>{const u=s.shape.slice();r.forEach(g=>{u[g]=1});const h=Y(n,u);return Ut(G(h,$a(s.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fnt={kernelName:qb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{axis:i}=s,[r,o]=t,a=le(i,r.shape),c=UD(n,o,r,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mnt={kernelName:Yd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>G(n,Rt(uu(e,s),"float32")),b:()=>G(n,Rt(hi(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lnt={kernelName:Kb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:i}=e,r=i.map(o=>o[0]);return{x:()=>qe(n,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bnt={kernelName:Jd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{const a=Dn(e.shape,i);return a.length>0?Y(Vt(n,a),e.shape):n},b:()=>{const a=G(n,mn(kx(Ut(e,s)))),c=Dn(s.shape,i);return c.length>0?Y(Vt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const znt={kernelName:Zd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{const a=G(n,Rt(s,"float32")),c=Dn(e.shape,i);return c.length>0?Y(Vt(a,c),e.shape):a},b:()=>{const a=G(n,Rt(e,"float32")),c=Dn(s.shape,i);return c.length>0?Y(Vt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wnt={kernelName:Xb,gradFunc:n=>({x:()=>mn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vnt={kernelName:Zb,inputsToSave:["indices"],gradFunc:(n,t)=>{const e=t[0];return{indices:()=>Bn(e.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Unt={kernelName:Jb,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hnt={kernelName:Qb,saveAllInputs:!0,gradFunc:(n,t,e)=>{const{axis:s}=e;return Pc(n,s).map(r=>()=>r)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WE={kernelName:tx,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:i}=e,r=i.map(o=>o[0]);return{x:()=>qe(n,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gnt={kernelName:Qd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{const[e,s,i]=t,r=e,o=s,a=ee(r.shape,o.shape);return{a:()=>{const u=Rt(o,"float32");let h=G(n,G(u,Dc(r,jt(u,Ae(1)))));const f=Dn(r.shape,a);return f.length>0&&(h=Vt(h,f)),Y(h,r.shape)},b:()=>{const u=hi(r,0),h=ys(u,Mr(r),ke(r));let f=G(n,G(i,h));const g=Dn(o.shape,a);return g.length>0&&(f=Vt(f,g)),Y(f,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jnt={kernelName:ex,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{const[e,s]=t,i=hi(e,0);return{x:()=>ys(i,n,G(n,s)),alpha:()=>{let r=ys(i,ke(n),G(n,e));const o=Dn(s.shape,n.shape);return o.length>0&&(r=Vt(r,o)),Y(r,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qnt(n,t,e){const s=n.shape.slice();s[e]=1;const i=Y(t,s),r=gv(n,e,!0,!1),o=gv(n,e,!0,!0),a=G(r,o);return G(i,a)}function Knt(n,t,e){const s=n.shape.length,i=s-e.length,r=un(e,s);let o=n;r!=null&&(o=Ie(n,r));const a=o.shape.slice(),l=a.splice(s-e.length,e.length).reduce((f,g)=>f*g,1);a.push(l);const u=o.reshape(a);let h=qnt(u,t,i);if(h=h.reshape(o.shape),r!=null){const f=Ta(r);h=Ie(h,f)}return h}const Xnt={kernelName:nx,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:i}=e;let r=[];return i==null?r=s.shape.map((o,a)=>a):typeof i=="number"?r=[i]:r=i,{x:()=>Knt(s,n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ynt={kernelName:Pd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{const a=Ut(n,Rt(s,"float32")),c=Dn(e.shape,i);return c.length>0?Y(Vt(a,c),e.shape):a},b:()=>{let a=G(n,Rt(e,"float32"));const c=Dn(s.shape,i);c.length>0&&(a=Y(Vt(a,c),s.shape));const l=Qe(s);return mn(Ut(a,Rt(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jnt={kernelName:tf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,mn(Qe(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Znt={kernelName:nf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=G(uu(e,6),If(e));return{x:()=>G(n,Rt(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qnt={kernelName:ef,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,Rt(If(e),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tst={kernelName:sx,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Y(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const est={kernelName:rx,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,i={dy:n,images:s};return{images:()=>q.runKernel(iC,i,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nst={kernelName:ix,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,i={dy:n,images:s};return{images:()=>q.runKernel(sC,i,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sst={kernelName:ox,gradFunc:(n,t,e)=>{const{dims:s}=e,i=le(s,n.shape);return{x:()=>Oc(n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ist={kernelName:sf,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rst={kernelName:rf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>mn(Ut(n,G(Dc(e,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ost={kernelName:ax,inputsToSave:["condition"],gradFunc:(n,t)=>{const[e]=t;return{condition:()=>Rt(ke(e),"float32"),t:()=>G(n,Rt(e,n.dtype)),e:()=>G(n,Rt(SC(e),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ast={kernelName:of,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=hi(e,Ae(0)),i=Ae(Tx),r=Ae(Ex),o=G(n,r),a=G(G(n,i),Fr(Rt(e,"float32")));return ys(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cst={kernelName:uf,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,G(e,jt(Ae(1),e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lst={kernelName:lf,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ust={kernelName:af,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(yC(Rt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hst={kernelName:cf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G($A(Rt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dst={kernelName:cx,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{begin:i,size:r}=e,o=s.shape,[a,c]=Sx(s,i,r),l=[];for(let u=0;u<n.rank;u++)l.push([a[u],o[u]-a[u]-c[u]]);return{x:()=>EC(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fst={kernelName:dx,outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{dim:i}=e,r=!0,o=G(n,s);return{logits:()=>jt(o,G(Vt(o,[i],r),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pst={kernelName:hf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,lu(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VE={kernelName:ux,gradFunc:(n,t,e)=>{const{blockShape:s,paddings:i}=e;return{x:()=>bC(n,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UE={kernelName:hx,gradFunc:(n,t,e)=>{const{axis:s}=e;return{x:()=>Rs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gst={kernelName:df,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,G(ss(Rt(e,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mst={kernelName:rC,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(n,G(Rt(e,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bst={kernelName:ff,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=Ae(2);return{a:()=>G(n,G(i,jt(e,s))),b:()=>G(n,G(i,jt(s,e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xst={kernelName:xf,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yst={kernelName:pf,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,i=ee(e.shape,s.shape);return{a:()=>{let a=n;const c=Dn(e.shape,i);return c.length>0&&(a=Vt(a,c)),Y(a,e.shape)},b:()=>{let a=n;const c=Dn(s.shape,i);return c.length>0&&(a=Vt(a,c)),Y(mn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wst={kernelName:lx,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,i=s.shape.slice(),{axis:r}=e;le(r,s.shape).forEach(l=>{i[l]=1});const a=Y(n,i),c=G(a,$a(s.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vst={kernelName:gf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Ut(n,Qe(yC(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cst={kernelName:mf,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>G(jt(Ae(1),Qe(e)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ist={kernelName:bf,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{reps:i}=e;return{x:()=>{let o=ke(s);if(s.rank===1)for(let a=0;a<i[0];++a)o=It(o,qe(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<i[0];++a)for(let c=0;c<i[1];++c)o=It(o,qe(n,[a*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<i[0];++a)for(let c=0;c<i[1];++c)for(let l=0;l<i[2];++l)o=It(o,qe(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<i[0];++a)for(let c=0;c<i[1];++c)for(let l=0;l<i[2];++l)for(let u=0;u<i[3];++u)o=It(o,qe(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kst={kernelName:Dl,gradFunc:(n,t,e)=>{const s=e,{perm:i}=s,r=Ta(i);return{x:()=>Ie(n,r)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sst={kernelName:fx,gradFunc:(n,t,e)=>{const s=e,{axis:i}=s;return{value:()=>$o(n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _st={kernelName:px,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Tst(n,e)}}};function Tst(n,t){const e=Ea(t,ke(t)),s=CC(n,e);let i=Uc(t,Ae(0,"int32"));const r=s.rank-i.rank;for(let a=0;a<r;++a)i=$s(i,a+1);i=Eo(i,$a(s.shape,"bool"));const o=ke(s);return ys(i,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Est={kernelName:gx,gradFunc:n=>({x:()=>ke(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $st=[VD,_et,Tet,Eet,$et,Net,Ret,Aet,Det,Oet,Pet,Fet,Bet,Vet,Uet,Het,Get,jet,qet,Ket,Xet,Yet,Zet,Jet,ent,nnt,snt,int,rnt,ont,Ynt,ant,cnt,lnt,unt,hnt,fnt,dnt,pnt,gnt,mnt,bnt,xnt,ynt,wnt,vnt,Cnt,Int,knt,Tnt,zE,zE,Ent,Rnt,Ont,Pnt,Fnt,Mnt,Lnt,Bnt,znt,Wnt,Vnt,Unt,Hnt,WE,WE,Gnt,jnt,Xnt,Jnt,Znt,Qnt,tst,est,nst,sst,ist,rst,ost,ast,cst,lst,ust,hst,dst,fst,pst,VE,VE,UE,UE,gst,bst,mst,xst,yst,wst,vst,Cst,Ist,kst,Sst,_st,Est];for(const n of $st)aY(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.abs=function(){return this.throwIfDisposed(),fs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.acos=function(){return this.throwIfDisposed(),l9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.acosh=function(){return this.throwIfDisposed(),h9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.add=function(n){return this.throwIfDisposed(),It(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.all=function(n,t){return this.throwIfDisposed(),SA(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.any=function(n,t){return this.throwIfDisposed(),fv(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.argMax=function(n){return this.throwIfDisposed(),Jh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.argMin=function(n){return this.throwIfDisposed(),m9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.asScalar=function(){return this.throwIfDisposed(),P(this.size===1,()=>"The array must have only 1 element."),Y(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.asType=function(n){return this.throwIfDisposed(),Rt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.as1D=function(){return this.throwIfDisposed(),Y(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.as2D=function(n,t){return this.throwIfDisposed(),Y(this,[n,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),Y(this,[n,t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.as4D=function(n,t,e,s){return this.throwIfDisposed(),Y(this,[n,t,e,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.as5D=function(n,t,e,s,i){return this.throwIfDisposed(),Y(this,[n,t,e,s,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.asin=function(){return this.throwIfDisposed(),x9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.asinh=function(){return this.throwIfDisposed(),w9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.atan=function(){return this.throwIfDisposed(),C9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.atan2=function(n){return this.throwIfDisposed(),k9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.atanh=function(){return this.throwIfDisposed(),_9(this)};ct().prototype.avgPool=function(n,t,e,s){return this.throwIfDisposed(),mC(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),bC(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.batchNorm=function(n,t,e,s,i){return this.throwIfDisposed(),wx(this,n,t,e,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Fh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.cast=function(n){return this.throwIfDisposed(),Rt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.ceil=function(){return this.throwIfDisposed(),Q9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),ui(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof Tn&&(n=[n]),Rs([this,...n],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.conv1d=function(n,t,e,s,i,r){return this.throwIfDisposed(),_A(this,n,t,e,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.conv2dTranspose=function(n,t,e,s,i){return this.throwIfDisposed(),TA(this,n,t,e,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.conv2d=function(n,t,e,s,i,r){return this.throwIfDisposed(),Ac(this,n,t,e,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.cos=function(){return this.throwIfDisposed(),yC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.cosh=function(){return this.throwIfDisposed(),$A(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),gv(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),NA(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),kJ(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.depthwiseConv2d=function(n,t,e,s,i,r){return this.throwIfDisposed(),wC(this,n,t,e,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.dilation2d=function(n,t,e,s,i){return this.throwIfDisposed(),TJ(this,n,t,e,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.divNoNan=function(n){return this.throwIfDisposed(),AJ(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.div=function(n){return this.throwIfDisposed(),Ut(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.dot=function(n){return this.throwIfDisposed(),OJ(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.elu=function(){return this.throwIfDisposed(),Cx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.equal=function(n){return this.throwIfDisposed(),Pr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.erf=function(){return this.throwIfDisposed(),RA(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),jJ(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.exp=function(){return this.throwIfDisposed(),Fr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.expandDims=function(n){return this.throwIfDisposed(),$s(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.expm1=function(){return this.throwIfDisposed(),YJ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.fft=function(){return this.throwIfDisposed(),YA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.flatten=function(){return this.throwIfDisposed(),Y(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.floor=function(){return this.throwIfDisposed(),kx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.floorDiv=function(n){return this.throwIfDisposed(),kA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.gather=function(n,t,e){return this.throwIfDisposed(),CC(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Uc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.greater=function(n){return this.throwIfDisposed(),hi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.ifft=function(){return this.throwIfDisposed(),mv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.irfft=function(){return this.throwIfDisposed(),WQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.isFinite=function(){return this.throwIfDisposed(),rZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.isInf=function(){return this.throwIfDisposed(),aZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.isNaN=function(){return this.throwIfDisposed(),lZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.leakyRelu=function(n){return this.throwIfDisposed(),kC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.lessEqual=function(n){return this.throwIfDisposed(),uu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.less=function(n){return this.throwIfDisposed(),Rm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.localResponseNormalization=function(n,t,e,s){return this.throwIfDisposed(),pZ(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logSigmoid=function(){return this.throwIfDisposed(),vZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logSoftmax=function(n){return this.throwIfDisposed(),FA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),MA(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.log=function(){return this.throwIfDisposed(),Mr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.log1p=function(){return this.throwIfDisposed(),PA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Eo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logicalNot=function(){return this.throwIfDisposed(),SC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logicalOr=function(n){return this.throwIfDisposed(),LA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.logicalXor=function(n){return this.throwIfDisposed(),$Z(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),Ne(this,n,t,e)};ct().prototype.maxPool=function(n,t,e,s){return this.throwIfDisposed(),_C(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.max=function(n,t){return this.throwIfDisposed(),ir(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.maximum=function(n){return this.throwIfDisposed(),Ea(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.mean=function(n,t){return this.throwIfDisposed(),kn(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.min=function(n,t){return this.throwIfDisposed(),Nm(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.minimum=function(n){return this.throwIfDisposed(),td(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),MZ(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.mod=function(n){return this.throwIfDisposed(),BZ(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.mul=function(n){return this.throwIfDisposed(),G(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.neg=function(){return this.throwIfDisposed(),mn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.norm=function(n,t,e){return this.throwIfDisposed(),Ix(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.notEqual=function(n){return this.throwIfDisposed(),Am(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),BA(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.onesLike=function(){return this.throwIfDisposed(),Mi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.pad=function(n,t){return this.throwIfDisposed(),EC(this,n,t)};ct().prototype.pool=function(n,t,e,s,i,r){return this.throwIfDisposed(),XZ(this,n,t,e,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.pow=function(n){return this.throwIfDisposed(),Dc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.prelu=function(n){return this.throwIfDisposed(),NC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.prod=function(n,t){return this.throwIfDisposed(),ZZ(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.reciprocal=function(){return this.throwIfDisposed(),vQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.relu=function(){return this.throwIfDisposed(),Gc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.relu6=function(){return this.throwIfDisposed(),VA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.reshapeAs=function(n){return this.throwIfDisposed(),Y(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.reshape=function(n){return this.throwIfDisposed(),Y(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),eD(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),nD(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.reverse=function(n){return this.throwIfDisposed(),Oc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.rfft=function(){return this.throwIfDisposed(),HQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.round=function(){return this.throwIfDisposed(),UA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.rsqrt=function(){return this.throwIfDisposed(),HA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.selu=function(){return this.throwIfDisposed(),GA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.separableConv2d=function(n,t,e,s,i,r){return this.throwIfDisposed(),jA(this,n,t,e,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sigmoid=function(){return this.throwIfDisposed(),lu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sign=function(){return this.throwIfDisposed(),NQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sin=function(){return this.throwIfDisposed(),qA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sinh=function(){return this.throwIfDisposed(),KA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.slice=function(n,t){return this.throwIfDisposed(),qe(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.softmax=function(n){return this.throwIfDisposed(),zC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.softplus=function(){return this.throwIfDisposed(),wf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),$C(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.split=function(n,t){return this.throwIfDisposed(),li(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sqrt=function(){return this.throwIfDisposed(),ss(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.square=function(){return this.throwIfDisposed(),Qe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.squaredDifference=function(n){return this.throwIfDisposed(),jQ(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.squeeze=function(n){return this.throwIfDisposed(),Cf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.stack=function(n,t){this.throwIfDisposed();const e=n instanceof Tn?[this,n]:[this,...n];return $o(e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.step=function(n){return this.throwIfDisposed(),If(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.stridedSlice=function(n,t,e,s,i,r,o,a){return this.throwIfDisposed(),JQ(this,n,t,e,s,i,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sub=function(n){return this.throwIfDisposed(),jt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.sum=function(n,t){return this.throwIfDisposed(),Vt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.tan=function(){return this.throwIfDisposed(),QQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.tanh=function(){return this.throwIfDisposed(),yx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.tile=function(n){return this.throwIfDisposed(),Qi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.toBool=function(){return this.throwIfDisposed(),Rt(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.toFloat=function(){return this.throwIfDisposed(),Rt(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.toInt=function(){return this.throwIfDisposed(),Rt(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.topk=function(n,t){return this.throwIfDisposed(),ntt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.transpose=function(n){return this.throwIfDisposed(),Ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.unique=function(n){return this.throwIfDisposed(),rtt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),QA(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.unstack=function(n){return this.throwIfDisposed(),Pc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.where=function(n,t){return this.throwIfDisposed(),ys(n,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ct().prototype.zerosLike=function(){return this.throwIfDisposed(),ke(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,kr.prototype)}}class Di extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Di.prototype)}}class H extends Error{constructor(t){super(t),Object.setPrototypeOf(this,H.prototype)}}class se extends Error{constructor(t){super(t),Object.setPrototypeOf(this,se.prototype)}}class CI extends Error{constructor(t){super(t),Object.setPrototypeOf(this,CI.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HD{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fc(n,t){if(Array.isArray(n)){let e=[];for(let s=0;s<t;s++)e=e.concat(n);return e}else{const e=new Array(t);return e.fill(n),e}}function Sr(n,t){if(!n)throw new CI(t)}function HE(n,t){let e=0;for(const s of n)s===t&&e++;return e}function Ns(n){return n.length===1?n[0]:n}function Me(n){return Array.isArray(n)?n:[n]}function ho(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function cc(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}let Ii={};function II(n){if(n==null)return null;const t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function yv(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>yv(t));else{const t=Object.keys(n);for(const e of t){const s=n[e];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[e]=s.value:yv(s))}}}function Tf(n,t={},e={},s="object",i=!1){if(typeof n=="string"){const r=n;let o;if(r in e)o=e[r];else if(r in Ii)o=Ii[r];else if(o=t[r],o==null)throw new H(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const r=n;if(r.className==null||r.config==null)throw new H(`${s}: Improper config format: ${JSON.stringify(r)}.
'className' and 'config' must set.`);const o=r.className;let a,c;if(o in e?[a,c]=e[o]:o in Ii?[a,c]=Ii.className:o in t&&([a,c]=t[o]),a==null)throw new H(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const l={};for(const g of Object.keys(Ii))l[g]=Ii[g];for(const g of Object.keys(e))l[g]=e[g];const u=r.config;u.customObjects=l;const h=Object.assign({},Ii);for(const g of Object.keys(e))Ii[g]=e[g];yv(r.config);const f=c(a,r.config,e,i);return Ii=Object.assign({},h),f}else{const l=Object.assign({},Ii);for(const h of Object.keys(e))Ii[h]=e[h];const u=new a(r.config);return Ii=Object.assign({},l),u}}}function Nst(n,t){return n<t?-1:n>t?1:0}function Sg(n,t){return-1*Nst(n,t)}function da(n){if(n==null)return n;const t=[];for(const e of n)t.indexOf(e)===-1&&t.push(e);return t}function Rst(n){if(n==null)throw new H(`Invalid value in obj: ${JSON.stringify(n)}`);for(const t in n)if(n.hasOwnProperty(t))return!1;return!0}function qc(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new H(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function kI(n,t,e=0,s=1/0){return Sr(e>=0),Sr(s>=e),Array.isArray(n)&&n.length>=e&&n.length<=s&&n.every(i=>typeof i===t)}function Wn(n,t){Array.isArray(n)?(P(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,s)=>Wn(e,`element ${s+1} of ${t}`))):P(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${GD(n)}.`)}function GD(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>GD(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function Ast(n,t,e){let s=e!=null?e():Es(),i;return(...o)=>{const a=e!=null?e():Es();return a-s<t||(s=a,i=n(...o)),i}}function jD(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Dst=0;function qD(){return Dst++}const _g={};function $x(n=""){return n in _g||(_g[n]=0),_g[n]+=1,n+_g[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ost=["channelsFirst","channelsLast"],Pst=["nearest","bilinear"],Fst=["valid","same","causal"],Mst=["max","avg"],Lst=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wl=new Map;function yn(n){qc(Ost,"DataFormat",n)}function Bst(n){qc(Pst,"InterpolationFormat",n)}function di(n){qc(Fst,"PaddingMode",n)}function KD(n){qc(Mst,"PoolMode",n)}const Mh=[],GE="/";function yc(n,t){Mh.push(n);try{const e=t();return Mh.pop(),e}catch(e){throw Mh.pop(),e}}function zst(){return Mh.length===0?"":Mh.join(GE)+GE}function XD(n){if(!JD(n))throw new Error("Not a valid tensor name: '"+n+"'");return zst()+n}function YD(n){if(!JD(n))throw new Error("Not a valid tensor name: '"+n+"'");wl.has(n)||wl.set(n,0);const t=wl.get(n);if(wl.set(n,wl.get(n)+1),t>0){const e=`${n}_${t}`;return wl.set(e,1),e}else return n}const Wst=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function JD(n){return!!n.match(Wst)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vst(n){return n===parseInt(n.toString(),10)}function fa(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let s=1;for(let i=t;i<e;++i)s*=n[i];return s}function Xl(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s<t&&(t=s)}return t}function ba(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s>t&&(t=s)}return t}function ar(n,t){if(t<n)throw new H(`end (${t}) < begin (${n}) is forbidden.`);const e=[];for(let s=n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let rw;function En(){return rw==null&&(rw=DY().epsilon()),rw}function cr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dr(n,t){return Rt(n,t)}function Ef(n,t=-1){const e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),Y(n,e)}function Ust(n,t){return nt(()=>{if(n.shape.length!==2)throw new H(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const e=Ef(n,1);return wv(e,[1,t,1])})}function Hst(n){const t=[fa(n.shape)];return Y(n,t)}function Gst(n){if(n.rank<=1)throw new H(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const t=[n.shape[0],fa(n.shape,1)];return Y(n,t)}function wc(n,t,e){return nt(()=>{switch(n.rank){case 1:return LC(n,t,e);case 2:return XA(n,[t,0],[e,n.shape[1]]);case 3:return BC(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return Om(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return qe(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return qe(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new H(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function ow(n,t,e){return nt(()=>{switch(n.rank){case 1:return LC(n,t,e);case 2:return XA(n,[0,t],[n.shape[0],e]);case 3:return BC(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return Om(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Tg(n,t,e,s){return nt(()=>{switch(n.rank){case 1:return LC(n,t,e);case 2:switch(s){case 1:return wc(n,t,e);case 2:return ow(n,t,e);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return wc(n,t,e);case 2:return BC(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return ow(n,t,e);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return wc(n,t,e);case 2:return Om(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return Om(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return ow(n,t,e);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function SI(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),Rs(n,t)}function jE(n,t){switch(n.rank){case 1:return nJ([n,t]);case 2:return iJ([n,t],0);case 3:return oJ([n,t],0);case 4:return cJ([n,t],0);default:throw new H(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function wv(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new H(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return Qi(n,t)}function Nx(n,t=0,e=1,s,i){return bQ(n,t,e,s,i)}function Or(n,t,e,s){if(n.rank<2||t.rank<2)throw new se(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){const i=n.shape.slice(-1)[0],r=t.shape.slice(-2)[0];if(i!==r)throw new se(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return AE({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?vv(n.rank,s,cr()):null,activation:e});{const i=n.shape.slice(),r=i.pop();n=Y(n,[-1,r]);const o=t.shape.slice(),a=o.pop(),c=o.pop(),l=[...o,a],u=Array.from({length:t.rank},(m,x)=>x===0?t.rank-2:x<=t.rank-2?x-1:x);t=Y(Ie(t,u),[c,-1]);const h=[...i,...l];return Y(AE({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?vv(n.rank,s,cr()):null,activation:e}),h)}}function ZD(n,t,e){return nt(()=>(Array.isArray(t)?t=js(t,"int32"):t=Rt(t,"int32"),CC(n,t,e)))}function $f(n){return G(n,n)}function vv(n,t,e){const s=t.shape;if(t.rank!==1&&t.rank!==n)throw new H(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return s.length===1?Y(t,[1,s[0],1,1,1]):Y(t,[1,s[3],s[0],s[1],s[2]]);if(e==="channelsLast")return s.length===1?Y(t,[1,1,1,1,s[0]]):Y(t,[1].concat(s))}else if(n===4){if(e==="channelsFirst")return s.length===1?Y(t,[1,s[0],1,1]):Y(t,[1,s[2],s[0],s[1]]);if(e==="channelsLast")return s.length===1?Y(t,[1,1,1,s[0]]):Y(t,[1].concat(s))}else if(n===3){if(e==="channelsFirst")return s.length===1?Y(t,[1,s[0],1]):Y(t,[1,s[1],s[0]]);if(e==="channelsLast")return s.length===1?Y(t,[1,1,s[0]]):Y(t,[1].concat(s))}else if(n<3)return t;throw new H(`Unsupported input rank by biasAdd: ${t.rank}`)}function fr(n,t,e){return nt(()=>(e==null&&(e=cr()),yn(e),It(n,vv(n.rank,t,e))))}function jst(n,t=1){if(t!==1)throw new se(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Cx(n)}function qst(n){return nt(()=>Ut(n,It(fs(n),1)))}function QD(n,t,e,s){return nt(()=>dtt(n,t,e,s))}function Kst(n){return nt(()=>{const t=It(.5,G(.2,n));return ui(t,0,1)})}function Nf(n,t,e=!1){return e?n():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xst=["fanIn","fanOut","fanAvg"],Yst=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jst(n){qc(Xst,"FanMode",n)}function Zst(n){qc(Yst,"Distribution",n)}class Bi extends du{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class tO extends Bi{apply(t,e){return Bn(t,e)}}tO.className="Zeros";xt(tO);class _I extends Bi{apply(t,e){return $a(t,e)}}_I.className="Ones";xt(_I);class eO extends Bi{constructor(t){if(super(),typeof t!="object")throw new H(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new H(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return nt(()=>G(Ae(this.value),$a(t,e)))}getConfig(){return{value:this.value}}}eO.className="Constant";xt(eO);class nO extends Bi{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return vf(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}nO.className="RandomUniform";xt(nO);class sO extends Bi{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new se(`randomNormal does not support dType ${e}.`);return Nx(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}sO.className="RandomNormal";xt(sO);class iO extends Bi{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new se(`truncatedNormal does not support dType ${e}.`);return ZA(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}iO.className="TruncatedNormal";xt(iO);class rO extends Bi{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,e){return nt(()=>{if(t.length!==2||t[0]!==t[1])throw new H("Identity matrix initializer can only be used for 2D square matrices.");return G(this.gain,OA(t[0]))})}getConfig(){return{gain:this.gain}}}rO.className="Identity";xt(rO);function Qst(n,t="channelsLast"){let e,s;if(yn(t),n.length===2)e=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){const i=fa(n,2);e=n[1]*i,s=n[0]*i}else if(t==="channelsLast"){const i=fa(n,0,n.length-2);e=n[n.length-2]*i,s=n[n.length-1]*i}}else{const i=fa(n);e=Math.sqrt(i),s=Math.sqrt(i)}return[e,s]}class Xs extends Bi{constructor(t){if(super(),t.scale<0)throw new H(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,Jst(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,Zst(this.distribution),this.seed=t.seed}apply(t,e){const s=Qst(t),i=s[0],r=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,r):o/=Math.max(1,(i+r)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(e=e||"float32",e!=="float32"&&e!=="int32")throw new se(`${this.getClassName()} does not support dType ${e}.`);return ZA(t,0,a,e,this.seed)}else{const a=Math.sqrt(3*o);return vf(t,-a,a,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Xs.className="VarianceScaling";xt(Xs);class TI extends Xs{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Xs.className}}TI.className="GlorotUniform";xt(TI);class EI extends Xs{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Xs.className}}EI.className="GlorotNormal";xt(EI);class $I extends Xs{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Xs.className}}$I.className="HeNormal";xt($I);class NI extends Xs{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Xs.className}}NI.className="HeUniform";xt(NI);class RI extends Xs{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Xs.className}}RI.className="LeCunNormal";xt(RI);class AI extends Xs{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Xs.className}}AI.className="LeCunUniform";xt(AI);class oO extends Bi{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return nt(()=>{if(t.length<2)throw new se("Shape must be at least 2D.");if(e!=="int32"&&e!=="float32"&&e!==void 0)throw new TypeError(`Unsupported data type ${e}.`);e=e;const s=ut(t.slice(0,-1)),i=t[t.length-1],r=s*i;r>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${r}) elements: Slowness may result.`);const o=[Math.max(i,s),Math.min(i,s)],a=Nx(o,0,1,e,this.seed),c=cet.qr(a,!1);let l=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(i,s)*Math.min(i,s)],[Math.min(i,s)+1]);return l=G(l,h.sign()),s<i&&(l=l.transpose()),G(Ae(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}oO.className="Orthogonal";xt(oO);const qE={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function KE(n,t={}){return Tf(n,$i.getMap().classNameMap,t,"initializer")}function ln(n){return II(n)}function rn(n){if(typeof n=="string"){const t=n in qE?qE[n]:n;if(t==="GlorotNormal")return new EI;if(t==="GlorotUniform")return new TI;if(t==="HeNormal")return new $I;if(t==="HeUniform")return new NI;if(t==="LeCunNormal")return new RI;if(t==="LeCunUniform")return new AI;{const e={};return e.className=t,e.config={},KE(e)}}else return n instanceof Bi?n:KE(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Cv(n){return Array.isArray(n)&&Array.isArray(n[0])}function Pm(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Xt(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new H(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function Te(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new H(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fm(n){let t=0;for(const e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((s,i)=>s*i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const XE="Variable";class tit{constructor(t,e="float32",s=XE,i=!0,r=null){this.dtype=e??"float32",this.shape=t.shape,this.id=qD(),s=s??XE,this.originalName=XD(s),this.name=YD(this.originalName),this.trainable_=i,this.constraint=r,this.val=ctt(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),eit(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function eit(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function Iv(n){return n.map(t=>t.read())}function DI(n){n.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $n{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Lr{constructor(t,e,s,i,r,o,a){this.dtype=t,this.shape=e,this.sourceLayer=s,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=qD(),o!=null&&(this.originalName=XD(o),this.name=YD(this.originalName)),this.rank=e.length}}let nit=0;class Rx{constructor(t,e){this.callArgs=e,this.id=nit++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let sit=0;class ue extends du{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=sit++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const s=this.getClassName();e=ho(s)+"_"+$x(s)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let r=null;t.batchSize!=null&&(r=t.batchSize),s=[r].concat(t.inputShape)}this.batchInputShape=s;let i=t.dtype;i==null&&(i=t.inputDType),i==null&&(i="float32"),this.dtype=i}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new Di(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new H(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Ns(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Ns(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new kr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new kr(`Layer ${this.name} is not connected, no input to return.`);return Ns(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new kr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new kr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ns(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){const e=Me(t);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Me(this.inputSpec);if(e.length!==s.length)throw new H(`Layer ${this.name} expects ${s.length} inputs, but it received ${e.length} input tensors. Input received: ${t}`);for(let i=0;i<e.length;i++){const r=e[i],o=s[i];if(o==null)continue;const a=r.rank;if(o.ndim!=null&&a!==o.ndim)throw new H(`Input ${i} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new H(`Input ${i} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new H(`Input ${i} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&r.dtype!==o.dtype)throw new H(`Input ${i} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${r.dtype}.`);if(o.axes){const c=r.shape;for(const l in o.axes){const u=Number(l),h=o.axes[l],f=u>=0?c[u]:c[c.length+u];if(h!=null&&[h,null].indexOf(f)===-1)throw new H(`Input ${i} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${h} but got shape ${c}.`)}}if(o.shape!=null)for(let c=0;c<o.shape.length;++c){const l=o.shape[c],u=r.shape[c];if(l!=null&&u!=null&&l!==u)throw new H(`Input ${i} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const s=Me(t),i=oit(t),r=ait(t);if(i===r)throw new H("Arguments to apply() must be all SymbolicTensors or all Tensors");return yc(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const o=[];for(const a of Me(t))o.push(a.shape);this.build(Ns(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&r&&(this._refCount=1)}if(this.assertInputCompatibility(t),r){let o=this.call(t,e);this.supportsMasking&&this.setMaskMetadata(t,o);const a=Me(o),c=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(o=Ns(c),this.activityRegularizer!=null)throw new se("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=iit(t),a=this.computeOutputShape(o);let c;const l=rit(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((u,h)=>new Lr(l,u,this,Me(t),e,this.name,h)):c=new Lr(l,a,this,Me(t),e,this.name),this.addInboundNode(t,c,null,null,o,a,e),this._refCount++,this.activityRegularizer!=null)throw new se("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((s,i)=>{s!=null&&t[i]!=null&&t[i]!==s&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new kr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const s=JSON.stringify(e.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new kr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Di(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Fm(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Iv(t?this.trainableWeights:this.weights)}setWeights(t){nt(()=>{const e=this.weights;if(e.length!==t.length)throw new H(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;const s=[],i=Iv(e);for(let r=0;r<i.length;++r){const o=i[r],a=e[r],c=t[r];if(!De(o.shape,c.shape))throw new H(`Layer weight shape ${o.shape} not compatible with provided weight shape ${c.shape}`);s.push([a,c])}DI(s)})}addWeight(t,e,s,i,r,o,a,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new H(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():rn("zeros"));const l=i.apply(e,s),u=new tit(l,s,t,o,a);return l.dispose(),r!=null&&this.addLoss(()=>r.apply(u.read())),o==null&&(o=!0),o?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=Me(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}setMaskMetadata(t,e,s){if(!this.supportsMasking)return;const i=this.computeMask(t,s),r=Me(e),o=Me(i);if(r.length!==o.length)throw new Error(`${this.name} outputs ${r.length} tensors but ${r.length} masks for those tensors`);for(let a=0;a<r.length;a++)r[a].kerasMask=o[a]}addInboundNode(t,e,s,i,r,o,a=null){const c=Me(t);e=Me(e),s=Me(s),i=Me(i),r=Pm(r),o=Pm(o);const l=[],u=[],h=[];for(const f of c)l.push(f.sourceLayer),u.push(f.nodeIndex),h.push(f.tensorIndex);new Rx({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:h,inputTensors:c,outputTensors:e,inputMasks:s,outputMasks:i,inputShapes:r,outputShapes:o},a);for(let f=0;f<e.length;f++)e[f].sourceLayer=this,e[f].nodeIndex=this.inboundNodes.length-1,e[f].tensorIndex=f}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function iit(n){n=Me(n);const t=[];for(const e of n)t.push(e.shape);return Ns(t)}function rit(n){return"float32"}function aO(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{const s=t.inboundNodes[e];if(s.inboundLayers.length===0)return s.inputTensors;{const i=[];for(let r=0;r<s.inboundLayers.length;r++){const o=s.inputTensors[r],a=s.inboundLayers[r],c=s.nodeIndices[r],l=aO(o,a,c);for(const u of l)i.indexOf(u)===-1&&i.push(u)}return i}}}function oit(n){let t=!0;for(const e of Me(n))if(!(e instanceof Lr)){t=!1;break}return t}function ait(n){let t=!0;for(const e of Me(n))if(e instanceof Lr){t=!1;break}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Rf extends ue{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:$x("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new H("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(e==null){if(t.inputShape==null)throw new H("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new H("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=e,this.dtype=s,this.inputSpec=[{shape:e}];const i=new Lr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new Rx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new H(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Rf.className="InputLayer";xt(Rf);function cit(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new H("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new Rf({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lit(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return Rt(t,n.dtype)}catch{throw new H(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class ra{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof ra)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=lit(t,e),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new H(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Lr){if(this.id2Value[t.id]==null)throw new H(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const e=this.name2Id[t];if(e==null)throw new H(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof Lr){if(this.id2Value[t.id]==null)throw new H(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const e=this.name2Id[t];if(e==null)throw new H(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&fe(this.id2Mask)}}const Mm=new HD,Lm=new HD;function uit(n){Mm!=null&&Mm.setMaxEntries(n),Lm!=null&&Lm.setMaxEntries(n)}function kh(n,t,e,s){const i=e==null?!1:e.training,r=Array.isArray(n),o=r?n:[n],a=o.map(m=>m.name),c=[],l=t.names();for(const m of a)l.indexOf(m)!==-1?c.push(t.getValue(m)):c.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const u=a.join(",")+"|"+t.names().sort().join(",");let h=Mm.get(u),f;if(h==null){const m=hit(o,t);h=m.sorted,f=m.recipientCounts,Mm.put(u,h),Lm.put(u,f)}f={},i||Object.assign(f,Lm.get(u));const g=new ra(t);for(let m=0;m<h.length;++m){if(s!=null){const F=lv().numTensors;F>s.maxNumTensors&&(s.maxNumTensors=F),F<s.minNumTensors&&(s.minNumTensors=F)}const x=h[m],b=x.sourceLayer;if(b instanceof Rf)continue;const y=[],v=[],k=[];let I=!1;for(const F of x.inputs){const L=g.getValue(F),V=g.getMask(F);y.push(L),v.push(V),V!=null&&(I=!0),i||(f[F.name]--,f[F.name]===0&&!t.hasKey(F)&&a.indexOf(F.name)===-1&&!L.isDisposed&&F.sourceLayer.stateful!==!0&&k.push(L))}I&&(e=e||{},e.mask=v[0]);const _=Me(b.apply(y,e));let $=null;b.supportsMasking&&($=b.computeMask(y,v));const R=fit(x),A=Array.isArray(R)?R:[R];for(let F=0;F<A.length;++F){g.hasKey(A[F])||g.add(A[F],_[F],Array.isArray($)?$[0]:$);const L=a.indexOf(A[F].name);L!==-1&&(c[L]=_[F])}i||fe(k)}return g.disposeMasks(),r?c:c[0]}function hit(n,t){P(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],s={};if(n.length===1){const i=YE(n[0],t);e=i.sorted,s=i.recipientMap}else{const i=new Set;for(const r of n){const{sorted:o,recipientMap:a}=YE(r,t);for(const c of o)i.has(c.name)||(e.push(c),i.add(c.name));for(const c in a)s[c]==null&&(s[c]=new Set),a[c].forEach(l=>s[c].add(l))}}return{sorted:e,recipientCounts:dit(s)}}function dit(n){const t={};for(const e in n)t[e]=n[e].size;return t}function YE(n,t){const e=new Set,s=[],i={};for(const a of t.names())e.add(a);const r=[],o=[];for(r.push(n);r.length>0;){const a=r[r.length-1];if(e.has(a.name)){r.pop();continue}const c=o[o.length-1]===r.length-1;if(a.inputs.length===0||c)r.pop(),s.push(a),e.add(a.name),c&&o.pop();else{o.push(r.length-1);for(const l of a.inputs)i[l.name]==null&&(i[l.name]=new Set),i[l.name].add(a.name),!e.has(l.name)&&r.push(l)}}return{sorted:s,recipientMap:i}}function fit(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const i of n.sourceLayer.inboundNodes[s].outputTensors)if(i.id===n.id){e=s;break}t=n.sourceLayer.getOutputAt(e)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pit=rt();pit.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,uit);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OI(n,t){return nt(()=>ss(Vt(G(n,n),t,!0)))}class Af extends du{getConfig(){return{}}}class cO extends Af{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return nt(()=>{const e=OI(t,this.axis),s=ui(e,0,this.maxValue);return G(t,Ut(s,It(En(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}cO.className="MaxNorm";xt(cO);class lO extends Af{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return nt(()=>Ut(t,It(En(),OI(t,this.axis))))}getConfig(){return{axis:this.axis}}}lO.className="UnitNorm";xt(lO);class uO extends Af{apply(t){return Gc(t)}}uO.className="NonNeg";xt(uO);class hO extends Af{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return nt(()=>{const e=OI(t,this.axis),s=It(G(this.rate,ui(e,this.minValue,this.maxValue)),G(1-this.rate,e));return G(t,Ut(s,It(En(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}hO.className="MinMaxNorm";xt(hO);const JE={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Nn(n){return II(n)}function ZE(n,t={}){return Tf(n,$i.getMap().classNameMap,t,"constraint")}function Rn(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in JE?JE[n]:n,config:{}};return ZE(e)}else return n instanceof Af?n:ZE(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ec(n){if(n==null)return;const t=[],e=[],s=[];for(const i in n){const r=n[i];if(typeof r!="number"){const o=r;t.push(o.data()),e.push(i),s.push(o)}}if(t.length>0){const i=await Promise.all(t);for(let r=0;r<i.length;++r)n[e[r]]=i[r][0];fe(s)}}function dO(n){if(n!=null)for(const t in n){const e=n[t];typeof e!="number"&&e.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var QE;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(QE||(QE={}));const git=125;class nd{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class mit{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochBegin(t,e)}async onEpochEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochEnd(t,e)}async onBatchBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchBegin(t,e)}async onBatchEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchEnd(t,e)}async onTrainBegin(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class bit extends nd{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){e==null&&(e={});const s=e.size==null?0:e.size;this.seen+=s;for(const i in e){const r=e[i];if(typeof r=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+r*s;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=nt(()=>It(this.totals[i],G(r,s)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(t,e){if(e!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?e[s]=this.totals[s]/this.seen:nt(()=>{const i=G(Ut(1,this.seen),this.totals[s]);e[s]=i,this.totals[s].dispose(),Rr(e[s])}))}}class xit extends nd{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){e==null&&(e={}),this.epoch.push(t);for(const s in e)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(e[s])}async syncData(){const t=[],e=[],s=[];for(const r in this.history){const o=this.history[r];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const c=o[a];t.push(c.data()),e.push(r),s.push(a)}}const i=await Promise.all(t);for(let r=0;r<i.length;++r)this.history[e[r]][s[r]].dispose(),this.history[e[r]][s[r]]=i[r][0]}}class yit extends nd{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||bD,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=git),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Jw(this.yieldEvery)&&(this.maybeWait=Ast(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,s){const i=[];this.yield!=null&&(await ec(s),i.push(this.yield(t,e,s))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,e){this.currentEpoch=t,this.epochBegin!=null&&(await ec(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const s=[];this.epochEnd!=null&&(await ec(e),s.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,e){this.batchBegin!=null&&(await ec(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const s=[];this.batchEnd!=null&&(await ec(e),s.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Jw(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await ec(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await ec(t),await this.trainEnd(t))}}function fO(n,t){return n==null&&(n={}),n instanceof nd?[n]:Array.isArray(n)&&n[0]instanceof nd?n:Me(n).map(s=>new yit(s,t))}class _i{constructor(){}static registerCallbackConstructor(t,e){P(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),_i.checkForDuplicate(e),_i.constructors[t]==null&&(_i.constructors[t]=[]),_i.constructors[t].push(e)}static checkForDuplicate(t){for(const e in _i.constructors)_i.constructors[+e].forEach(i=>{if(i===t)throw new H("Duplicate callback constructor.")})}static clear(){_i.constructors={}}static createCallbacks(t){const e=[];for(const s in _i.constructors){const i=+s;t>=i&&e.push(..._i.constructors[i])}return e.map(s=>new s)}}_i.constructors={};function pO(n,t,e,s,i,r,o,a,c){const l=new xit,u=[new bit,..._i.createCallbacks(t)];n!=null&&u.push(...n),u.push(l);const h=new mit(u);return h.setParams({epochs:e,initialEpoch:s,samples:i,steps:r,batchSize:o,verbose:t,doValidation:a,metrics:c}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function So(n,t={},e=!1){return Tf(n,$i.getMap().classNameMap,t,"layer",e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bm(n,t){return nt(()=>{n.dtype!=="float32"&&(n=Rt(n,"float32"));const e=Vt($f(n),t,!0),s=vx(e.shape,En()),i=ss(Ea(e,s));return Ut(n,i)})}function Ax(n,t){return nt(()=>kn($f(jt(t,n)),-1))}function PI(n,t){return nt(()=>kn(fs(jt(t,n)),-1))}function FI(n,t){return nt(()=>{const e=jt(n,t),s=ui(fs(n),En(),Number.MAX_VALUE),i=fs(Ut(e,s));return G(100,kn(i,-1))})}function wit(n,t){return nt(()=>{const e=ui(t,En(),Number.MAX_VALUE),s=Mr(It(1,e)),i=ui(n,En(),Number.MAX_VALUE),r=Mr(It(1,i));return kn($f(jt(s,r)),-1)})}function vit(n,t){return nt(()=>{const e=Ea(0,jt(1,G(n,t)));return kn($f(e),-1)})}function Cit(n,t){return nt(()=>{const e=Ea(0,jt(1,G(n,t)));return kn(e,-1)})}function Iit(n,t){return nt(()=>{const e=Vt(G(n,t),-1),s=ir(G(jt(1,n),t),-1);return Ea(0,It(1,jt(s,e)))})}function kit(n,t){return nt(()=>{const e=Math.log(2),s=jt(t,n),i=jt(It(s,wf(G(-2,s))),e);return kn(i,-1)})}function sd(n,t,e=!1){return nt(()=>{if(e)t=zC(t);else{const s=Vt(t,t.shape.length-1,!0);t=Ut(t,s)}return t=ui(t,En(),1-En()),mn(Vt(G(Rt(n,"float32"),Mr(t)),t.shape.length-1))})}function zm(n,t,e=!1){return nt(()=>{const s=Rt(kx(Hst(n)),"int32");t=ui(t,En(),1-En());const i=t.shape,r=Y(BA(s,i[i.length-1]),i);return sd(r,t,e)})}function Sit(n,t){if(!De(n.shape,t.shape))throw new H(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return nt(()=>{const e=Gc(t),s=mn(fs(t));return It(jt(e,G(t,n)),PA(Fr(s)))})}function Dx(n,t){return nt(()=>{let e;return e=ui(t,En(),1-En()),e=Mr(Ut(e,jt(1,e))),kn(Sit(n,e),-1)})}function _it(n,t){return nt(()=>{const e=ui(n,En(),1),s=ui(t,En(),1);return Vt(G(n,Mr(Ut(e,s))),-1)})}function Tit(n,t){return nt(()=>{const e=Mr(It(En(),t));return kn(jt(t,G(n,e)),-1)})}function gO(n,t){return nt(()=>{const e=Bm(n,-1),s=Bm(t,-1),i=G(e,s);return mn(Vt(i,-1))})}const Wm={meanSquaredError:Ax,meanAbsoluteError:PI,meanAbsolutePercentageError:FI,meanSquaredLogarithmicError:wit,squaredHinge:vit,hinge:Cit,categoricalHinge:Iit,logcosh:kit,categoricalCrossentropy:sd,sparseCategoricalCrossentropy:zm,binaryCrossentropy:Dx,kullbackLeiblerDivergence:_it,poisson:Tit,cosineProximity:gO};function aw(n){if(typeof n=="string"){if(n in Wm)return Wm[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new H(t)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mO(n,t){return nt(()=>{const e=G(.5,Mi(t)),s=Dr(hi(t,e),n.dtype);return kn(Pr(n,s),-1)})}function bO(n,t){return nt(()=>Dr(Pr(Jh(n,-1),Jh(t,-1)),"float32"))}function Eit(n,t){return nt(()=>Rt(Vt(Eo(Pr(n,1),Pr(t,1))),"float32"))}function $it(n,t){return nt(()=>Rt(Vt(Eo(Pr(n,0),Pr(t,1))),"float32"))}function Nit(n,t){return nt(()=>{const e=Eit(n,t),s=$it(n,t),i=It(e,s);return Rt(ys(hi(i,0),Ut(e,i),0),"float32")})}function Rit(n,t){return Dx(n,t)}function Ait(n,t){return n.rank===t.rank&&(n=Cf(n,[n.rank-1])),t=Jh(t,-1),t.dtype!==n.dtype&&(t=Rt(t,n.dtype)),Rt(Pr(n,t),"float32")}const Dit=Ax,Oit=Ax,Pit=PI,Fit=PI,Mit=FI,Lit=FI,xO=sd,Bit=gO,yO=zm,Vm={binaryAccuracy:mO,categoricalAccuracy:bO,precision:Nit,categoricalCrossentropy:xO,sparseCategoricalCrossentropy:yO,mse:Dit,MSE:Oit,mae:Pit,MAE:Fit,mape:Mit,MAPE:Lit,cosine:Bit};function zit(n){if(typeof n=="string"&&n in Vm)return Vm[n];if(typeof n!="string"&&n!=null)return n;throw new H(`Unknown metric ${n}`)}function Eg(n){if(Sr(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(const e of Object.keys(Wm))if(Wm[e]===n){t=e;break}if(t!==void 0)return t;for(const e of Object.keys(Vm))if(Vm[e]===n){t=e;break}return t!==void 0?t:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wit(n){const t={Adagrad:()=>yl.adagrad(.01),Adadelta:()=>yl.adadelta(1,.95,En()),Adam:()=>yl.adam(.001,.9,.999,En()),Adamax:()=>yl.adamax(.002,.9,.999,En(),0),RMSProp:()=>yl.rmsprop(.001,.9,0,En()),SGD:()=>yl.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new H(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const t$=1*1024*1024;function e$(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!kv(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){const s=JSON.stringify(n);s.length>t$&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${t$}.`)}}function kv(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const t=Object.keys(n);for(const e of t)if(typeof e!="string"||!kv(n[e]))return!1;return!0}else if(Array.isArray(n)){for(const t of n)if(!kv(t))return!1;return!0}else return!1;else{const t=typeof n;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vit(n,t,e,s=console.log){const i=Hit(n),r=["Layer (type)","Input Shape","Output shape","Param #"];i?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(t*u)));let o;if(!i){r.push("Receives inputs"),o=[];for(const u in n.nodesByDepth)o.push(...n.nodesByDepth[u])}s("_".repeat(t)),Um(r,e,s),s("=".repeat(t));const a=n.layers;for(let u=0;u<a.length;++u)i?Git(a[u],e,s):jit(a[u],e,o,s),s((u===a.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();const c=Uit(n),l=Fm(n.nonTrainableWeights);s(`Total params: ${c+l}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${l}`),s("_".repeat(t))}function Uit(n){let t;return n.collectedTrainableWeights!=null?t=Fm(n.collectedTrainableWeights):t=Fm(n.trainableWeights),t}function Hit(n){let t=!0;const e=[],s=[];for(const i in n.nodesByDepth)e.push(n.nodesByDepth[i]);for(const i of e){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){t=!1;break}s.push(...i)}if(t)for(const i of n.layers){let r=!1;for(const o of i.inboundNodes)if(s.indexOf(o)!==-1)if(r){t=!1;break}else r=!0;if(!t)break}return t}function Um(n,t,e=console.log){let s="";for(let i=0;i<n.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=n[i],s=s.slice(0,t[i]),s+=" ".repeat(t[i]-s.length);e(s)}function Git(n,t,e){let s,i;try{i=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const r=n.name,o=n.getClassName(),a=[`${r} (${o})`,i,s,n.countParams().toString()];Um(a,t,e)}function jit(n,t,e,s){let i,r;try{r=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{r="multiple"}try{i=JSON.stringify(n.outputShape)}catch{i="multiple"}const o=[];for(const h of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(h)===-1))for(let f=0;f<h.inboundLayers.length;++f){const g=h.inboundLayers[f].name,m=h.nodeIndices[f],x=h.tensorIndices[f];o.push(`${g}[${m}][${x}]`)}const a=n.name,c=n.getClassName(),l=o.length===0?"":o[0],u=[`${a} (${c})`,r,i,n.countParams().toString(),l];Um(u,t,s);for(let h=1;h<o.length;++h)Um(["","","","",o[h]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wO(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function Sv(n,t){if(n===null)return null;if(typeof n=="string")return cc(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let i=0;i<s;++i){const r=n[i];wO(t,i,r)?e.push(r):e.push(Sv(r,t))}return e}else{const e={};for(const s of Object.keys(n)){const i=n[s];if(s==="name"&&typeof i=="string")e[s]=i;else{const r=cc(s);e[r]=Sv(i,r)}}return e}}function _v(n,t){if(n==null)return null;if(typeof n=="string")return ho(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let i=0;i<s;++i){const r=n[i];wO(t,i,r)?e.push(r):e.push(_v(r,t))}return e}else{const e={};for(const s of Object.keys(n)){const i=n[s],r=ho(s);(s==="name"||s==="className")&&typeof i=="string"?e[r]=i:e[r]=_v(i,s)}return e}}/** @license See the LICENSE file. */const vO="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qit=n=>{const t=Object.keys(n);if(t.length===0)return!1;const e=t[0].split("/");return!isNaN(parseInt(e[e.length-1],10))};class Ki extends ue{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const v=this.getClassName().toLowerCase();this.name=$x(v)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],da(this.inputs).length!==this.inputs.length)throw new H(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(v=>v.name)}`);da(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(v=>v.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const k=v.sourceLayer,I=v.nodeIndex,_=v.tensorIndex;this.outputLayers.push(k),this.outputLayersNodeIndices.push(I),this.outputLayersTensorIndices.push(_)}for(const v of this.inputs){const k=v.sourceLayer,I=v.nodeIndex,_=v.tensorIndex;Sr(I===0,"input layer has >1 nodes"),Sr(_===0,"input layer has >1 tensors"),this.inputLayers.push(k),this.inputLayersNodeIndices.push(I),this.inputLayersTensorIndices.push(_)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const k=this.inputLayers[v];if(!(k instanceof Rf))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${v} (0-based) originates from layer type ${k.getClassName()}.`);this.inputNames.push(k.name),this.feedInputShapes.push(k.batchInputShape),this.feedInputNames.push(k.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(v=>v.shape),this.internalOutputShapes=this.outputs.map(v=>v.shape);const e={},s={},i={},r={},o={},a=[],c=(v,k,I,_,$,R)=>{(_==null||$==null||R==null)&&(_=v.sourceLayer,$=v.nodeIndex,R=v.tensorIndex);const A=_.inboundNodes[$];if(I.indexOf(A)!==-1)throw new Di(`The tensor ${v.name} at layer "${_.name}" is part of a cycle.`);if(k.indexOf(A)!==-1)return;this.containerNodes.add(Ki.nodeKey(_,$)),_.id in o||(o[_.id]=Object.keys(o).length),I.indexOf(A)===-1&&I.push(A);const F=A.inboundLayers.length;for(let L=0;L<F;L++){const V=A.inputTensors[L],j=A.inboundLayers[L],Z=A.nodeIndices[L],et=A.tensorIndices[L];c(V,k,I,j,Z,et)}for(k.push(A);I.indexOf(A)>=0;)I.splice(I.indexOf(A),1);a.push(A)},l=[],u=[];for(const v of this.outputs)c(v,l,u);const h=a.slice().reverse();for(const v of h){s[v.id]=v,v.id in e||(e[v.id]=0);let k=e[v.id];const I=i[v.outboundLayer.id]==null?0:i[v.outboundLayer.id];k=Math.max(k,I),i[v.outboundLayer.id]=k,r[v.outboundLayer.id]=v.outboundLayer,e[v.id]=k;for(let _=0;_<v.inboundLayers.length;_++){const $=v.inboundLayers[_],R=v.nodeIndices[_],A=$.inboundNodes[R],F=e[A.id]==null?0:e[A.id];e[A.id]=Math.max(k+1,F),s[A.id]=A}}const f={};for(const v in e){const k=e[v];k in f||(f[k]=[]),f[k].push(s[v])}const g={};for(const v in i){const k=i[v];k in g||(g[k]=[]),g[k].push(r[v])}let m=Object.keys(g).map(v=>parseInt(v,10)).sort(Sg);this.layers=[];for(const v of m){const k=g[v];k.sort((I,_)=>{const $=o[I.id],R=o[_.id];return $<R?-1:$>R?1:0});for(const I of k)I instanceof Ki&&this.internalContainerRefs.push(I),this.layers.push(I)}this.layersByDepth=g,m=Object.keys(f).map(v=>parseInt(v,10)).sort(Sg);const x=this.inputs.slice(),b=[];for(const v of m)for(const k of f[v]){const I=k.outboundLayer;if(I!=null){for(const _ of k.inputTensors)if(x.indexOf(_)===-1)throw new Di(`Graph disconnected: cannot obtain value for tensor ${_} at layer "${I.name}". The following previous layers were accessed without issue: ${b}`);for(const _ of k.outputTensors)x.push(_);b.push(I.name)}}this.nodesByDepth=f;const y=this.layers.map(v=>v.name);for(const v of y){const k=y.filter(I=>I===v).length;if(k!==1)throw new Di(`The name "${v}" is used ${k} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Rx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(v=>null),outputMasks:this.outputs.map(v=>null),inputShapes:this.inputs.map(v=>v.shape),outputShapes:this.outputs.map(v=>v.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new H("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.layers)e.push(...s.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const s={};let i=0;const r=qit(t);r&&this.parseWeights(t);for(const a of this.layers)for(const[c,l]of a.weights.entries()){const u=r?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(s[u]!=null)throw new H(`Duplicate weight name: ${u}`);s[u]=l,i++}const o=[];for(const a in t){let c=a;if(s[a]==null){const l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[c]!=null)o.push([s[c],t[a]]);else if(e)throw new H(`Provided weight data has no target variable: ${a}`);delete s[c]}if(e){const a=[];for(const c in s)a.push(c);if(a.length>0)throw new H(`${a.length} of ${i} weights are not set: ${a}`)}DI(o)}parseWeights(t){for(const e in Object.keys(t)){const s=e.split("/"),i=["vars","layer_checkpoint_dependencies"],r=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!i.includes(o)).join("/");r!==e&&(t[r]=t[e],delete t[e])}}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${vO}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const s=_v(this.updatedConfig());return e?JSON.stringify(s):s}call(t,e){return nt(()=>{t=Me(t);const s=new ra;for(let i=0;i<this.inputs.length;++i)s.add(this.inputs[i],t[i]);return kh(this.outputs,s,e)})}computeMask(t,e){return nt(()=>{t=Me(t);let s;return e==null?s=Fc(null,t.length):s=Me(e),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const e=Pm(t);if(e.length!==this.inputLayers.length)throw new H(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<e.length;a++){const c=this.inputLayers[a],l=e[a],u=c.name+"_0_0";s[u]=l}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Sg);if(i.length>1)for(const a of i){const c=this.nodesByDepth[a];for(const l of c){const u=l.outboundLayer;if(this.inputLayers.map(x=>x.id).indexOf(u.id)!==-1)continue;const h=[];for(let x=0;x<l.inboundLayers.length;x++){const b=l.inboundLayers[x],y=l.nodeIndices[x],v=l.tensorIndices[x],k=`${b.name}_${y}_${v}`,I=s[k];h.push(I)}const f=u.computeOutputShape(Ns(h)),g=Pm(f),m=u.inboundNodes.indexOf(l);for(let x=0;x<g.length;x++){const b=`${u.name}_${m}_${x}`;s[b]=g[x]}}}const r=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],h=`${c.name}_${l}_${u}`;o.push(h)}for(let a=0;a<o.length;a++){const c=o[a];Sr(c in s),r.push(s[c])}return Ns(r)}runInternalGraph(t,e){e==null&&(e=Fc(null,t.length));const s={};for(let c=0;c<this.inputs.length;++c){const l=this.inputs[c],u=t[c],h=e[c];s[l.id]=[u,h]}const i=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Sg);for(const c of i){const l=this.nodesByDepth[c];for(const u of l){const h=u.outboundLayer,f=u.inputTensors,g=u.outputTensors,m=new Array;for(const x of f)x.id in s&&m.push(s[x.id]);if(m.length===f.length){let x={},b,y,v,k;if(u.callArgs!=null&&(x=u.callArgs),m.length===1){const[I,_]=m[0];x.mask==null&&(x.mask=_),v=Me(h.call(I,x)),k=Me(h.computeMask(I,_)),b=[I],y=[_]}else b=m.map(I=>I[0]),y=m.map(I=>I[1]),x.mask==null&&(x.mask=y),v=Me(h.call(b,x)),k=Me(h.computeMask(b,y));if(h.activityRegularizer)throw new se("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let I=0;I<g.length;++I){const _=g[I],$=v[I],R=k[I];s[_.id]=[$,R]}}}}const r=[],o=[],a=[];for(const c of this.outputs){Sr(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[l,u]=s[c.id];a.push(l.shape),r.push(l),o.push(u)}return[r,o,a]}buildNodeConversionMap(t){const e={};let s;for(const i of this.layers){s=i instanceof Ki?1:0;for(let r=0;r<i.inboundNodes.length;r++){const o=Ki.nodeKey(i,r);this.containerNodes.has(o)&&(e[o]=s,s+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new H("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const s of this.layers)if(s.name===t)return s;throw new H(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new H(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return nt(()=>{const t=[];for(const e of this.layers)for(let s=0;s<e.inboundNodes.length;++s){const i=Ki.nodeKey(e,s);this.containerNodes.has(i)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),c=o.getConfig(),l=[];for(let h=0;h<o.inboundNodes.length;h++){const f=o.inboundNodes[h],g=Ki.nodeKey(o,h);let m={};if(this.containerNodes.has(g)){if(f.callArgs)try{JSON.stringify(f.callArgs),m=f.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(f.inboundLayers.length>0){const x=[];for(let b=0;b<f.inboundLayers.length;b++){const y=f.inboundLayers[b],v=f.nodeIndices[b],k=f.tensorIndices[b],I=Ki.nodeKey(y,v);let _=e[I];_==null&&(_=0),x.push([y.name,_,k,m])}l.push(x)}}}const u={};u.name=o.name,u.className=a,u.config=c,u.inboundNodes=l,s.push(u)}t.layers=s;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],c=this.inputLayersNodeIndices[o],l=Ki.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let u=e[l];u==null&&(u=0);const h=this.inputLayersTensorIndices[o];i.push([a.name,u,h])}t.inputLayers=i;const r=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],c=this.outputLayersNodeIndices[o],l=Ki.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let u=e[l];u==null&&(u=0);const h=this.outputLayersTensorIndices[o];r.push([a.name,u,h])}return t.outputLayers=r,t}static fromConfig(t,e,s={},i=!1){const r={},o={};function a(b,y){b.name in o?o[b.name].push(y):o[b.name]=[y]}function c(b,y){const v=[];let k;for(const I of y){const _=I[0],$=I[1],R=I[2];if(k=I[3]==null?{}:I[3],!(_ in r)){a(b,y);return}const A=r[_];if(A.inboundNodes.length<=$){a(b,y);return}const F=A.inboundNodes[$];v.push(F.outputTensors[R])}v.length>0&&b.apply(Ns(v),k)}function l(b){const y=b.name,v=So(b,e.customObjects!=null?e.customObjects:{});v.setFastWeightInitDuringBuild(i),r[y]=v,b.inboundNodes.forEach(I=>{if(!(I instanceof Array))throw new H(`Corrupted configuration, expected array for nodeData: ${I}`);a(v,I)})}const u=e.name,h=e.layers;for(const b of h)l(b);for(;!Rst(o);)for(const b of h){const y=r[b.name];if(y.name in o){const v=o[y.name];delete o[y.name];for(const k of v)c(y,k)}}const f=[],g=[],m=e.inputLayers;for(const b of m){const y=b[0],v=b[1],k=b[2];Sr(y in r);const _=r[y].inboundNodes[v].outputTensors;f.push(_[k])}const x=e.outputLayers;for(const b of x){const y=b[0],v=b[1],k=b[2];Sr(y in r);const _=r[y].inboundNodes[v].outputTensors;g.push(_[k])}return new t({inputs:f,outputs:g,name:u})}get stateful(){if(this._stateful)throw new H("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){nt(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kit(n,t,e){const s=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(i=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const i=[];return t.forEach(r=>{r in n?i.push(n[r]):i.push(null)}),i}else throw new Error(`The model has multiple (${s}) outputs, so ${e} must be either an array with ${s} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function CO(n,t){return Kit(n,t,"classWeight")}async function IO(n,t,e,s){if(t!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){const i=nt(()=>{if(n.shape.length===1)return xc(n);if(n.shape.length===2){if(n.shape[1]>1)return Jh(n,1);if(n.shape[1]===1)return Y(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await i.data());fe(i);const o=[];return r.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(e[a])}),js(o,"float32")}else return null}function Xit(n,t){return G(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Yit=32;function kO(n,t){let e,s;const i=t;e=i.xs,s=i.ys,P(e!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const r=n$("input",n.inputNames,e),o=n$("output",n.outputNames,s),a=r[0].shape[0];P(r.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${r.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),P(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<r.length;c++)P(r[c].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${r[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let c=0;c<o.length;c++)P(o[c].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${o[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:r,ys:o}}function n$(n,t,e){if(e instanceof Tn)return[e];if(Array.isArray(e))return P(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{const s=[];for(const i of t){if(e[i]==null)throw new H(`The feature data generated by the dataset lacks the required ${n} key '${i}'.`);s.push(e[i])}return s}}function Jit(n){if(n.length===3)throw new se("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function Zit(n,t,e){const s=e.batchesPerEpoch!=null;if(P(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),P(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),P(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),P(!s||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),P(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const i=e.validationData!=null;let r,o;if(i)if(s$(e.validationData))P(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{const b=Jit(e.validationData);r=b.xs,o=b.ys}const a=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let l;i?l=c.slice().concat(c.map(b=>"val_"+b)):l=c.slice();const u=fO(e.callbacks,e.yieldEvery),h=e.verbose==null?1:e.verbose,{callbackList:f,history:g}=pO(u,h,e.epochs,null,null,Qit(t,e),null,i,l);f.setModel(n),n.history=g,await f.onTrainBegin(),n.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,x=await t.iterator();for(;m<e.epochs;){const b={};await f.onEpochBegin(m);let y=0,v=0;for(s||(x=await t.iterator());!s||y<e.batchesPerEpoch;){const k=await x.next();if(s&&k.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(k.value!=null){const{xs:I,ys:_}=kO(n,k.value),$={};$.batch=v,$.size=I[0].shape[0],await f.onBatchBegin(v,$);const R=[];if(e.classWeight!=null){const L=CO(e.classWeight,n.outputNames);for(let V=0;V<L.length;++V)R.push(await IO(_[V],null,L[V]))}const A=I.concat(_).concat(R),F=a(A);fe(A);for(let L=0;L<c.length;++L){const V=c[L],j=F[L];$[V]=j,Rr(j)}await f.onBatchEnd(v,$),dO($),v++,y++}if(s?y>=e.batchesPerEpoch:k.done){if(i){let I;s$(e.validationData)?I=Me(await n.evaluateDataset(e.validationData,{batches:e.validationBatches})):I=Me(n.evaluate(r,o,{batchSize:e.validationBatchSize==null?Yit:e.validationBatchSize,verbose:0}));for(let _=0;_<n.metricsNames.length;++_)b[`val_${n.metricsNames[_]}`]=I[_]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(m,b),m++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function Qit(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function s$(n){return typeof n.iterator=="function"}function trt(n){return typeof n.next=="function"}async function ert(n,t,e){e=e||{};const s=e.batches!=null,i=n.testFunction;let r=[];if(e.verbose>0)throw new se("Verbose mode is not implemented yet.");P(!s||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);const o=trt(t)?t:await t.iterator();let a=0,c=0;for(;!s||c<e.batches;){const l=await o.next();if(r=nt(()=>{if(l.value){const{xs:u,ys:h}=kO(n,l.value),f=u.concat(h),g=nt(()=>i(f));if(fe(f),c===0)for(let x=0;x<g.length;++x)r.push(Ae(0));const m=f[0].shape[0];for(let x=0;x<g.length;++x){const b=g[x],y=r[x];r[x]=nt(()=>It(r[x],G(m,b))),c>0&&fe(y)}fe(g),a+=m,++c}return r}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<r.length;++l){const u=r[l];r[l]=Ut(r[l],a),fe(u)}return Ns(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cw(n){P(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function dh(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(s=>wc(s,t,e-t)):wc(n,t,e-t)}function Tv(n,t){return nt(()=>n==null?null:Array.isArray(n)?n.map(e=>Tv(e,t)):ZD(n,t.dtype==="int32"?t:Rt(t,"int32")))}function lw(n,t){const e=[];let s=0,i=null;for(;s<n;)i=s+t,i>=n&&(i=n),e.push([s,i]),s=i;return e}function SO(n){const t=[];n instanceof Tn&&(n=[n]);for(let e=0;e<n.length;++e){const s=n[e];if(s.rank===1)t.push(Ef(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function qi(n,t){if(n==null)return;const e=[];if(t instanceof Tn)e.push(t.id);else if(Array.isArray(t))t.forEach(i=>e.push(i.id));else if(t!=null)for(const i in t){const r=t[i];e.push(r.id)}const s=[];if(n instanceof Tn)e.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(i=>{e.indexOf(i.id)===-1&&s.push(i)});else if(n!=null)for(const i in n){const r=n[i];e.indexOf(r.id)===-1&&s.push(r)}s.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nrt(n){return n instanceof Tn}function Ev(n){return Array.isArray(n)}function i$(n){return!nrt(n)&&!Ev(n)}function r$(n,t,e,s=!0,i=""){if(t==null||t.length===0){if(n!=null){let o=!1;if(Ev(n)&&n.length>0)o=!0;else if(i$(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new H(`Error when checking model ${i} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(o=>null);let r;if(i$(n)){n=n,r=[];for(const o of t){if(n[o]==null)throw new H(`No data provided for "${o}". Need data for each key in: ${t}`);r.push(n[o])}}else if(Ev(n)){if(n=n,n.length!==t.length)throw new H(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);r=n}else{if(n=n,t.length>1)throw new H(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);r=[n]}if(r=SO(r),e!=null)for(let o=0;o<t.length;++o){if(e[o]==null)continue;const a=r[o];if(a.shape.length!==e[o].length)throw new H(`Error when checking ${i}: expected ${t[o]} to have ${e[o].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<e[o].length;++c){if(c===0&&!s)continue;const l=a.shape[c],u=e[o][c];if(u!=null&&u>=0&&l!==u)throw new H(`${i} expected a batch of elements where each example has shape [${e[o].slice(1,e[o].length)}] (i.e.,tensor shape [*,${e[o].slice(1,e[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return r}function srt(n,t,e){const s=da(n.map(r=>r.shape[0]));s.sort();const i=da(t.map(r=>r.shape[0]));if(i.sort(),s.length>1)throw new H(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(r=>r.shape))}`);if(i.length>1)throw new H(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(r=>r.shape))}`);if(s.length>0&&i.length>0&&!De(s,i))throw new H(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function irt(n,t,e){const s=[Ax,Dx,sd];for(let i=0;i<n.length;++i){const r=n[i],o=t[i],a=e[i];if(o!=null){if(o===sd&&r.shape[r.shape.length-1]===1)throw new H(`You are passing a target array of shape ${r.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const c=r.shape.slice(1),l=a.slice(1);for(let u=0;u<c.length;++u){const h=c[u],f=l[u];if(f!=null&&h!==f)throw new H(`A target Tensor with shape ${r.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function o$(n,t,e,s=!0,i=""){let r;if(Array.isArray(n)){if(n.length!==t.length)throw new H(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);r=n}else{if(t.length>1)throw new H(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);r=[n]}if(e!=null)for(let o=0;o<t.length;++o){if(e[o]==null)continue;const a=r[o];if(a.shape.length!==e[o].length)throw new H(`Error when checking ${i}: expected ${t[o]} to have ${e[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<e[o].length;++c){if(c===0&&!s)continue;const l=a.shape[c],u=e[o][c];if(u!=null&&u!==l)throw new H(`Error when checking ${i}: expected ${t[o]} to have shape ${JSON.stringify(e[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function rrt(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(s=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(s=>e);{const s=[];for(const i of t){let r=e.hasOwnProperty(i)?e[i]:[];Array.isArray(r)||(r=[r]),s.push(r)}return s}}const ort="layers-model";class Pl extends Ki{constructor(t){super(t),this.isTraining=!1}summary(t,e,s=console.log){if(!this.built)throw new H("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Vit(this,t,e,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Wit(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Na))throw new H("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new H(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)t.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),e.push(aw(t.loss[o]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new H(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(a=>aw(a))}else{const o=aw(t.loss);this.outputs.forEach(a=>{e.push(o)})}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],c=this.outputNames[o];this.feedOutputNames.push(c),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],yc("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=rrt(t.metrics,this.outputNames),r=(o,a,c)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([c,o])};yc("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=i[o];(l=>{const u="";let h,f,g;for(const m of l){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const b=this.internalOutputShapes[o];b[b.length-1]===1||this.lossFunctions[o]===Dx?["accuracy","acc"].indexOf(m)!==-1?f=mO:["crossentropy","ce"].indexOf(m)!==-1&&(f=Rit):this.lossFunctions[o]===zm?["accuracy","acc"].indexOf(m)!==-1?f=Ait:["crossentropy","ce"].indexOf(m)!==-1&&(f=yO):["accuracy","acc"].indexOf(m)!==-1?f=bO:["crossentropy","ce"].indexOf(m)!==-1&&(f=xO);let y;["accuracy","acc"].indexOf(m)!==-1?y="acc":["crossentropy","ce"].indexOf(m)!==-1&&(y="ce"),g=f,h=u+y}else g=zit(m),h=u+Eg(m);let x;yc(h,()=>{x=g}),r(o,h,x)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,s={}){const i=s.batchSize==null?32:s.batchSize;cw(i);const r=!0,o=this.standardizeUserDataXY(t,e,r,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const c=this.testFunction,l=this.testLoop(c,a,i,s.verbose,s.steps);return Ns(l)}finally{qi(o[0],t),qi(o[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),ert(this,t,e)}checkNumSamples(t,e,s,i="steps"){let r;if(s!=null){if(r=null,e!=null)throw new H(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else if(t!=null)Array.isArray(t)?r=t[0].shape[0]:r=t.shape[0];else throw new H(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return r}execute(t,e){if(Array.isArray(e)&&e.length===0)throw new H("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(e),i=s?e:[e],r=this.retrieveSymbolicTensors(i),o=new ra;if(t instanceof Tn&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new H(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)o.add(this.inputs[c],t[c])}else for(const c of this.inputs){const l=t[c.name];if(l==null)throw new H(`No value is provided for the model's input ${c.name}`);o.add(c,l)}const a=kh(r,o);return s?a:a[0]}retrieveSymbolicTensors(t){const e=Fc(null,t.length);let s=t.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],o=r.map(a=>a.name);for(let a=0;a<t.length;++a){const c=o.indexOf(t[a]);if(c!==-1&&(e[a]=r[c],s--),s===0)break}if(s===0)break}if(s>0){const i=[];throw e.forEach((r,o)=>{r==null&&i.push(t[o])}),new H(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return e}predictLoop(t,e=32,s=!1){return nt(()=>{const i=this.checkNumSamples(t);if(s)throw new se("Verbose predictLoop() is not implemented yet.");const r=lw(i,e),o=this.outputs.map(a=>[]);for(let a=0;a<r.length;++a)nt(()=>{const l=r[a][0],u=r[a][1],h=dh(t,l,u),f=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)f.push({key:this.inputs[m],value:h[m]});else f.push({key:this.inputs[0],value:h});const g=new ra(f);return kh(this.outputs,g)}).forEach((l,u)=>o[u].push(l));return Ns(o.map(a=>Rs(a,0)))})}predict(t,e={}){const s=SO(t);o$(s,this.inputNames,this.feedInputShapes,!1);try{const i=e.batchSize==null?32:e.batchSize;return cw(i),this.predictLoop(s,i)}finally{qi(s,t)}}predictOnBatch(t){o$(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,s=!0,i){if(this.optimizer_==null)throw new Di("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===zm?r.push(a.slice(0,a.length-1).concat([1])):r.push(a)}if(t=r$(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=r$(e,this.feedOutputNames,r,!1,"target"),srt(t,e),irt(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new H(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,s,i,r=!0,o){const[a,c]=this.standardizeUserDataXY(t,e,r,o);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(i!=null){const u=CO(i,this.outputNames);l=[];for(let h=0;h<u.length;++h)l.push(await IO(c[h],null,u[h]))}return[a,c,l]}testLoop(t,e,s,i=0,r){return nt(()=>{const o=this.checkNumSamples(e,s,r,"steps"),a=[];if(i>0)throw new se("Verbose mode is not implemented yet.");if(r!=null)throw new se("steps mode in testLoop() is not implemented yet");{const c=lw(o,s),l=js(ar(0,o));for(let u=0;u<c.length;++u){const h=c[u][0],f=c[u][1],g=wc(l,h,f-h),m=Tv(e,g),x=t(m);if(u===0)for(let b=0;b<x.length;++b)a.push(Ae(0));for(let b=0;b<x.length;++b){const y=x[b];a[b]=It(a[b],G(f-h,y))}}for(let u=0;u<a.length;++u)a[u]=Ut(a[u],o)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let s=0;s<t.length;++s){const i=t[s];let r=i;if(HE(t,i)>1){const o=HE(t.slice(0,s),i);r+=`_${o}`}e.push(r)}return e}makeTrainFunction(){return t=>{const e=[],s=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let x=0;x<this.inputs.length;++x)h.push({key:this.inputs[x],value:s[x]});const f=new ra(h),g=kh(this.outputs,f,{training:!0});let m;for(let x=0;x<this.lossFunctions.length;++x){const b=this.lossFunctions[x];let y=b(i[x],g[x]);r[x]!=null&&(y=Xit(y,r[x]));const v=kn(y);e.push(v),x===0?m=y:m=It(m,y)}for(let x=0;x<this.metricsTensors.length;++x){let b;if(this.outputs.length>1&&x<this.outputs.length)b=e[x];else{const y=this.metricsTensors[x][0],v=this.metricsTensors[x][1];b=kn(y(i[v],g[v]))}Rr(b),o.push(b)}return m=kn(m),this.calculateLosses().forEach(x=>{m=It(m,x)}),m},c=this.collectedTrainableWeights.map(h=>h.read()),l=!0;return[this.optimizer_.minimize(a,l,c)].concat(o)}}makeTestFunction(){this.testFunction=t=>nt(()=>{const e=[];let s;const i=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let l=0;l<this.inputs.length;++l)o.push({key:this.inputs[l],value:i[l]});const a=new ra(o),c=kh(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const u=this.lossFunctions[l],h=kn(u(r[l],c[l]));l===0?s=h:s=It(s,h),e.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const u=this.metricsTensors[l][0],h=this.metricsTensors[l][1],f=kn(u(r[h],c[h]));e.push(f)}return e})}async fit(t,e,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,r,o,a,c,l,u,h,f;try{const g=s.batchSize==null?32:s.batchSize;cw(g);const m=!1,x=await this.standardizeUserData(t,e,s.sampleWeight,s.classWeight,m,g);i=x[0],r=x[1],f=x[2];let b=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)c=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new se("validationData including sample weights is not supported yet."):new H(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const F=!0,L=await this.standardizeUserData(c,l,null,null,F,g);u=L[0],h=L[1],y=u.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const F=Math.floor(i[0].shape[0]*(1-s.validationSplit)),L=i[0].shape[0];u=dh(i,F,L),o=i,i=dh(i,0,F),h=dh(r,F,L),a=r,r=dh(r,0,F),y=u.concat(h)}else s.validationSteps!=null&&(b=!0);const v=i.concat(r).concat(f);this.checkTrainableWeightsConsistency();const k=this.makeTrainFunction(),I=this.getDedupedMetricsNames();let _,$;b?(this.makeTestFunction(),_=this.testFunction,$=I.slice().concat(I.map(F=>"val_"+F))):(_=null,y=[],$=I.slice());const R=fO(s.callbacks,s.yieldEvery);return await this.fitLoop(k,v,I,g,s.epochs,s.verbose,R,_,y,s.shuffle,$,s.initialEpoch,null,null)}finally{this.isTraining=!1,qi(i,t),qi(r,e),qi(o,t),qi(a,e),qi(u,c),qi(h,l),f!=null&&fe(f)}}async fitLoop(t,e,s,i,r,o,a,c,l,u,h,f,g,m){i==null&&(i=32),r==null&&(r=1),u==null&&(u=!0),f==null&&(f=0);let x=!1;if(c!=null&&l!=null&&(x=!0),m!=null&&(x=!0,g==null))throw new H("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(e,i,g,"steps_per_epoch");let y;b!=null&&(y=ar(0,b)),o==null&&(o=1);const{callbackList:v,history:k}=pO(a,o,r,f,b,g,i,x,h);v.setModel(this),this.history=k,await v.onTrainBegin(),this.stopTraining_=!1;for(let I=f;I<r;++I){await v.onEpochBegin(I);const _={};if(g!=null)throw new se("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new se("batch shuffling is not implemneted yet");u&&U7(y);const $=js(y),R=lw(b,i);for(let A=0;A<R.length;++A){const F={};if(await v.onBatchBegin(A,F),nt(()=>{const L=R[A][0],V=R[A][1],j=wc($,L,V-L);F.batch=A,F.size=V-L;const Z=Tv(e,j),et=t(Z);for(let K=0;K<s.length;++K){const tt=s[K],it=et[K];F[tt]=it,Rr(it)}if(A===R.length-1&&x){const K=this.testLoop(c,l,i);for(let tt=0;tt<s.length;++tt){const it=s[tt],st=K[tt];Rr(st),_["val_"+it]=st}}}),await v.onBatchEnd(A,F),dO(F),this.stopTraining_)break}$.dispose()}if(await v.onEpochEnd(I,_),this.stopTraining_)break}return await v.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return Zit(this,t,e)}async trainOnBatch(t,e){const s=await this.standardizeUserData(t,e),i=s[0],r=s[1],a=this.makeTrainFunction()(i.concat(r)),c=[];for(const l of a){const u=await l.data();c.push(u[0])}return fe(a),qi(s[0],t),qi(s[1],e),Ns(c)}getNamedWeights(t){const e=[],s=t!=null&&t.trainableOnly,i=s?this.trainableWeights:this.weights,r=this.getWeights(s);for(let o=0;o<i.length;++o)s&&!i[o].trainable||e.push({name:i[o].originalName,tensor:r[o]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const e=lv().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-lv().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=ho(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if(typeof e!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(e=>ho(e))}else{const e=Object.keys(this.loss);t={};const s=this.loss;for(const i of e)if(typeof s[i]=="string")t[i]=ho(s[i]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ho(Eg(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>ho(Eg(t)));{const t={};for(const e in this.metrics)t[e]=ho(Eg(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const e=Sv(t.optimizer_config),s=So(e);let i;if(typeof t.loss=="string")i=cc(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(o=>cc(o));else if(t.loss!=null){i={};for(const o in t.loss)i[o]=cc(t.loss[o])}let r;if(Array.isArray(t.metrics))r=t.metrics.map(o=>cc(o));else if(t.metrics!=null){r={};for(const o in t.metrics)r[o]=cc(t.metrics[o])}this.compile({loss:i,metrics:r,optimizer:s})}async save(t,e){if(typeof t=="string"){const l=LY(t);if(l.length===0)throw new H(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new H(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new H("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await EE(this.getNamedWeights(e)),i=!1,r=null,a={modelTopology:this.toJSON(r,i),format:ort,generatedBy:`TensorFlow.js tfjs-layers v${vO}`,convertedBy:null};if((e==null?!1:e.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:u,specs:h}=await EE(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=MY([s.data,u])}return this.userDefinedMetadata!=null&&(e$(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,t.save(a)}setUserDefinedMetadata(t){e$(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Pl.className="Model";xt(Pl);class _O extends Pl{}_O.className="Functional";xt(_O);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Yl extends Pl{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:$x("sequential_"),t.layers!=null)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new H(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof Yl||t instanceof Pl;let s;if(e){if(s=t,s.outputs.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new H("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new H("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=cit({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(e)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new H(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=aO(this.outputs[0])}this.inboundNodes=[],new Rx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Fc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return this.model==null&&this.build(),this.model.call(t,e)}build(t){if(Te(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Pl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,s=console.log){this.built||this.build(),super.summary(t,e,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,e,s={}){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.evaluate(t,e,s)}async evaluateDataset(t,e){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return this.model==null&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,s={}){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.fit(t,e,s)}async fitDataset(t,e){if(!this.built)throw new Di("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,s={},i=!1){let r,o={};if(e instanceof Array){if(e[0].className==null||e[0].className==="Merge")throw new H("Legacy serialization format not supported yet.");r=e}else P(e.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=e.layers,delete e.layers,o=e;const a=new t(o);if(!(a instanceof Yl))throw new se(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const c of r){const u=So(c,void 0,i);i&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(t){if(this.model==null)throw new H("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new H("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const s={};s.className=e.getClassName(),s.config=e.getConfig(),t.push(s)}return{name:this.name,layers:t}}}Yl.className="Sequential";xt(Yl);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uw(n){return new Yl(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let rs=class extends du{getConfig(){return{}}};class TO extends rs{apply(t,e=1){return jst(t,e)}}TO.className="elu";xt(TO);class EO extends rs{apply(t){return GA(t)}}EO.className="selu";xt(EO);class $O extends rs{apply(t){return Gc(t)}}$O.className="relu";xt($O);class NO extends rs{apply(t){return nt(()=>td(6,Gc(t)))}}NO.className="relu6";xt(NO);class RO extends rs{apply(t){return t}}RO.className="linear";xt(RO);class AO extends rs{apply(t){return lu(t)}}AO.className="sigmoid";xt(AO);class DO extends rs{apply(t){return Kst(t)}}DO.className="hardSigmoid";xt(DO);class OO extends rs{apply(t){return wf(t)}}OO.className="softplus";xt(OO);class PO extends rs{apply(t){return qst(t)}}PO.className="softsign";xt(PO);class FO extends rs{apply(t){return yx(t)}}FO.className="tanh";xt(FO);let MI=class extends rs{apply(t,e=-1){return zC(t,e)}};MI.className="softmax";xt(MI);class MO extends rs{apply(t,e=-1){return FA(t,e)}}MO.className="logSoftmax";xt(MO);class LO extends rs{apply(t){return nt(()=>nt(()=>{const e=Math.sqrt(2),s=G(.5,It(1,RA(Ut(t,e))));return G(t,s)}))}}LO.className="gelu";xt(LO);class BO extends rs{apply(t){return nt(()=>G(.5,G(t,It(1,yx(G(ss(Ut(2,Math.PI)),It(t,G(.044715,Dc(t,3)))))))))}}BO.className="gelu_new";xt(BO);class zO extends rs{apply(t){return nt(()=>G(t,yx(wf(t))))}}zO.className="mish";xt(zO);class WO extends rs{apply(t,e=1){return nt(()=>G(lu(G(t,e)),t))}}WO.className="swish";xt(WO);function xa(n){return n.getClassName()}function hw(n,t={}){return Tf(n,$i.getMap().classNameMap,t,"activation")}function ya(n){if(n==null){const t={};return t.className="linear",t.config={},hw(t)}if(typeof n=="string"){const t={};return t.className=n,t.config={},hw(t)}else return n instanceof rs?n:hw(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function art(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class VO extends du{}class UO extends VO{constructor(t){super(),art(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return nt(()=>{let e=Bn([1]);return this.hasL1&&(e=It(e,Vt(G(this.l1,fs(t))))),this.hasL2&&(e=It(e,Vt(G(this.l2,$f(t))))),Y(e,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}UO.className="L1L2";xt(UO);const a$={l1l2:"L1L2"};function Ve(n){return II(n)}function c$(n,t={}){return Tf(n,$i.getMap().classNameMap,t,"regularizer")}function on(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in a$?a$[n]:n,config:{}};return c$(e)}else return n instanceof VO?n:c$(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HO extends ue{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,e){t=Xt(t);let s=Gc(t);return this.maxValue!=null&&(s=ui(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}HO.className="ReLU";xt(HO);class GO extends ue{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=Xt(t);return kC(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}GO.className="LeakyReLU";xt(GO);class jO extends ue{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=rn(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=on(t.alphaRegularizer),this.alphaConstraint=Rn(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new H(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=Te(t);const e=t.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)e[i-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let i=1;i<t.length;++i)s[i]=t[i];this.inputSpec=[new $n({ndim:t.length,axes:s})],this.built=!0}call(t,e){return t=Xt(t),NC(t,this.alpha.read())}getConfig(){const t={alphaInitializer:ln(this.alphaInitializer),alphaRegularizer:Ve(this.alphaRegularizer),alphaConstraint:Nn(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}jO.className="PReLU";xt(jO);let qO=class extends ue{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new se(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=Xt(t);return Cx(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}};qO.className="ELU";xt(qO);class KO extends ue{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,e){const s=Xt(t);return G(s,Rt(hi(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}KO.className="ThresholdedReLU";xt(KO);class XO extends ue{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new MI().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,e){return nt(()=>{let s=Xt(t);const i=e.mask;if(i!=null){const r=G(jt($a(s.shape),Rt(i,s.dtype)),Ae(-1e9));s=It(s,r)}return this.axis instanceof Array?this.axis.length>1?Fr(jt(s,MA(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}XO.className="Softmax";xt(XO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fl(n,t,e){if(typeof n=="number")return Fc(n,t);if(n.length!==t)throw new H(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let s=0;s<t;++s){const i=n[s];if(!Vst(i))throw new H(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${i}`)}return n}function rr(n,t,e,s,i=1){if(n==null)return n;const r=t+(t-1)*(i-1);let o;return e==="same"?o=n:o=n-r+1,Math.floor((o+s-1)/s)}function _r(n,t,e,s){if(n==null)return null;if(s==="valid")n=n*t+ba([e-t,0]);else if(s==="same")n=n*t;else throw new H(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LI(n,t){return nt(()=>(yn(t),t==="channelsFirst"?Ie(n,[0,2,3,1]):n))}function YO(n,t){return nt(()=>(yn(t),t==="channelsFirst"?Ie(n,[0,2,3,4,1]):n))}function crt(n,t,e,s=1,i="valid",r,o=1){return nt(()=>{if(r==null&&(r=cr()),yn(r),n.shape.length!==3)throw new H(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new H(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new H(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(r==="channelsFirst"&&(n=Ie(n,[0,2,1])),i==="causal")throw new se("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=_A(n,t,s,i==="same"?"same":"valid","NWC",o);return e!=null&&(a=fr(a,e)),a})}function l$(n,t,e,s=[1,1],i="valid",r,o,a=null){return nt(()=>{if(r==null&&(r=cr()),yn(r),n.rank!==3&&n.rank!==4)throw new H(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new H(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=LI(n,r);if(i==="causal")throw new se("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=gtt({x:c,filter:t,strides:s,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:e,activation:a}),r==="channelsFirst"&&(c=Ie(c,[0,3,1,2])),c})}function lrt(n,t,e,s=[1,1,1],i="valid",r,o){return nt(()=>{if(r==null&&(r=cr()),yn(r),n.rank!==4&&n.rank!==5)throw new H(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new H(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=YO(n,r);if(i==="causal")throw new se("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=pJ(a,t,s,i==="same"?"same":"valid","NDHWC",o),e!=null&&(a=fr(a,e)),r==="channelsFirst"&&(a=Ie(a,[0,4,1,2,3])),a})}class Ox extends ue{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Ox.verifyArgs(e),this.rank=t,Wn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new se(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Fl(e.kernelSize,t,"kernelSize"),this.strides=Fl(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,di(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yn(this.dataFormat),this.activation=ya(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=rn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Rn(e.biasConstraint),this.biasRegularizer=on(e.biasRegularizer),this.activityRegularizer=on(e.activityRegularizer),this.dilationRate=Fl(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new H(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new H(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new H(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Sr("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!kI(t.kernelSize,"number",1,3))throw new H(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:xa(this.activation),useBias:this.useBias,biasInitializer:ln(this.biasInitializer),biasRegularizer:Ve(this.biasRegularizer),activityRegularizer:Ve(this.activityRegularizer),biasConstraint:Nn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class fu extends Ox{constructor(t,e){super(t,e),this.kernel=null,fu.verifyArgs(e),this.filters=e.filters,Wn(this.filters,"filters"),this.kernelInitializer=rn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Rn(e.kernelConstraint),this.kernelRegularizer=on(e.kernelRegularizer)}build(t){t=Te(t);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new H(`The channel dimension of the input should be defined. Found ${t[e]}`);const s=t[e],i=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:s}}],this.built=!0}call(t,e){return nt(()=>{t=Xt(t);let s;const i=this.bias==null?null:this.bias.read(),r=jD(this.activation.getClassName());if(r!=null&&this.rank===2)s=l$(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(this.rank===1)s=crt(t,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=l$(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=lrt(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new se("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=Te(t);const e=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let r=0;r<s.length;++r){const o=rr(s[r],this.kernelSize[r],this.padding,this.strides[r],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[r]);e.push(o)}let i=[t[0]];return this.dataFormat==="channelsLast"?(i=i.concat(e),i.push(this.filters)):(i.push(this.filters),i=i.concat(e)),i}getConfig(){const t={filters:this.filters,kernelInitializer:ln(this.kernelInitializer),kernelRegularizer:Ve(this.kernelRegularizer),kernelConstraint:Nn(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new H(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Df extends fu{constructor(t){super(2,t),Df.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!kI(t.kernelSize,"number",1,2))throw new H(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Df.className="Conv2D";xt(Df);class Of extends fu{constructor(t){super(3,t),Of.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new H(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Of.className="Conv3D";xt(Of);class JO extends Df{constructor(t){if(super(t),this.inputSpec=[new $n({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Te(t),t.length!==4)throw new H("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new $n({ndim:4,axes:{[e]:s}})],this.built=!0}call(t,e){return nt(()=>{let s=Xt(t);if(s.shape.length!==4)throw new H(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,r=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const c=i[o],l=i[a],u=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],g=this.strides[1],m=_r(c,f,u,this.padding),x=_r(l,g,h,this.padding),b=[r,m,x,this.filters];this.dataFormat!=="channelsLast"&&(s=Ie(s,[0,2,3,1]));let y=TA(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Ie(y,[0,3,1,2])),this.bias!=null&&(y=fr(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(t){t=Te(t);const e=t.slice();let s,i,r;this.dataFormat==="channelsFirst"?(s=1,i=2,r=3):(s=3,i=1,r=2);const o=this.kernelSize[0],a=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return e[s]=this.filters,e[i]=_r(e[i],c,o,this.padding),e[r]=_r(e[r],l,a,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}JO.className="Conv2DTranspose";xt(JO);class ZO extends Of{constructor(t){if(super(t),this.inputSpec=[new $n({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Te(t),t.length!==5)throw new H("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new $n({ndim:5,axes:{[e]:s}})],this.built=!0}call(t,e){return nt(()=>{let s=Xt(t);if(s.shape.length!==5)throw new H(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,r=i[0];let o,a,c;this.dataFormat==="channelsFirst"?(c=2,o=3,a=4):(c=1,o=2,a=3);const l=i[c],u=i[o],h=i[a],f=this.kernelSize[0],g=this.kernelSize[1],m=this.kernelSize[2],x=this.strides[0],b=this.strides[1],y=this.strides[2],v=_r(l,x,f,this.padding),k=_r(u,b,g,this.padding),I=_r(h,y,m,this.padding),_=[r,v,k,I,this.filters];this.dataFormat!=="channelsLast"&&(s=Ie(s,[0,2,3,4,1]));let $=bJ(s,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=Ie($,[0,4,1,2,3])),this.bias!==null&&($=fr($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(t){t=Te(t);const e=t.slice();let s,i,r,o;this.dataFormat==="channelsFirst"?(s=1,i=2,r=3,o=4):(s=4,i=1,r=2,o=3);const a=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],u=this.strides[0],h=this.strides[1],f=this.strides[2];return e[s]=this.filters,e[i]=_r(e[i],u,a,this.padding),e[r]=_r(e[r],h,c,this.padding),e[o]=_r(e[o],f,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}ZO.className="Conv3DTranspose";xt(ZO);class QO extends fu{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,e.filters==null)throw new H("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(e.kernelInitializer!=null||e.kernelRegularizer!=null||e.kernelConstraint!=null)throw new H("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(e.padding!=null&&e.padding!=="same"&&e.padding!=="valid")throw new H(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=rn(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=on(e.depthwiseRegularizer),this.depthwiseConstraint=Rn(e.depthwiseConstraint),this.pointwiseInitializer=rn(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=on(e.pointwiseRegularizer),this.pointwiseConstraint=Rn(e.pointwiseConstraint)}build(t){if(t=Te(t),t.length<this.rank+2)throw new H(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null||t[e]<0)throw new H(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const s=t[e],i=this.kernelSize.concat([s,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new $n({ndim:this.rank+2,axes:{[e]:s}})],this.built=!0}call(t,e){return nt(()=>{t=Xt(t);let s;if(this.rank===1)throw new se("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=Ie(t,[0,2,3,1])),s=jA(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=fr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Ie(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=ln(this.depthwiseInitializer),t.pointwiseInitializer=ln(this.pointwiseInitializer),t.depthwiseRegularizer=Ve(this.depthwiseRegularizer),t.pointwiseRegularizer=Ve(this.pointwiseRegularizer),t.depthwiseConstraint=Nn(this.depthwiseConstraint),t.pointwiseConstraint=Nn(this.pointwiseConstraint),t}}QO.className="SeparableConv";class tP extends QO{constructor(t){super(2,t)}}tP.className="SeparableConv2D";xt(tP);class Px extends fu{constructor(t){super(1,t),Px.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!kI(t.kernelSize,"number",1,1))throw new H(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Px.className="Conv1D";xt(Px);class eP extends ue{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return nt(()=>{if(t=Xt(t),this.dataFormat==="channelsLast"){const s=Tg(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Tg(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Tg(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Tg(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}eP.className="Cropping2D";xt(eP);class nP extends ue{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,yn(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,Bst(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const e=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],e,s]}else{const e=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],e,s,t[3]]}}call(t,e){return nt(()=>{let s=Xt(t);const i=s.shape;if(this.dataFormat==="channelsFirst"){s=Ie(s,[0,2,3,1]);const r=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?Io.resizeNearestNeighbor(s,[r,o]):Io.resizeBilinear(s,[r,o]);return Ie(a,[0,3,1,2])}else{const r=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?Io.resizeNearestNeighbor(s,[r,o]):Io.resizeBilinear(s,[r,o])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}nP.className="UpSampling2D";xt(nP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function urt(n,t,e=[1,1],s="valid",i,r){return nt(()=>{i==null&&(i=cr()),yn(i);let o=LI(n,i);if(n.rank!==4)throw new H(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new H(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=wC(o,t,e,s==="same"?"same":"valid","NHWC",r),i==="channelsFirst"&&(o=Ie(o,[0,3,1,2])),o})}class sP extends Ox{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=rn(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Rn(t.depthwiseConstraint),this.depthwiseRegularizer=on(t.depthwiseRegularizer)}build(t){if(t=Te(t),t.length<4)throw new H(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e=this.dataFormat==="channelsFirst"?1:3;if(t[e]==null||t[e]<0)throw new H(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const s=t[e],i=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return nt(()=>{t=Xt(t);let s=urt(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=fr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=Te(t);const e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,r=rr(e,this.kernelSize[0],this.padding,this.strides[0]),o=rr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,r,o]:[t[0],r,o,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=ln(this.depthwiseInitializer),t.depthwiseRegularizer=Ve(this.depthwiseRegularizer),t.depthwiseConstraint=Nn(this.depthwiseRegularizer),t}}sP.className="DepthwiseConv2D";xt(sP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iP(n,t,e,s){if(Array.isArray(n)){if(t!=null||e!=null)throw new H("When inputs is an array, neither initialState or constants should be provided");s!=null&&(e=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function i(r){return r==null||Array.isArray(r)?r:[r]}return t=i(t),e=i(e),{inputs:n,initialState:t,constants:e}}function rP(n,t,e,s=!1,i,r,o=!1,a=!1){return nt(()=>{const c=t.shape.length;if(c<3)throw new H(`Input should be at least 3D, but is ${c}D.`);const l=[1,0].concat(ar(2,c));if(t=Ie(t,l),r!=null)throw new se("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=Rt(Rt(i,"bool"),"float32"),i.rank===c-1&&(i=$s(i,-1)),i=Ie(i,l)),s&&(t=Oc(t,0),i!=null&&(i=Oc(i,0)));const u=[];let h,f=e;const g=t.shape[0],m=Pc(t);let x;i!=null&&(x=Pc(i));for(let y=0;y<g;++y){const v=m[y],k=nt(()=>n(v,f));if(i==null)h=k[0],f=k[1];else{const I=nt(()=>{const _=x[y],$=jt(Mi(_),_),R=It(G(k[0],_),G(f[0],$)),A=f.map((F,L)=>It(G(k[1][L],_),G(F,$)));return{output:R,newStates:A}});h=I.output,f=I.newStates}a&&u.push(h)}let b;return a&&(b=$o(u,1)),[h,b,f]})}class Ra extends ue{constructor(t){super(t);let e;if(t.cell==null)throw new H("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?e=new WI({cells:t.cell}):e=t.cell,e.stateSize==null)throw new H("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new $n({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ar(0,t).map(e=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){Cv(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const s=e[0];let i;if(this.returnSequences?i=[t[0],t[1],s]:i=[t[0],s],this.returnState){const r=[];for(const o of e)r.push([t[0],o]);return[i].concat(r)}else return i}computeMask(t,e){return nt(()=>{Array.isArray(e)&&(e=e[0]);const s=this.returnSequences?e:null;if(this.returnState){const i=this.states.map(r=>null);return[s].concat(i)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let s=0;s<t;++s)e.push(null);return e}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new se("Constants support is not implemented in RNN yet.");Cv(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new $n({shape:[e,null,...s]});const i=[t[0]].concat(t.slice(2));this.cell.build(i);let r;if(Array.isArray(this.cell.stateSize)?r=this.cell.stateSize:r=[this.cell.stateSize],this.stateSpec!=null){if(!De(this.stateSpec.map(o=>o.shape[o.shape.length-1]),r))throw new H(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map(o=>new $n({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){nt(()=>{if(!this.stateful)throw new kr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Bn([s,i])):this.states_=[Bn([s,this.cell.stateSize])];else if(t==null)fe(this.states_),this.keptStates!=null&&(fe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Bn([s,i])):this.states_[0]=Bn([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e===!0?this.keptStates.push(this.states_.slice()):fe(this.states_);for(let i=0;i<this.states_.length;++i){const r=t[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[s,o];if(!De(r.shape,a))throw new H(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[i]=r}}this.states_=this.states_.map(i=>Rr(i.clone()))})}apply(t,e){let s=e==null?null:e.initialState,i=e==null?null:e.constants;e==null&&(e={});const r=iP(t,s,i,this.numConstants);t=r.inputs,s=r.initialState,i=r.constants;let o=[],a=[];if(s!=null){e.initialState=s,o=o.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new $n({shape:l.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(e.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof Lr){const l=[t].concat(o),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const f=super.apply(l,e);return this.inputSpec=h,f}else return super.apply(t,e)}call(t,e){return nt(()=>{const s=e==null?null:e.mask,i=e==null?null:e.training;let r=e==null?null:e.initialState;t=Xt(t),r==null&&(this.stateful?r=this.states_:r=this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==o)throw new H(`RNN Layer has ${o} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},l=rP((m,x)=>{const b=this.cell.call([m].concat(x),a);return[b[0],b.slice(1)]},t,r,this.goBackwards,s,null,this.unroll,this.returnSequences),u=l[0],h=l[1],f=l[2];this.stateful&&this.resetStates(f,i);const g=this.returnSequences?h:u;return this.returnState?[g].concat(f):g})}getInitialState(t){return nt(()=>{let e=Bn(t.shape);return e=Vt(e,[1,2]),e=Ef(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?wv(e,[1,s]):e):this.cell.stateSize>1?[wv(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ra.className&&(e.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),t),e)}static fromConfig(t,e,s={}){const i=e.cell,r=So(i,s);return new t(Object.assign(e,{cell:r}))}}Ra.className="RNN";xt(Ra);class Fx extends ue{}class BI extends Fx{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Wn(this.units,"units"),this.activation=ya(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=on(t.kernelRegularizer),this.recurrentRegularizer=on(t.recurrentRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.kernelConstraint=Rn(t.kernelConstraint),this.recurrentConstraint=Rn(t.recurrentConstraint),this.biasConstraint=Rn(t.biasConstraint),this.dropout=Xl([1,ba([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Xl([1,ba([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Te(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return nt(()=>{if(t=t,t.length!==2)throw new H(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const i=e.training==null?!1:e.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=wa({ones:()=>Mi(t),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=wa({ones:()=>Mi(s),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let r;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?r=Or(G(t,o),this.kernel.read()):r=Or(t,this.kernel.read()),this.bias!=null&&(r=fr(r,this.bias.read())),a!=null&&(s=G(s,a));let c=It(r,Or(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:xa(this.activation),useBias:this.useBias,kernelInitializer:ln(this.kernelInitializer),recurrentInitializer:ln(this.recurrentInitializer),biasInitializer:ln(this.biasInitializer),kernelRegularizer:Ve(this.kernelRegularizer),recurrentRegularizer:Ve(this.recurrentRegularizer),biasRegularizer:Ve(this.biasRegularizer),activityRegularizer:Ve(this.activityRegularizer),kernelConstraint:Nn(this.kernelConstraint),recurrentConstraint:Nn(this.recurrentConstraint),biasConstraint:Nn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}BI.className="SimpleRNNCell";xt(BI);class oP extends Ra{constructor(t){t.cell=new BI(t),super(t)}call(t,e){return nt(()=>{this.cell.dropoutMask!=null&&(fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,i=e==null?null:e.training,r=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:r})})}static fromConfig(t,e){return new t(e)}}oP.className="SimpleRNN";xt(oP);class zI extends Fx{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new H("GRUCell does not support reset_after parameter set to true.");this.units=t.units,Wn(this.units,"units"),this.activation=ya(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ya(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=on(t.kernelRegularizer),this.recurrentRegularizer=on(t.recurrentRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.kernelConstraint=Rn(t.kernelConstraint),this.recurrentConstraint=Rn(t.recurrentConstraint),this.biasConstraint=Rn(t.biasConstraint),this.dropout=Xl([1,ba([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Xl([1,ba([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Te(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return nt(()=>{if(t=t,t.length!==2)throw new H(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training==null?!1:e.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=wa({ones:()=>Mi(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=wa({ones:()=>Mi(i),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,o=this.recurrentDropoutMask;let a,c,l;0<this.dropout&&this.dropout<1&&(t=G(t,r[0]));let u=Or(t,this.kernel.read());this.useBias&&(u=fr(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=G(i,o[0]));const h=this.recurrentKernel.read(),[f,g]=li(h,[2*this.units,this.units],h.rank-1),m=Or(i,f),[x,b,y]=li(u,3,u.rank-1),[v,k]=li(m,2,m.rank-1);a=this.recurrentActivation.apply(It(x,v)),c=this.recurrentActivation.apply(It(b,k));const I=Or(G(c,i),g);l=this.activation.apply(It(y,I));const _=It(G(a,i),G(It(1,mn(a)),l));return[_,_]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:xa(this.activation),recurrentActivation:xa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ln(this.kernelInitializer),recurrentInitializer:ln(this.recurrentInitializer),biasInitializer:ln(this.biasInitializer),kernelRegularizer:Ve(this.kernelRegularizer),recurrentRegularizer:Ve(this.recurrentRegularizer),biasRegularizer:Ve(this.biasRegularizer),activityRegularizer:Ve(this.activityRegularizer),kernelConstraint:Nn(this.kernelConstraint),recurrentConstraint:Nn(this.recurrentConstraint),biasConstraint:Nn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}zI.className="GRUCell";xt(zI);class aP extends Ra{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new zI(t),super(t)}call(t,e){return nt(()=>{this.cell.dropoutMask!=null&&(fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,i=e==null?null:e.training,r=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:r})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}aP.className="GRU";xt(aP);class Mx extends Fx{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Wn(this.units,"units"),this.activation=ya(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ya(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=on(t.kernelRegularizer),this.recurrentRegularizer=on(t.recurrentRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.kernelConstraint=Rn(t.kernelConstraint),this.recurrentConstraint=Rn(t.recurrentConstraint),this.biasConstraint=Rn(t.biasConstraint),this.dropout=Xl([1,ba([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Xl([1,ba([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=Te(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const r=this.biasInitializer,o=this.units;i=new(e=class extends Bi{apply(c,l){const u=r.apply([o]),h=new _I().apply([o]),f=r.apply([o*2]);return jE(jE(u,h),f)}},e.className="CustomInit",e)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return nt(()=>{const s=e.training==null?!1:e.training;if(t=t,t.length!==3)throw new H(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const r=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=wa({ones:()=>Mi(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=wa({ones:()=>Mi(i),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let c,l,u,h;0<this.dropout&&this.dropout<1&&(t=G(t,o[0]));let f=Or(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=G(i,a[0])),f=It(f,Or(i,this.recurrentKernel.read())),this.useBias&&(f=fr(f,this.bias.read()));const[g,m,x,b]=li(f,4,f.rank-1);c=this.recurrentActivation.apply(g),l=this.recurrentActivation.apply(m),u=It(G(l,r),G(c,this.activation.apply(x))),h=this.recurrentActivation.apply(b);const y=G(h,this.activation.apply(u));return[y,y,u]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:xa(this.activation),recurrentActivation:xa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ln(this.kernelInitializer),recurrentInitializer:ln(this.recurrentInitializer),biasInitializer:ln(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ve(this.kernelRegularizer),recurrentRegularizer:Ve(this.recurrentRegularizer),biasRegularizer:Ve(this.biasRegularizer),activityRegularizer:Ve(this.activityRegularizer),kernelConstraint:Nn(this.kernelConstraint),recurrentConstraint:Nn(this.recurrentConstraint),biasConstraint:Nn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}Mx.className="LSTMCell";xt(Mx);class cP extends Ra{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Mx(t),super(t)}call(t,e){return nt(()=>{this.cell.dropoutMask!=null&&(fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,i=e==null?null:e.training,r=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:r})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}cP.className="LSTM";xt(cP);class WI extends Fx{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return nt(()=>{t=t;let s=t.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(s.splice(0,a.stateSize.length)):i.push(s.splice(0,1));i.reverse();const r=[];let o;for(let a=0;a<this.cells.length;++a){const c=this.cells[a];s=i[a],a===0?o=[t[0]].concat(s):o=[o[0]].concat(s),o=c.call(o,e),r.push(o.slice(1))}s=[];for(const a of r.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(t){Cv(t)&&(t=t[0]),t=t;let e;this.cells.forEach((s,i)=>{yc(`RNNCell_${i}`,()=>{s.build(t),Array.isArray(s.stateSize)?e=s.stateSize[0]:e=s.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=super.getConfig(),e=r=>({className:r.getClassName(),config:r.getConfig()}),i={cells:this.cells.map(e)};return Object.assign(Object.assign({},t),i)}static fromConfig(t,e,s={}){const i=[];for(const r of e.cells)i.push(So(r,s));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.cells)e.push(...s.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return Iv(t)}setWeights(t){const e=[];for(const s of this.cells){const i=s.weights.length,r=t.splice(i);for(let o=0;o<s.weights.length;++o)e.push([s.weights[o],r[o]])}DI(e)}}WI.className="StackedRNNCells";xt(WI);function wa(n){const{ones:t,rate:e,training:s=!1,count:i=1,dropoutFunc:r}=n,o=()=>r!=null?r(t(),e):QD(t(),e),a=()=>Nf(o,t,s);return!i||i<=1?Rr(a().clone()):Array(i).fill(void 0).map(a).map(l=>Rr(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var hrt=globalThis&&globalThis.__rest||function(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(e[s[i]]=n[s[i]]);return e};class lP extends Ra{constructor(t){if(t.unroll)throw new se("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new se("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new $n({ndim:5})]}call(t,e){return nt(()=>{if(this.cell.dropoutMask!=null&&(fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new H("ConvRNN2D cell does not support constants");const s=e==null?null:e.mask,i=e==null?null:e.training,r=e==null?null:e.initialState;return super.call(t,{mask:s,training:i,initialState:r})})}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return nt(()=>{const{stateSize:e}=this.cell,s=t.shape,i=this.computeSingleOutputShape(s),r=[i[0],...i.slice(2)],o=Bn(r);return Array.isArray(e)?Array(e.length).fill(o):[o]})}resetStates(t,e=!1){nt(()=>{if(!this.stateful)throw new kr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,i=this.computeSingleOutputShape(s),r=[i[0],...i.slice(2)];if(s[0]==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Bn(r)):this.states_=[Bn(r)];else if(t==null)fe(this.states_),this.keptStates!=null&&(fe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Bn(r)):this.states_[0]=Bn(r);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):fe(this.states_);for(let a=0;a<this.states_.length;++a){const c=t[a],l=r;if(!De(c.shape,l))throw new H(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${c.shape}`);this.states_[a]=c}}this.states_=this.states_.map(a=>Rr(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:e,filters:s,kernelSize:i,padding:r,strides:o,dilationRate:a}=this.cell,c=e==="channelsFirst",l=t[c?3:2],u=t[c?4:3],h=rr(l,i[0],r,o[0],a[0]),f=rr(u,i[1],r,o[1],a[1]);return[...t.slice(0,2),...c?[s,h,f]:[h,f,s]]}}lP.className="ConvRNN2D";class VI extends Mx{constructor(t){const{filters:e,kernelSize:s,strides:i,padding:r,dataFormat:o,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,Wn(this.filters,"filters"),this.kernelSize=Fl(s,2,"kernelSize"),this.kernelSize.forEach(c=>Wn(c,"kernelSize")),this.strides=Fl(i||1,2,"strides"),this.strides.forEach(c=>Wn(c,"strides")),this.padding=r||"valid",di(this.padding),this.dataFormat=o||"channelsLast",yn(this.dataFormat),this.dilationRate=Fl(a||1,2,"dilationRate"),this.dilationRate.forEach(c=>Wn(c,"dilationRate"))}build(t){var e;t=Te(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new H(`The channel dimension of the input should be defined. Found ${t[s]}`);const i=t[s],r=4,o=this.kernelSize.concat([i,this.filters*r]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*r]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const l=this.biasInitializer,u=this.filters;c=new(e=class extends Bi{apply(f,g){const m=l.apply([u]),x=$a([u]),b=l.apply([u*2]);return SI([m,x,b])}},e.className="CustomInit",e)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*r],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return nt(()=>{if(t.length!==3)throw new H(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training||!1,i=t[0],r=t[1],o=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=wa({ones:()=>Mi(i),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,l=(bt,ft,yt)=>!ft||!ft[yt]?bt:G(ft[yt],bt);let u=l(i,c,0),h=l(i,c,1),f=l(i,c,2),g=l(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=wa({ones:()=>Mi(r),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let x=l(r,m,0),b=l(r,m,1),y=l(r,m,2),v=l(r,m,3);const k=3,[I,_,$,R]=li(this.kernel.read(),a,k),[A,F,L,V]=this.useBias?li(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,I,A,this.padding),h=this.inputConv(h,_,F,this.padding),f=this.inputConv(f,$,L,this.padding),g=this.inputConv(g,R,V,this.padding);const[j,Z,et,K]=li(this.recurrentKernel.read(),a,k);x=this.recurrentConv(x,j),b=this.recurrentConv(b,Z),y=this.recurrentConv(y,et),v=this.recurrentConv(v,K);const tt=this.recurrentActivation.apply(It(u,x)),it=this.recurrentActivation.apply(It(h,b)),st=It(G(it,o),G(tt,this.activation.apply(It(f,y)))),ot=G(this.recurrentActivation.apply(It(g,v)),this.activation.apply(st));return[ot,ot,st]})}getConfig(){const t=super.getConfig(),e=hrt(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},e),s)}inputConv(t,e,s,i){const r=Ac(t,e,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?fr(r,s,this.dataFormat):r}recurrentConv(t,e){return Ac(t,e,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}VI.className="ConvLSTM2DCell";xt(VI);class uP extends lP{constructor(t){const e=new VI(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}uP.className="ConvLSTM2D";xt(uP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Lx extends ue{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const e=t.shape,s=[];for(let i=0;i<this.noiseShape.length;++i)s.push(this.noiseShape[i]==null?e[i]:this.noiseShape[i]);return s}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t);if(0<this.rate&&this.rate<1){const i=e.training==null?!1:e.training,r=this.getNoiseShape(s);return Nf(()=>QD(s,this.rate,r,this.seed),()=>s,i)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}Lx.className="Dropout";xt(Lx);class hP extends Lx{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}hP.className="SpatialDropout1D";xt(hP);class UI extends ue{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let e=null;t.batchSize!=null&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,Wn(this.units,"units"),this.activation=ya(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Rn(t.kernelConstraint),this.biasConstraint=Rn(t.biasConstraint),this.kernelRegularizer=on(t.kernelRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.activityRegularizer=on(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=Te(t);const e=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=Te(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t),i=jD(this.activation.getClassName());let r;return i!=null?r=Or(s,this.kernel.read(),i,this.bias?this.bias.read():null):(r=Or(s,this.kernel.read()),this.bias!=null&&(r=fr(r,this.bias.read())),this.activation!=null&&(r=this.activation.apply(r))),r})}getConfig(){const t={units:this.units,activation:xa(this.activation),useBias:this.useBias,kernelInitializer:ln(this.kernelInitializer),biasInitializer:ln(this.biasInitializer),kernelRegularizer:Ve(this.kernelRegularizer),biasRegularizer:Ve(this.biasRegularizer),activityRegularizer:Ve(this.activityRegularizer),kernelConstraint:Nn(this.kernelConstraint),biasConstraint:Nn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}UI.className="Dense";xt(UI);class dP extends ue{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=Te(t);for(const e of t.slice(1))if(e==null)throw new H(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],fa(t,1)]}call(t,e){return nt(()=>{this.invokeCallHook(t,e);let s=Xt(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const i=[0];for(let r=2;r<s.rank;++r)i.push(r);i.push(1),s=Ie(s,i)}return Gst(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}dP.className="Flatten";xt(dP);class fP extends ue{constructor(t){super(t),this.supportsMasking=!0,this.activation=ya(t.activation)}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t);return this.activation.apply(s)})}getConfig(){const t={activation:xa(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}fP.className="Activation";xt(fP);class pP extends ue{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return nt(()=>(t=Xt(t),Ust(t,this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}pP.className="RepeatVector";xt(pP);class gP extends ue{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,e){const s="Total size of new array must be unchanged.",i=e.slice();let r=1,o=null;for(let c=0;c<i.length;++c){const l=i[c];if(this.isUnknown(l))if(o===null)o=c;else throw new H("Can only specifiy one unknown dimension.");else r*=l}const a=fa(t);if(o!==null){if(r===0||a%r!==0)throw new H(s);i[o]=a/r}else if(a!==r)throw new H(s);return i}computeOutputShape(t){let e=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t),i=s.shape,r=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return Y(s,r)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}gP.className="Reshape";xt(gP);class mP extends ue{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=ar(1,t.dims.length+1);if(!De(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new $n({ndim:this.dims.length+1})]}computeOutputShape(t){t=Te(t);const e=t.slice();return this.dims.forEach((s,i)=>{e[i+1]=t[s]}),e}call(t,e){return Ie(Xt(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}mP.className="Permute";xt(mP);class bP extends ue{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const s=Xt(t),i=-1;return fv(Am(s,this.maskValue),i)}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t),i=-1,r=!0,o=fv(Am(s,this.maskValue),i,r);return G(s,Rt(o,s.dtype))})}}bP.className="Masking";xt(bP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xP extends ue{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let e=null;t.batchSize!=null&&(e=t.batchSize),t.inputLength==null?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(Me(t.inputLength))}this.inputDim=t.inputDim,Wn(this.inputDim,"inputDim"),this.outputDim=t.outputDim,Wn(this.outputDim,"outputDim"),this.embeddingsInitializer=rn(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=on(t.embeddingsRegularizer),this.activityRegularizer=on(t.activityRegularizer),this.embeddingsConstraint=Rn(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return nt(()=>this.maskZero?(t=Xt(t),Am(t,ke(t))):null)}computeOutputShape(t){if(t=Te(t),this.inputLength==null)return[...t,this.outputDim];const e=Me(this.inputLength);if(e.length!==t.length-1)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let i=0;i<e.length;++i){const r=e[i],o=t[i+1];if(r!=null&&o!=null&&r!==o)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);r==null&&(e[s]=o),s++}}return[t[0],...e,this.outputDim]}call(t,e){return nt(()=>{this.invokeCallHook(t,e);let s=Xt(t);s.dtype!=="int32"&&(s=Dr(s,"int32"));const i=ZD(this.embeddings.read(),Y(s,[s.size]));return Y(i,Te(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ln(this.embeddingsInitializer),embeddingsRegularizer:Ve(this.embeddingsRegularizer),activityRegularizer:Ve(this.activityRegularizer),embeddingsConstraint:Nn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}xP.className="Embedding";xt(xP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Kc extends ue{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new se}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;const s=t.slice(0,t.length-e.length);for(let i=0;i<e.length;++i){const r=t[t.length-e.length+i],o=e[i];if(r==null||o==null||r<0||o<0)s.push(null);else if(r===1)s.push(o);else if(o===1)s.push(r);else{if(r!==o)throw new H("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));s.push(r)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Te(t)]),t=t,t.length<2)throw new H(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const r of t)r!=null&&r[0]!==null&&e.push(r[0]);if(e=da(e),e.length>1)throw new H(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let r=1;r<t.length;++r){const o=t[r]==null?null:t[r].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const i=t.map(r=>r.length);t.indexOf(null)===-1&&da(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return nt(()=>{if(t=t,this.reshapeRequired){const s=[],i=t.map(r=>r.rank);if(i.indexOf(null)===-1){const r=ba(i);for(let o of t){const a=o.rank;for(let c=0;c<r-a;++c)o=Ef(o,1);s.push(o)}return this.mergeFunction(s)}else{let r=!1;for(const c of t){const l=c.rank;if(l==null){const u=c.shape,h=u[0],f=u.slice(1).concat([h]);let g=Y(c,[h].concat(fa(u.slice(1))));g=Ie(g,[1,0]),g=Y(g,f),s.push(g),r=!0}else if(l>1){const u=ar(1,l).concat([0]);s.push(Ie(c,u)),r=!0}else s.push(c)}let o=this.mergeFunction(s);const a=o.rank;if(r){if(a==null){const c=o.shape,l=c.length,u=c[l-1],h=[u].concat(c.slice(0,c.length-1));o=Y(Ie(Y(o,[-1,u]),[1,0]),h)}else if(a>1){const c=[a-1].concat(ar(0,a-1));o=Ie(o,c)}}return o}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let i=1;i<t.length;++i){const r=t[i]==null?null:t[i].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}let s=[];for(const i of t)i!=null&&i[0]!==null&&s.push(i[0]);return s=da(s),s.length===1?e=s.concat(e):e=[null].concat(e),e}computeMask(t,e){return nt(()=>{if(e==null)return null;if(!Array.isArray(e))throw new H("`mask` should be an Array");if(!Array.isArray(t))throw new H("`inputs` should be an Array");if(e.length!==t.length)throw new H(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(i=>i==null))return null;e=e.map(i=>i==null?i:$s(i,0));let s=e[0];for(let i=1;i<e.length-1;++i)s=Eo(s,e[i]);return s})}}class yP extends Kc{constructor(t){super(t)}mergeFunction(t){return nt(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=It(e,t[s]);return e})}}yP.className="Add";xt(yP);class wP extends Kc{constructor(t){super(t)}mergeFunction(t){return nt(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=G(e,t[s]);return e})}}wP.className="Multiply";xt(wP);class vP extends Kc{constructor(t){super(t)}mergeFunction(t){return nt(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=It(e,t[s]);return G(1/t.length,e)})}}vP.className="Average";xt(vP);class CP extends Kc{constructor(t){super(t)}mergeFunction(t){return nt(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=Ea(e,t[s]);return e})}}CP.className="Maximum";xt(CP);class IP extends Kc{constructor(t){super(t)}mergeFunction(t){return nt(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=td(e,t[s]);return e})}}IP.className="Minimum";xt(IP);class kP extends Kc{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new H("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const i of t)if(i!=null){e=!1;break}if(e)return;const s=[];for(let i=0;i<t.length;++i){const r=t[i].slice();r.splice(this.axis,1);let o=!1;for(const a of s)if(De(a,r)){o=!0;break}o||s.push(r)}if(s.length>1)throw new H("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return nt(()=>SI(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new H("A `Concatenate` layer should be called on a list of inputs.");const e=t,s=e[0].slice(),i=this.axis<0?s.length+this.axis:this.axis;for(const r of e.slice(1)){if(s[i]==null||r[i]==null){s[i]=null;break}s[i]+=r[i]}return s}computeMask(t,e){if(e==null)return null;if(!Array.isArray(e))throw new H("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new H("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new H(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return nt(()=>{let s=!0;if(e.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const i=[];for(let o=0;o<t.length;++o)e[o]==null?i.push(Rt(Mi(t[o]),"bool")):e[o].rank<t[o].rank?i.push($s(e[o],-1)):i.push(e[o]);const r=Rs(i,this.axis);return SA(r,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}kP.className="Concatenate";xt(kP);function fh(n,t){for(;n<0;)n+=t;return n}function drt(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new se("batchDot is not implemented for tensors of 4D or higher rank yet");if(P(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),P(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new se("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,i=t.shape.length;e==null&&(e=[s-1,i-2]);const r=e;return nt(()=>{let o;if(s>i){o=s-i;const c=[];for(let l=0;l<o;++l)c.push(1);t=Y(t,t.shape.concat(c))}else if(i>s){o=i-s;const c=[];for(let l=0;l<o;++l)c.push(1);n=Y(n,n.shape.concat(c))}else o=0;let a;if(n.shape.length===2&&t.shape.length===2)r[0]===r[1]?a=Vt(G(n,t),r[0]):a=Vt(G(Ie(n,[1,0]),t),r[1]);else{const c=r[0]!==n.shape.length-1,l=r[1]===t.shape.length-1;a=Ne(n,t,c,l)}if(o>0){let c;s>i?c=s+i-3:c=s-1;const l=[];for(let u=c;u<c+o;++u)l.push(u);a=Cf(a,l)}return a.shape.length===1&&(a=$s(a,1)),a})}class SP extends Kc{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){P(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],s=t[1];if(e.length>3||s.length>3)throw new se("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,s);if(e[i[0]]!==s[i[1]])throw new H(`Dimension incompatibility: ${e[i[0]]} !== ${s[i[1]]}`)}mergeFunction(t){if(t.length!==2)throw new H(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e=t[0],s=t[1],i;return Array.isArray(this.axes)?i=this.axes.map((r,o)=>fh(r,t[o].shape.length)):i=[fh(this.axes,e.shape.length),fh(this.axes,s.shape.length)],this.normalize&&(e=Bm(e,i[0]),s=Bm(s,i[1])),drt(e,s,i)}interpretAxes(t,e){let s;return Array.isArray(this.axes)?s=this.axes:s=[fh(this.axes,t.length),fh(this.axes,e.length)],s}computeOutputShape(t){P(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),s=t[1].slice();if(e.length>3||s.length>3)throw new se("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,s);e.splice(i[0],1),s.splice(i[1],1),s.splice(0,1);const r=e.concat(s);return r.length===1&&r.push(1),r}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}SP.className="Dot";xt(SP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _P extends ue{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t);return Nf(()=>It(Nx(s.shape,0,this.stddev),s),()=>s,e.training||!1)})}}_P.className="GaussianNoise";xt(_P);class TP extends ue{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return nt(()=>{this.invokeCallHook(t,e);const s=Xt(t);return this.rate>0&&this.rate<1?Nf(()=>{const r=Math.sqrt(this.rate/(1-this.rate));return G(s,Nx(s.shape,1,r))},()=>s,e.training||!1):s})}}TP.className="GaussianDropout";xt(TP);class EP extends ue{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Xt(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return nt(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return Nf(()=>{const r=Xt(t),o=1.6732632423543772,a=1.0507009873554805,c=-o*a;let l=Uc(vf(s),this.rate);l=Dr(l,"float32");const u=((1-this.rate)*(1+this.rate*c**2))**-.5,h=-u*c*this.rate,f=It(G(r,l),G(It(l,-1),c));return It(G(f,u),h)},()=>Xt(t),e.training||!1)}return t})}}EP.className="AlphaDropout";xt(EP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function id(n,t,e,s,i,r=.001){let o;if(n.rank===2)o=H9(n,t,e,s,i,r);else if(n.rank===3)o=j9(n,t,e,s,i,r);else if(n.rank===4)o=K9(n,t,e,s,i,r);else throw new se(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function frt(n,t,e,s,i=.001){return nt(()=>{const r=TC(n,s),o=r.mean,a=r.variance;return[id(n,o,a,e,t,i),o,a]})}function prt(n,t,e,s,i=.001){return nt(()=>{const r=TC(n,s),o=r.mean,a=r.variance,c=[];for(const m of ar(0,n.rank))s.indexOf(m)!==-1?c.push(1):c.push(n.shape[m]);const l=Y(o,c),u=Y(a,c),h=t==null?null:Y(t,c),f=e==null?null:Y(e,c);return[id(n,l,u,f,h,i),o,a]})}function grt(n,t,e,s,i=.001){return De(s.slice().sort(),ar(0,n.rank-1))?frt(n,t,e,s,i):prt(n,t,e,s,i)}class $P extends ue{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=rn(t.betaInitializer||"zeros"),this.gammaInitializer=rn(t.gammaInitializer||"ones"),this.movingMeanInitializer=rn(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=rn(t.movingVarianceInitializer||"ones"),this.betaConstraint=Rn(t.betaConstraint),this.gammaConstraint=Rn(t.gammaConstraint),this.betaRegularizer=on(t.betaRegularizer),this.gammaRegularizer=on(t.gammaRegularizer)}build(t){t=Te(t);const e=this.axis>=0?this.axis:this.axis+t.length,s=t[e];if(s==null)throw new H(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new $n({ndim:t.length,axes:{[e]:s}})];const i=[s];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return nt(()=>{const s=e.training==null?!1:e.training,i=Xt(t),r=i.shape,o=r.length,a=ar(0,o),c=this.axis>=0?this.axis:this.axis+o;a.splice(c,1);const l=Fc(1,o);l[c]=r[c];const u=a.slice();u.sort();const h=!De(u,ar(0,o).slice(0,o-1)),f=()=>{if(h){const v=Y(this.movingMean.read(),l),k=Y(this.movingVariance.read(),l),I=this.center?Y(this.beta.read(),l):null,_=this.scale?Y(this.gamma.read(),l):null;return id(i,v,k,I,_,this.epsilon)}else return id(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[g,m,x]=grt(i,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(v,k,I)=>{nt(()=>{const _=1-I,$=v.read(),R=G(jt($,k),_);v.write(jt($,R))})};return(()=>{b(this.movingMean,m,this.momentum),b(this.movingVariance,x,this.momentum)})(),g})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ln(this.betaInitializer),gammaInitializer:ln(this.gammaInitializer),movingMeanInitializer:ln(this.movingMeanInitializer),movingVarianceInitializer:ln(this.movingVarianceInitializer),betaRegularizer:Ve(this.betaRegularizer),gammaRegularizer:Ve(this.gammaRegularizer),betaConstraint:Nn(this.betaConstraint),gammaConstraint:Nn(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}$P.className="BatchNormalization";xt($P);class NP extends ue{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=rn(t.betaInitializer||"zeros"),this.gammaInitializer=rn(t.gammaInitializer||"ones"),this.betaRegularizer=on(t.betaRegularizer),this.gammaRegularizer=on(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=Te(t);const e=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=e);for(const r of this.axis)if(r<0||r>=e)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==da(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(r=>t[r]),i=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(t,e){const s=Xt(t),i=s.shape,r=i.length;return nt(()=>{let{mean:a,variance:c}=TC(s,this.axis,!0);const l=Fc(1,r);for(const x of this.axis)l[x]=i[x];const u=x=>x!=null&&x.shape.length!==r?Y(x,l):x;let h=this.scale?u(this.gamma.read()):null,f=this.center?u(this.beta.read()):null;const g=[],m=[];for(let x=0;x<r;++x)this.axis.indexOf(x)!==-1?(g.push(i[x]),m.push(1)):(g.push(1),m.push(i[x]));return a=Qi(a,g),c=Qi(c,g),h!=null&&(h=Qi(h,m)),f!=null&&(f=Qi(f,m)),id(s,a,c,f,h,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ln(this.betaInitializer),gammaInitializer:ln(this.gammaInitializer),betaRegularizer:Ve(this.betaRegularizer),gammaRegularizer:Ve(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}NP.className="LayerNormalization";xt(NP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mrt(n,t,e){return nt(()=>{if(n.rank!==4)throw new H(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new H("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=cr()),e!=="channelsLast"&&e!=="channelsFirst")throw new H(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return e==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],EC(n,s)})}class RP extends ue{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?cr():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new H(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,s;if(typeof t.padding[0]=="number")e=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new H(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],t.padding[1].length!==2)throw new H(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[e,s]}this.inputSpec=[new $n({ndim:4})]}computeOutputShape(t){t=Te(t);let e,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?e=t[2]+this.padding[0][0]+this.padding[0][1]:e=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],e,s]):(t[1]!=null&&t[1]>=0?e=t[1]+this.padding[0][0]+this.padding[0][1]:e=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],e,s,t[3]])}call(t,e){return nt(()=>mrt(Xt(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}RP.className="ZeroPadding2D";xt(RP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bx(n,t,e,s,i,r){return nt(()=>{yn(i),KD(r),di(s),e==null&&(e=[1,1]),s==null&&(s="valid"),i==null&&(i=cr()),r==null&&(r="max"),n=LI(n,i);let o;const a=s==="same"?"same":"valid";return r==="max"?o=_C(n,t,e,a):o=mC(n,t,e,a),i==="channelsFirst"&&(o=Ie(o,[0,3,1,2])),o})}function AP(n,t,e,s,i,r){return nt(()=>{yn(i),KD(r),di(s),e==null&&(e=[1,1,1]),s==null&&(s="valid"),i==null&&(i=cr()),r==null&&(r="max"),n=YO(n,i);let o;const a=s==="same"?"same":"valid";return r==="max"?o=AZ(n,t,e,a):o=O9(n,t,e,a),i==="channelsFirst"&&(o=Ie(o,[0,4,1,2,3])),o})}class DP extends ue{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new H(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(Wn(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new H(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);Wn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,di(this.padding),this.inputSpec=[new $n({ndim:3})]}computeOutputShape(t){t=Te(t);const e=rr(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return nt(()=>{this.invokeCallHook(t,e),t=Ef(Xt(t),2);const s=this.poolingFunction(Xt(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Cf(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class OP extends DP{constructor(t){super(t)}poolingFunction(t,e,s,i,r){return yn(r),di(i),Bx(t,e,s,i,r,"max")}}OP.className="MaxPooling1D";xt(OP);class PP extends DP{constructor(t){super(t)}poolingFunction(t,e,s,i,r){return yn(r),di(i),Bx(t,e,s,i,r,"avg")}}PP.className="AveragePooling1D";xt(PP);class FP extends ue{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new H(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];Wn(this.poolSize,"poolSize"),Wn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,yn(this.dataFormat),di(this.padding),this.inputSpec=[new $n({ndim:4})]}computeOutputShape(t){t=Te(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=rr(e,this.poolSize[0],this.padding,this.strides[0]),s=rr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s]:[t[0],e,s,t[3]]}call(t,e){return nt(()=>(this.invokeCallHook(t,e),this.poolingFunction(Xt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class MP extends FP{constructor(t){super(t)}poolingFunction(t,e,s,i,r){return yn(r),di(i),Bx(t,e,s,i,r,"max")}}MP.className="MaxPooling2D";xt(MP);class LP extends FP{constructor(t){super(t)}poolingFunction(t,e,s,i,r){return yn(r),di(i),Bx(t,e,s,i,r,"avg")}}LP.className="AveragePooling2D";xt(LP);class BP extends ue{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new H(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];Wn(this.poolSize,"poolSize"),Wn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,yn(this.dataFormat),di(this.padding),this.inputSpec=[new $n({ndim:5})]}computeOutputShape(t){t=Te(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=rr(e,this.poolSize[0],this.padding,this.strides[0]),s=rr(s,this.poolSize[1],this.padding,this.strides[1]),i=rr(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s,i]:[t[0],e,s,i,t[4]]}call(t,e){return nt(()=>(this.invokeCallHook(t,e),this.poolingFunction(Xt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class zP extends BP{constructor(t){super(t)}poolingFunction(t,e,s,i,r){return yn(r),di(i),AP(t,e,s,i,r,"max")}}zP.className="MaxPooling3D";xt(zP);class WP extends BP{constructor(t){super(t)}poolingFunction(t,e,s,i,r){return yn(r),di(i),AP(t,e,s,i,r,"avg")}}WP.className="AveragePooling3D";xt(WP);class VP extends ue{constructor(t){super(t),this.inputSpec=[new $n({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new se}}class UP extends VP{constructor(t){super(t||{})}call(t,e){return nt(()=>{const s=Xt(t);return kn(s,1)})}}UP.className="GlobalAveragePooling1D";xt(UP);class HP extends VP{constructor(t){super(t||{})}call(t,e){return nt(()=>{const s=Xt(t);return ir(s,1)})}}HP.className="GlobalMaxPooling1D";xt(HP);class GP extends ue{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,yn(this.dataFormat),this.inputSpec=[new $n({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new se}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class jP extends GP{call(t,e){return nt(()=>{const s=Xt(t);return this.dataFormat==="channelsLast"?kn(s,[1,2]):kn(s,[2,3])})}}jP.className="GlobalAveragePooling2D";xt(jP);class qP extends GP{call(t,e){return nt(()=>{const s=Xt(t);return this.dataFormat==="channelsLast"?ir(s,[1,2]):ir(s,[2,3])})}}qP.className="GlobalMaxPooling2D";xt(qP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KP extends ue{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,s={}){const i=e.layer,r=So(i,s);delete e.layer;const o={layer:r};return Object.assign(o,e),new t(o)}}class XP extends KP{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=Te(t),t.length<3)throw new H(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=Te(t);const e=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(e),i=t[1];return[s[0],i].concat(s.slice(1))}call(t,e){return nt(()=>(t=Xt(t),rP((o,a)=>[Xt(this.layer.call(o,e)),[]],t,[],!1,null,null,!1,!0)[1]))}}XP.className="TimeDistributed";xt(XP);function brt(n){qc(Lst,"BidirectionalMergeMode",n)}const xrt="concat";class YP extends KP{constructor(t){super(t);const e=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=e,this.forwardLayer=So(s),e.goBackwards=e.goBackwards!==!0;const i={};if(i.className=t.layer.getClassName(),i.config=e,this.backwardLayer=So(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?xrt:t.mergeMode,brt(this.mergeMode),t.weights)throw new se("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,s=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;let s,i,r;return this.returnState&&(r=e.slice(1)),s=e[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,i=[s]):this.mergeMode==null?i=[s,s.slice()]:i=[s],this.returnState?this.mergeMode==null?i.concat(r).concat(r.slice()):[s].concat(r).concat(r.slice()):Ns(i)}apply(t,e){let s=e==null?null:e.initialState,i=e==null?null:e.constants;e==null&&(e={});const r=iP(t,s,i,this.numConstants);if(t=r.inputs,s=r.initialState,i=r.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&i==null)return super.apply(t,e);const o=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new H("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=s,o.push(...s);const u=s.map(h=>new $n({shape:h.shape}));this.forwardLayer.stateSpec=u.slice(0,l/2),this.backwardLayer.stateSpec=u.slice(l/2),a.push(...u)}if(i!=null)throw new se("Support for constants in Bidirectional layers is not implemented yet.");const c=o[0]instanceof Lr;for(const l of o)if(l instanceof Lr!==c)throw new H("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const l=[t].concat(o),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const f=super.apply(l,e);return this.inputSpec=h,f}else return super.apply(t,e)}call(t,e){return nt(()=>{const s=e.initialState;let i,r;if(s==null)i=this.forwardLayer.call(t,e),r=this.backwardLayer.call(t,e);else{const c=s.slice(0,s.length/2),l=s.slice(s.length/2);i=this.forwardLayer.call(t,Object.assign(e,{initialState:c})),r=this.backwardLayer.call(t,Object.assign(e,{initialState:l}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(r.slice(1))),i=i[0],r=r[0]),this.returnSequences&&(r=Oc(r,1));let a;return this.mergeMode==="concat"?a=SI([i,r]):this.mergeMode==="sum"?a=It(i,r):this.mergeMode==="ave"?a=G(.5,It(i,r)):this.mergeMode==="mul"?a=G(i,r):this.mergeMode==null&&(a=[i,r]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){yc(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),yc(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){Array.isArray(e)&&(e=e[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[e,e]:s=e:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const r=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(r).concat(r):[s].concat(r).concat(r)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const s=So(e.layer);if(delete e.layer,e.numConstants!=null)throw new se("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=e;return i.layer=s,new t(i)}}YP.className="Bidirectional";xt(YP);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JP extends ue{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return nt(()=>(t=Xt(t),t.dtype!=="float32"&&(t=Dr(t,"float32")),It(G(t,this.scale),this.offset)))}}JP.className="Rescaling";xt(JP);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:yrt,cropAndResize:wrt}=Io;class ZP extends ue{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,s,i,r,o,a,c){return nt(()=>{let l,u=!1;const h=e/o,f=s/a,g=(i+e)/o,m=(r+s)/a,x=[h,f,g,m],b=[];t.rank===3?(u=!0,l=$o([t])):l=t;for(let _=0;_<l.shape[0];_++)b.push(x);const y=gA(b,[b.length,4]),v=ed(0,b.length,1,"int32"),I=wrt(l,y,v,[i,r],"nearest");return Dr(u?Xt(Pc(I)):I,c)})}upsize(t,e,s,i){return nt(()=>{const r=yrt(t,[e,s]);return Dr(r,i)})}call(t,e){return nt(()=>{const s=Xt(t),i=s.dtype,r=s.shape,o=r[r.length-3],a=r[r.length-2];let c=0;o!==this.height&&(c=Math.floor((o-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),c>=0&&l>=0?this.centerCrop(s,c,l,this.height,this.width,o,a,i):this.upsize(t,this.height,this.width,i)})}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Te(t);const e=t.length-3,s=t.length-2;return t[e]=this.height,t[s]=this.width,t}}ZP.className="CenterCrop";xt(ZP);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vrt(n,t,e,s){let i=Xt(n);if(i.dtype!=="int32"&&(i=Dr(i,"int32")),t==="int")return i;const r=i.shape;if(i.rank===0&&(i=$s(i,-1)),t==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=$s(i,-1)),i.rank>2)throw new H(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${r} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(t),a=i;let c;if(typeof s<"u"&&t==="count"?c=RE(a,s,e,o):c=RE(a,[],e,o),t!=="tfIdf")return c;if(s)return G(c,s);throw new H("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class QP extends ue{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return t=Te(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return nt(()=>{t=Xt(t),t.dtype!=="int32"&&(t=Dr(t,"int32"));let s;if(typeof e.countWeights<"u"){if(this.outputMode!=="count")throw new H(`countWeights is not used when outputMode !== count.
              Received countWeights=${e.countWeights}`);s=Xt(e.countWeights)}const i=ir(t),r=Nm(t),o=hi(this.numTokens,i).bufferSync().get(0),a=Uc(r,0).bufferSync().get(0);if(!(o&&a))throw new H(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return vrt(t,this.outputMode,this.numTokens,s)})}}QP.className="CategoryEncoding";xt(QP);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Crt=["bilinear","nearest"],u$=new Set(Crt);class tF extends ue{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(u$.has(t.interpolation))this.interpolation=t.interpolation;else throw new H(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=Te(t);const e=t[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return nt(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Io.resizeBilinear(t,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Io.resizeNearestNeighbor(t,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...u$]} are supported`)})}}tF.className="Resizing";xt(tF);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class eF{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}eF.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nF extends ue{constructor(t){super(t),this.randomGenerator=new eF(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}nF.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Irt=["bilinear","nearest"],h$=new Set(Irt);class sF extends nF{constructor(t){super(t);const{factor:e,interpolation:s="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new H(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new H(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new H(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(h$.has(s))this.interpolation=s;else throw new H(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Te(t);const e=t[2];return[this.imgHeight,-1,e]}call(t,e){return nt(()=>{const s=Xt(t);this.imgHeight=s.shape[s.shape.length-3];const i=s.shape[s.shape.length-2];this.widthFactor=vf([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*i;r=Math.round(r);const o=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return Io.resizeBilinear(t,o);case"nearest":return Io.resizeNearestNeighbor(t,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...h$]} are supported`)}})}}sF.className="RandomWidth";xt(sF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yr(n){return new UI(n)}function dw(n){return new Lx(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const krt=rt();krt.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var d$;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(d$||(d$={}));var f$;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(f$||(f$={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var p$;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(p$||(p$={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pt(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&P(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Srt=tD;class zx extends y1{nextDataId(){return zx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new yR(this,Cr())}write(t,e,s){this.firstUse&&(this.firstUse=!1,rt().get("IS_NODE")&&ai(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:s,refCount:1}),i}makeTensorInfo(t,e,s){let i;if(e==="string"&&s!=null&&s.length>0&&Cd(s[0])){const r=s.map(o=>ha(o));i=this.write(r,t,e)}else i=this.write(s,t,e);return{dataId:i,shape:t,dtype:e}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,s,i,r){this.data.set(t,{values:e,dtype:i,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:s}=this.data.get(t);if(e==="complex64"){const i=this.readSync(s.real.dataId),r=this.readSync(s.imag.dataId);return No(i,r)}return X7(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(i=>ma(i));return ce(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ce(t.shape,t.dtype,e)}makeOutput(t,e,s){return Cr().makeTensorFromTensorInfo(this.makeTensorInfo(e,s,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=Es();return t(),{kernelMs:Es()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Pt([t],"where");const e=this.readSync(t.dataId);return Srt(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}zx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(n){const t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}const _rt=n=>{const{x:t}=n.inputs,e=n.backend;Pt(t,"abs");let s=new Float32Array(ut(t.shape));const i=e.data.get(t.dataId).values;return s=iF(i),e.makeOutput(s,t.shape,t.dtype)},Trt={kernelName:mb,backendName:"cpu",kernelFunc:_rt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wn(n){return(t,e,s,i,r)=>{const o=ee(t,e),a=o.length,c=Wt(o),l=ut(o),u=es(r,l),h=t.length,f=e.length,g=Wt(t),m=Wt(e),x=ql(t,o),b=ql(e,o);if(x.length+b.length===0)for(let y=0;y<u.length;++y)u[y]=n(s[y%s.length],i[y%i.length]);else for(let y=0;y<u.length;++y){const v=ou(y,a,c),k=v.slice(-h);x.forEach(R=>k[R]=0);const I=Nr(k,h,g),_=v.slice(-f);b.forEach(R=>_[R]=0);const $=Nr(_,f,m);u[y]=n(s[I],i[$])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hs(n){const{inputs:t,backend:e}=n,{real:s,imag:i}=t,r=e.data.get(s.dataId).values,o=e.data.get(i.dataId).values,a=e.makeTensorInfo(s.shape,"complex64"),c=e.data.get(a.dataId);return c.complexTensorInfos={real:e.makeTensorInfo(s.shape,"float32",r),imag:e.makeTensorInfo(i.shape,"float32",o)},a}const Ert={kernelName:A1,backendName:"cpu",kernelFunc:Hs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hm(n,t,e="float32"){if(e==="complex64"){const i=Hm(n,t,"float32"),r=Hm(n,t,"float32");return Hs({inputs:{real:i,imag:r},backend:n})}const s=ns(ut(t),e);return n.makeTensorInfo(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Br(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const $rt={kernelName:Ud,backendName:"cpu",kernelFunc:Br};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mc(n){const{inputs:t,backend:e}=n,{input:s}=t,i=e.data.get(s.dataId).complexTensorInfos.real,r=e.data.get(i.dataId).values;return e.makeTensorInfo(i.shape,i.dtype,r)}const Nrt={kernelName:nC,backendName:"cpu",kernelFunc:Mc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rF(n,t,e,s){if(s==="int32"){const i=Int32Array.from(n);return[t,"int32",i]}if(s==="bool"){const i=Vc([0],e),[r,o]=wn((a,c)=>a!==c?1:0)(t,[],n,i,"bool");return[o,"bool",r]}throw new Error(`Error in Cast: failed to cast ${e} to ${s}`)}function va(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{dtype:r}=s;if(r==="complex64"){if(i.dtype==="complex64")return Br({inputs:{x:i},backend:e});const u=Hm(e,i.shape,i.dtype),h=va({inputs:{x:i},backend:e,attrs:{dtype:"float32"}}),f=Hs({inputs:{real:h,imag:u},backend:e});return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(h),f}if(i.dtype==="complex64"){const u=Mc({inputs:{input:i},backend:e}),h=va({inputs:{x:u},backend:e,attrs:{dtype:r}});return e.disposeIntermediateTensorInfo(u),h}if(!CR(i.dtype,r)){const u=Br({inputs:{x:i},backend:e});return{dataId:u.dataId,shape:u.shape,dtype:r}}const o=e.data.get(i.dataId).values,[a,c,l]=rF(o,i.shape,i.dtype,r);return e.makeTensorInfo(a,c,l)}const Rrt={kernelName:Nd,backendName:"cpu",kernelFunc:va};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(n,t,e,s){return e==null?({inputs:i,backend:r})=>{const{a:o,b:a}=i,c=r;Pt([o,a],n);const l=c.data.get(o.dataId).values,u=c.data.get(a.dataId).values,h=o.dtype==="string"?Ro(l):l,f=o.dtype==="string"?Ro(u):u,g=s||o.dtype,[m,x]=t(o.shape,a.shape,h,f,g);return c.makeTensorInfo(x,g,m)}:({inputs:i,backend:r})=>{const{a:o,b:a}=i,c=r;if(o.dtype==="complex64"||a.dtype==="complex64"){const l=va({inputs:{x:o},backend:c,attrs:{dtype:"complex64"}}),u=c.data.get(l.dataId),h=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,g=c.data.get(h.dataId).values,m=c.data.get(f.dataId).values,x=va({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),b=c.data.get(x.dataId),y=b.complexTensorInfos.real,v=b.complexTensorInfos.imag,k=c.data.get(y.dataId).values,I=c.data.get(v.dataId).values,[_,$,R]=e(o.shape,a.shape,g,m,k,I),A=c.makeTensorInfo(R,"float32",_),F=c.makeTensorInfo(R,"float32",$),L=Hs({inputs:{real:A,imag:F},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(x),c.disposeIntermediateTensorInfo(A),c.disposeIntermediateTensorInfo(F),L}else{const l=c.data.get(o.dataId).values,u=c.data.get(a.dataId).values,h=s||o.dtype,[f,g]=t(o.shape,a.shape,l,u,h);return c.makeTensorInfo(g,h,f)}}}function HI(n){return(t,e,s,i,r,o)=>{const a=ee(t,e),c=ut(a),l=a.length,u=Wt(a),h=es("float32",c),f=es("float32",c),g=ql(t,a),m=ql(e,a),x=No(s,i),b=No(r,o),y=t.length,v=Wt(t),k=e.length,I=Wt(e);if(g.length+m.length===0)for(let _=0;_<h.length;_++){const $=_%x.length,R=_%b.length,A=n(x[$*2],x[$*2+1],b[R*2],b[R*2+1]);h[_]=A.real,f[_]=A.imag}else for(let _=0;_<h.length;_++){const $=ou(_,l,u),R=$.slice(-y);g.forEach(j=>R[j]=0);const A=Nr(R,y,v),F=$.slice(-k);m.forEach(j=>F[j]=0);const L=Nr(F,k,I),V=n(x[A*2],x[A*2+1],b[L*2],b[L*2+1]);h[_]=V.real,f[_]=V.imag}return[h,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oF=wn((n,t)=>n+t),Art=HI((n,t,e,s)=>({real:n+e,imag:t+s})),Jl=On(au,oF,Art),Drt={kernelName:au,backendName:"cpu",kernelFunc:Jl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GI(n,t,e,s,i){const r=ut(s),o=ns(i,e);for(let a=0;a<n.length;a++){const c=n[a];if(c<0)throw new Error("Input x must be non-negative!");c>=i||(r>0?o[c]+=t[a]:o[c]+=1)}return o}function aF(n,t,e,s=!1){const i=n.shape[0],r=n.shape[1],o=ce([i,e],t.dtype);for(let a=0;a<i;a++)for(let c=0;c<r;c++){const l=n.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=e||(s?o.set(1,a,l):t.size>0?o.set(o.get(a,l)+t.get(a,c),a,l):o.set(o.get(a,l)+1,a,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cF=wn((n,t)=>n&t),Ort=On(R1,cF),Prt={kernelName:R1,backendName:"cpu",kernelFunc:Ort};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wr(n){return(t,e,s)=>{const i=gn(e,t.length);for(let r=0;r<t.length;++r)i[r]=n(t[r],s);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(n,t,e){const s=Wr(t);return Aa(n,s,e)}function Aa(n,t,e){return({inputs:s,attrs:i,backend:r})=>{const{x:o}=s;Pt(o,n);const a=r,c=a.data.get(o.dataId).values;let l;if(o.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=Ro(c)}else l=c;const u=e||o.dtype,h=t(l,u,i);return a.makeTensorInfo(o.shape,u,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lF=Wr(n=>Math.ceil(n)),Frt=Aa(Rd,lF),Mrt={kernelName:Rd,backendName:"cpu",kernelFunc:Frt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uF(n,t,e,s){const i=gn(e,ut(t));if(s&&e!=="string"){let r=0;n.forEach(o=>{const a=ut(o.shape);i.set(o.vals,r),r+=a})}else{let r=0;n.forEach(o=>{const a=e==="string"?Ro(o.vals):o.vals;let c=0;for(let l=0;l<o.shape[0];++l){const u=l*t[1]+r;for(let h=0;h<o.shape[1];++h)i[u+h]=a[c++]}r+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hF=wn((n,t)=>n===t?1:0),dF=On(Rb,hF,null,"bool"),Lrt={kernelName:Rb,backendName:"cpu",kernelFunc:dF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF=Wr(n=>Math.exp(n)),pF=Aa(Ld,fF,"float32"),Brt={kernelName:Ld,backendName:"cpu",kernelFunc:pF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gF=Wr(n=>Math.expm1(n)),zrt=Aa(Bd,gF),Wrt={kernelName:Bd,backendName:"cpu",kernelFunc:zrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mF=Wr(n=>Math.floor(n)),Vrt=Aa(zd,mF),Urt={kernelName:zd,backendName:"cpu",kernelFunc:Vrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF=wn((n,t)=>Math.floor(n/t)),Hrt=On(Wd,bF,null,"int32"),Grt={kernelName:Wd,backendName:"cpu",kernelFunc:Hrt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xF(n,t,e,s,i,r,o,a,c){const l=ce([s,r],e);for(let u=0;u<s;u++){const h=[];let f=0;for(let g=0;g<i;g++){const m=n[u*i+g];f+=m*o[g],h.push(m)}if(f<0||f>=c/r)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let g=0;g<r;g++)l.values[u*r+g]=t.get(...t.indexToLoc(f*r+g))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yF(n,t,e){const s=ce(e,n.dtype);for(let i=0;i<s.size;++i){const o=s.indexToLoc(i).slice(),a=o[0],c=o[2],l=t.locToIndex([a,c]);o[2]=t.values[l];const u=n.locToIndex(o);0<=u&&u<n.values.length&&(s.values[i]=n.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF=wn((n,t)=>n>t?1:0),jrt=On(Pb,wF,null,"bool"),qrt={kernelName:Pb,backendName:"cpu",kernelFunc:jrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=wn((n,t)=>n>=t?1:0),Krt=On(Vd,vF,null,"bool"),Xrt={kernelName:Vd,backendName:"cpu",kernelFunc:Krt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CF=wn((n,t)=>n<t?1:0),Yrt=On(Mb,CF,null,"bool"),Jrt={kernelName:Mb,backendName:"cpu",kernelFunc:Yrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF=wn((n,t)=>n<=t?1:0),Zrt=On(Lb,IF,null,"bool"),Qrt={kernelName:Lb,backendName:"cpu",kernelFunc:Zrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kF(n,t,e){const s=(t-n)/(e-1),i=ns(e,"float32");i[0]=n;for(let r=1;r<i.length;r++)i[r]=i[r-1]+s;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SF=Wr(n=>Math.log(n)),tot=Aa(qd,SF),eot={kernelName:qd,backendName:"cpu",kernelFunc:tot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _F(n,t,e,s){const i=es(s,ut(e));for(let r=0;r<i.length;++r){const o=r*t;let a=n[o];for(let c=0;c<t;++c){const l=n[o+c];(Number.isNaN(l)||l>a)&&(a=l)}i[r]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF=wn((n,t)=>Math.max(n,t)),not=On(Xd,TF),sot={kernelName:Xd,backendName:"cpu",kernelFunc:not};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EF=wn((n,t)=>Math.min(n,t)),iot=On(Yd,EF),rot={kernelName:Yd,backendName:"cpu",kernelFunc:iot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jI=wn((n,t)=>n*t),oot=HI((n,t,e,s)=>({real:n*e-t*s,imag:n*s+t*e})),Wx=On(Zd,jI,oot),aot={kernelName:Zd,backendName:"cpu",kernelFunc:Wx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $F(n,t,e){const s=Sa(-1,e);return jI([],t,s,n,e)}function cot(n){const{inputs:t,backend:e}=n,{x:s}=t;Pt(s,"neg");const i=e.data.get(s.dataId).values,[r,o]=$F(i,s.shape,s.dtype);return e.makeTensorInfo(o,s.dtype,r)}const lot={kernelName:Xb,backendName:"cpu",kernelFunc:cot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF=wn((n,t)=>n!==t?1:0),uot=On(Yb,NF,null,"bool"),hot={kernelName:Yb,backendName:"cpu",kernelFunc:uot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qI(n,t,e,s,i){const r=t.length,o=ut(t),a=Wt(t),c=Wt(i),l=es(e,ut(i));for(let u=0;u<o;++u){const h=ou(u,r,a),f=new Array(h.length);for(let m=0;m<f.length;m++)f[m]=h[s[m]];const g=Nr(f,r,c);l[g]=n[u]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Os(n){const{inputs:t,attrs:e,backend:s}=n,{x:i}=t,{perm:r}=e;Pt(i,"transpose");const o=i.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=i.shape[r[h]];const c=s.data.get(i.dataId).values,l=qI(c,i.shape,i.dtype,r,a);return{dataId:s.write(l,a,i.dtype),shape:a,dtype:i.dtype}}const dot={kernelName:Dl,backendName:"cpu",kernelFunc:Os};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(n,t,e,s){const[i,r]=Vn(n,s),o=Ks(t,"int32"),a=ns(ut(i),o),c=ut(r);for(let l=0;l<a.length;++l){const u=l*c;let h=1;for(let f=0;f<c;++f)h*=e[u+f];a[l]=h}return{outVals:a,outShape:i,outDtype:o}}function fot(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s;Pt(i,"prod");const a=i.shape.length,c=le(r,i.shape),l=un(c,a);let u=c,h=i;const f=[];l!=null&&(h=Os({inputs:{x:i},backend:e,attrs:{perm:l}}),f.push(h),u=xn(u.length,a));const g=e.data.get(h.dataId).values,{outVals:m,outShape:x,outDtype:b}=RF(h.shape,h.dtype,g,u);let y=x;return o&&(y=_n(x,c)),f.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.makeTensorInfo(y,b,m)}const pot={kernelName:nx,backendName:"cpu",kernelFunc:fot};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function got(n,t,e){n.forEach((s,i)=>{if(s<0||s>=e){const r=ou(i,t.length,Wt(t)).join(",");throw new Error(`indices[${r}] = ${s} is not in [0, ${e})`)}})}function mot(n,t){for(let e=0;e<n.length;++e){const s=n[e],i=e===n.length-1?t:n[e+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>i)throw new Error("Ragged splits must not point past values");for(let r=1;r<s.length;++r)if(s[r-1]>s[r])throw new Error("Ragged splits must be sorted in ascending order")}}function bot(n,t,e,s){const i=[];let r=0;const o=t.length-1+e.length,a=new Array(o).fill(null).map(()=>[0]);mot(e,s);let c=1;for(let l=0;l<t.length-1;++l){c*=t[l];const u=t[l+1];for(let h=1;h<c+1;++h)a[l].push(h*u)}for(let l=0;l<n.length;++l){let u=n[l],h=n[l]+1;for(let f=0;f<e.length;++f){const g=e[f],m=f+t.length-1;if(m>=0){const x=a[m],b=x[x.length-1]-g[u];for(let y=u;y<h;++y)a[m].push(g[y+1]+b)}u=g[u],h=g[h]}h!==u&&(i.push([u,h]),r+=h-u)}return{outSplits:a,valueSlices:i,numValues:r}}function xot(n){const t=[];for(let e=0;e<n.length;++e){const s=n[e].length,i=gn("int32",s);t.push(i),n[e].forEach((r,o)=>i[o]=r)}return t}function g$(n,t){const e=n.slice(0,t);for(;e.length<t;)e.push(1);for(let s=t;s<n.length;s++)e[t-1]*=n[s];return e}function yot(n,t,e,s,i,r){const o=g$(t,2)[1],a=g$(r,2)[1];let c=0;for(const l of e)for(let u=l[0];u<l[1];++u){for(let h=0;h<s;++h)i[c*a+h]=n[u*o+h];++c}}function wot(n,t,e,s,i){const r=t.slice();r[0]=i;const o=gn(e,ut(r)),a=n.length,c=a===0?0:a/t[0];return yot(n,t,s,c,o,r),[o,r]}function AF(n,t,e,s,i,r,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const c=t[0][0]-1;if(got(r,o,c),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:u,valueSlices:h,numValues:f}=bot(r,o,n,l),g=xot(u),m=wot(e,s,i,h,f);return[g,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$=2147483647;function DF(n,t,e,s,i,r,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,c=i.length===0,l=o.length===0,u=[];a||u.push(t[0]),c||u.push(i[0]),l||u.push(o[0]);for(let b=1;b<u.length;++b)if(u[b]!==u[b-1])throw new Error("starts, limits, and deltas must have the same shape");const h=u.length===0?1:u[0],f=gn("int32",h+1);f[0]=0;for(let b=0;b<h;++b){const y=a?n[0]:n[b],v=c?s[0]:s[b],k=l?r[0]:r[b];if(k===0)throw new Error("Requires delta != 0");let I;if(k>0&&v<y||k<0&&v>y)I=0;else if(I=Math.ceil(Math.abs((v-y)/k)),I>m$)throw new Error(`Requires ((limit - start) / delta) <= ${m$}`);f[b+1]=f[b]+I}const g=f[h],m=gn(e,g);let x=0;for(let b=0;b<h;++b){const y=f[b+1]-f[b];let v=a?n[0]:n[b];const k=l?r[0]:r[b];for(let I=0;I<y;++I)m[x++]=v,v+=k}return[f,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ki=Yi;class Gm{constructor(t,e,s,i,r,o,a,c,l,u){this.shape=t,this.shapeShape=e,this.values=s,this.valuesShape=i,this.valuesDType=r,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=yD(u),this.raggedRank=wD(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===ki.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===ki.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case ki.VALUE_ROWIDS:return Gm.getMaxWidthValueRowID(e);case ki.ROW_SPLITS:return Gm.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${ki[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(e===0||e===1)return 0;let s=0;for(let i=0;i<e-1;++i){const r=t[i+1]-t[i];r>s&&(s=r)}return s}static getMaxWidthValueRowID(t){const e=t.length;if(e===0)return 0;let s=0,i=t[0],r=0;for(let o=1;o<e;++o){const a=t[o];a!==i&&(i=a,r=Math.max(o-s,r),s=o)}return Math.max(e-s,r)}tensorShapeFromTensor(t,e,s=!0){if(e.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return x$(t,s)}calculateOutputSize(t){const e=this.valuesShape,s=this.defaultValueShape;vD(s,e);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=xD(this.raggedRank,i,e);o[0]<0&&(o[0]=t);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(t,e,s){const i=Math.min(t,s),r=[];let o=0;for(let a=0;a<i;++a,o+=e)r.push(o);for(let a=i;a<t;++a)r.push(-1);return P(r.length===t,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(t,e,s,i){const r=t.length,o=[];for(let a=0;a<r-1;++a){const c=t[a+1]-t[a];let l=Math.min(i,c),u=e[a];u===-1&&(l=0);for(let h=0;h<l;++h)o.push(u),u+=s;for(let h=0;h<c-l;++h)o.push(-1)}if(r>0&&o.length!==t[r-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,e,s,i){const r=t.length,o=[];if(r===0)return[];let a=0,c=t[0];if(c>=e.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${e.length}`);let l=e[c];o.push(l);for(let u=1;u<r;++u){const h=t[u];if(h===c)l>=0&&(++a,a<i?l+=s:l=-1);else{if(a=0,c=h,h>=e.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${e.length}`);l=e[h]}o.push(l)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,e,s,i){const r=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case ki.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,e,s,i);case ki.ROW_SPLITS:if(r.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${r.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(r,e,s,i);default:throw new Error(`Unsupported partition type: ${ki[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case ki.FIRST_DIM_SIZE:return t[0];case ki.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ki.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ki[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),s=this.calculateOutputSize(e),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let c=i.length-2;c>=0;--c)i[c]=i[c+1]*s[c+1];const r=x$(s,!1),o=gn(this.valuesDType,ut(r));if(i[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(e,i[0],s[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,i[l],s[l]);this.setOutput(this.raggedRank,c,o,r)}return[r,o]}setOutput(t,e,s,i){if(s.length===0)return;const r=this.values,o=s;let a=i.slice();a=a.slice(t+1);const c=ut(a),l=e.length;let u=this.defaultValue;if(u.length!==c&&u.length!==1){const m=this.defaultValueShape;nt(()=>{const x=Y(u,m);u=Fh(x,a).dataSync()})}let h=0,f=0,g=0;for(let m=0;m<=l;++m){let x=m<l?e[m]:-1;if(x===g){++g;continue}if(f<g){const b=r.subarray(h*c),y=o.subarray(f*c),v=(g-f)*c;b$(y,b,v)}if(m>=l){const b=s.length;x=Math.floor(b/c)}if(x>g)if(this.defaultValue.length===1)o.subarray(g*c,x*c).fill(this.defaultValue[0]),g=x;else for(;x>g;){const b=o.slice(g*c);b$(b,u,c),++g}x<0?(h=m+1,f=g):(h=m,f=g,g=f+1)}}}function b$(n,t,e){for(let s=0;s<e;s++)n[s]=t[s]}function x$(n,t){const e=[];for(let s of n){if(s<0){if(!t)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}e.push(s)}return e}function OF(n,t,e,s,i,r,o,a,c,l){return new Gm(n,t,e,s,i,r,o,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PF(n,t,e,s){const i=n===t,r=n<t&&e<0,o=t<n&&e>1;if(i||r||o)return ns(0,s);const a=Math.abs(Math.ceil((t-n)/e)),c=ns(a,s);t<n&&e===1&&(e=-1),c[0]=n;for(let l=1;l<c.length;l++)c[l]=c[l-1]+e;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FF=Wr(n=>1/Math.sqrt(n)),vot=Aa(rf,FF),Cot={kernelName:rf,backendName:"cpu",kernelFunc:vot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gc(n,t,e,s,i,r,o,a,c,l){const u=[s/i,i],h=n.values,f=t.values;if(s===0)return ce(e,t.dtype);const g=c instanceof jn?c:ce(u,t.dtype);typeof c=="string"||typeof c=="number"?g.values.fill(c):typeof c=="boolean"&&g.values.fill(+c);for(let m=0;m<r;m++){const x=[];let b=0;for(let y=0;y<o;y++){const v=h[m*o+y];x.push(v),b+=v*a[y]}if(b<0||b>=s/i)throw new Error(`Invalid indices: ${x} does not index into ${e}`);for(let y=0;y<i;y++)l?g.values[b*i+y]+=f[m*i+y]:g.values[b*i+y]=t.rank===0?f[0]:f[m*i+y]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iot=Wr(n=>1/(1+Math.exp(-n))),MF=Le(uf,n=>1/(1+Math.exp(-n))),kot={kernelName:uf,backendName:"cpu",kernelFunc:MF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LF(n,t,e,s,i){const r=tI(s,t,e),o=ut(e),a=Wt(s);if(r){const h=eI(t,a);return i==="string"?n.slice(h,h+o):n.subarray(h,h+o)}const c=i==="string"?Ro(n):n,l=ce(s,i,c),u=ce(e,i);for(let h=0;h<u.size;++h){const f=u.indexToLoc(h),g=f.map((m,x)=>m+t[x]);u.set(l.get(...g),...f)}return i==="string"?WD(u.values):u.values}function Lc(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{begin:r,size:o}=s;Pt(i,"slice");const[a,c]=Sx(i,r,o);ZC(i,a,c);const l=e.data.get(i.dataId).values,u=LF(l,a,c,i.shape,i.dtype);return e.makeTensorInfo(c,i.dtype,u)}const Sot={kernelName:cx,backendName:"cpu",kernelFunc:Lc};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BF(n,t,e,s,i,r,o){const a=t[0],c=r[0],l=new Array(c),u=new Array(a),h=t[1];if(c===0){if(a!==0)throw new Error(ED(a));const b=gn(e,0),y=gn(i,0);return[b,[0,h],y,l,u]}let f=!0,g=0;const m=new Array(c).fill(0);for(let b=0;b<a;++b){const y=n[b*h];if(y<0)throw new Error($D(b,y));if(y>=c)throw new Error(ND(b,y,c));++m[y],f=f&&y>=g,g=y}let x=!0;for(let b=0;b<c;++b){const y=m[b]===0;l[b]=y,x=x&&!y,m[b]=Math.max(m[b],1),b>0&&(m[b]+=m[b-1])}if(x&&f){const b=n,y=s;for(let v=0;v<a;++v)u[v]=v;return[b,[a,h],y,l,u]}else{const b=m[c-1],y=gn(e,b*h),v=gn(i,b),k=new Array(c).fill(0);for(let I=0;I<a;++I){const _=n[I*h],$=k[_],R=(_===0?0:m[_-1])+$;k[_]++;for(let A=0;A<h;++A)y[R*h+A]=n[I*h+A];v[R]=s[I],u[I]=R}for(let I=0;I<c;++I)if(k[I]===0){const $=I===0?0:m[I-1];y[$*h+0]=I;for(let R=1;R<h;++R)y[$*h+R]=0;v[$]=o}return[y,[b,h],v,l,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(n,t,e,s,i){const r=ut(s),o=t[0],a=i.length,c=[];let l=1,u=-1;for(let b=0;b<a;++b){const y=i[b];if(y===-1){if(u!==-1)throw new Error(RD(u,b));u=b,c.push(1)}else{if(y<0)throw new Error(AD(b,y));l*=y,c.push(y)}}if(u!==-1){if(l<=0)throw new Error(DD());const b=Math.trunc(r/l);if(l*b!==r)throw new Error(OD(s,c));c[u]=b}if(ut(c)!==r)throw new Error(PD(s,c));const f=s.length,g=[];if(f>0){g[f-1]=1;for(let b=f-2;b>=0;--b)g[b]=g[b+1]*s[b+1]}const m=[];if(a>0){m[a-1]=1;for(let b=a-2;b>=0;--b)m[b]=m[b+1]*c[b+1]}const x=gn(e,o*a);for(let b=0;b<o;++b){let y=0;for(let v=0;v<f;++v)y+=n[b*f+v]*g[v];for(let v=0;v<a;++v)x[b*a+v]=Math.trunc(y/m[v]),y%=m[v]}return[x,[o,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KI(n,t,e,s,i,r=!1,o=0){const a=s.length,c=[t[0],n.length/t[0]],l=c[1],h=a>0?i[a-1]+1:0;if(h<0)throw new Error(xv());const f=t.slice();f[0]=h;const g=f.reduce((k,I)=>k*I,1),m=gn(e,g);if(a===0)return h>0&&m.fill(o),[m,f];if(h<=0)throw new Error(xv());let x=0,b=1,y=0,v=i[x];for(;;){let k=0;if(b<a){if(k=i[b],v===k){++b;continue}if(v>=k)throw new Error(FD())}if(v<0||v>=h)throw new Error(MD(v,h));v>y&&m.fill(o,y*l,v*l);for(let I=x;I<b;++I){const _=s[I];if(_<0||_>=c[0])throw new Error(LD(I,s[I],c[0]));for(let $=0;$<l;$++)m[v*l+$]+=n[_*l+$]}if(r)for(let I=0;I<l;I++)m[v*l+I]/=b-x;if(x=b,++b,y=v+1,v=k,b>a)break}return y<h&&m.fill(o,y*l,h*l),[m,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ot=Wr(n=>Math.sqrt(n)),Tot=Le(df,n=>Math.sqrt(n)),Eot={kernelName:df,backendName:"cpu",kernelFunc:Tot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WF=wn((n,t)=>{const e=n-t;return e*e}),$ot=On(ff,WF),Not={kernelName:ff,backendName:"cpu",kernelFunc:$ot};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VF=Wr((n,t)=>{const{pattern:e,replaceGlobal:s,rewrite:i}=t;return n.replace(new RegExp(e,s?"g":""),i)}),Rot=Aa(oC,VF),Aot={kernelName:oC,backendName:"cpu",kernelFunc:Rot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(n,t,e,s){const i=ce(n,t.dtype);for(let r=0;r<i.size;r++){const o=i.indexToLoc(r),a=new Array(o.length);for(let c=0;c<a.length;c++)a[c]=o[c]*e[c]+s[c];i.set(t.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dot{constructor(t,e,s,i,r,o){this.separator=ha(t),this.nGramWidths=e,this.leftPad=ha(s),this.rightPad=ha(i),this.padWidth=r,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const s=this.getPadWidth(e);return Math.max(0,t+2*s-e+1)}createNGrams(t,e,s,i,r,o){for(let a=0;a<r;++a){const c=this.getPadWidth(o),l=Math.max(0,c-a),u=Math.max(0,c-(r-(a+1))),h=o-(l+u),f=e+(l>0?0:a-c);let g=0;g+=l*this.leftPad.length;for(let v=0;v<h;++v)g+=t[f+v].length;g+=u*this.rightPad.length;const m=l+u+h-1;g+=m*this.separator.length,s[i+a]=new Uint8Array(g);const x=s[i+a];let b=0;const y=v=>v.forEach(k=>x[b++]=k);for(let v=0;v<l;++v)y(this.leftPad),y(this.separator);for(let v=0;v<h-1;++v)y(t[f+v]),y(this.separator);if(h>0){y(t[f+h-1]);for(let v=0;v<u;++v)y(this.separator),y(this.rightPad)}else{for(let v=0;v<u-1;++v)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(t,e){const s=t.length,i=e.length;if(i>0){let c=e[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<i;++l){let u=e[l]>=c;if(u=u&&e[l]<=s,!u)throw new Error(`Invalid split value ${e[l]}, must be in [${c}, ${s}]`);c=e[l]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const r=i-1,o=gn("int32",i);if(s===0||i===0){const c=new Array(s);for(let l=0;l<=r;++l)o[l]=0;return[c,o]}o[0]=0;for(let c=1;c<=r;++c){const l=e[c]-e[c-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&u===0&&(u=1),o[c]=o[c-1]+u}const a=new Array(o[r]);for(let c=0;c<r;++c){const l=e[c];let u=o[c];if(this.nGramWidths.forEach(h=>{const f=e[c+1]-e[c],g=this.getNumNGrams(f,h);this.createNGrams(t,l,a,u,g,h),u+=g}),this.preserveShort&&u===o[c]){const h=e[c+1]-e[c];if(h===0)continue;const f=h+2*this.padWidth,g=1;this.createNGrams(t,l,a,u,g,f)}}return[a,o]}}function HF(n,t,e,s,i,r,o,a){return new Dot(e,s,i,r,o,a).compute(n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oot(n,t,e,s){if(!n.length)return;if(t.length===0){for(let r=0;r<n.length;++r)s.push(n.subarray(r,r+1));return}if(t.length===1){const r=t[0];let o=n.indexOf(r);for(;o!==-1;){const a=n.subarray(0,o);(!e||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(r)}(!e||n.length!==0)&&s.push(n);return}let i=0;for(let r=0;r<n.length+1;r++)if(r===n.length||t.indexOf(n[r])!==-1){const o=n.subarray(i,r);(!e||o.length!==0)&&s.push(o),i=r+1}}function GF(n,t,e){const s=n.length,i=[];let r=0,o=0;const a=new Array(s);for(let f=0;f<s;++f){const g=i.length;Oot(n[f],t,e,i);const m=i.length-g;a[f]=m,r+=m,o=Math.max(o,m)}const c=gn("int32",r*2),l=new Array(r),u=[s,o];let h=0;for(let f=0;f<s;++f)for(let g=0;g<a[f];++g)c[h*2]=f,c[h*2+1]=g,l[h]=i[h],++h;return[c,l,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jF(n,t){const e=gn("int32",n.length);for(let s=0;s<n.length;++s)e[s]=pY(n[s]).modulo(t).getLowBitsUnsigned();return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qF=wn((n,t)=>n-t),Pot=HI((n,t,e,s)=>({real:n-e,imag:t-s})),XI=On(pf,qF,Pot),Fot={kernelName:pf,backendName:"cpu",kernelFunc:XI};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KF(n,t){const e=new Array(n.rank);for(let i=0;i<e.length;i++)e[i]=n.shape[i]*t[i];const s=ce(e,n.dtype);for(let i=0;i<s.values.length;++i){const r=s.indexToLoc(i),o=new Array(n.rank);for(let c=0;c<o.length;c++)o[c]=r[c]%n.shape[c];const a=n.locToIndex(o);s.values[i]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sh=(n,t)=>{const e=t.value-n.value;return e===0?n.index-t.index:e};function XF(n,t,e=0,s=n.length-1){for(;s>e;){if(s-e>600){const a=s-e+1,c=t-e+1,l=Math.log(a),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(a-u)/a)*Math.sign(c-a/2),f=Math.max(e,Math.floor(t-c*u/a+h)),g=Math.min(s,Math.floor(t+(a-c)*u/a+h));XF(n,t,f,g)}const i=n[t];let r=e,o=s;for(Il(n,e,t),Sh(n[s],i)>0&&Il(n,e,s);r<o;){for(Il(n,r,o),r++,o--;Sh(n[r],i)<0;)r=r+1;for(;Sh(n[o],i)>0;)o=o-1}Sh(n[e],i)===0?Il(n,e,o):(o=o+1,Il(n,o,s)),o<=t&&(e=o+1),t<=o&&(s=o-1)}}function YF(n,t,e,s,i){const r=t[t.length-1],[o,a]=[n.length/r,r],c=es(e,o*s),l=es("int32",o*s);for(let h=0;h<o;h++){const f=h*a,g=n.subarray(f,f+a);let m=new Array(g.length);g.forEach((v,k)=>m[k]={value:v,index:k}),s<m.length&&(XF(m,s),m=m.slice(0,s)),i&&m.sort(Sh);const x=h*s,b=c.subarray(x,x+s),y=l.subarray(x,x+s);for(let v=0;v<s;v++)b[v]=m[v].value,y[v]=m[v].index}const u=t.slice();return u[u.length-1]=s,[ce(u,e,c),ce(u,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(n,t,e,s){const i=le(t,e)[0],r=[1,e[0],1];for(let m=0;m<i;m++)r[0]*=e[m];r[1]=e[i];for(let m=i+1;m<e.length;m++)r[2]*=e[m];const o=new Map,a=new Int32Array(e[i]),c=new jn(r,s,n),l=[],u=r[0]===1&&r[2]===1;for(let m=0;m<e[i];m++){let x;if(u)x=n[m].toString();else{const y=[];for(let v=0;v<r[0];v++)for(let k=0;k<r[2];k++)y.push(c.get(v,m,k));x=y.join(",")}const b=o.get(x);if(b!=null)a[m]=b;else{const y=o.size;o.set(x,y),a[m]=y,l.push(m)}}const h=r.slice();h[1]=o.size;const f=new jn(h,s);l.forEach((m,x)=>{for(let b=0;b<r[0];b++)for(let y=0;y<r[2];y++)f.set(c.get(b,m,y),b,x,y)});const g=e.slice();return g[i]=h[1],{outputValues:f.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mot=Object.freeze(Object.defineProperty({__proto__:null,addImpl:oF,bincountImpl:GI,bincountReduceImpl:aF,bitwiseAndImpl:cF,castImpl:rF,ceilImpl:lF,concatImpl:uF,equalImpl:hF,expImpl:fF,expm1Impl:gF,floorDivImpl:bF,floorImpl:mF,gatherNdImpl:xF,gatherV2Impl:yF,greaterEqualImpl:vF,greaterImpl:wF,lessEqualImpl:IF,lessImpl:CF,linSpaceImpl:kF,logImpl:SF,maxImpl:_F,maximumImpl:TF,minimumImpl:EF,multiplyImpl:jI,negImpl:$F,notEqualImpl:NF,prodImpl:RF,raggedGatherImpl:AF,raggedRangeImpl:DF,raggedTensorToTensorImpl:OF,rangeImpl:PF,rsqrtImpl:FF,scatterImpl:gc,sigmoidImpl:Iot,simpleAbsImpl:iF,sliceImpl:LF,sparseFillEmptyRowsImpl:BF,sparseReshapeImpl:zF,sparseSegmentReductionImpl:KI,sqrtImpl:_ot,squaredDifferenceImpl:WF,staticRegexReplaceImpl:VF,stridedSliceImpl:UF,stringNGramsImpl:HF,stringSplitImpl:GF,stringToHashBucketFastImpl:jF,subImpl:qF,tileImpl:KF,topKImpl:YF,transposeImpl:qI,uniqueImpl:JF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mA("cpu",()=>new zx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF=Le(Fd,n=>n>=0?n:Math.exp(n)-1),Lot={kernelName:Fd,backendName:"cpu",kernelFunc:ZF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{alpha:r}=s;Pt([i],"leakyRelu");const o=ut(i.shape),a=e.data.get(i.dataId).values,c=es("float32",o);for(let l=0;l<a.length;l++)c[l]=a[l]<0?r*a[l]:a[l];return e.makeTensorInfo(i.shape,"float32",c)}const Bot={kernelName:Fb,backendName:"cpu",kernelFunc:QF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zot=wn((n,t)=>n<0?t*n:n);function tM(n){const{inputs:t,backend:e}=n,{x:s,alpha:i}=t;Pt([s,i],"prelu");const r=e.data.get(s.dataId).values,o=e.data.get(i.dataId).values,[a,c]=zot(s.shape,i.shape,r,o,"float32");return e.makeTensorInfo(c,"float32",a)}const Wot={kernelName:ex,backendName:"cpu",kernelFunc:tM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eM=Le(ef,n=>Math.max(0,n)),Vot={kernelName:ef,backendName:"cpu",kernelFunc:eM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM=Le(nf,n=>Math.min(Math.max(0,n),6)),Uot={kernelName:nf,backendName:"cpu",kernelFunc:nM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jm(n,t,e,s,i){if(e==="linear")return Br({inputs:{x:t},backend:n});if(e==="relu")return eM({inputs:{x:t},backend:n});if(e==="elu")return ZF({inputs:{x:t},backend:n});if(e==="relu6")return nM({inputs:{x:t},backend:n});if(e==="prelu")return tM({inputs:{x:t,alpha:s},backend:n});if(e==="leakyrelu")return QF({inputs:{x:t},backend:n,attrs:{alpha:i}});if(e==="sigmoid")return MF({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ke(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{shape:r}=s,o=ut(i.shape),a=vR(r,o),c=ut(a);P(o===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),e.incRef(i.dataId);const l=e.data.get(i.dataId);if(l.complexTensorInfos!=null){const u=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;u.shape=a,h.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const Hot={kernelName:sx,backendName:"cpu",kernelFunc:Ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sM(n){const{inputs:t,backend:e,attrs:s}=n,{a:i,b:r}=t,{transposeA:o,transposeB:a}=s;Pt([i,r],"matMul");const c=i.shape.length,l=r.shape.length,u=o?i.shape[c-2]:i.shape[c-1],h=a?r.shape[l-1]:r.shape[l-2],f=o?i.shape[c-1]:i.shape[c-2],g=a?r.shape[l-2]:r.shape[l-1],m=i.shape.slice(0,-2),x=r.shape.slice(0,-2),b=ut(m),y=ut(x),k=ee(i.shape.slice(0,-2),r.shape.slice(0,-2)).concat([f,g]);P(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${i.shape} and ${r.shape} and transposeA=${o} and transposeB=${a} must match.`);const I=o?[b,u,f]:[b,f,u],_=a?[y,g,h]:[y,h,g],$=Ke({inputs:{x:i},backend:e,attrs:{shape:I}}),R=Ke({inputs:{x:r},backend:e,attrs:{shape:_}}),A=o?$.shape[1]:$.shape[2],F=o?$.shape[2]:$.shape[1],L=a?R.shape[1]:R.shape[2],V=Math.max(b,y),j=e.data.get($.dataId).values,Z=e.data.get(R.dataId).values,et=Wt($.shape),K=Wt(R.shape),[tt,it,st]=o?[et[0],1,et[1]]:[et[0],et[1],1],[ot,bt,ft]=a?[1,K[1],K[0]]:[K[1],1,K[0]],yt=F*L,vt=ce([V,F,L],$.dtype),St=vt.values,pt=e.blockSize;for(let Ct=0;Ct<V;Ct++){const Mt=Ct%b,Bt=Ct%y;for(let At=0;At<F;At+=pt){const Jt=Math.min(At+pt,F);for(let Yt=0;Yt<L;Yt+=pt){const re=Math.min(Yt+pt,L);for(let Ee=0;Ee<A;Ee+=pt){const pe=Math.min(Ee+pt,A);for(let be=At;be<Jt;be++)for(let _e=Yt;_e<re;_e++){let xe=0;for(let Oe=Ee;Oe<pe;Oe++){const ti=j[Mt*tt+be*it+Oe*st],Xe=Z[Oe*ot+_e*bt+Bt*ft];xe+=ti*Xe}St[Ct*yt+(be*L+_e)]+=xe}}}}}return e.disposeIntermediateTensorInfo($),e.disposeIntermediateTensorInfo(R),e.makeTensorInfo(k,vt.dtype,vt.values)}const Got={kernelName:vb,backendName:"cpu",kernelFunc:sM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jot(n){const{inputs:t,backend:e,attrs:s}=n,{a:i,b:r,bias:o,preluActivationWeights:a}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=s;let f,g,m;const x=[];f=sM({inputs:{a:i,b:r},attrs:{transposeA:c,transposeB:l},backend:e}),o&&(g=Jl({inputs:{a:f,b:o},backend:e}),x.push(f),f=g),u&&(m=jm(e,f,u,a,h),x.push(f),f=m);for(const y of x)e.disposeIntermediateTensorInfo(y);return f}const qot={kernelName:Sm,backendName:"cpu",kernelFunc:jot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kot=Le(Id,n=>Math.acos(n)),Xot={kernelName:Id,backendName:"cpu",kernelFunc:Kot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yot=Le(kd,n=>Math.acosh(n)),Jot={kernelName:kd,backendName:"cpu",kernelFunc:Yot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zot(n){const{inputs:t,backend:e}=n,s=t;Pt(t,"addN");const i=s.map(a=>e.data.get(a.dataId).values),r=ce(s[0].shape,s[0].dtype),o=r.values;for(let a=0;a<s.length;a++){const c=i[a];for(let l=0;l<o.length;l++)o[l]+=c[l]}return e.makeTensorInfo(r.shape,r.dtype,r.values)}const Qot={kernelName:S1,backendName:"cpu",kernelFunc:Zot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s;Pt(i,"all");const a=le(r,i.shape);let c=a;const l=un(c,i.shape.length);let u=i;l!=null&&(u=Os({inputs:{x:i},backend:e,attrs:{perm:l}}),c=xn(c.length,i.shape.length)),Yn("all",c,u.shape.length);const[h,f]=Vn(u.shape,c),g=ut(f),m=ns(ut(h),u.dtype),x=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){const v=y*g;let k=x[v];for(let I=0;I<g;++I){const _=x[v+I];k=k&&_}m[y]=k}l!=null&&e.disposeIntermediateTensorInfo(u);const b=e.makeTensorInfo(h,u.dtype,m);if(o){const y=_n(h,a),v=Ke({inputs:{x:b},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(b),v}return b}const eat={kernelName:_1,backendName:"cpu",kernelFunc:tat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s;Pt(i,"any");const a=le(r,i.shape);let c=a;const l=un(c,i.shape.length);let u=i;l!=null&&(u=Os({inputs:{x:i},backend:e,attrs:{perm:l}}),c=xn(c.length,i.shape.length)),Yn("any",c,u.shape.length);const[h,f]=Vn(u.shape,c),g=ut(f),m=ns(ut(h),u.dtype),x=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){const v=y*g;let k=x[v];for(let I=0;I<g;++I){const _=x[v+I];k=k||_}m[y]=k}l!=null&&e.disposeIntermediateTensorInfo(u);const b=e.makeTensorInfo(h,u.dtype,m);if(o){const y=_n(h,a),v=Ke({inputs:{x:b},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(b),v}return b}const sat={kernelName:T1,backendName:"cpu",kernelFunc:nat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r}=s;Pt(i,"argMax");let o=le(r,i.shape);const a=un(o,i.shape.length);let c=i;const l=[];a!=null&&(c=Os({inputs:{x:i},backend:e,attrs:{perm:a}}),l.push(c),o=xn(o.length,c.shape.length)),o=[o[0]],Yn("argMax",o,c.shape.length);const[u,h]=Vn(c.shape,o),f=ut(u),g=ns(f,"int32"),m=ut(h),x=e.data.get(c.dataId).values;for(let b=0;b<g.length;++b){const y=b*m;let v=x[y],k=0;for(let I=0;I<m;++I){const _=x[y+I];_>v&&(v=_,k=I)}g[b]=k}return l.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(u,"int32",g)}const rat={kernelName:bb,backendName:"cpu",kernelFunc:iat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r}=s;Pt(i,"argMin");let o=le(r,i.shape);const a=un(o,i.shape.length);let c=i;const l=[];a!=null&&(c=Os({inputs:{x:i},backend:e,attrs:{perm:a}}),l.push(c),o=xn(o.length,c.shape.length)),o=[o[0]],Yn("argMin",o,c.shape.length);const[u,h]=Vn(c.shape,o),f=ut(u),g=ns(f,"int32"),m=ut(h),x=e.data.get(c.dataId).values;for(let b=0;b<g.length;++b){const y=b*m;let v=x[y],k=0;for(let I=0;I<m;++I){const _=x[y+I];_<v&&(v=_,k=I)}g[b]=k}return l.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(u,"int32",g)}const aat={kernelName:xb,backendName:"cpu",kernelFunc:oat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cat=Le(Sd,n=>Math.asin(n)),lat={kernelName:Sd,backendName:"cpu",kernelFunc:cat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uat=Le(_d,n=>Math.asinh(n)),hat={kernelName:_d,backendName:"cpu",kernelFunc:uat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dat=Le(Td,n=>Math.atan(n)),fat={kernelName:Td,backendName:"cpu",kernelFunc:dat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pat=wn((n,t)=>Math.atan2(n,t)),gat=On($d,pat),mat={kernelName:$d,backendName:"cpu",kernelFunc:gat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bat=Le(Ed,n=>Math.atanh(n)),xat={kernelName:Ed,backendName:"cpu",kernelFunc:bat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YI(n,t,e,s,i,r){const o=i.strideHeight,a=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,u=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=i.padInfo.top,g=i.padInfo.left,m=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=ce(i.outShape,e),b=x.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],v=i.outShape[2]*i.outShape[3],k=i.outShape[3];for(let I=0;I<i.batchSize;++I){const _=I*y,$=I*s[0];for(let R=0;R<i.inChannels;++R)for(let A=0;A<i.outHeight;++A){const F=A*o-f,L=Math.max(0,F),V=Math.min(i.inHeight,u+F),j=_+A*v;for(let Z=0;Z<i.outWidth;++Z){const et=Z*a-g,K=Math.max(0,et),tt=Math.min(i.inWidth,h+et);let it=m,st=0,ot=0;for(let ft=L;ft<V;ft+=c){const yt=$+ft*s[1];for(let vt=K;vt<tt;vt+=l){const St=yt+vt*s[2],pt=n[St+R];r==="max"&&pt>it?it=pt:r==="avg"&&(st+=pt,ot++)}if(isNaN(it))break}const bt=j+Z*k+R;b[bt]=r==="avg"?st/ot:it}}}return x}function iM(n,t,e,s,i=!1,r=!1){const o=ce(s.outShape,"int32"),a=s.strideHeight,c=s.strideWidth,l=s.dilationHeight,u=s.dilationWidth,h=s.effectiveFilterHeight,f=s.effectiveFilterWidth,g=s.padInfo.top,m=s.padInfo.left,x=ce(t,e,n);for(let b=0;b<s.batchSize;++b)for(let y=0;y<s.inChannels;++y)for(let v=0;v<s.outHeight;++v){const k=v*a-g;let I=k;for(;I<0;)I+=l;const _=Math.min(s.inHeight,h+k);for(let $=0;$<s.outWidth;++$){const R=$*c-m;let A=R;for(;A<0;)A+=u;const F=Math.min(s.inWidth,f+R);let L=Number.NEGATIVE_INFINITY,V=-1;for(let j=I;j<_;j+=l){const Z=j-k;for(let et=A;et<F;et+=u){const K=et-R,tt=x.get(b,j,et,y);tt>L&&(L=tt,i?V=r?((b*s.inHeight+j)*s.inWidth+et)*s.inChannels+y:(j*s.inWidth+et)*s.inChannels+y:V=Z*f+K)}}o.set(V,b,v,$,y)}}return o}function rM(n,t,e,s,i,r){const o=i.strideDepth,a=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,u=i.dilationHeight,h=i.dilationWidth,f=i.effectiveFilterDepth,g=i.effectiveFilterHeight,m=i.effectiveFilterWidth,x=i.padInfo.front,b=i.padInfo.top,y=i.padInfo.left,v=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,k=ce(i.outShape,e),I=k.values,_=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],$=i.outShape[2]*i.outShape[3]*i.outShape[4],R=i.outShape[3]*i.outShape[4],A=i.outShape[4];for(let F=0;F<i.batchSize;++F){const L=F*_,V=F*s[0];for(let j=0;j<i.inChannels;++j)for(let Z=0;Z<i.outDepth;++Z){const et=Z*o-x;let K=et;for(;K<0;)K+=l;const tt=Math.min(i.inDepth,f+et),it=L+Z*$;for(let st=0;st<i.outHeight;++st){const ot=st*a-b;let bt=ot;for(;bt<0;)bt+=u;const ft=Math.min(i.inHeight,g+ot),yt=it+st*R;for(let vt=0;vt<i.outWidth;++vt){const St=vt*c-y;let pt=St;for(;pt<0;)pt+=h;const Ct=Math.min(i.inWidth,m+St),Mt=yt+vt*A;let Bt=v,At=0,Jt=0;for(let re=K;re<tt;re+=l){const Ee=V+re*s[1];for(let pe=bt;pe<ft;pe+=u){const be=Ee+pe*s[2];for(let _e=pt;_e<Ct;_e+=h){const xe=be+_e*s[3],Oe=n[xe+j];if(r==="max"&&Oe>Bt?Bt=Oe:r==="avg"&&(At+=Oe,Jt++),isNaN(Bt))break}if(isNaN(Bt))break}if(isNaN(Bt))break}const Yt=Mt+j;I[Yt]=r==="avg"?At/Math.max(Jt,1):Bt}}}}return k}function yat(n,t){const e=ce(t.outShape,"int32"),s=t.strideDepth,i=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,g=t.padInfo.top,m=t.padInfo.left;for(let x=0;x<t.batchSize;++x)for(let b=0;b<t.inChannels;++b)for(let y=0;y<t.outDepth;++y){const v=y*s-f;let k=v;for(;k<0;)k+=o;const I=Math.min(t.inDepth,l+v);for(let _=0;_<t.outHeight;++_){const $=_*i-g;let R=$;for(;R<0;)R+=a;const A=Math.min(t.inHeight,u+$);for(let F=0;F<t.outWidth;++F){const L=F*r-m;let V=L;for(;V<0;)V+=c;const j=Math.min(t.inWidth,h+L);let Z=Number.NEGATIVE_INFINITY,et=-1;for(let K=k;K<I;K+=o){const tt=K-v;for(let it=R;it<A;it+=a){const st=it-$;for(let ot=V;ot<j;ot+=c){const bt=ot-L,ft=n.get(x,K,it,ot,b);ft>=Z&&(Z=ft,et=tt*u*h+st*u+bt)}}}e.set(et,x,y,_,F,b)}}}return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;Pt(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:c}=s,l=1;P(is(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Li(i.shape,r,o,l,a,c);let h;if(u.filterWidth===1&&u.filterHeight===1&&De(u.inShape,u.outShape))h=Br({inputs:{x:i},backend:e});else{const f=e.data.get(i.dataId).values,g=Wt(i.shape),m=YI(f,i.shape,i.dtype,g,u,"avg");h=e.makeTensorInfo(u.outShape,i.dtype,m.values)}return h}const vat={kernelName:yb,backendName:"cpu",kernelFunc:wat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{filterSize:r,strides:o,pad:a,dimRoundingMode:c,dataFormat:l}=s;Pt(i,"avgPool3d");const u=Po(i.shape,r,o,1,a,c,l),h=e.data.get(i.dataId).values,f=rM(h,i.shape,i.dtype,Wt(i.shape),u,"avg");return e.makeTensorInfo(f.shape,"float32",f.values)}const Iat={kernelName:wb,backendName:"cpu",kernelFunc:Cat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kat(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r}=t,{filterSize:o,strides:a,pad:c,dimRoundingMode:l}=s;Pt([i,r],"avgPool3DGrad");const u=Po(r.shape,o,a,1,c,l),h=u.strideDepth,f=u.strideHeight,g=u.strideWidth,m=u.filterDepth,x=u.filterHeight,b=u.filterWidth,y=u.dilationDepth,v=u.dilationHeight,k=u.dilationWidth,I=u.effectiveFilterDepth,_=u.effectiveFilterHeight,$=u.effectiveFilterWidth,R=I-1-u.padInfo.front,A=$-1-u.padInfo.left,F=_-1-u.padInfo.top,L=ce(r.shape,"float32"),V=1/(m*x*b),j=e.bufferSync(i);for(let Z=0;Z<u.batchSize;++Z)for(let et=0;et<u.inChannels;++et)for(let K=0;K<u.inDepth;++K)for(let tt=0;tt<u.inHeight;++tt)for(let it=0;it<u.inWidth;++it){const st=K-R,ot=tt-F,bt=it-A;let ft=0;for(let yt=0;yt<I;yt+=y){const vt=(st+yt)/h;if(!(vt<0||vt>=u.outDepth||Math.floor(vt)!==vt))for(let St=0;St<_;St+=v){const pt=(ot+St)/f;if(!(pt<0||pt>=u.outHeight||Math.floor(pt)!==pt))for(let Ct=0;Ct<$;Ct+=k){const Mt=(bt+Ct)/g;if(Mt<0||Mt>=u.outWidth||Math.floor(Mt)!==Mt)continue;const Bt=j.get(Z,vt,pt,Mt,et);ft+=Bt}}}L.set(ft*V,Z,K,tt,it,et)}return e.makeTensorInfo(L.shape,L.dtype,L.values)}const Sat={kernelName:$1,backendName:"cpu",kernelFunc:kat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _at(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r}=t,o=r;Pt([i,r],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,u=Li(o.shape,a,c,1,l),h=u.strideHeight,f=u.strideWidth,g=u.filterHeight,m=u.filterWidth,x=u.dilationHeight,b=u.dilationWidth,y=u.effectiveFilterHeight,v=u.effectiveFilterWidth,k=v-1-u.padInfo.left,I=y-1-u.padInfo.top,_=ce(o.shape,"float32"),$=1/(g*m),R=e.data.get(i.dataId).values,A=ce(i.shape,"float32",R);for(let F=0;F<u.batchSize;++F)for(let L=0;L<u.inChannels;++L)for(let V=0;V<u.inHeight;++V)for(let j=0;j<u.inWidth;++j){const Z=V-I,et=j-k;let K=0;for(let tt=0;tt<y;tt+=x){const it=(Z+tt)/h;if(!(it<0||it>=u.outHeight||Math.floor(it)!==it))for(let st=0;st<v;st+=b){const ot=(et+st)/f;if(ot<0||ot>=u.outWidth||Math.floor(ot)!==ot)continue;const bt=A.get(F,it,ot,L);K+=bt}}_.set(K*$,F,V,j,L)}return e.makeTensorInfo(_.shape,_.dtype,_.values)}const Tat={kernelName:E1,backendName:"cpu",kernelFunc:_at};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,scale:r,offset:o,mean:a,variance:c}=t;P(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),P(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),P(r==null||a.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Pt([i,a,c,r,o],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const u=e.data.get(i.dataId).values,h=e.data.get(a.dataId).values,f=e.data.get(c.dataId).values,g=r?e.data.get(r.dataId).values:new Float32Array([1]),m=o?e.data.get(o.dataId).values:new Float32Array([0]),x=new Float32Array(u.length),b=m.length,y=g.length,v=f.length,k=h.length;let I=0,_=0,$=0,R=0;for(let A=0;A<u.length;++A)x[A]=m[I++]+(u[A]-h[_++])*g[$++]/Math.sqrt(f[R++]+l),I>=b&&(I=0),_>=k&&(_=0),$>=y&&($=0),R>=v&&(R=0);return e.makeTensorInfo(i.shape,i.dtype,x)}const $at={kernelName:Db,backendName:"cpu",kernelFunc:Eat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockShape:r,crops:o}=s;Pt([i],"batchToSpaceND");const a=r.reduce((y,v)=>y*v),c=kf(i.shape,r,a),l=Sf(c.length,r.length),u=_f(i.shape,r,a),h=oI(o,r.length),f=aI(u,o,r.length),g=Ke({inputs:{x:i},backend:e,attrs:{shape:c}}),m=Os({inputs:{x:g},backend:e,attrs:{perm:l}}),x=Ke({inputs:{x:m},backend:e,attrs:{shape:u}}),b=Lc({inputs:{x},backend:e,attrs:{begin:h,size:f}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),b}const Rat={kernelName:Cb,backendName:"cpu",kernelFunc:Nat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,weights:r}=t,{size:o}=s,a=e.data.get(i.dataId).values,c=e.data.get(r.dataId).values,l=GI(a,c,r.dtype,r.shape,o);return e.makeTensorInfo([o],r.dtype,l)}const Dat={kernelName:N1,backendName:"cpu",kernelFunc:Aat};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oat(n){const{inputs:t,backend:e}=n,{s0:s,s1:i}=t,r=e.data.get(s.dataId).values,o=e.data.get(i.dataId).values,a=ee(Array.from(r),Array.from(o));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Pat={kernelName:TR,backendName:"cpu",kernelFunc:Oat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fat=Le(Ad,(n,t)=>{const e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),Mat={kernelName:Ad,backendName:"cpu",kernelFunc:Fat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lat=n=>{const{x:t}=n.inputs,e=n.backend,s=new Float32Array(ut(t.shape)),i=e.data.get(t.dataId),r=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=e.data.get(r.dataId).values,c=e.data.get(o.dataId).values;for(let l=0;l<a.length;l++){const u=a[l],h=c[l];s[l]=Math.hypot(u,h)}return e.makeOutput(s,t.shape,"float32")},Bat={kernelName:Ib,backendName:"cpu",kernelFunc:Lat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zl(n){const{inputs:t,backend:e}=n,{input:s}=t,i=e.data.get(s.dataId).complexTensorInfos.imag,r=e.data.get(i.dataId).values;return e.makeTensorInfo(i.shape,i.dtype,r)}const zat={kernelName:K1,backendName:"cpu",kernelFunc:Zl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(n){const{inputs:t,backend:e,attrs:s}=n,{axis:i}=s,r=le(i,t[0].shape)[0],o=t.map(x=>x.shape);sI(o,r);let a=Ar(t.map(x=>x.shape),r);if(ut(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);const c=t.filter(x=>ut(x.shape)>0);if(c.length===1)return Br({inputs:{x:c[0]},backend:e});if(c[0].dtype==="complex64"){const x=c.map(I=>Mc({inputs:{input:I},backend:e})),b=c.map(I=>Zl({inputs:{input:I},backend:e})),y=Ql({inputs:x,backend:e,attrs:{axis:r}}),v=Ql({inputs:b,backend:e,attrs:{axis:r}}),k=Hs({inputs:{real:y,imag:v},backend:e});return x.forEach(I=>e.disposeIntermediateTensorInfo(I)),b.forEach(I=>e.disposeIntermediateTensorInfo(I)),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),k}const l=c.map(x=>{const y=[-1,ut(x.shape.slice(r))];return Ke({inputs:{x},backend:e,attrs:{shape:y}})}),u=l.map(x=>({vals:e.data.get(x.dataId).values,shape:x.shape}));a=Ar(l.map(x=>x.shape),1);const h=l[0].shape[0]===1,f=uF(u,a,t[0].dtype,h),g=Ar(c.map(x=>x.shape),r),m=e.makeTensorInfo(g,t[0].dtype,f);return l.forEach(x=>e.disposeIntermediateTensorInfo(x)),m}const Wat={kernelName:kb,backendName:"cpu",kernelFunc:Ql};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oM(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=s;Pt([i,r],"conv2d");const h=Fo(c),f=Xn(i.shape,r.shape,o,l,a,u,!1,h),g=f.filterHeight,m=f.filterWidth,x=f.dilationHeight,b=f.dilationWidth,y=f.padInfo.left,v=f.padInfo.top,k=f.dataFormat==="channelsLast",I=new jn(f.outShape,i.dtype),_=Wt(i.shape),$=Wt(r.shape),R=_[0],A=k?_[1]:_[2],F=k?_[2]:1,L=k?1:_[1],V=I.strides[0],j=k?I.strides[1]:I.strides[2],Z=k?I.strides[2]:1,et=k?1:I.strides[1],K=e.data.get(i.dataId).values,tt=e.data.get(r.dataId).values,it=I.values;for(let st=0;st<f.batchSize;++st){const ot=st*R,bt=st*V;for(let ft=0;ft<f.outHeight;++ft){const yt=bt+ft*j,vt=ft*f.strideHeight-v;for(let St=0;St<g;++St){const pt=vt+St*x;if(pt<0||pt>=f.inHeight)continue;const Ct=St*$[0],Mt=ot+pt*A;for(let Bt=0;Bt<f.outWidth;++Bt){const At=yt+Bt*Z,Jt=Bt*f.strideWidth-y;for(let Yt=0;Yt<m;++Yt){const re=Jt+Yt*b;if(re<0||re>=f.inWidth)continue;const Ee=Ct+Yt*$[1],pe=Mt+re*F;let be=Ee;for(let _e=0;_e<f.inChannels;++_e){const xe=K[pe+_e*L];for(let Oe=0;Oe<f.outChannels;++Oe)it[At+Oe*et]+=xe*tt[be+Oe];be+=f.outChannels}}}}}}return e.makeTensorInfo(I.shape,I.dtype,it)}const Vat={kernelName:Sb,backendName:"cpu",kernelFunc:oM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:r}=t,{strides:o,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=s;Pt([i,r],"conv2dBackpropFilter");const h=Fo(c),f=Xn(i.shape,u,o,1,a,l,!1,h),{strideHeight:g,strideWidth:m,filterHeight:x,filterWidth:b}=f,y=f.dataFormat==="channelsLast",v=new jn(f.filterShape,"float32"),k=f.padInfo.left,I=f.padInfo.top,_=e.data.get(i.dataId).values,$=e.data.get(r.dataId).values,R=new jn(i.shape,i.dtype,_),A=new jn(r.shape,r.dtype,$);for(let F=0;F<x;++F){const L=Math.max(0,Math.ceil((I-F)/g)),V=Math.min(f.outHeight,(f.inHeight+I-F)/g);for(let j=0;j<b;++j){const Z=Math.max(0,Math.ceil((k-j)/m)),et=Math.min(f.outWidth,(f.inWidth+k-j)/m);for(let K=0;K<f.inChannels;++K)for(let tt=0;tt<f.outChannels;++tt){let it=0;for(let st=0;st<f.batchSize;++st)for(let ot=L;ot<V;++ot){const bt=F+ot*g-I;for(let ft=Z;ft<et;++ft){const yt=j+ft*m-k;y?it+=R.get(st,bt,yt,K)*A.get(st,ot,ft,tt):it+=R.get(st,K,bt,yt)*A.get(st,tt,ot,ft)}}v.set(it,F,j,K,tt)}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}const Hat={kernelName:D1,backendName:"cpu",kernelFunc:Uat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gat(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:r}=t,{inputShape:o,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=s;Pt([i,r],"conv2dBackpropInput");const h=Wt(r.shape),f=Wt(i.shape);let g=Fo(l);const m=Xn(o,r.shape,a,1,c,u,!1,g),x=new jn(m.inShape,"float32"),b=x.values,y=e.data.get(i.dataId).values,v=e.data.get(r.dataId).values,[k,I,_]=h,{batchSize:$,filterHeight:R,filterWidth:A,inChannels:F,inHeight:L,inWidth:V,outChannels:j,outHeight:Z,outWidth:et,strideHeight:K,strideWidth:tt}=m;g=m.dataFormat;const it=R-1-m.padInfo.top,st=A-1-m.padInfo.left,ot=g==="channelsLast",bt=x.strides[0],ft=ot?x.strides[1]:x.strides[2],yt=ot?x.strides[2]:1,vt=ot?1:x.strides[1],St=f[0],pt=ot?f[1]:f[2],Ct=ot?f[2]:1,Mt=ot?1:f[1];for(let Bt=0;Bt<$;++Bt)for(let At=0;At<F;++At)for(let Jt=0;Jt<L;++Jt){const Yt=Jt-it,re=Math.max(0,Math.ceil(Yt/K)),Ee=Math.min(Z,(R+Yt)/K);for(let pe=0;pe<V;++pe){const be=pe-st,_e=Math.max(0,Math.ceil(be/tt)),xe=Math.min(et,(A+be)/tt);let Oe=0;for(let Xe=re;Xe<Ee;++Xe){const dn=Xe*K-Yt;for(let vn=_e;vn<xe;++vn){const Zn=vn*tt-be,Is=St*Bt+pt*Xe+Ct*vn,he=k*(R-1-dn)+I*(A-1-Zn)+_*At;for(let fi=0;fi<j;++fi){const as=y[Is+Mt*fi],Qn=v[he+fi];Oe+=as*Qn}}}const ti=bt*Bt+ft*Jt+yt*pe+vt*At;b[ti]=Oe}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}const jat={kernelName:_b,backendName:"cpu",kernelFunc:Gat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dilations:c}=s;Pt([i,r],"conv3d");const l=_a(i.shape,r.shape,o,c,a),{filterDepth:u,filterHeight:h,filterWidth:f,dilationDepth:g,dilationHeight:m,dilationWidth:x,padInfo:b}=l,y=b.front,v=b.left,k=b.top,I=new jn(l.outShape,i.dtype),_=e.data.get(i.dataId).values,$=e.data.get(r.dataId).values,R=I.values,A=Wt(i.shape),F=Wt(r.shape);for(let L=0;L<l.batchSize;++L){const V=L*A[0],j=L*I.strides[0];for(let Z=0;Z<l.outDepth;++Z){const et=j+Z*I.strides[1],K=Z*l.strideDepth-y;for(let tt=0;tt<u;++tt){const it=K+tt*g;if(it<0||it>=l.inDepth)continue;const st=tt*F[0],ot=V+it*A[1];for(let bt=0;bt<l.outHeight;++bt){const ft=et+bt*I.strides[2],yt=bt*l.strideHeight-k;for(let vt=0;vt<h;++vt){const St=yt+vt*m;if(St<0||St>=l.inHeight)continue;const pt=st+vt*F[1],Ct=ot+St*A[2];for(let Mt=0;Mt<l.outWidth;++Mt){const Bt=ft+Mt*l.outChannels,At=Mt*l.strideWidth-v;for(let Jt=0;Jt<f;++Jt){const Yt=At+Jt*x;if(Yt<0||Yt>=l.inWidth)continue;const re=pt+Jt*F[2],Ee=Ct+Yt*l.inChannels;let pe=re;for(let be=0;be<l.inChannels;++be){const _e=_[Ee+be];for(let xe=0;xe<l.outChannels;++xe)R[Bt+xe]+=_e*$[pe+xe];pe+=l.outChannels}}}}}}}}return e.makeTensorInfo(I.shape,I.dtype,I.values)}const Kat={kernelName:Tb,backendName:"cpu",kernelFunc:qat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xat(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:r}=t,{strides:o,pad:a,filterShape:c}=s;Pt([i,r],"conv3dBackpropFilterV2");const l=Wt(i.shape),u=Wt(r.shape),h=_a(i.shape,c,o,1,a),f=h.strideDepth,g=h.strideHeight,m=h.strideWidth,x=h.filterDepth,b=h.filterHeight,y=h.filterWidth,v=new jn(h.filterShape,"float32"),k=v.values,[I,_,$,R]=v.strides,A=e.data.get(r.dataId).values,[F,L,V,j]=u,Z=e.data.get(i.dataId).values,[et,K,tt,it]=l,st=h.padInfo.front,ot=h.padInfo.left,bt=h.padInfo.top;for(let ft=0;ft<x;++ft){const yt=Math.max(0,Math.ceil((st-ft)/f)),vt=Math.min(h.outDepth,(h.inDepth+st-ft)/f),St=ft*I;for(let pt=0;pt<b;++pt){const Ct=Math.max(0,Math.ceil((bt-pt)/g)),Mt=Math.min(h.outHeight,(h.inHeight+bt-pt)/g),Bt=pt*_+St;for(let At=0;At<y;++At){const Jt=Math.max(0,Math.ceil((ot-At)/m)),Yt=Math.min(h.outWidth,(h.inWidth+ot-At)/m),re=At*$+Bt;for(let Ee=0;Ee<h.inChannels;++Ee){const pe=Ee*R+re;for(let be=0;be<h.outChannels;++be){let _e=0;for(let xe=0;xe<h.batchSize;++xe){const Oe=xe*et,ti=xe*F;for(let Xe=yt;Xe<vt;++Xe){const vn=(ft+Xe*f-st)*K+Oe,Zn=Xe*L+ti;for(let Is=Ct;Is<Mt;++Is){const fi=(pt+Is*g-bt)*tt+vn,as=Is*V+Zn;for(let Qn=Jt;Qn<Yt;++Qn){const Vr=(At+Qn*m-ot)*it+fi,Ur=Qn*j+as;_e+=Z[Vr+Ee]*A[Ur+be]}}}}k[pe+be]=_e}}}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}const Yat={kernelName:O1,backendName:"cpu",kernelFunc:Xat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jat(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:r}=t,{pad:o,strides:a,inputShape:c}=s;Pt([i],"conv3dBackpropInputV2");const l=Wt(i.shape),u=Wt(r.shape),h=_a(c,r.shape,a,1,o),f=new jn(h.inShape,"float32"),g=f.values,[m,x,b,y]=f.strides,v=e.data.get(i.dataId).values,[k,I,_,$]=l,R=e.data.get(r.dataId).values,[A,F,L,V]=u,{batchSize:j,filterDepth:Z,filterHeight:et,filterWidth:K,inChannels:tt,inDepth:it,inHeight:st,inWidth:ot,outChannels:bt,outDepth:ft,outHeight:yt,outWidth:vt,strideDepth:St,strideHeight:pt,strideWidth:Ct}=h,Mt=Z-1-h.padInfo.front,Bt=et-1-h.padInfo.top,At=K-1-h.padInfo.left;for(let Jt=0;Jt<j;++Jt)for(let Yt=0;Yt<tt;++Yt)for(let re=0;re<it;++re){const Ee=re-Mt,pe=Math.max(0,Math.ceil(Ee/St)),be=Math.min(ft,(Z+Ee)/St);for(let _e=0;_e<st;++_e){const xe=_e-Bt,Oe=Math.max(0,Math.ceil(xe/pt)),ti=Math.min(yt,(et+xe)/pt);for(let Xe=0;Xe<ot;++Xe){const dn=Xe-At,vn=Math.max(0,Math.ceil(dn/Ct)),Zn=Math.min(vt,(K+dn)/Ct);let Is=0;for(let he=pe;he<be;++he){const fi=he*St-Ee;for(let as=Oe;as<ti;++as){const Qn=as*pt-xe;for(let Wi=vn;Wi<Zn;++Wi){const Vr=Wi*Ct-dn,Ur=k*Jt+I*he+_*as+$*Wi,Oa=A*(Z-1-fi)+F*(et-1-Qn)+L*(K-1-Vr)+V*Yt;for(let pi=0;pi<bt;++pi){const Hr=v[Ur+pi],Pa=R[Oa+pi];Is+=Hr*Pa}}}}g[m*Jt+x*re+b*_e+y*Xe+Yt]=Is}}}return e.makeTensorInfo(f.shape,f.dtype,f.values)}const Zat={kernelName:P1,backendName:"cpu",kernelFunc:Jat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qat=Le(Dd,n=>Math.cos(n)),tct={kernelName:Dd,backendName:"cpu",kernelFunc:Qat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ect=Le(Od,n=>Math.cosh(n)),nct={kernelName:Od,backendName:"cpu",kernelFunc:ect};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sct(n){const{inputs:t,backend:e,attrs:s}=n,{image:i,boxes:r,boxInd:o}=t,{cropSize:a,method:c,extrapolationValue:l}=s,[u,h,f,g]=i.shape,m=r.shape[0],[x,b]=a,y=ce([m,x,b,g],"float32"),v=e.data.get(r.dataId).values,k=e.data.get(o.dataId).values,I=e.data.get(i.dataId).values,_=Wt(i.shape),$=Wt(y.shape);for(let R=0;R<m;R++){const A=R*4,F=v[A],L=v[A+1],V=v[A+2],j=v[A+3],Z=k[R];if(Z>=u)continue;const et=x>1?(V-F)*(h-1)/(x-1):0,K=b>1?(j-L)*(f-1)/(b-1):0;for(let tt=0;tt<x;tt++){const it=x>1?F*(h-1)+tt*et:.5*(F+V)*(h-1);if(it<0||it>h-1){for(let st=0;st<b;st++)for(let ot=0;ot<g;ot++){const bt=ot+st*$[2]+tt*$[1]+R*$[0];y.values[bt]=l}continue}if(c==="bilinear"){const st=Math.floor(it),ot=Math.ceil(it),bt=it-st;for(let ft=0;ft<b;ft++){const yt=b>1?L*(f-1)+ft*K:.5*(L+j)*(f-1);if(yt<0||yt>f-1){for(let Ct=0;Ct<g;Ct++){const Mt=Ct+ft*$[2]+tt*$[1]+R*$[0];y.values[Mt]=l}continue}const vt=Math.floor(yt),St=Math.ceil(yt),pt=yt-vt;for(let Ct=0;Ct<g;Ct++){let Mt=Ct+vt*_[2]+st*_[1]+Z*_[0];const Bt=I[Mt];Mt=Ct+St*_[2]+st*_[1]+Z*_[0];const At=I[Mt];Mt=Ct+vt*_[2]+ot*_[1]+Z*_[0];const Jt=I[Mt];Mt=Ct+St*_[2]+ot*_[1]+Z*_[0];const Yt=I[Mt],re=Bt+(At-Bt)*pt,Ee=Jt+(Yt-Jt)*pt;Mt=Ct+ft*$[2]+tt*$[1]+R*$[0],y.values[Mt]=re+(Ee-re)*bt}}}else for(let st=0;st<b;++st){const ot=b>1?L*(f-1)+st*K:.5*(L+j)*(f-1);if(ot<0||ot>f-1){for(let yt=0;yt<g;yt++){const vt=yt+st*$[2]+tt*$[1]+R*$[0];y.values[vt]=l}continue}const bt=Math.round(ot),ft=Math.round(it);for(let yt=0;yt<g;yt++){const vt=yt+bt*_[2]+ft*_[1]+Z*_[0],St=yt+st*$[2]+tt*$[1]+R*$[0];y.values[St]=I[vt]}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}const ict={kernelName:M1,backendName:"cpu",kernelFunc:sct};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rct(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,exclusive:o,reverse:a}=s;Pt(i,"cumprod");const c=un([r],i.shape.length);let l=i;c!=null&&(l=Os({inputs:{x:i},backend:e,attrs:{perm:c}}));const u=xn(1,i.shape.length)[0];if(u!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${u}`);const h=Ks(l.dtype,"int32"),f=C1(ut(l.shape),h),g=e.data.get(l.dataId).values,m=l.shape[l.shape.length-1],x=a?(y,v)=>y+m-v-1:(y,v)=>y+v;for(let y=0;y<g.length;y+=m)for(let v=0;v<m;v++){const k=x(y,v);if(v===0)f[k]=o?1:g[k];else{const I=x(y,v-1);f[k]=o?g[I]*f[I]:g[k]*f[I]}}const b=e.makeTensorInfo(l.shape,h,f);if(c!=null){const y=Ta(c),v=Os({inputs:{x:b},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(l),v}return b}const oct={kernelName:F1,backendName:"cpu",kernelFunc:rct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function act(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,exclusive:o,reverse:a}=s;Pt(i,"cumsum");const c=un([r],i.shape.length);let l=i;c!=null&&(l=Os({inputs:{x:i},backend:e,attrs:{perm:c}}));const u=xn(1,i.shape.length)[0];if(u!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${u}`);const h=Ks(l.dtype,"int32"),f=ns(ut(l.shape),h),g=e.data.get(l.dataId).values,m=l.shape[l.shape.length-1],x=a?(y,v)=>y+m-v-1:(y,v)=>y+v;for(let y=0;y<g.length;y+=m)for(let v=0;v<m;v++){const k=x(y,v);if(v===0)f[k]=o?0:g[k];else{const I=x(y,v-1);f[k]=o?g[I]+f[I]:g[k]+f[I]}}const b=e.makeTensorInfo(l.shape,h,f);if(c!=null){const y=Ta(c),v=Os({inputs:{x:b},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(l),v}return b}const cct={kernelName:Eb,backendName:"cpu",kernelFunc:act};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lct(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,weights:r}=t,{size:o,binaryOutput:a}=s;if(i.shape.length===1){const c=e.data.get(i.dataId).values,l=e.data.get(r.dataId).values,u=GI(c,l,r.dtype,r.shape,o);return e.makeTensorInfo([o],r.dtype,u)}else if(i.shape.length===2){const c=e.bufferSync(i),l=e.bufferSync(r),u=aF(c,l,o,a);return e.makeTensorInfo(u.shape,r.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const uct={kernelName:L1,backendName:"cpu",kernelFunc:lct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hct(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockSize:r,dataFormat:o}=s;P(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],c=i.shape[1],l=i.shape[2],u=i.shape[3],h=c*r,f=l*r,g=u/(r*r),m=e.data.get(i.dataId).values,x=new Float32Array(a*h*f*g);let b=0;for(let y=0;y<a;++y)for(let v=0;v<h;++v){const k=Math.floor(v/r),I=v%r;for(let _=0;_<f;++_){const $=Math.floor(_/r),R=_%r,A=(I*r+R)*g;for(let F=0;F<g;++F){const V=F+A+u*($+l*(k+c*y));x[b++]=m[V]}}}return e.makeTensorInfo([a,h,f,g],i.dtype,x)}const dct={kernelName:B1,backendName:"cpu",kernelFunc:hct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dilations:c,dimRoundingMode:l}=s;Pt([i,r],"depthwiseConv2DNative");const u=Wt(i.shape),h=Wt(r.shape);let f=c;f==null&&(f=[1,1]),P(is(o,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`);const g=Xn(i.shape,r.shape,o,f,a,l,!0),{filterHeight:m,filterWidth:x,dilationHeight:b,dilationWidth:y,padInfo:v}=g,k=v.left,I=v.top,_=g.outChannels/g.inChannels,$=new jn(g.outShape,i.dtype),R=e.data.get(i.dataId).values,A=e.data.get(r.dataId).values,F=$.values;for(let L=0;L<g.batchSize;++L){const V=L*u[0],j=L*$.strides[0];for(let Z=0;Z<g.outHeight;++Z){const et=j+Z*$.strides[1],K=Z*g.strideHeight-I;for(let tt=0;tt<m;++tt){const it=K+tt*b;if(it<0||it>=g.inHeight)continue;const st=tt*h[0],ot=V+it*u[1];for(let bt=0;bt<g.outWidth;++bt){const ft=et+bt*$.strides[2],yt=bt*g.strideWidth-k;for(let vt=0;vt<x;++vt){const St=yt+vt*y;if(St<0||St>=g.inWidth)continue;const pt=st+vt*h[1],Ct=ot+St*g.inChannels;let Mt=ft,Bt=pt;for(let At=0;At<g.inChannels;++At){const Jt=R[Ct+At];for(let Yt=0;Yt<_;++Yt)F[Mt+Yt]+=Jt*A[Bt+Yt];Mt+=_,Bt+=_}}}}}}return e.makeTensorInfo($.shape,$.dtype,$.values)}const fct={kernelName:$b,backendName:"cpu",kernelFunc:aM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pct(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:r}=t,{strides:o,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=s;Pt([i,r],"depthwiseConv2dNativeBackpropFilter");const h=Xn(i.shape,u,o,a,c,l,!0),{strideHeight:f,strideWidth:g,filterHeight:m,filterWidth:x}=h,b=new jn(h.filterShape,"float32"),y=h.padInfo.left,v=h.padInfo.top,k=h.outChannels/h.inChannels,I=e.data.get(i.dataId).values,_=new jn(i.shape,i.dtype,I),$=e.data.get(r.dataId).values,R=new jn(r.shape,r.dtype,$);for(let A=0;A<m;++A){const F=Math.max(0,Math.ceil((v-A)/f)),L=Math.min(h.outHeight,(h.inHeight+v-A)/f);for(let V=0;V<x;++V){const j=Math.max(0,Math.ceil((y-V)/g)),Z=Math.min(h.outWidth,(h.inWidth+y-V)/g);for(let et=0;et<h.outChannels;++et){const K=Math.trunc(et/k),tt=et%k;let it=0;for(let st=0;st<h.batchSize;++st)for(let ot=F;ot<L;++ot){const bt=A+ot*f-v;for(let ft=j;ft<Z;++ft){const yt=V+ft*g-y;it+=_.get(st,bt,yt,K)*R.get(st,ot,ft,et)}}b.set(it,A,V,K,tt)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const gct={kernelName:z1,backendName:"cpu",kernelFunc:pct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mct(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:r}=t,{strides:o,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=s;Pt([i,r],"depthwiseConv2DNativeBackpropInput");const h=Wt(i.shape),f=Wt(r.shape),g=Xn(u,r.shape,o,a,c,l,!0),m=new jn(g.inShape,"float32"),x=m.values,[b,y,v]=m.strides,k=e.data.get(i.dataId).values,[I,_,$]=h,R=e.data.get(r.dataId).values,[A,F,L]=f,{batchSize:V,filterHeight:j,filterWidth:Z,inChannels:et,inHeight:K,inWidth:tt,outChannels:it,outHeight:st,outWidth:ot,strideHeight:bt,strideWidth:ft}=g,yt=j-1-g.padInfo.top,vt=Z-1-g.padInfo.left,St=it/et;for(let pt=0;pt<V;++pt)for(let Ct=0;Ct<et;++Ct)for(let Mt=0;Mt<K;++Mt){const Bt=Mt-yt,At=Math.max(0,Math.ceil(Bt/bt)),Jt=Math.min(st,(j+Bt)/bt);for(let Yt=0;Yt<tt;++Yt){const re=Yt-vt,Ee=Math.max(0,Math.ceil(re/ft)),pe=Math.min(ot,(Z+re)/ft);let be=0;for(let _e=At;_e<Jt;++_e){const xe=_e*bt-Bt;for(let Oe=Ee;Oe<pe;++Oe){const ti=Oe*ft-re,Xe=I*pt+_*_e+$*Oe,dn=A*(j-1-xe)+F*(Z-1-ti)+L*Ct;for(let vn=0;vn<St;++vn){const Zn=Ct*St+vn,Is=k[Xe+Zn],he=R[dn+vn];be+=Is*he}}}x[b*pt+y*Mt+v*Yt+Ct]=be}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}const bct={kernelName:W1,backendName:"cpu",kernelFunc:mct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xct(n){const{inputs:t,backend:e}=n,{x:s}=t,i=ut(s.shape),r=e.data.get(s.dataId).values,o=ce([i,i],s.dtype),a=o.values;for(let l=0;l<r.length;l++)a[l*i+l]=r[l];const c=[...s.shape,...s.shape];return e.makeTensorInfo(c,o.dtype,o.values)}const yct={kernelName:ER,backendName:"cpu",kernelFunc:xct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wct={kernelName:Nb,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:i}=n,{strides:r,pad:o,dilations:a}=e,c=t,l=c.data.get(s.dataId).values,u=s.shape.length,h=c.data.get(i.dataId).values,f=i.shape.length,{batchSize:g,inHeight:m,inWidth:x,inChannels:b,outHeight:y,outWidth:v,padInfo:k,strideHeight:I,strideWidth:_,filterHeight:$,filterWidth:R,dilationHeight:A,dilationWidth:F,outShape:L}=yf(s.shape,i.shape,r,o,"NHWC",a),V=ut(L),j=L.length,Z=gn(s.dtype,V);for(let K=0;K<g;++K)for(let tt=0;tt<y;++tt){const it=tt*I-k.top;for(let st=0;st<v;++st){const ot=st*_-k.left;for(let bt=0;bt<b;++bt){let ft=Number.MIN_SAFE_INTEGER;for(let vt=0;vt<$;++vt){const St=it+vt*A;if(St>=0&&St<m)for(let pt=0;pt<R;++pt){const Ct=ot+pt*F;if(Ct>=0&&Ct<x){const Mt=Nr([K,St,Ct,bt],u,Wt(s.shape)),Bt=Nr([vt,pt,bt],f,Wt(i.shape)),At=l[Mt]+h[Bt];At>ft&&(ft=At)}}}const yt=Nr([K,tt,st,bt],j,Wt(L));Z[yt]=ft}}}return{dataId:c.write(Vc(Z,s.dtype),L,s.dtype),shape:L,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vct={kernelName:ev,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:i,dy:r}=n,{strides:o,pad:a,dilations:c}=e,l=t,u=sr(s.shape,l.data.get(s.dataId).values),h=sr(i.shape,l.data.get(i.dataId).values),{batchSize:f,inHeight:g,inWidth:m,inChannels:x,outHeight:b,outWidth:y,padInfo:v,strideHeight:k,strideWidth:I,filterHeight:_,filterWidth:$,dilationHeight:R,dilationWidth:A,outShape:F}=yf(s.shape,i.shape,o,a,"NHWC",c);P(r.rank===F.length,()=>`Error in ${ev}, dy must have the same rank as output ${F.length}, but got ${r.rank}`);const L=sr(F,l.data.get(r.dataId).values),V=kR(i.shape,i.dtype);for(let Z=0;Z<f;++Z)for(let et=0;et<b;++et){const K=et*k-v.top;for(let tt=0;tt<y;++tt){const it=tt*I-v.left;for(let st=0;st<x;++st){let ot=Number.MIN_SAFE_INTEGER,bt=0,ft=0;for(let yt=0;yt<_;++yt){const vt=K+yt*R;if(vt>=0&&vt<g)for(let St=0;St<$;++St){const pt=it+St*A;if(pt>=0&&pt<m){const Ct=u[Z][vt][pt][st]+h[yt][St][st];Ct>ot&&(ot=Ct,bt=yt,ft=St)}}}V[bt][ft][st]+=L[Z][et][tt][st]}}}return{dataId:l.write(Vc(V,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cct={kernelName:tv,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:i,dy:r}=n,{strides:o,pad:a,dilations:c}=e,l=t,u=sr(s.shape,l.data.get(s.dataId).values),h=sr(i.shape,l.data.get(i.dataId).values),{batchSize:f,inHeight:g,inWidth:m,inChannels:x,outHeight:b,outWidth:y,padInfo:v,strideHeight:k,strideWidth:I,filterHeight:_,filterWidth:$,dilationHeight:R,dilationWidth:A,outShape:F}=yf(s.shape,i.shape,o,a,"NHWC",c);P(r.rank===F.length,()=>`Error in ${tv}, dy must have the same rank as output ${F.length}, but got ${r.rank}`);const L=sr(F,l.data.get(r.dataId).values),V=kR(s.shape,s.dtype);for(let Z=0;Z<f;++Z)for(let et=0;et<b;++et){const K=et*k-v.top;for(let tt=0;tt<y;++tt){const it=tt*I-v.left;for(let st=0;st<x;++st){let ot=Number.MIN_SAFE_INTEGER,bt=K<0?0:K,ft=it<0?0:it;for(let yt=0;yt<_;++yt){const vt=K+yt*R;if(vt>=0&&vt<g)for(let St=0;St<$;++St){const pt=it+St*A;if(pt>=0&&pt<m){const Ct=u[Z][vt][pt][st]+h[yt][St][st];Ct>ot&&(ot=Ct,bt=vt,ft=pt)}}}V[Z][bt][ft][st]+=L[Z][et][tt][st]}}}return{dataId:l.write(Vc(V,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ict(n){const{inputs:t,backend:e,attrs:s}=n,{image:i}=t,{canvas:r,options:o}=s,{contextOptions:a,imageOptions:c}=o||{},l=(c==null?void 0:c.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=r.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${u} type.`);const[f,g]=i.shape.slice(0,2),m=i.shape.length===2?1:i.shape[2],x=e.data.get(i.dataId).values,b=i.dtype==="float32"?255:1,y=new Uint8ClampedArray(g*f*4);for(let k=0;k<f*g;++k){const I=[0,0,0,255*l];for(let $=0;$<m;$++){const R=x[k*m+$];if(i.dtype==="float32"){if(R<0||R>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${R}.`)}else if(i.dtype==="int32"&&(R<0||R>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${R}.`);m===1?(I[0]=R*b,I[1]=R*b,I[2]=R*b):I[$]=R*b}const _=k*4;y[_+0]=Math.round(I[0]),y[_+1]=Math.round(I[1]),y[_+2]=Math.round(I[2]),y[_+3]=Math.round(I[3])}r.width=g,r.height=f;const v=new ImageData(y,g,f);return h.putImageData(v,0,0),i}const kct={kernelName:sY,backendName:"cpu",kernelFunc:Ict};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pf(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s;Pt(i,"sum");let a;i.dtype==="bool"?a=va({inputs:{x:i},backend:e,attrs:{dtype:"int32"}}):a=Br({inputs:{x:i},backend:e});const c=a.shape.length,l=le(r,a.shape),u=un(l,c);let h=l,f=a;u!=null&&(f=Os({inputs:{x:a},backend:e,attrs:{perm:u}}),h=xn(h.length,c)),Yn("sum",h,f.shape.length);const[g,m]=Vn(f.shape,h),x=Ks(f.dtype,"int32");let b=Hm(e,g,x);const y=ut(m),v=e.data.get(b.dataId).values,k=e.data.get(f.dataId).values;for(let I=0;I<v.length;++I){const _=I*y;let $=0;for(let R=0;R<y;++R)$+=k[_+R];v[I]=$}if(o){const I=_n(b.shape,l),_=b;b=Ke({inputs:{x:b},backend:e,attrs:{shape:I}}),e.disposeIntermediateTensorInfo(_)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(f),b}const Sct={kernelName:lx,backendName:"cpu",kernelFunc:Pf};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ct(n){const{inputs:t,backend:e,attrs:s}=n,{equation:i}=s,r=t,{allDims:o,summedDims:a,idDims:c}=gI(i,r.length);bI(o.length,c,r);const{path:l,steps:u}=xI(a,c),h=u.length;let f=null,g=o.length;const m=[];for(let x=0;x<h;++x){for(const b of u[x]){const{permutationIndices:y,expandDims:v}=mI(g,c[b]);let k;yI(y)?k=r[b]:(k=Os({inputs:{x:r[b]},backend:e,attrs:{perm:y}}),m.push(k));const I=k.shape.slice();for(let _=0;_<v.length;++_)I.splice(v[_],0,1);De(k.shape,I)||(k=Ke({inputs:{x:k},backend:e,attrs:{shape:I}}),m.push(k)),f===null?f=k:(f=Wx({inputs:{a:k,b:f},backend:e}),m.push(f))}x<h-1&&(l[x]>=0&&(f=Pf({inputs:{x:f},backend:e,attrs:{axis:l[x]-(o.length-g),keepDims:!1}}),m.push(f)),g--)}for(const x of m)x!==f&&e.disposeIntermediateTensorInfo(x);return f}const Tct={kernelName:V1,backendName:"cpu",kernelFunc:_ct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ect(n){const{inputs:t,backend:e}=n,{dy:s,y:i}=t;Pt([s,i],"eluGrad");const r=new Float32Array(ut(i.shape)),o=e.data.get(i.dataId).values,a=e.data.get(s.dataId).values;for(let c=0;c<o.length;++c){const l=o[c];l>=0?r[c]=a[c]:r[c]=a[c]*(l+1)}return e.makeTensorInfo(i.shape,"float32",r)}const $ct={kernelName:U1,backendName:"cpu",kernelFunc:Ect};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nct=cI,Rct=lI,Act=uI,Dct=hI,Oct=dI,Pct=fI,Fct=Le(Md,n=>{const t=Math.sign(n),e=Math.abs(n),s=1/(1+Nct*e);return t*(1-((((Pct*s+Oct)*s+Dct)*s+Act)*s+Rct)*s*Math.exp(-e*e))}),Mct={kernelName:Md,backendName:"cpu",kernelFunc:Fct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qm(n){const{inputs:t,backend:e,attrs:s}=n,{input:i}=t,{dim:r}=s,o=i.shape.length,a=i.shape.slice();let c=r;return r<0&&(P(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+r+1),a.splice(c,0,1),Ke({inputs:{x:i},backend:e,attrs:{shape:a}})}const Lct={kernelName:Ab,backendName:"cpu",kernelFunc:qm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bct=wn((n,t)=>n/t),JI=On(Pd,Bct),$v={kernelName:Pd,backendName:"cpu",kernelFunc:JI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cM(n,t,e){const s=n.shape,i=s[0],r=s[1],o=e.data.get(n.dataId),a=o.complexTensorInfos.real,c=o.complexTensorInfos.imag,l=[i,r],u=ut(l),h=es("float32",u),f=es("float32",u);for(let b=0;b<i;b++){const y=Lc({inputs:{x:a},backend:e,attrs:{begin:[b,0],size:[1,r]}}),v=Lc({inputs:{x:c},backend:e,attrs:{begin:[b,0],size:[1,r]}}),k=Hs({inputs:{real:y,imag:v},backend:e}),{real:I,imag:_}=zct(k,t,e),$=No(I,_);for(let R=0;R<r;R++){const A=pI($,R);h[b*r+R]=A.real,f[b*r+R]=A.imag}e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(k)}const g=e.makeTensorInfo(l,"float32",h),m=e.makeTensorInfo(l,"float32",f),x=Hs({inputs:{real:g,imag:m},backend:e});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(m),x}function zct(n,t,e){const s=ut(n.shape),i=e.data.get(n.dataId),r=e.data.get(i.complexTensorInfos.real.dataId).values,o=e.data.get(i.complexTensorInfos.imag.dataId).values;if(Wct(s)){const a=Nv(r,o,s,t,e),c=[n.shape[0],n.shape[1]];if(t){const l=e.makeTensorInfo(c,"float32",a.real),u=e.makeTensorInfo(c,"float32",a.imag),h=e.makeTensorInfo([],"float32",Sa(s,"float32")),f=Br({inputs:{x:h},backend:e}),g=$v.kernelFunc({inputs:{a:l,b:h},backend:e}),m=$v.kernelFunc({inputs:{a:u,b:f},backend:e}),x=e.data.get(g.dataId).values,b=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(m),{real:x,imag:b}}return a}else{const a=No(r,o),c=Vct(a,s,t);return CD(c)}}function Wct(n){return(n&n-1)===0}function Nv(n,t,e,s,i){if(e===1)return{real:n,imag:t};const r=No(n,t),o=e/2,a=ID(r),c=a.real,l=a.imag,u=[c.length],h=i.makeTensorInfo(u,"float32",c),f=i.makeTensorInfo(u,"float32",l),g=Hs({inputs:{real:h,imag:f},backend:i}),m=kD(r),x=m.real,b=m.imag,y=[x.length],v=i.makeTensorInfo(y,"float32",x),k=i.makeTensorInfo(y,"float32",b),I=Hs({inputs:{real:v,imag:k},backend:i}),_=Nv(c,l,o,s,i),$=_.real,R=_.imag,A=[$.length],F=i.makeTensorInfo(A,"float32",$),L=i.makeTensorInfo(A,"float32",R),V=Hs({inputs:{real:F,imag:L},backend:i}),j=Nv(x,b,o,s,i),Z=j.real,et=j.imag,K=[Z.length],tt=i.makeTensorInfo(K,"float32",Z),it=i.makeTensorInfo(K,"float32",et),st=Hs({inputs:{real:tt,imag:it},backend:i}),ot=_D(e,s),bt=[ot.real.length],ft=i.makeTensorInfo(bt,"float32",ot.real),yt=i.makeTensorInfo(bt,"float32",ot.imag),vt=Hs({inputs:{real:ft,imag:yt},backend:i}),St=Wx({inputs:{a:vt,b:st},backend:i}),pt=Jl({inputs:{a:V,b:St},backend:i}),Ct=XI({inputs:{a:V,b:St},backend:i}),Mt=Mc({inputs:{input:pt},backend:i}),Bt=Mc({inputs:{input:Ct},backend:i}),At=Zl({inputs:{input:pt},backend:i}),Jt=Zl({inputs:{input:Ct},backend:i}),Yt=Ql({inputs:[Mt,Bt],backend:i,attrs:{axis:0}}),re=Ql({inputs:[At,Jt],backend:i,attrs:{axis:0}}),Ee=i.data.get(Yt.dataId).values,pe=i.data.get(re.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(g),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(tt),i.disposeIntermediateTensorInfo(it),i.disposeIntermediateTensorInfo(st),i.disposeIntermediateTensorInfo(ft),i.disposeIntermediateTensorInfo(yt),i.disposeIntermediateTensorInfo(vt),i.disposeIntermediateTensorInfo(St),i.disposeIntermediateTensorInfo(pt),i.disposeIntermediateTensorInfo(Ct),i.disposeIntermediateTensorInfo(Mt),i.disposeIntermediateTensorInfo(At),i.disposeIntermediateTensorInfo(Bt),i.disposeIntermediateTensorInfo(Jt),i.disposeIntermediateTensorInfo(Yt),i.disposeIntermediateTensorInfo(re),{real:Ee,imag:pe}}function Vct(n,t,e){const s=new Float32Array(t*2);for(let i=0;i<t;i++){let r=0,o=0;for(let a=0;a<t;a++){const c=TD(i*a,t,e),l=pI(n,a);r+=l.real*c.real-l.imag*c.imag,o+=l.real*c.imag+l.imag*c.real}e&&(r/=t,o/=t),SD(s,r,o,i)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uct(n){const{inputs:t,backend:e}=n,{input:s}=t,i=ut(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=Ke({inputs:{x:s},backend:e,attrs:{shape:[o,r]}}),c=cM(a,!1,e),l=Ke({inputs:{x:c},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),l}const Hct={kernelName:H1,backendName:"cpu",kernelFunc:Uct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZI(n){const{backend:t,attrs:e}=n,{shape:s,value:i,dtype:r}=e,o=r||ru(i),a=gn(o,ut(s));return jct(a,i,o),t.makeTensorInfo(s,o,a)}const Gct={kernelName:G1,backendName:"cpu",kernelFunc:ZI};function jct(n,t,e){n.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qct={kernelName:j1,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,i=e,r=es(s.dtype,ut(s.shape)),[o,a,c,l]=s.shape,u=i.data.get(s.dataId).values;for(let f=0;f<o;f++){const g=f*c*a*l;for(let m=0;m<a;m++){const x=m*(c*l);for(let b=0;b<c;b++){const y=b*l;for(let v=0;v<l;v++){const k=Math.round(c-b-1),I=g+x+y+v;let _=u[I];if(k>=0&&k<c){const $=k*l,R=g+x+$+v;_=u[R]}r[I]=_}}}}return{dataId:i.write(r,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kct(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r,bias:o,preluActivationWeights:a}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f,activation:g,leakyreluAlpha:m}=s;let x=oM({inputs:{x:i,filter:r},backend:e,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f}});if(o){const b=x;if(u==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=Ke({inputs:{x:o},backend:e,attrs:{shape:[o.shape[0],1,1]}});x=Jl({inputs:{a:x,b:y},backend:e}),e.disposeIntermediateTensorInfo(y)}else x=Jl({inputs:{a:x,b:o},backend:e});e.disposeIntermediateTensorInfo(b)}if(g){const b=x;if(u==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=Ke({inputs:{x:a},backend:e,attrs:{shape:[a.shape[0],1,1]}});x=jm(e,x,g,y,m),e.disposeIntermediateTensorInfo(y)}else x=jm(e,x,g,a,m);e.disposeIntermediateTensorInfo(b)}return x}const Xct={kernelName:_m,backendName:"cpu",kernelFunc:Kct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yct(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r,bias:o,preluActivationWeights:a}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f,activation:g,leakyreluAlpha:m}=s;let x=aM({inputs:{x:i,filter:r},backend:e,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f}});if(o){const b=x;x=Jl({inputs:{a:x,b:o},backend:e}),e.disposeIntermediateTensorInfo(b)}if(g){const b=x;x=jm(e,x,g,a,m),e.disposeIntermediateTensorInfo(b)}return x}const Jct={kernelName:qR,backendName:"cpu",kernelFunc:Yct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zct(n){const{inputs:t,backend:e}=n,{params:s,indices:i}=t,r=ut(s.shape),o=i.shape,a=o[o.length-1],[c,l,u,h]=JC(s,i);if(l===0)return e.makeTensorInfo(c,s.dtype,[]);const f=e.data.get(i.dataId).values,g=e.bufferSync(s),m=xF(f,g,s.dtype,l,a,u,h,s.shape,r);return e.makeTensorInfo(c,s.dtype,m.values)}const Qct={kernelName:$R,backendName:"cpu",kernelFunc:Zct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,indices:r}=t,{axis:o,batchDims:a}=s;Pt([i,r],"gatherV2");const c=le(o,i.shape)[0],l=e.data.get(r.dataId).values,u=i.shape[c];for(let I=0;I<l.length;++I){const _=l[I];P(_<=u-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${u-1}]`)}let h=a;a==null&&(h=0);const f=ut(r.shape),g=vI(i,r,c,h),m=Ke({inputs:{x:i},backend:e,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),x=Ke({inputs:{x:r},backend:e,attrs:{shape:[g.batchSize,f/g.batchSize]}}),b=[g.batchSize,g.outerSize,f/g.batchSize,g.sliceSize],y=e.bufferSync(x),v=e.bufferSync(m),k=yF(v,y,b);return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),e.makeTensorInfo(g.outputShape,k.dtype,k.values)}const elt={kernelName:Ob,backendName:"cpu",kernelFunc:tlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nlt(n){const{inputs:t,backend:e}=n,{input:s}=t,i=ut(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=Ke({inputs:{x:s},backend:e,attrs:{shape:[o,r]}}),c=cM(a,!0,e),l=Ke({inputs:{x:c},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),l}const slt={kernelName:q1,backendName:"cpu",kernelFunc:nlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ilt=Le(Hd,n=>Number.isFinite(n)?1:0,"bool"),rlt={kernelName:Hd,backendName:"cpu",kernelFunc:ilt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const olt=Le(Gd,n=>Math.abs(n)===1/0?1:0,"bool"),alt={kernelName:Gd,backendName:"cpu",kernelFunc:olt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const clt=Le(jd,n=>Number.isNaN(n)?1:0,"bool"),llt={kernelName:jd,backendName:"cpu",kernelFunc:clt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ult(n){const{backend:t,attrs:e}=n,{start:s,stop:i,num:r}=e,o=kF(s,i,r);return t.makeTensorInfo([o.length],"float32",o)}const hlt={kernelName:NR,backendName:"cpu",kernelFunc:ult};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dlt=Le(Kd,n=>Math.log1p(n)),flt={kernelName:Kd,backendName:"cpu",kernelFunc:dlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const plt=wn((n,t)=>n&&t),glt=On(Bb,plt,null,"bool"),mlt={kernelName:Bb,backendName:"cpu",kernelFunc:glt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const blt=Le(zb,n=>n?0:1,"bool"),xlt={kernelName:zb,backendName:"cpu",kernelFunc:blt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ylt=wn((n,t)=>n||t),wlt=On(Wb,ylt,null,"bool"),vlt={kernelName:Wb,backendName:"cpu",kernelFunc:wlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Clt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{depthRadius:r,bias:o,alpha:a,beta:c}=s;Pt(i,"LRN");const l=i.shape[3],u=l-1,h=e.data.get(i.dataId).values,f=ut(i.shape),g=new Float32Array(f);function m(x){const b=x%l;let y=x-b+Math.max(0,b-r);const v=x-b+Math.min(b+r,u);let k=0;for(;y<=v;y++){const I=h[y];k+=I*I}return k}for(let x=0;x<f;x++){const b=m(x),y=h[x]*Math.pow(o+a*b,-c);g[x]=y}return e.makeTensorInfo(i.shape,i.dtype,g)}const Ilt={kernelName:Vb,backendName:"cpu",kernelFunc:Clt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function klt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,y:r,dy:o}=t,{depthRadius:a,bias:c,alpha:l,beta:u}=s;Pt(o,"LRNGrad");const h=ut(o.shape),f=o.shape[3],g=e.data.get(o.dataId).values,m=e.data.get(i.dataId).values,x=e.data.get(r.dataId).values,b=new Float32Array(h),y=h;for(let v=0;v<y;v++){const k=v%f,I=v-k+Math.max(0,k-a),_=v-k+Math.min(f,k+a+1);let $=0;for(let R=I;R<_;R++)$+=Math.pow(m[R],2);$=l*$+c;for(let R=I;R<_;R++){let A=-2*l*u*m[R]*x[v]/$;v===R&&(A+=Math.pow($,-u)),A*=g[v],b[R]+=A}}return e.makeTensorInfo(o.shape,i.dtype,b)}const Slt={kernelName:X1,backendName:"cpu",kernelFunc:klt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lM(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{reductionIndices:r,keepDims:o}=s,a=e;let c=i.shape;const l=c.length,u=le(r,c);let h=u;const f=un(h,l);let g=a.data.get(i.dataId).values;if(f!=null){const I=new Array(l);for(let _=0;_<I.length;_++)I[_]=c[f[_]];g=qI(g,c,i.dtype,f,I),h=xn(h.length,l),c=I}Pt(i,"max"),Yn("max",h,l);const[m,x]=Vn(c,h),b=ut(x),y=_F(g,b,m,i.dtype),v=a.write(y,m,i.dtype);let k=m;return o&&(k=_n(m,u)),{dataId:v,shape:k,dtype:i.dtype}}const _lt={kernelName:Ub,backendName:"cpu",kernelFunc:lM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;Pt(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:c}=s,l=1;P(is(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Li(i.shape,r,o,l,a,c);let h;if(u.filterWidth===1&&u.filterHeight===1&&De(u.inShape,u.outShape))h=Br({inputs:{x:i},backend:e});else{const f=e.data.get(i.dataId).values,g=Wt(i.shape),m=YI(f,i.shape,i.dtype,g,u,"max");h=e.makeTensorInfo(u.outShape,i.dtype,m.values)}return h}const Elt={kernelName:Hb,backendName:"cpu",kernelFunc:Tlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $lt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{filterSize:r,strides:o,pad:a,dimRoundingMode:c,dataFormat:l}=s;Pt(i,"maxPool3d");const u=Po(i.shape,r,o,1,a,c,l),h=e.data.get(i.dataId).values,f=rM(h,i.shape,i.dtype,Wt(i.shape),u,"max");return e.makeTensorInfo(f.shape,"float32",f.values)}const Nlt={kernelName:Gb,backendName:"cpu",kernelFunc:$lt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rlt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r}=t,{filterSize:o,strides:a,pad:c,dimRoundingMode:l}=s;Pt([i,r],"maxPool3DGrad");const u=Po(r.shape,o,a,1,c,l),h=e.bufferSync(r),f=yat(h,u),g=u.strideDepth,m=u.strideHeight,x=u.strideWidth,b=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,k=u.effectiveFilterDepth,I=u.effectiveFilterHeight,_=u.effectiveFilterWidth,$=k-1-u.padInfo.front,R=_-1-u.padInfo.left,A=I-1-u.padInfo.top,F=ce(r.shape,"float32"),L=e.bufferSync(i);for(let V=0;V<u.batchSize;++V)for(let j=0;j<u.inChannels;++j)for(let Z=0;Z<u.inDepth;++Z)for(let et=0;et<u.inHeight;++et)for(let K=0;K<u.inWidth;++K){const tt=Z-$,it=et-A,st=K-R;let ot=0;for(let bt=0;bt<k;bt+=b){const ft=(tt+bt)/g;if(!(ft<0||ft>=u.outDepth||Math.floor(ft)!==ft))for(let yt=0;yt<I;yt+=y){const vt=(it+yt)/m;if(!(vt<0||vt>=u.outHeight||Math.floor(vt)!==vt))for(let St=0;St<_;St+=v){const pt=(st+St)/x;if(pt<0||pt>=u.outWidth||Math.floor(pt)!==pt)continue;const Ct=k*I*_-1-f.get(V,ft,vt,pt,j),Mt=bt*I*_+yt*_+St,Bt=Ct===Mt?1:0;if(Bt===0)continue;const At=L.get(V,ft,vt,pt,j);ot+=At*Bt}}}F.set(ot,V,Z,et,K,j)}return e.makeTensorInfo(F.shape,F.dtype,F.values)}const Alt={kernelName:J1,backendName:"cpu",kernelFunc:Rlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dlt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r,output:o}=t,a=r;Pt([r,o],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=s,f=Li(a.shape,c,l,1,u,h),g=e.data.get(a.dataId).values,m=ce(f.outShape,a.dtype,iM(g,a.shape,a.dtype,f).values),x=f.strideHeight,b=f.strideWidth,y=f.dilationHeight,v=f.dilationWidth,k=f.effectiveFilterHeight,I=f.effectiveFilterWidth,_=I-1-f.padInfo.left,$=k-1-f.padInfo.top,R=ce(a.shape,"float32"),A=e.data.get(i.dataId).values,F=ce(i.shape,"float32",A);for(let L=0;L<f.batchSize;++L)for(let V=0;V<f.inChannels;++V)for(let j=0;j<f.inHeight;++j)for(let Z=0;Z<f.inWidth;++Z){const et=j-$,K=Z-_;let tt=0;for(let it=0;it<k;it+=y){const st=(et+it)/x;if(!(st<0||st>=f.outHeight||Math.floor(st)!==st))for(let ot=0;ot<I;ot+=v){const bt=(K+ot)/b;if(bt<0||bt>=f.outWidth||Math.floor(bt)!==bt)continue;const ft=k*I-1-m.get(L,st,bt,V),yt=it*I+ot,vt=ft===yt?1:0;if(vt===0)continue;const St=F.get(L,st,bt,V);tt+=St*vt}}R.set(tt,L,j,Z,V)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}const Olt={kernelName:Y1,backendName:"cpu",kernelFunc:Dlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Plt(n,t,e,s,i){const r=Wt(t),o=YI(n,t,e,r,i,"max"),a=iM(n,t,e,i,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Flt={kernelName:RR,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=t,c=e;Pt(s,"MaxPoolWithArgmax");const l=c.data.get(s.dataId).values,u=Li(s.shape,i,r,[1,1],o),[h,f]=Plt(l,s.shape,s.dtype,a,u),g=c.write(h,u.outShape,s.dtype),m=c.write(f,u.outShape,s.dtype);return[{dataId:g,shape:u.outShape,dtype:s.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s,a=le(r,i.shape),l=Vn(i.shape,a)[1],u=ut(l),h=[],f=e.makeTensorInfo([],"float32",new Float32Array([u]));h.push(f);const g=va({inputs:{x:i},backend:e,attrs:{dtype:"float32"}});h.push(g);const m=JI({inputs:{a:g,b:f},backend:e});h.push(m);const x=Pf({inputs:{x:m},backend:e,attrs:{axis:r,keepDims:o}});return h.forEach(b=>e.disposeIntermediateTensorInfo(b)),x}const Llt={kernelName:jb,backendName:"cpu",kernelFunc:Mlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Blt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s;Pt(i,"min");const a=le(r,i.shape);let c=a;const l=un(c,i.shape.length);let u=i;l!=null&&(u=Os({inputs:{x:i},backend:e,attrs:{perm:l}}),c=xn(c.length,i.shape.length)),Yn("min",c,u.shape.length);const[h,f]=Vn(u.shape,c),g=ut(f),m=ns(ut(h),u.dtype),x=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){const v=y*g;let k=x[v];for(let I=0;I<g;++I){const _=x[v+I];(Number.isNaN(_)||_<k)&&(k=_)}m[y]=k}l!=null&&e.disposeIntermediateTensorInfo(u);const b=e.makeTensorInfo(h,u.dtype,m);if(o){const y=_n(h,a),v=Ke({inputs:{x:b},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(b),v}return b}const zlt={kernelName:qb,backendName:"cpu",kernelFunc:Blt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{paddings:r,mode:o}=s;Pt(i,"mirrorPad");const a=r.map((k,I)=>k[0]+i.shape[I]+k[1]),c=r.map(k=>k[0]),l=r.map((k,I)=>k[0]+i.shape[I]),u=o==="reflect"?0:1,h=e.data.get(i.dataId).values,f=i.shape.length,g=Wt(i.shape),m=ut(a),x=a.length,b=Wt(a),y=es(i.dtype,m);for(let k=0;k<m;k++){let I=ou(k,x,b);for(let $=0;$<x;$++)I[$]<c[$]?I[$]=c[$]*2-I[$]-u:I[$]>=l[$]&&(I[$]=(l[$]-1)*2-I[$]+u);I=I.map(($,R)=>$-c[R]);const _=Nr(I,f,g);y[k]=h[_]}return{dataId:e.write(y,a,i.dtype),shape:a,dtype:i.dtype}}const Vlt={kernelName:Kb,backendName:"cpu",kernelFunc:Wlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ult=wn((n,t)=>{const e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),Hlt=On(Jd,Ult),Glt={kernelName:Jd,backendName:"cpu",kernelFunc:Hlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uM(n){const{inputs:t,backend:e,attrs:s}=n,{logits:i}=t,{dim:r}=s,o=i.shape.length;let a=r;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const c=le([a],i.shape),l=lM({inputs:{x:i},backend:e,attrs:{reductionIndices:c,keepDims:!1}}),u=_n(l.shape,c),h=Ke({inputs:{x:l},backend:e,attrs:{shape:u}}),f=XI({inputs:{a:i,b:h},backend:e}),g=pF({inputs:{x:f},backend:e}),m=Pf({inputs:{x:g},backend:e,attrs:{axis:c,keepDims:!1}}),x=Ke({inputs:{x:m},backend:e,attrs:{shape:u}}),b=JI({inputs:{a:g,b:x},backend:e});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),b}const jlt={kernelName:dx,backendName:"cpu",kernelFunc:uM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qlt(n){const{inputs:t,backend:e,attrs:s}=n,{logits:i}=t,{numSamples:r,seed:o,normalized:a}=s;Pt(i,"multinomial");const c=a?i:uM({inputs:{logits:i},backend:e,attrs:{dim:-1}}),l=c.shape[0],u=c.shape[1],h=e.data.get(c.dataId).values,f=[l,r],g=ns(ut(f),"int32");for(let m=0;m<l;++m){const x=m*u,b=new Float32Array(u-1);b[0]=h[x];for(let k=1;k<b.length;++k)b[k]=b[k-1]+h[x+k];const y=MC.alea(o.toString()),v=m*r;for(let k=0;k<r;++k){const I=y();g[v+k]=b.length;for(let _=0;_<b.length;_++)if(I<b[_]){g[v+k]=_;break}}}return a||e.disposeIntermediateTensorInfo(c),e.makeTensorInfo(f,"int32",g)}const Klt={kernelName:AR,backendName:"cpu",kernelFunc:qlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xlt=jC;function Ylt(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:r}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c}=s;Pt(i,"NonMaxSuppression");const l=e.data.get(i.dataId).values,u=e.data.get(r.dataId).values,{selectedIndices:h}=Xlt(l,u,o,a,c);return e.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Jlt={kernelName:Z1,backendName:"cpu",kernelFunc:Ylt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zlt=qC;function Qlt(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:r}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s;Pt(i,"NonMaxSuppressionPadded");const u=e.data.get(i.dataId).values,h=e.data.get(r.dataId).values,{selectedIndices:f,validOutputs:g}=Zlt(u,h,o,a,c,l);return[e.makeTensorInfo([f.length],"int32",new Int32Array(f)),e.makeTensorInfo([],"int32",new Int32Array([g]))]}const tut={kernelName:Q1,backendName:"cpu",kernelFunc:Qlt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eut=KC;function nut(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:r}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s;Pt(i,"NonMaxSuppressionWithScore");const u=e.data.get(i.dataId).values,h=e.data.get(r.dataId).values,f=o,g=a,m=c,x=l,{selectedIndices:b,selectedScores:y}=eut(u,h,f,g,m,x);return[e.makeTensorInfo([b.length],"int32",new Int32Array(b)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const sut={kernelName:tC,backendName:"cpu",kernelFunc:nut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iut(n){const{inputs:t,backend:e,attrs:s}=n,{indices:i}=t,{dtype:r,depth:o,onValue:a,offValue:c}=s;Pt(i,"oneHot");const l=ut(i.shape),u=new Float32Array(l*o);u.fill(c);const h=e.data.get(i.dataId).values;for(let f=0;f<l;++f)h[f]>=0&&h[f]<o&&(u[f*o+h[f]]=a);return e.makeTensorInfo([...i.shape,o],r,u)}const rut={kernelName:Zb,backendName:"cpu",kernelFunc:iut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Km(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=Mc({inputs:{input:s},backend:e}),r=Km({inputs:{x:i},backend:e}),o=Zl({inputs:{input:s},backend:e}),a=Km({inputs:{x:o},backend:e}),c=Hs({inputs:{real:r,imag:a},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),c}else return ZI({backend:e,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const out={kernelName:gx,backendName:"cpu",kernelFunc:Km};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hM(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=Mc({inputs:{input:s},backend:e}),r=hM({inputs:{x:i},backend:e}),o=Zl({inputs:{input:s},backend:e}),a=Km({inputs:{x:o},backend:e}),c=Hs({inputs:{real:r,imag:a},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),c}else return ZI({backend:e,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const aut={kernelName:Jb,backendName:"cpu",kernelFunc:hM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dM(n){const{inputs:t,backend:e,attrs:s}=n,{axis:i}=s;if(t.length===1)return qm({inputs:{input:t[0]},backend:e,attrs:{dim:i}});const r=t[0].shape,o=t[0].dtype;t.forEach(u=>{v1(r,u.shape,"All tensors passed to stack must have matching shapes"),P(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=t.map(u=>{const h=qm({inputs:{input:u},backend:e,attrs:{dim:i}});return a.push(h),h}),l=Ql({inputs:c,backend:e,attrs:{axis:i}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),l}const cut={kernelName:Qb,backendName:"cpu",kernelFunc:dM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lut(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{paddings:r,constantValue:o}=s;Pt(i,"pad");const a=r.map((v,k)=>v[0]+i.shape[k]+v[1]),c=r.map(v=>v[0]),l=e.data.get(i.dataId).values,u=ut(i.shape),h=i.shape.length,f=Wt(i.shape),g=ut(a),m=a.length,x=Wt(a),b=es(i.dtype,g);o!==0&&b.fill(o);for(let v=0;v<u;v++){const I=ou(v,h,f).map(($,R)=>$+c[R]),_=Nr(I,m,x);b[_]=l[v]}return{dataId:e.write(b,a,i.dtype),shape:a,dtype:i.dtype}}const fM={kernelName:tx,backendName:"cpu",kernelFunc:lut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uut=wn((n,t)=>Math.pow(n,t)),hut=On(Qd,uut),dut={kernelName:Qd,backendName:"cpu",kernelFunc:hut};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fut(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:i,paramsDenseValues:r,indices:o}=t,a=i.map(b=>e.data.get(b.dataId).values),c=i.map(b=>b.shape),l=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,[h,f,g]=AF(a,c,l,r.shape,r.dtype,u,o.shape),m=h.map(b=>e.makeTensorInfo([b.length],"int32",b)),x=e.makeTensorInfo(g,r.dtype,f);return m.concat([x])}const put={kernelName:DR,backendName:"cpu",kernelFunc:fut};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gut(n){const{inputs:t,backend:e}=n,{starts:s,limits:i,deltas:r}=t,o=e.data.get(s.dataId).values,a=e.data.get(i.dataId).values,c=e.data.get(r.dataId).values,[l,u]=DF(o,s.shape,s.dtype,a,i.shape,c,r.shape),h=e.makeTensorInfo([l.length],"int32",l),f=e.makeTensorInfo([u.length],s.dtype,u);return[h,f]}const mut={kernelName:OR,backendName:"cpu",kernelFunc:gut};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function but(n){const{inputs:t,backend:e,attrs:s}=n,{shape:i,values:r,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:c}=s,l=e.data.get(i.dataId).values,u=e.data.get(r.dataId).values,h=e.data.get(o.dataId).values,f=a.map(b=>e.data.get(b.dataId).values),g=a.map(b=>b.shape),[m,x]=OF(l,i.shape,u,r.shape,r.dtype,h,o.shape,f,g,c);return e.makeTensorInfo(m,r.dtype,x)}const xut={kernelName:PR,backendName:"cpu",kernelFunc:but};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yut(n){const{backend:t,attrs:e}=n,{start:s,stop:i,dtype:r,step:o}=e,a=PF(s,i,o,r);return t.makeTensorInfo([a.length],r,a)}const wut={kernelName:eC,backendName:"cpu",kernelFunc:yut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vut=Le(tf,n=>1/n),Cut={kernelName:tf,backendName:"cpu",kernelFunc:vut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iut(n){const{inputs:t,backend:e,attrs:s}=n,{images:i}=t,{alignCorners:r,halfPixelCenters:o,size:a}=s;Pt(i,"resizeBilinear");const c=Wt(i.shape),[l,u]=a,[h,f,g,m]=i.shape,x=e.data.get(i.dataId).values,b=new Float32Array(ut([h,l,u,m])),y=[r&&l>1?f-1:f,r&&u>1?g-1:g],v=[r&&l>1?l-1:l,r&&u>1?u-1:u];let k=0;const I=y[0]/v[0],_=y[1]/v[1];for(let $=0;$<h;$++)for(let R=0;R<l;R++){let A;o?A=I*(R+.5)-.5:A=I*R;const F=Math.max(0,Math.floor(A)),L=A-F,V=Math.min(f-1,Math.ceil(A)),j=$*c[0]+F*c[1],Z=$*c[0]+V*c[1];for(let et=0;et<u;et++){let K;o?K=_*(et+.5)-.5:K=_*et;const tt=Math.max(0,Math.floor(K)),it=K-tt,st=Math.min(g-1,Math.ceil(K)),ot=j+tt*c[2],bt=Z+tt*c[2],ft=j+st*c[2],yt=Z+st*c[2];for(let vt=0;vt<m;vt++){const St=x[ot+vt],pt=x[bt+vt],Ct=x[ft+vt],Mt=x[yt+vt],Bt=St+(Ct-St)*it,At=pt+(Mt-pt)*it,Jt=Bt+(At-Bt)*L;b[k++]=Jt}}}return e.makeTensorInfo([h,l,u,m],"float32",b)}const kut={kernelName:rx,backendName:"cpu",kernelFunc:Iut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sut(n){const{inputs:t,backend:e,attrs:s}=n,{images:i,dy:r}=t,{alignCorners:o}=s;Pt([r,i],"resizeBilinearGrad");const a=Wt(i.shape),[c,l,u,h]=i.shape,[,f,g]=r.shape,m=new Float32Array(c*l*u*h),x=[o&&f>1?l-1:l,o&&g>1?u-1:u],b=[o&&f>1?f-1:f,o&&g>1?g-1:g],y=x[0]/b[0],v=x[1]/b[1],k=e.data.get(r.dataId).values;let I=0;for(let _=0;_<c;_++){const $=_*a[0];for(let R=0;R<f;R++){const A=R*y,F=Math.floor(A),L=Math.min(Math.ceil(A),l-1),V=$+F*a[1],j=$+L*a[1],Z=A-F,et=1-Z;for(let K=0;K<g;K++){const tt=K*v,it=Math.floor(tt),st=Math.min(Math.ceil(tt),u-1),ot=tt-it,bt=1-ot,ft=V+it*a[2],yt=V+st*a[2],vt=j+it*a[2],St=j+st*a[2],pt=et*bt,Ct=et*ot,Mt=Z*bt,Bt=Z*ot;for(let At=0;At<h;At++){const Jt=k[I++];m[ft+At]+=Jt*pt,m[yt+At]+=Jt*Ct,m[vt+At]+=Jt*Mt,m[St+At]+=Jt*Bt}}}}return e.makeTensorInfo([c,u,l,h],"float32",m)}const _ut={kernelName:iC,backendName:"cpu",kernelFunc:Sut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tut(n){const{inputs:t,backend:e,attrs:s}=n,{images:i}=t,{alignCorners:r,halfPixelCenters:o,size:a}=s;Pt(i,"resizeNearestNeighbor");const c=Wt(i.shape),[l,u]=a,[h,f,g,m]=i.shape,x=e.data.get(i.dataId).values,b=new Float32Array(h*l*u*m),y=[r&&l>1?f-1:f,r&&u>1?g-1:g],v=[r&&l>1?l-1:l,r&&u>1?u-1:u],k=y[0]/v[0],I=y[1]/v[1];let _=0;for(let $=0;$<h;$++){const R=$*c[0];for(let A=0;A<l;A++){const F=o?k*(A+.5):k*A;let L=Math.min(f-1,r?Math.round(F):Math.floor(F));o&&(L=Math.max(0,L));const V=R+L*c[1];for(let j=0;j<u;j++){const Z=o?I*(j+.5):I*j;let et=Math.min(g-1,r?Math.round(Z):Math.floor(Z));o&&(et=Math.max(0,et));const K=V+et*c[2];for(let tt=0;tt<m;tt++){const it=x[K+tt];b[_++]=it}}}}return e.makeTensorInfo([h,l,u,m],i.dtype,b)}const Eut={kernelName:ix,backendName:"cpu",kernelFunc:Tut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ut(n){const{inputs:t,backend:e,attrs:s}=n,{images:i,dy:r}=t,{alignCorners:o}=s;Pt([r,i],"resizeNearestNeighborGrad");const a=Wt(i.shape),c=Wt(r.shape),[l,u,h,f]=i.shape,[,g,m]=r.shape,x=new Float32Array(l*u*h*f),b=e.data.get(r.dataId).values,y=[o&&g>1?u-1:u,o&&m>1?h-1:h],v=[o&&g>1?g-1:g,o&&m>1?m-1:m],k=y[0]/v[0],I=y[1]/v[1],_=1/k,$=1/I,R=Math.ceil(_)*2+2,A=Math.ceil($)*2+2;for(let F=0;F<l;F++){const L=F*a[0];for(let V=0;V<u;V++){const j=L+V*a[1],Z=Math.floor(V*_),et=Math.floor(Z-R/2);for(let K=0;K<h;K++){const tt=j+K*a[2],it=Math.floor(K*$),st=Math.floor(it-A/2);for(let ot=0;ot<f;ot++){let bt=0;for(let ft=0;ft<R;ft++){const yt=ft+et;if(yt<0||yt>=g)continue;const vt=L+yt*c[1],St=yt*k,pt=Math.min(u-1,o?Math.round(St):Math.floor(St));if(V===pt)for(let Ct=0;Ct<A;Ct++){const Mt=Ct+st;if(Mt<0||Mt>=m)continue;const Bt=vt+Mt*c[2],At=Mt*I,Jt=Math.min(h-1,o?Math.round(At):Math.floor(At));K===Jt&&(bt+=b[Bt+ot])}}x[tt+ot]=bt}}}}return e.makeTensorInfo(i.shape,i.dtype,x)}const Nut={kernelName:sC,backendName:"cpu",kernelFunc:$ut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rut(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{dims:r}=s;Pt(i,"reverse");const o=i.shape.length,a=le(r,i.shape);if(o===0)return Br({inputs:{x:i},backend:e});const c=new jn(i.shape,i.dtype),l=e.bufferSync(i);for(let u=0;u<c.size;u++){const h=c.indexToLoc(u),f=h.slice();a.forEach(g=>f[g]=i.shape[g]-1-f[g]),c.set(l.get(...f),...h)}return e.makeTensorInfo(c.shape,c.dtype,c.values)}const Aut={kernelName:ox,backendName:"cpu",kernelFunc:Rut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dut={kernelName:hC,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:i,fillValue:r,center:o}=t,a=e,c=es(s.dtype,ut(s.shape)),[l,u,h,f]=s.shape,[g,m]=rI(o,u,h),x=255,b=Math.sin(i),y=Math.cos(i),v=a.data.get(s.dataId).values;for(let I=0;I<l;I++){const _=I*h*u*f;for(let $=0;$<u;$++){const R=$*(h*f);for(let A=0;A<h;A++){const F=A*f;for(let L=0;L<f;L++){const V=[l,$,A,L],j=V[2],Z=V[1];let et=(j-g)*y-(Z-m)*b,K=(j-g)*b+(Z-m)*y;et=Math.round(et+g),K=Math.round(K+m);let tt=r;if(typeof r!="number"&&(L===3?tt=x:tt=r[L]),et>=0&&et<h&&K>=0&&K<u){const st=K*(h*f),ot=et*f,bt=_+st+ot+L;tt=v[bt]}const it=_+R+F+L;c[it]=tt}}}}return{dataId:a.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Out=Le(sf,n=>{const t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),Put={kernelName:sf,backendName:"cpu",kernelFunc:Out};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fut(n){const{inputs:t,backend:e,attrs:s}=n,{indices:i,updates:r}=t,{shape:o}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=jc(r,i,o),f=!0,g=e.bufferSync(i),m=e.bufferSync(r),x=gc(g,m,o,h,l,c,a,u,0,f);return e.makeTensorInfo(o,x.dtype,x.values)}const Mut={kernelName:FR,backendName:"cpu",kernelFunc:Fut};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lut(n,t){let e=0,s=n.length,i=0;for(;e<s;)i=Math.floor((e+s)/2),n[i]<t?e=i+1:s=i;return s}function But(n,t){let e=0,s=n.length,i=0;for(;e<s;)i=Math.floor((e+s)/2),n[i]<=t?e=i+1:s=i;return s}function zut(n,t,e,s,i,r){const o=gn("int32",e*i);for(let a=0;a<e;++a){const c=n.slice(a*s,(a+1)*s),l=a*i;for(let u=0;u<i;++u)o[l+u]=r==="left"?Lut(c,t[u+l]):But(c,t[u+l])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wut(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:i,values:r}=t,{side:o}=s,a=e.data.get(i.dataId).values,c=e.data.get(r.dataId).values,l=zut(a,c,i.shape[0],i.shape[1],r.shape[1],o);return e.makeTensorInfo(r.shape,"int32",l)}const Vut={kernelName:LR,backendName:"cpu",kernelFunc:Wut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uut(n){const{inputs:t,backend:e}=n,{condition:s,t:i,e:r}=t;Pt([s,i,r],"select");const o=s.shape.length,a=e.data.get(s.dataId).values,c=e.data.get(i.dataId).values,l=e.data.get(r.dataId).values,u=Ks(i.dtype,r.dtype),h=ns(ut(i.shape),u);let f=0;const g=o===0||o>1||i.shape.length===1?1:ut(i.shape.slice(1));for(let m=0;m<a.length;m++)for(let x=0;x<g;x++)a[m]===1?h[f++]=c[m]:h[f++]=l[m];return e.makeTensorInfo(i.shape,u,h)}const Hut={kernelName:ax,backendName:"cpu",kernelFunc:Uut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gut=Tx,jut=Ex,qut=Le(of,n=>n>=0?jut*n:Gut*(Math.exp(n)-1)),Kut={kernelName:of,backendName:"cpu",kernelFunc:qut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xut=Le(lf,n=>n<0?-1:n>0?1:0),Yut={kernelName:lf,backendName:"cpu",kernelFunc:Xut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jut=Le(af,n=>Math.sin(n)),Zut={kernelName:af,backendName:"cpu",kernelFunc:Jut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qut=Le(cf,n=>Math.sinh(n)),tht={kernelName:cf,backendName:"cpu",kernelFunc:Qut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eht=11920928955078125e-23,y$=Math.log(eht)+2,nht=Le(hf,n=>{const t=n>-y$,e=n<y$,s=Math.exp(n);let i;return e?i=s:t?i=n:i=Math.log(1+s),i}),sht={kernelName:hf,backendName:"cpu",kernelFunc:nht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iht(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockShape:r,paddings:o}=s;Pt([i],"spaceToBatchND");const a=ut(r),c=[[0,0]];c.push(...o);for(let $=1+r.length;$<i.shape.length;++$)c.push([0,0]);const l=fM.kernelFunc({inputs:{x:i},backend:e,attrs:{paddings:c,constantValue:0}}),u=kf(l.shape,r,a,!1),h=Sf(u.length,r.length,!1),f=_f(l.shape,r,a,!1),x=Ke({inputs:{x:l},backend:e,attrs:{shape:u}}),v=Os({inputs:{x},backend:e,attrs:{perm:h}}),_=Ke({inputs:{x:v},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(v),_}const rht={kernelName:ux,backendName:"cpu",kernelFunc:iht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oht(n){const{inputs:t,backend:e}=n,{indices:s,values:i,denseShape:r,defaultValue:o}=t;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=e.data.get(s.dataId).values,c=e.data.get(i.dataId).values,l=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values[0],[h,f,g,m,x]=BF(a,s.shape,s.dtype,c,i.dtype,l,u);return[e.makeTensorInfo(f,s.dtype,h),e.makeTensorInfo([f[0]],i.dtype,g),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(b=>Number(b)))),e.makeTensorInfo([x.length],s.dtype,new Int32Array(x))]}const aht={kernelName:BR,backendName:"cpu",kernelFunc:oht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cht(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:i,newShape:r}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const o=Array.from(e.data.get(i.dataId).values),a=e.data.get(s.dataId).values,c=Array.from(e.data.get(r.dataId).values),[l,u,h]=zF(a,s.shape,s.dtype,o,c);return[e.makeTensorInfo(u,s.dtype,l),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}const lht={kernelName:zR,backendName:"cpu",kernelFunc:cht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uht(n){const{inputs:t,backend:e}=n,{data:s,indices:i,segmentIds:r}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${r.shape}`);if(i.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const o=e.data.get(s.dataId).values,a=e.data.get(i.dataId).values,c=e.data.get(r.dataId).values,[l,u]=KI(o,s.shape,s.dtype,a,c,!0);return e.makeTensorInfo(u,s.dtype,l)}const hht={kernelName:WR,backendName:"cpu",kernelFunc:uht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dht(n){const{inputs:t,backend:e}=n,{data:s,indices:i,segmentIds:r}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${r.shape}`);if(i.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const o=e.data.get(s.dataId).values,a=e.data.get(i.dataId).values,c=e.data.get(r.dataId).values,[l,u]=KI(o,s.shape,s.dtype,a,c);return e.makeTensorInfo(u,s.dtype,l)}const fht={kernelName:VR,backendName:"cpu",kernelFunc:dht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pht(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:i,sparseValues:r,defaultValue:o}=t,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=jc(r,i,a),g=!1,m=e.bufferSync(i);let x;switch(r.dtype){case"bool":{const b=e.bufferSync(r),y=!!e.data.get(o.dataId).values[0];x=gc(m,b,a,f,u,l,c,h,y,g);break}case"float32":{const b=e.bufferSync(r),y=e.data.get(o.dataId).values[0];x=gc(m,b,a,f,u,l,c,h,y,g);break}case"int32":{const b=e.bufferSync(r),y=e.data.get(o.dataId).values[0];x=gc(m,b,a,f,u,l,c,h,y,g);break}case"string":{const b=e.bufferSync(r),y=ma(e.data.get(o.dataId).values[0]);x=gc(m,b,a,f,u,l,c,h,y,g);break}default:throw new Error(`Unsupported type ${r.dtype}`)}return e.makeTensorInfo(a,x.dtype,x.values)}const ght={kernelName:UR,backendName:"cpu",kernelFunc:pht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mht(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{numOrSizeSplits:r,axis:o}=s,a=le(o,i.shape)[0],c=wI(i,r,a),l=new Array(i.shape.length).fill(0),u=i.shape.slice();return c.map(h=>{const f=[...u];f[a]=h;const g=Lc({inputs:{x:i},backend:e,attrs:{begin:l,size:f}});return l[a]+=h,g})}const bht={kernelName:hx,backendName:"cpu",kernelFunc:mht};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xht={kernelName:rC,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{const{x:e}=n,s=t;Pt(e,"square");const i=s.data.get(e.dataId).values,r=new Float32Array(i.length);for(let a=0;a<i.length;++a){const c=i[a];r[a]=c*c}return{dataId:s.write(r,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yht=Le(xf,(n,t)=>{const e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),wht={kernelName:xf,backendName:"cpu",kernelFunc:yht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vht(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{begin:r,end:o,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f}=s;Pt(i,"stridedSlice");const{finalShapeSparse:g,finalShape:m,isIdentity:x,sliceDim0:b,isSimpleSlice:y,begin:v,end:k,strides:I}=nI(i.shape,r,o,a,c,l,u,h,f);let _;if(x)_=Ke({inputs:{x:i},backend:e,attrs:{shape:m}});else if(b||y){P(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const $=QC(v,k,I),R=Lc({inputs:{x:i},backend:e,attrs:{begin:v,size:$}});_=Ke({inputs:{x:R},backend:e,attrs:{shape:m}}),e.disposeIntermediateTensorInfo(R)}else{const $=e.bufferSync(i),R=UF(g,$,I,v);_=e.makeTensorInfo(m,R.dtype,R.values)}return _}const Cht={kernelName:aC,backendName:"cpu",kernelFunc:vht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iht(n){const{inputs:t,backend:e,attrs:s}=n,{separator:i,nGramWidths:r,leftPad:o,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:u,dataSplits:h}=t,f=e.data.get(u.dataId).values,g=e.data.get(h.dataId).values,[m,x]=HF(f,g,i,r,o,a,c,l);return[e.makeTensorInfo([m.length],"string",m),e.makeTensorInfo(h.shape,"int32",x)]}const kht={kernelName:HR,backendName:"cpu",kernelFunc:Iht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sht(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:i}=s,{input:r,delimiter:o}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=e.data.get(r.dataId).values,c=e.data.get(o.dataId).values[0],[l,u,h]=GF(a,c,i),f=u.length;return[e.makeTensorInfo([f,2],"int32",l),e.makeTensorInfo([f],"string",u),e.makeTensorInfo([2],"int32",new Int32Array(h))]}const _ht={kernelName:GR,backendName:"cpu",kernelFunc:Sht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tht(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:i}=s,{input:r}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=e.data.get(r.dataId).values,a=jF(o,i);return e.makeTensorInfo(r.shape,"int32",a)}const Eht={kernelName:jR,backendName:"cpu",kernelFunc:Tht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ht=Le(gf,n=>Math.tan(n)),Nht={kernelName:gf,backendName:"cpu",kernelFunc:$ht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rht=Le(mf,n=>Math.tanh(n)),Aht={kernelName:mf,backendName:"cpu",kernelFunc:Rht};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dht(n){const{inputs:t,backend:e}=n,{tensor:s,indices:i,updates:r}=t,{sliceRank:o,numUpdates:a,sliceSize:c,strides:l,outputSize:u}=jc(r,i,s.shape),h=!1,f=e.bufferSync(i),g=e.bufferSync(r),m=e.bufferSync(s),x=gc(f,g,s.shape,u,c,a,o,l,m,h);return e.makeTensorInfo(s.shape,x.dtype,x.values)}const Oht={kernelName:MR,backendName:"cpu",kernelFunc:Dht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pht(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{reps:r}=s;Pt(i,"tile");const o=KF(e.bufferSync(i),r);return e.makeTensorInfo(o.shape,o.dtype,o.values)}const Fht={kernelName:bf,backendName:"cpu",kernelFunc:Pht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mht(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{k:r,sorted:o}=s;Pt(i,"topk");const a=e.data.get(i.dataId).values,[c,l]=YF(a,i.shape,i.dtype,r,o);return[e.makeTensorInfo(c.shape,c.dtype,c.values),e.makeTensorInfo(l.shape,l.dtype,l.values)]}const Lht={kernelName:cC,backendName:"cpu",kernelFunc:Mht};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bht(n){const{inputs:t,attrs:e,backend:s}=n,{image:i,transforms:r}=t,{interpolation:o,fillMode:a,fillValue:c,outputShape:l}=e,[u,h,f,g]=i.shape,[m,x]=l??[h,f],b=[u,m,x,g],y=Wt(i.shape),v=y[0],k=y[1],I=y[2],_=Wt(b),$=_[0],R=_[1],A=_[2],F=es(i.dtype,ut(b));F.fill(c);const L=s.data.get(i.dataId).values,V=s.data.get(r.dataId).values;for(let Z=0;Z<u;++Z){const et=r.shape[0]===1?V:V.subarray(Z*8,Z*8+8);for(let K=0;K<m;++K)for(let tt=0;tt<x;++tt)for(let it=0;it<g;++it){let st;const ot=et[6]*tt+et[7]*K+1;if(ot===0)continue;const bt=(et[0]*tt+et[1]*K+et[2])/ot,ft=(et[3]*tt+et[4]*K+et[5])/ot,yt=w$(bt,f,a),vt=w$(ft,h,a);switch(o){case"nearest":st=Ght(L,h,f,v,k,I,Z,vt,yt,it,c);break;case"bilinear":st=jht(L,h,f,v,k,I,Z,vt,yt,it,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const St=Z*$+K*R+tt*A+it;F[St]=st}return s.makeTensorInfo(b,i.dtype,F)}return{dataId:s.write(F,b,i.dtype),shape:i.shape,dtype:i.dtype}}const zht={kernelName:lC,backendName:"cpu",kernelFunc:Bht};function w$(n,t,e){switch(e){case"reflect":return Wht(n,t);case"wrap":return Vht(n,t);case"nearest":return Hht(n,t);case"constant":default:return Uht(n)}}function Wht(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=2*t;e<s&&(e=s*Math.trunc(-e/s)+e),e=e<-t?e+s:-e-1}else if(e>t-1)if(t<=1)e=0;else{const s=2*t;e-=s*Math.trunc(e/s),e>=t&&(e=s-e-1)}return _c(0,e,t-1)}function Vht(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=t-1;e+=t*(Math.trunc(-e/s)+1)}else if(e>t-1)if(t<=1)e=0;else{const s=t-1;e-=t*Math.trunc(e/s)}return _c(0,e,t-1)}function Uht(n,t){return n}function Hht(n,t){return _c(0,n,t-1)}function _h(n,t,e,s,i,r,o,a,c,l,u){const h=o*s+a*i+c*r+l;return 0<=a&&a<t&&0<=c&&c<e?n[h]:u}function Ght(n,t,e,s,i,r,o,a,c,l,u){const h=Math.round(a),f=Math.round(c);return _h(n,t,e,s,i,r,o,h,f,l,u)}function jht(n,t,e,s,i,r,o,a,c,l,u){const h=Math.floor(a),f=Math.floor(c),g=h+1,m=f+1,x=(m-c)*_h(n,t,e,s,i,r,o,h,f,l,u)+(c-f)*_h(n,t,e,s,i,r,o,h,m,l,u),b=(m-c)*_h(n,t,e,s,i,r,o,g,f,l,u)+(c-f)*_h(n,t,e,s,i,r,o,g,m,l,u);return(g-a)*x+(a-h)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qht(n){const{inputs:t,attrs:e,backend:s}=n,{axis:i}=e,{x:r}=t;Pt(r,"unique");const o=s.data.get(r.dataId).values,{outputValues:a,outputShape:c,indices:l}=JF(o,i,r.shape,r.dtype);return[s.makeTensorInfo(c,r.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const Kht={kernelName:uC,backendName:"cpu",kernelFunc:qht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xht(n){const{inputs:t,backend:e,attrs:s}=n,{value:i}=t;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i.shape.length,a=i.shape[r],c=new Array(o-1);let l=0;for(let g=0;g<o;g++)g!==r&&(c[l++]=i.shape[g]);const u=new Array(o).fill(0),h=i.shape.slice();h[r]=1;const f=new Array(a);for(let g=0;g<f.length;g++){u[r]=g;const m=Lc({inputs:{x:i},backend:e,attrs:{begin:u,size:h}});f[g]=Ke({inputs:{x:m},backend:e,attrs:{shape:c}}),e.disposeIntermediateTensorInfo(m)}return f}const Yht={kernelName:fx,backendName:"cpu",kernelFunc:Xht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jht(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,segmentIds:r}=t,{numSegments:o}=s;Pt(i,"unsortedSegmentSum");const a=i.shape.length,c=r.shape.length,l=[],u=[],h=a-c;let f=r;for(let m=0;m<h;++m){const x=qm({inputs:{input:f},backend:e,attrs:{dim:m+1}});f=x,u.push(x)}for(let m=0;m<o;++m){const x=Sa(m,"int32"),b=e.makeTensorInfo([],"int32",x),y=dF({inputs:{a:b,b:f},backend:e}),v=va({inputs:{x:y},backend:e,attrs:{dtype:"float32"}}),k=Wx({inputs:{a:v,b:i},backend:e}),I=Pf({inputs:{x:k},backend:e,attrs:{axis:0,keepDims:!1}});l.push(I),u.push(b),u.push(y),u.push(v),u.push(k),u.push(I)}const g=dM({inputs:l,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),g}const Zht={kernelName:px,backendName:"cpu",kernelFunc:Jht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qht=[qot,Trt,Xot,Jot,Drt,Qot,eat,sat,rat,aat,lat,hat,fat,mat,xat,vat,Iat,Sat,Tat,Got,$at,Rat,Dat,Prt,Pat,Rrt,Mrt,Mat,Ert,Bat,Wat,Vat,Hat,jat,Kat,Yat,Zat,tct,nct,ict,oct,cct,uct,dct,fct,gct,bct,yct,wct,vct,Cct,kct,Tct,Lot,$ct,Lrt,Mct,Brt,Lct,Wrt,Hct,Gct,qct,Urt,Grt,Xct,Jct,Qct,elt,qrt,Xrt,$rt,slt,zat,rlt,alt,llt,Bot,Jrt,Qrt,hlt,eot,flt,mlt,xlt,vlt,Ilt,Slt,_lt,sot,Elt,Nlt,Alt,Olt,Flt,Llt,zlt,rot,Vlt,Glt,Klt,aot,lot,Jlt,tut,sut,hot,rut,aut,cut,fM,dut,Wot,pot,put,mut,xut,wut,Nrt,$v,Cut,Vot,Uot,Hot,kut,_ut,Eut,Nut,Aut,Dut,Put,Cot,Mut,Vut,Hut,Kut,kot,Yut,Zut,tht,Sot,jlt,sht,rht,aht,lht,hht,fht,ght,bht,Eot,xht,Not,Aot,wht,Cht,kht,_ht,Eht,Fot,Sct,Nht,Aht,Oht,Fht,Lht,zht,dot,Kht,Yht,Zht,out];for(const n of Qht)KR(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lc={},$g={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function tdt(n,t){lc[n]=t}function lr(n,t){if(!(n in lc)||t!=null){const s=ndt(n,t);if(s!==null)lc[n]=s;else return console.log("Could not get context for WebGL version",n),null}const e=lc[n];return e==null||e.isContextLost()?(delete lc[n],lr(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),lc[n])}function edt(n){if(!rt().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function ndt(n,t){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=t??edt(n);return e.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete lc[n]},!1),rt().getBool("SOFTWARE_WEBGL_ENABLED")&&($g.failIfMajorPerformanceCaveat=!1),n===1?e.getContext("webgl",$g)||e.getContext("experimental-webgl",$g):e.getContext("webgl2",$g)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rd;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(rd||(rd={}));var ci;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ci||(ci={}));var Hn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Hn||(Hn={}));function Ff(n,t){return[t,n]}function sdt(n,t){return n*t}function Ng(n){const t=ut(n),e=Math.ceil(t/4);return Yw(e)}function pu(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function idt(n,t){const[e,s]=pu(n,t);return e*s*4}function QI(n,t){const e=n;let s,i,r,o,a,c,l,u,h,f;return rt().getNumber("WEBGL_VERSION")===2?(s=e.R32F,i=e.R16F,r=e.RGBA16F,o=e.RGBA32F,a=e.RED,l=4,u=1,h=e.HALF_FLOAT,f=e.FLOAT,c=e.RGBA8):(s=n.RGBA,i=n.RGBA,r=n.RGBA,o=e.RGBA,a=n.RGBA,l=4,u=4,h=t!=null?t.HALF_FLOAT_OES:null,f=n.FLOAT,c=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(n,t){const e=t();return rt().getBool("DEBUG")&&rdt(n),e}function rdt(n){const t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+ldt(n,t))}const odt=596e-10,adt=65504;function cdt(n){return!!(rt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||odt<Math.abs(n)&&Math.abs(n)<adt)}function ldt(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function Rg(n,t){return Mo(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function udt(n,t){const e=Mo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Nt(n,()=>n.shaderSource(e,t)),Nt(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function hdt(n,t){const e=Mo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Nt(n,()=>n.shaderSource(e,t)),Nt(n,()=>n.compileShader(e)),rt().get("ENGINE_COMPILE_ONLY"))return e;if(n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw pM(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}const ddt=/ERROR: [0-9]+:([0-9]+):/g;function pM(n,t){const e=ddt.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}const s=+e[1],i=n.split(`
`),r=i.length.toString().length+2,o=i.map((h,f)=>Al((f+1).toString(),r)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const c=o.slice(0,s-1),l=o.slice(s-1,s),u=o.slice(s);console.log(c.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Al(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function fdt(n){return Mo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function pdt(n,t){if(Nt(n,()=>n.linkProgram(t)),!rt().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function fw(n,t){if(Nt(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function gdt(n,t){const e=Mo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Nt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),Nt(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function mdt(n,t){const e=Mo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Nt(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),Nt(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function bdt(n){return Mo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function xdt(n,t){const e=rt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){const s=`[${n}x${t}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>e||t>e){const s=`[${n}x${t}]`,i=`[${e}x${e}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function ydt(n){return Mo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function v$(n,t,e,s,i,r,o){const a=n.getAttribLocation(t,e);return a===-1?!1:(Nt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Nt(n,()=>n.vertexAttribPointer(a,i,n.FLOAT,!1,r,o)),Nt(n,()=>n.enableVertexAttribArray(a)),!0)}function wdt(n,t,e){Sdt(n,e),Nt(n,()=>n.activeTexture(n.TEXTURE0+e)),Nt(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function vdt(n,t,e){return Mo(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function Cdt(n,t,e){return n.getUniformLocation(t,e)}function Idt(n,t,e,s){Nt(n,()=>wdt(n,t,s)),Nt(n,()=>n.uniform1i(e,s))}function pw(n,t,e){Nt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Nt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function C$(n,t){Nt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Nt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Ag(n){const t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+kdt(n,t))}function kdt(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Mo(n,t,e){const s=Nt(n,()=>t());if(s==null)throw new Error(e);return s}function Sdt(n,t){const e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=t+n.TEXTURE0;if(s<n.TEXTURE0||s>e){const i=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${i}.`)}}function tu(n,t=2){return ut(n.slice(0,n.length-t))}function eu(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Dg(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[tu(n),...eu(n)]),t}function _dt(n,t=!1){let e=rt().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=rt().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&rt().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=e/2),t&&(e=e*2,s=s*2,n=n.map((a,c)=>c>=n.length-2?w1(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=ka(n).newShape);let i=ut(n),r=null;n.length<=1&&i<=e?r=[1,i]:n.length===2&&n[0]<=e&&n[1]<=e?r=n:n.length===3&&n[0]*n[1]<=e&&n[2]<=e?r=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=e&&n[1]*n[2]<=e?r=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e?r=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e&&(r=[n[0],n[1]*n[2]*n[3]]);const o=r!=null&&Math.max(...r)>s&&Math.min(...r)<=(t?2:1)&&Math.min(...r)>0;if(r==null||o)if(t){const a=tu(n);let c=2,l=2;n.length&&([c,l]=eu(n)),i=a*(c/2)*(l/2),r=Yw(i).map(u=>u*2)}else r=Yw(i);return r}function Og(n){return n%2===0}function Xm(n,t){if(n=n.slice(-2),t=t.slice(-2),De(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){const e=n[n.length-1],s=t[t.length-1];if(e===s||Og(e)&&Og(s)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Og(n[0])&&Og(t[0])}let gw,mw;function Tdt(n){if(gw==null){const t=lr(n);gw=t.getParameter(t.MAX_TEXTURE_SIZE)}return gw}function Edt(n){if(mw==null){const t=lr(n);mw=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,mw)}function $dt(n){if(n===0)return 0;let t;const e=lr(n);return Oi(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:Oi(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function Oi(n,t){return n.getExtension(t)!=null}function I$(n){try{if(lr(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Ndt(n){if(n===0)return!1;const t=lr(n);if(n===1){if(!Oi(t,"OES_texture_float"))return!1}else if(!Oi(t,"EXT_color_buffer_float"))return!1;return Rv(t)}function Rdt(n){if(n===0)return!1;const t=lr(n);if(n===1){if(!Oi(t,"OES_texture_float")||!Oi(t,"WEBGL_color_buffer_float"))return!1}else{if(Oi(t,"EXT_color_buffer_float"))return Rv(t);const s="EXT_color_buffer_half_float";if(Oi(t,s)){const i=t.getExtension(s);return Adt(t,i)}return!1}return Rv(t)}function Rv(n){const t=QI(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);const s=1,i=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,s,i,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(r),o}function Adt(n,t){const e=QI(n,t),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);const i=1,r=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,i,r,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function Ddt(n){return n!==2?!1:lr(n).fenceSync!=null}function Mf(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&P(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ft=rt();Ft.registerFlag("HAS_WEBGL",()=>Ft.getNumber("WEBGL_VERSION")>0);Ft.registerFlag("WEBGL_VERSION",()=>I$(2)?2:I$(1)?1:0);Ft.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ft.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ft.get("WEBGL_VERSION")===2);Ft.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ft.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ft.registerFlag("WEBGL_PACK",()=>Ft.getBool("HAS_WEBGL"));Ft.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_CLIP",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_REDUCE",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_CONV_IM2COL",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ft.getBool("WEBGL_PACK"));Ft.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Tdt(Ft.getNumber("WEBGL_VERSION")));Ft.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Edt(Ft.getNumber("WEBGL_VERSION")));Ft.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ft.getNumber("WEBGL_VERSION");return n===0?0:$dt(n)});Ft.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ft.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!hA());Ft.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Ndt(Ft.getNumber("WEBGL_VERSION")));Ft.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ft.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ft.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ft.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Rdt(Ft.getNumber("WEBGL_VERSION")));Ft.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Ddt(Ft.getNumber("WEBGL_VERSION")));Ft.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ft.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ft.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ft.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>hA()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ft.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ft.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ft.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ft.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ft.registerFlag("WEBGL_EXP_CONV",()=>!1);Ft.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ft.getBool("IS_TEST"));Ft.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ft.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ft.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ft.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cs(){let n,t,e,s,i,r,o,a,c,l;return rt().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",s="in",i="texture",r="outputColor",o="out vec4 outputColor;",a=rt().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",s="varying",i="texture2D",r="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:s,texture2D:i,output:r,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xc(n,t,e="index"){const s=Wt(t);return s.map((i,r)=>{const o=`int ${n[r]} = ${e} / ${i}`,a=r===s.length-1?`int ${n[r+1]} = ${e} - ${n[r]} * ${i}`:`index -= ${n[r]} * ${i}`;return`${o}; ${a};`}).join("")}function Vx(n,t,e="index"){const s=Wt(t);return s.map((i,r)=>{const o=`int ${n[r]} = ${e} / outShapeStrides[${r}]`,a=r===s.length-1?`int ${n[r+1]} = ${e} - ${n[r]} * outShapeStrides[${r}]`:`index -= ${n[r]} * outShapeStrides[${r}]`;return`${o}; ${a};`}).join("")}function Odt(n,t){const e=n.length,s=n.map(r=>`${t}[${r}]`),i=new Array(e-1);i[e-2]=s[e-1];for(let r=e-3;r>=0;--r)i[r]=`(${i[r+1]} * ${s[r+1]})`;return i}function Pdt(n,t,e="index"){const s=n.map((r,o)=>o),i=Odt(s,t);return i.map((r,o)=>{const a=`int ${n[o]} = ${e} / ${i[o]}`,c=o===i.length-1?`int ${n[o+1]} = ${e} - ${n[o]} * ${i[o]}`:`index -= ${n[o]} * ${i[o]}`;return`${a}; ${c};`}).join("")}function tk(n){const t=Wt(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function ek(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const gM=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:mM}=ket;function Fdt(n,t,e){const s=[];if(n.forEach(g=>{const m=ut(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${m>1?`[${m}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),e.enableShapeUniforms){const{uniformShape:x}=nk(e.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(x.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),e.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const i=s.join(`
`),r=n.map(g=>Mdt(g,t,e.packedInputs,e.enableShapeUniforms)).join(`
`),o=t.texShape,a=Cs(),c=zdt(a);let l,u,h=Udt(a);return t.isPacked?(l=Ldt(t.logicalShape,o,e.enableShapeUniforms),u=Vdt(a)):(l=Bdt(t.logicalShape,o,e.enableShapeUniforms),u=Wdt(a)),e.packedInputs&&(h+=qdt),[h,c,u,i,l,r,e.userCode].join(`
`)}function gu(n,t=!1){const e=n.shapeInfo.logicalShape;switch(e.length){case 0:return rft(n,t);case 1:return aft(n,t);case 2:return lft(n,t);case 3:return hft(n,t);case 4:return fft(n,t);case 5:return pft(n);case 6:return gft(n);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function bM(n,t){switch(n.shapeInfo.logicalShape.length){case 0:return ift(n);case 1:return oft(n,t);case 2:return cft(n,t);case 3:return uft(n,t);default:return dft(n,t)}}function Mdt(n,t,e=!1,s){let i="";e?i+=bM(n,s):i+=gu(n,s);const r=n.shapeInfo.logicalShape,o=t.logicalShape;return r.length<=o.length&&(e?i+=mft(n,t):i+=bft(n,t)),i}function Ldt(n,t,e){switch(n.length){case 0:return xM();case 1:return Kdt(n,t,e);case 2:return nft(n,t,e);case 3:return Ydt(n,t,e);default:return Zdt(n,t,e)}}function Bdt(n,t,e){switch(n.length){case 0:return xM();case 1:return Xdt(n,t,e);case 2:return sft(n,t,e);case 3:return Jdt(n,t,e);case 4:return Qdt(n,t,e);case 5:return tft(n,t);case 6:return eft(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function zdt(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function Wdt(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function Vdt(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function Udt(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Hdt}
    ${Gdt}
    ${jdt}
  `}const Hdt=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Gdt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jdt=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,qdt=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function xM(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Kdt(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return s[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function Xdt(n,t,e){return t[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function Ydt(n,t,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(n[2]/2),r=i*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function Jdt(n,t,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Vx(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Xc(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Zdt(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(n[n.length-1]/2),r=i*Math.ceil(n[n.length-2]/2);let o=r,a="",c="b, r, c";for(let l=2;l<n.length-1;l++)o*=n[n.length-l-1],a=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+a,c=`b${l}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${n.length}(${c});
    }
  `}function Qdt(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Vx(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Xc(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function tft(n,t){const e=Xc(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function eft(n,t){const e=Xc(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function nft(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(De(n,t))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const i=Math.ceil(n[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function sft(n,t,e){return De(n,t)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Yc(n){return`offset${n}`}function ift(n){const t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Cs();return`
    vec4 ${e}() {
      return ${s.texture2D}(${t}, halfCR);
    }
  `}function rft(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${e};}`;const[i,r]=n.shapeInfo.texShape;if(i===1&&r===1)return`
      float ${s}() {
        return sampleTexture(${e}, halfCR);
      }
    `;const o=Yc(e);if(t)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${o});
      return sampleTexture(${e}, uv);
    }
  `;const[a,c]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${o});
      return sampleTexture(${e}, uv);
    }
  `}function oft(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),i=n.shapeInfo.texShape,r=Cs();if(t)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${r.texture2D}(${e}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${r.texture2D}(${e}, uv);
    }
  `}function aft(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${mu(n)}
      }
    `;const i=n.shapeInfo.texShape,r=i[0],o=i[1];if(o===1&&r===1)return`
      float ${s}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;const a=Yc(e);return o===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${r}.0);
        return sampleTexture(${e}, uv);
      }
    `:r===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:t?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${a});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${r}, ${o}, index + ${a});
      return sampleTexture(${e}, uv);
    }
  `}function cft(n,t){const e=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n.shapeInfo.texShape,o=r[0],a=r[1],c=Cs();if(r!=null&&De(e,r))return t?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(t)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],u=Math.ceil(e[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function lft(n,t){const e=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n.shapeInfo.texShape;if(r!=null&&De(e,r)){if(t)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=r[0],g=r[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=ka(e),c=o;if(c.length<e.length){const f=bu(n,c),g=["row","col"];return`
      ${gu(f,t)}
      float ${i}(int row, int col) {
        return ${i}(${xu(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${mu(n)}
      }
    `;const l=r[0],u=r[1],h=Yc(s);return u===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:t?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function uft(n,t){const e=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(e[0]===1){const f=e.slice(1),g=[1,2],m=bu(n,f),x=["b","row","col"];return`
        ${bM(m,t)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${xu(x,g)});
        }
      `}const a=Cs();if(t)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const c=o[0],l=o[1],u=Math.ceil(e[2]/2),h=u*Math.ceil(e[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function hft(n,t){const e=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=e[1]*e[2],o=e[2],{newShape:a,keptDims:c}=ka(e),l=a;if(l.length<e.length){const x=bu(n,l),b=["row","col","depth"];return`
        ${gu(x,t)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${xu(b,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${r}, ${o}, 1)));
        ${mu(n)}
      }
    `;const u=n.shapeInfo.texShape,h=u[0],f=u[1],g=n.shapeInfo.flatOffset;if(f===r&&g==null)return t?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===o&&g==null)return t?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const m=Yc(s);return t?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r} + col * ${o} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function dft(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),i=Cs();if(t)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${e}, uv);
    }
  `;const r=n.shapeInfo.logicalShape,o=r.length,a=n.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],u=c[1],h=Math.ceil(r[o-1]/2);let f=h*Math.ceil(r[o-2]/2),g="int b, int row, int col",m=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let x=2;x<o-1;x++)g=`int b${x}, `+g,f*=r[o-x-1],m=`b${x} * ${f} + `+m;return`
    vec4 ${s}(${g}) {
      int index = ${m};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${l});
      return ${i.texture2D}(${e}, uv);
    }
  `}function fft(n,t){const e=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=e[3],o=e[2]*r,a=e[1]*o,{newShape:c,keptDims:l}=ka(e);if(c.length<e.length){const v=bu(n,c),k=["row","col","depth","depth2"];return`
      ${gu(v,t)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${xu(k,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${r}, 1)));
        ${mu(n)}
      }
    `;const u=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],g=h[1],m=`int stride2 = ${s}Shape[3];`,x=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&u==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${m}
        ${x}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===r&&u==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Yc(s);return t?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${x}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${r} + depth2;
      vec2 uv = uvFromFlat(${f}, ${g}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function pft(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),i=t[4],r=t[3]*i,o=t[2]*r,a=t[1]*o,{newShape:c,keptDims:l}=ka(t);if(c.length<t.length){const x=bu(n,c),b=["row","col","depth","depth2","depth3"];return`
      ${gu(x)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${xu(b,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${r}, ${i})) +
          depth3;
        ${mu(n)}
      }
    `;const u=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],g=h[1];if(g===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${r}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(g===i&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;const m=Yc(e);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${r} +
          depth2 * ${i} + depth3 + ${m};
      vec2 uv = uvFromFlat(${f}, ${g}, index);
      return sampleTexture(${e}, uv);
    }
  `}function gft(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:i,keptDims:r}=ka(t);if(i.length<t.length){const b=bu(n,i),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${gu(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${xu(y,r)});
      }
    `}const o=t[5],a=t[4]*o,c=t[3]*a,l=t[2]*c,u=t[1]*l;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${mu(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,g=f[0],m=f[1];if(m===u&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${g}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${g}.0);
        return sampleTexture(${e}, uv);
      }
    `;const x=Yc(e);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${x};
      vec2 uv = uvFromFlat(${g}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function mu(n){const t=n.name,e=ut(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function mft(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),i="get"+s+"AtOutCoords",r=n.shapeInfo.logicalShape.length,o=t.logicalShape.length,a=mM(n.shapeInfo.logicalShape,t.logicalShape),c=We(o),l=o-r;let u;const h=["x","y","z","w","u","v"];r===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(v=>`coords.${h[v+l]} = 0;`).join(`
`);let f="";o<2&&r>0?f="coords":f=n.shapeInfo.logicalShape.map((v,k)=>`coords.${h[k+l]}`).join(", ");let g="return outputValue;";const x=ut(n.shapeInfo.logicalShape)===1,y=ut(t.logicalShape)===1;if(r===1&&!x&&!y)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(x&&!y)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const v=r-2,k=r-1;a.indexOf(v)>-1&&a.indexOf(k)>-1?g="return vec4(outputValue.x);":a.indexOf(v)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(k)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${c} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${f});
      ${g}
    }
  `}function bft(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),i="get"+s+"AtOutCoords",r=t.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!n.shapeInfo.isUniform&&a===c&&n.shapeInfo.flatOffset==null&&De(o,r))return`
      float ${i}() {
        return sampleTexture(${e}, resultUV);
      }
    `;const l=We(c),u=mM(n.shapeInfo.logicalShape,t.logicalShape),h=c-a;let f;const g=["x","y","z","w","u","v"];a===0?f="":c<2&&u.length>=1?f="coords = 0;":f=u.map(x=>`coords.${g[x+h]} = 0;`).join(`
`);let m="";return c<2&&a>0?m="coords":m=n.shapeInfo.logicalShape.map((x,b)=>`coords.${g[b+h]}`).join(", "),`
    float ${i}() {
      ${l} coords = getOutputCoords();
      ${f}
      return get${s}(${m});
    }
  `}function We(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function nk(n,t,e){const{newShape:s,keptDims:i}=ka(t),r=t.length,o=n&&r===3&&t[0]===1,a=o?t.slice(1):s,c=!n&&r>1&&!De(t,e)&&s.length<r||o;return{useSqueezeShape:c,uniformShape:c?a:t,keptDims:i}}function bu(n,t){const e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function xu(n,t){return t.map(e=>n[e]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xft(n,t,e,s){const i=e.map((u,h)=>{const f={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(f.flatOffset=u.texData.slice.flatOffset),{name:t.variableNames[h],shapeInfo:f}}),r=i.map(u=>u.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=Fdt(i,o,t),c=hdt(n.gl,a),l=n.createProgram(c);return rt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:r,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:t,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:r,outShapeInfo:o},yM(n,t,l)))}function yM(n,t,e){const s=[],i=[];let r,o,a,c=null,l=null;l=n.getUniformLocation(e,"NAN",!1),rt().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(e,"INFINITY",!1));const u=!1;for(const h of t.variableNames){const f={name:h,uniform:n.getUniformLocation(e,h,u),offset:n.getUniformLocation(e,`offset${h}`,u)};t.enableShapeUniforms&&(f.shape=n.getUniformLocation(e,`${h}Shape`,u),f.texShape=n.getUniformLocation(e,`${h}TexShape`,u)),s.push(f)}if(t.enableShapeUniforms&&(r=n.getUniformLocation(e,"outShape",u),a=n.getUniformLocation(e,"outShapeStrides",u),o=n.getUniformLocation(e,"outTexShape",u)),t.customUniforms)for(const h of t.customUniforms)i.push(n.getUniformLocation(e,h.name,u));return{variablesLocations:s,customUniformLocations:i,infLoc:c,nanLoc:l,outShapeLocation:r,outShapeStridesLocation:a,outTexShapeLocation:o}}function k$(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,s)=>{const i=e.logicalShape,r=t[s],o=r.shape;if(!De(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(e.isUniform&&r.isUniform)return;const a=e.texShape,c=r.isUniform?null:r.texData.texShape;if(!De(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function yft(n,t,e,s,i){t.program.enableShapeUniforms||(k$(t.inShapeInfos,e),k$([t.outShapeInfo],[s]));const r=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(r.texture,o[0],o[1]):n.setOutputMatrixTexture(r.texture,o[0],o[1]),n.setProgram(t.webGLProgram),n.bindVertexArray(t.webGLProgram.vao),rt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN);for(let c=0;c<e.length;++c){const l=e[c],{uniform:u,offset:h,shape:f,texShape:g}=t.variablesLocations[c];if(f){const{uniformShape:m}=nk(t.program.packedInputs,l.shape,l.texData.texShape);switch(m.length){case 1:n.gl.uniform1iv(f,new Int32Array(m));break;case 2:n.gl.uniform2iv(f,new Int32Array(m));break;case 3:n.gl.uniform3iv(f,new Int32Array(m));break;case 4:n.gl.uniform4iv(f,new Int32Array(m));break}}if(g&&n.gl.uniform2i(g,l.texData.texShape[0],l.texData.texShape[1]),u!=null){if(l.isUniform){if(ut(l.shape)<2)n.gl.uniform1f(u,l.uniformValues[0]);else{let m=l.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),n.gl.uniform1fv(u,m)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,u,c)}}const a=t.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(t.outShapeStridesLocation){const c=Wt(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(c));break}}if(t.outTexShapeLocation&&n.gl.uniform2i(t.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),t.program.customUniforms&&i)for(let c=0;c<t.program.customUniforms.length;++c){const l=t.program.customUniforms[c],u=t.customUniformLocations[c],h=i[c];if(l.type==="float")n.gl.uniform1fv(u,h);else if(l.type==="vec2")n.gl.uniform2fv(u,h);else if(l.type==="vec3")n.gl.uniform3fv(u,h);else if(l.type==="vec4")n.gl.uniform4fv(u,h);else if(l.type==="int")n.gl.uniform1iv(u,h);else if(l.type==="ivec2")n.gl.uniform2iv(u,h);else if(l.type==="ivec3")n.gl.uniform3iv(u,h);else if(l.type==="ivec4")n.gl.uniform4iv(u,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function wft(n,t,e){let s="";t.concat(e).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const c=o.texData.texShape,{useSqueezeShape:l,uniformShape:u,keptDims:h}=nk(n.packedInputs,o.shape,c);let f="",g="",m="";if(u.length===1&&n.packedInputs){const _=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];f=`${_[0]>1}_${_[1]>1}`}else if(u.length===2&&!n.packedInputs)g=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!n.packedInputs){const _=Wt(u);m=`${_[0]===c[1]}_${_[_.length-1]===c[1]}`}const x=o.shape.length,b=u.length===2&&De(o.shape,c),y=ut(o.shape)===1,v=ql(o.shape,e.shape),k=!n.packedInputs&&x===e.shape.length&&De(c,e.texData.texShape),I=n.packedInputs||u.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${x}_${k}_${l?h:""}_${u.length}_${y}_${v}_${b}_${f}_${g}_${m}_${I}_${a}`}else{const c=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${c}_${a}`}});const i=n.userCode;let r=n.constructor.name;return r+="_"+s+"_"+i+`${rt().getNumber("WEBGL_VERSION")}`,r}function os(n){return rt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vft{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=Cs();this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Vx(["r","c","d"],t):Xc(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cft{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=Cs();this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Vx(["r","c","d"],t):Xc(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ift{constructor(t){this.variableNames=["A"],this.outTexUsage=ci.DOWNLOAD;const e=Cs();this.outputShape=t,this.userCode=`
      ${gM}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kft{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ci.DOWNLOAD;const e=Cs();this.outputShape=t,this.userCode=`
      ${gM}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sft={R:0,G:1,B:2,A:3};class S${constructor(t,e=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=Cs();this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length);let r="result";e&&(r="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const c=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Sft[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?ek():tk(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${o}
        }
        ${i.output} = vec4(${r}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ft{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Cs();this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length);let i="",r="result";e&&(r="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const c=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?ek():tk(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${s.output} = ${r};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tft(n){const t=Cs(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return udt(n,e)}function Eft(n){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return gdt(n,t)}function $ft(n){const t=new Uint16Array([0,1,2,2,1,3]);return mdt(n,t)}function Lf(n,t,e,s,i,r){xdt(t,e);const o=bdt(n),a=n.TEXTURE_2D;return Nt(n,()=>n.bindTexture(a,o)),Nt(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Nt(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Nt(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Nt(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),rt().getNumber("WEBGL_VERSION")===1?Nt(n,()=>n.texImage2D(a,0,s,t,e,0,i,r,null)):Nt(n,()=>n.texStorage2D(a,1,s,t,e)),Nt(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[e,t]}}function wM(n){return n.internalFormatFloat}function Nft(n,t,e,s){const[i,r]=Ff(t,e);return Lf(n,i,r,wM(s),s.textureFormatFloat,n.FLOAT)}function vM(n){return n.internalFormatHalfFloat}function Rft(n,t,e,s){const[i,r]=Ff(t,e);return Lf(n,i,r,vM(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function CM(n){return n.downloadTextureFormat}function Aft(n,t,e,s){const[i,r]=Ff(t,e);return Lf(n,i,r,CM(s),n.RGBA,n.UNSIGNED_BYTE)}function IM(n){return n.internalFormatPackedFloat}function Dft(n,t,e,s){const[i,r]=pu(t,e);return Lf(n,i,r,IM(s),n.RGBA,n.FLOAT)}function kM(n){return n.internalFormatPackedHalfFloat}function Oft(n,t,e,s){const[i,r]=pu(t,e);return Lf(n,i,r,kM(s),n.RGBA,s.textureTypeHalfFloat)}function Pft(n,t,e){return Nt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),v$(n,t,"clipSpacePos",e,3,20,0)&&v$(n,t,"uv",e,2,20,12)}function Fft(n,t,e,s,i,r){Nt(n,()=>n.bindTexture(n.TEXTURE_2D,t));let o,a,c;i instanceof Uint8Array?(o=new Uint8Array(e*s*4),a=n.UNSIGNED_BYTE,c=n.RGBA):(o=new Float32Array(e*s*4),a=n.FLOAT,c=r.internalFormatPackedFloat),o.set(i),rt().getNumber("WEBGL_VERSION")===2?Nt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e,s,n.RGBA,a,o)):Nt(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,e,s,0,n.RGBA,a,o)),Nt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Mft(n,t,e){Nt(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?rt().getNumber("WEBGL_VERSION")===2?Nt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e.data)):Nt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):rt().getNumber("WEBGL_VERSION")===2?Nt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):Nt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),Nt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Lft(n,t,e,s){const i=n.createBuffer();Nt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,i));const a=4*4*t*e;return Nt(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Nt(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),Nt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),i}function Bft(n,t,e){const s=n,i=new Float32Array(e);return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function zft(n,t,e,s){const[i,r]=Ff(t,e),o=4,a=new Uint8Array(sdt(t*e,o));return Nt(n,()=>n.readPixels(0,0,i,r,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Wft(n,t,e,s,i,r,o,a){const c=n,l=new Float32Array(idt(r,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function Vft(n,t,e){const s=new Float32Array(t*e*4);return Nt(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bw{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=rt().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,tdt(e,t)):this.gl=lr(e),t=this.gl,rt().getNumber("WEBGL_VERSION")===2){const r=t;this.createVertexArray=()=>Nt(r,()=>r.createVertexArray()),this.bindVertexArray=o=>Nt(r,()=>r.bindVertexArray(o)),this.deleteVertexArray=o=>Nt(r,()=>r.deleteVertexArray(o)),this.getVertexArray=()=>Nt(r,()=>r.getParameter(r.VERTEX_ARRAY_BINDING))}else if(t!=null){const r=t.getExtension("OES_vertex_array_object");if(r==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Nt(t,()=>r.createVertexArrayOES()),this.bindVertexArray=o=>Nt(t,()=>r.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Nt(t,()=>r.deleteVertexArrayOES(o)),this.getVertexArray=()=>Nt(t,()=>t.getParameter(r.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),rt().getNumber("WEBGL_VERSION")===1){const r="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Rg(this.gl,r),Oi(this.gl,o))this.textureHalfFloatExtension=Rg(this.gl,o);else if(rt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Oi(this.gl,i))this.colorBufferHalfFloatExtension=Rg(this.gl,i);else if(rt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Oi(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Oi(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Eft(this.gl),this.indexBuffer=$ft(this.gl),this.framebuffer=ydt(this.gl),this.textureConfig=QI(this.gl,this.textureHalfFloatExtension)}get debug(){return rt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;Nt(t,()=>t.finish()),Nt(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),Nt(t,()=>t.deleteFramebuffer(this.framebuffer)),Nt(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),Nt(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),Nt(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),Nft(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),Rft(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),Aft(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),Mft(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,s,i){this.throwIfDisposed(),Fft(this.gl,t,e,s,i,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),Oft(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),Dft(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(C$(this.gl,this.framebuffer),this.outputTexture=null),Nt(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,s){return this.downloadMatrixDriver(t,()=>zft(this.gl,e,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,s,i,r,o){return Wft(this.gl,t,e,s,i,r,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return Bft(this.gl,t,e)}createBufferFromTexture(t,e,s){this.bindTextureToFrameBuffer(t);const i=Lft(this.gl,e,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,s;if(rt().getBool("WEBGL_FENCE_API_ENABLED")){const i=t,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{const o=i.clientWaitSync(r,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},e=r}else rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(e,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:e,isFencePassed:s}}downloadMatrixFromPackedTexture(t,e,s){return this.downloadMatrixDriver(t,()=>Vft(this.gl,e,s))}createProgram(t){this.throwIfDisposed();const e=this.gl;this.vertexShader==null&&(this.vertexShader=Tft(e));const s=fdt(e);Nt(e,()=>e.attachShader(s,this.vertexShader)),Nt(e,()=>e.attachShader(s,t)),pdt(e,s);const i=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&fw(e,i),i}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const e=this.gl;Nt(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Pft(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(Nt(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&fw(this.gl,this.program),Nt(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,s=!0){return this.throwIfDisposed(),s?vdt(this.gl,t,e):Cdt(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),Nt(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,s){this.throwIfDisposed(),this.throwIfNoProgram(),Idt(this.gl,t,e,s)}setOutputMatrixTexture(t,e,s){this.setOutputMatrixTextureDriver(t,s,e)}setOutputPackedMatrixTexture(t,e,s){this.throwIfDisposed();const[i,r]=pu(e,s);this.setOutputMatrixTextureDriver(t,i,r)}setOutputMatrixWriteRegion(t,e,s,i){this.setOutputMatrixWriteRegionDriver(s,t,i,e)}setOutputPackedMatrixWriteRegion(t,e,s,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&fw(this.gl,this.program),Ag(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Nt(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Nt(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Rg(this.gl,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),r=s.createQuery();return s.beginQuery(i.TIME_ELAPSED_EXT,r),r}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const e=this.gl,s=this.getQueryTimerExtensionWebGL2();e.endQuery(s.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await dE(()=>this.disposed||this.isQueryAvailable(t,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(e===0)return null;if(e===2){const s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),r=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),r&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),i=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){const t=Uft(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){const{resolveFn:s}=this.itemsToPoll[e];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in rt().platform&&(s=rt().platform.setTimeoutCustom.bind(rt().platform)),dE(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),pw(this.gl,t,this.framebuffer),this.debug&&Ag(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(pw(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ag(this.gl)):C$(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const s=e();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,e,s){this.throwIfDisposed();const i=this.gl;pw(i,t,this.framebuffer),this.debug&&Ag(i),this.outputTexture=t,Nt(i,()=>i.viewport(0,0,e,s)),Nt(i,()=>i.scissor(0,0,e,s))}setOutputMatrixWriteRegionDriver(t,e,s,i){this.throwIfDisposed(),Nt(this.gl,()=>this.gl.scissor(t,e,s,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Uft(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Hft,bincountImpl:SM,bincountReduceImpl:Gft,bitwiseAndImpl:jft,castImpl:qft,ceilImpl:Kft,concatImpl:Xft,equalImpl:Yft,expImpl:Jft,expm1Impl:Zft,floorImpl:Qft,gatherNdImpl:tpt,gatherV2Impl:ept,greaterImpl:npt,greaterEqualImpl:spt,lessImpl:ipt,lessEqualImpl:rpt,linSpaceImpl:opt,logImpl:apt,maxImpl:cpt,maximumImpl:lpt,minimumImpl:upt,multiplyImpl:hpt,negImpl:dpt,notEqualImpl:fpt,prodImpl:ppt,raggedGatherImpl:gpt,raggedRangeImpl:mpt,raggedTensorToTensorImpl:bpt,rangeImpl:xpt,rsqrtImpl:ypt,scatterImpl:wpt,sigmoidImpl:vpt,simpleAbsImpl:_M,sliceImpl:Cpt,sparseFillEmptyRowsImpl:Ipt,sparseReshapeImpl:kpt,sparseSegmentReductionImpl:TM,sqrtImpl:Spt,staticRegexReplaceImpl:_pt,stridedSliceImpl:Tpt,stringNGramsImpl:Ept,stringSplitImpl:$pt,stringToHashBucketFastImpl:Npt,subImpl:Rpt,tileImpl:Apt,topKImpl:Dpt,transposeImpl:sk,uniqueImpl:Opt}=Mot;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EM(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function bs(n,t){return t===1?[n]:EM(n,t)}function Ppt(n,t){if(n===1)return"rc";let e="";for(let s=0;s<n;s++)e+=t[s],s<n-1&&(e+=",");return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fpt{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=os(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const e=bs("rc",this.rank),s=We(this.rank),i=this.getOutOfBoundsCondition(e),r=this.getSetup(e),o=this.getOutput(e);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${r}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(t){const e=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let r=`${s===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)r=`${t[t.length-1-o]},`+r;e.push(r)}return e}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let s=this.rank-2;s<this.rank;s++)e+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(e+="||");return e}getSetup(t){if(this.rank===1)return"";const e=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${i};
    `}getOutput(t){const e=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $M{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length);let s="";for(let i=0;i<4;i++){let r="thisRC = rc;";i%2===1&&(r+="thisRC.z += 1;"),i>1&&(r+="thisRC.y += 1;"),s+=`
        ${r}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${Mpt(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?ek():tk(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}function Mpt(n,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?Pdt(["r","c","d"],"inputShape"):Xc(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lpt{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,s){const i=T$(e,s),r=E$(t,i,s);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const o=_$(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const c=this.freeTextures[r].pop();return this.usedTextures[r].push(c),c}let a;return i===Hn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Hn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Hn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Hn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Hn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(t,e,s,i){if(this.freeTextures==null)return;const r=T$(s,i),o=E$(e,r,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=_$(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,i),c=rt().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],u=l&&l.indexOf(t);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Bpt(n,t){const e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;if(t===e.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function _$(n,t,e,s,i){const r=zpt(t,s);let o;if(i){const[c,l]=pu(n[0],n[1]);o=c*l}else{const[c,l]=Ff(n[0],n[1]);o=c*l}const a=Bpt(e,r);return o*a}function zpt(n,t){switch(n){case Hn.PACKED_2X2_FLOAT32:return IM(t);case Hn.PACKED_2X2_FLOAT16:return kM(t);case Hn.UNPACKED_FLOAT32:return wM(t);case Hn.UNPACKED_FLOAT16:return vM(t);case Hn.PACKED_4X1_UNSIGNED_BYTE:return CM(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function Wpt(n){return rt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Hn.PACKED_2X2_FLOAT32:Hn.UNPACKED_FLOAT32:n?Hn.PACKED_2X2_FLOAT16:Hn.UNPACKED_FLOAT16}function T$(n,t){if(n===ci.UPLOAD)return Hn.PACKED_2X2_FLOAT32;if(n===ci.RENDER||n==null)return Wpt(t);if(n===ci.DOWNLOAD||n===ci.PIXELS)return Hn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function E$(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tr{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const zi="if (isnan(x)) return x;",Vpt="return x;",$$="return abs(x);",Upt="return (x >= 0.0) ? x : (exp(x) - 1.0);",Hpt=zi+`
  return (x < 0.0) ? 0.0 : x;
`,Gpt=zi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Zo="return x;",jpt="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qpt="return x;",Kpt=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Xpt=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ypt=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Jpt="return 1.0 / (1.0 + exp(-1.0 * x));";class oa{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zpt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length);const e=t.length,s=bs("rc",e),i=We(e),r=Ppt(e,s),o=s.slice(-2),a=e<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${r});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qpt=tD,tgt=1e-7,egt=1e-4,Pg={};function ngt(n){return n in Pg||(Pg[n]={}),Pg[n]}const sgt=rt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),igt=600;function rgt(){return rt().global.screen==null?1024:rt().global.screen.height*rt().global.screen.width*window.devicePixelRatio*igt/1024/1024}class Ux extends y1{nextDataId(){return Ux.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!rt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(t!=null){if(t instanceof bw)e=t;else{const s=lr(rt().getNumber("WEBGL_VERSION"),t);e=new bw(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=lr(rt().getNumber("WEBGL_VERSION"));e=new bw(s),this.binaryCache=ngt(rt().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Lpt(this.gpgpu),this.numMBBeforeWarning=rgt(),this.texData=new yR(this,Cr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,s,i,r,o){const a=this.makeTensorInfo(e,s),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,r]},c.texShape=[i,r];const l=Dg(e),u=new S$(l,!1,o),h=this.runWebGLProgram(u,[a],s,[[i,r]]);return h.shape=e,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(t,e,s){if((rt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||rt().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:e,dtype:s,values:t,usage:ci.UPLOAD,refCount:1}),i}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--}}move(t,e,s,i,r){if(rt().getBool("DEBUG")&&this.checkNumericalProblems(e),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:i,values:e,usage:ci.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:s,dtype:i,complexTensorInfos:r,slice:o,shape:a,isPacked:c}=e;if(o!=null){let f;c?f=new oa(a,Zo):f=new Tr(a,Zo);const g=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:i}],i),m=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),m}if(s!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return s;const l=this.activeTimers!=null;let u;l&&(u=Es());let h;if(i==="complex64"){const f=this.readSync(r.real.dataId),g=this.readSync(r.imag.dataId);h=No(f,g)}else h=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=Es()-u),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){const m=this.pendingRead.get(t);return new Promise(x=>m.push(x))}const e=this.texData.get(t),{values:s,shape:i,slice:r,dtype:o,complexTensorInfos:a,isPacked:c}=e;if(r!=null){let m;c?m=new oa(i,Zo):m=new Tr(i,Zo);const x=this.runWebGLProgram(m,[{dataId:t,shape:i,dtype:o}],o),b=this.read(x.dataId);return this.disposeIntermediateTensorInfo(x),b}if(s!=null)return this.convertAndCacheOnCPU(t);if(rt().getBool("DEBUG")&&!rt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&rt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,u;if(o!=="complex64"&&rt().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const m=this.texData.get(u.dataId);l=this.gpgpu.createBufferFromTexture(m.texture.texture,...Ng(i))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),x=m[0],b=m[1];h=No(x,b)}else if(l==null)h=this.getValuesFromTexture(t);else{const m=ut(i);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,m)}if(u!=null&&this.disposeIntermediateTensorInfo(u),l!=null){const m=this.gpgpu.gl;Nt(m,()=>m.deleteBuffer(l))}const f=this.convertAndCacheOnCPU(t,h),g=this.pendingRead.get(t);return this.pendingRead.delete(t),g.forEach(m=>m(f)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Cr().removeDataId(t,this),this.pendingDeletes--),f}readToGPU(t,e={}){const s=this.texData.get(t),{values:i,shape:r,slice:o,dtype:a,isPacked:c,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;c?g=new oa(r,Zo):g=new Tr(r,Zo);const m=this.runWebGLProgram(g,[{dataId:t,shape:r,dtype:a}],a),x=this.readToGPU(m,e);return this.disposeIntermediateTensorInfo(m),x}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(t,e.customTexShape),h=Cr().makeTensorFromTensorInfo(u),f=this.texData.get(u.dataId);return Object.assign({tensorRef:h},f.texture)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(i=>ma(i));return ce(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ce(t.shape,t.dtype,e)}checkNumericalProblems(t){if(t!=null)for(let e=0;e<t.length;e++){const s=t[e];if(!cdt(s))throw rt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:e,dtype:s,isPacked:i}=this.texData.get(t),r=ut(e);if(rt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(t),g=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...Ng(e)).subarray(0,r);return this.disposeIntermediateTensorInfo(f),m}const o=rt().getBool("WEBGL_PACK")&&i===!0,a=o?Dg(e):e,c=o?new kft(a):new Ift(a),l=this.runWebGLProgram(c,[{shape:a,dtype:s,dataId:t}],"float32"),u=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,s=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,t();const r=Tc(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),o=Tc(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=e,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(r);a.kernelMs=H7(c),a.getExtraProfileInfo=()=>c.map((l,u)=>({name:o[u],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Es(),endMs:null}}endTimer(t){return rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Es(),t)}async getQueryTime(t){if(rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,e),this.disposeData(s.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:s,texShape:i,usage:r,isPacked:o,slice:a}=this.texData.get(t),c=a&&a.origDataId||t,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),e!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(e,i,r,o)));const u=this.texData.get(t);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=sgt){return rt().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&ut(s.shape)<e)}getGPGPUContext(){return this.gpgpu}where(t){ai("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return Qpt(t.shape,e)}packedUnaryOp(t,e,s){const i=new oa(t.shape,e),r=this.compileAndRun(i,[t],s);return Cr().makeTensorFromTensorInfo(r)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const i=_M(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,i)}if(rt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$$,t.dtype);const e=new Tr(t.shape,$$),s=this.compileAndRun(e,[t]);return Cr().makeTensorFromTensorInfo(s)}makeTensorInfo(t,e,s){let i;if(e==="string"&&s!=null&&s.length>0&&Cd(s[0])){const r=s.map(o=>ha(o));i=this.write(r,t,e)}else i=this.write(s,t,e);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:e}}makeOutput(t,e,s){return Cr().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,s),this)}unpackTensor(t){const e=new Zpt(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new Fpt(t.shape),s=!0;return this.runWebGLProgram(e,[t],t.dtype,null,s)}packedReshape(t,e){const s=[tu(t.shape),...eu(t.shape)],i={dtype:t.dtype,shape:s,dataId:t.dataId},r=[tu(e),...eu(e)],o=new $M(r,s),a=!0,c=[s],l=this.runWebGLProgram(o,[i],t.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}decode(t,e){const s=this.texData.get(t),{isPacked:i,shape:r,dtype:o}=s;if(e!=null){const f=ut(r),g=e[0]*e[1]*4;P(f<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Dg(r);let c;i?c=new Cft(a):c=new vft(a);const l=!0,u=[e??Ng(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:o,dataId:t}],o,u,l,e);return{dtype:o,shape:r,dataId:h.dataId}}runWebGLProgram(t,e,s,i,r=!1,o){const a=this.makeTensorInfo(t.outputShape,s),c=this.texData.get(a.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===rd.DENSE){const y=o??Ng(t.outputShape);c.texShape=y.map(v=>v*2)}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),ut(a.shape)===0)return c.values=es(a.dtype,0),a;const l=[],u=e.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let v=this.texData.get(y.dataId);if(v.texture==null){if(!t.packedInputs&&ut(y.shape)<=rt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:v.values};t.packedInputs&&(v.isPacked=!0,v.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!v.isPacked!=!!t.packedInputs)y=v.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),v=this.texData.get(y.dataId);else if(v.isPacked&&!Xm(v.shape,y.shape)){const k=y,I=y.shape;y.shape=v.shape,y=this.packedReshape(y,I),l.push(y),v=this.texData.get(y.dataId),k.shape=I}return{shape:y.shape,texData:v,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},f=wft(t,u,h),g=this.getAndSaveBinary(f,()=>xft(this.gpgpu,t,u,h)),m=this.activeTimers!=null;let x;m&&(x=this.startTimer()),rt().get("ENGINE_COMPILE_ONLY")||yft(this.gpgpu,g,u,h,i),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(x=this.endTimer(x),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(x)}));const b=rt().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const y=Es();y-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!rt().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&r===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(t,e,s,i,r=!1){return s=s||e[0].dtype,this.runWebGLProgram(t,e,s,i,r)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(rt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=nt(()=>{if(!rt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=rt().getBool("DEBUG");rt().set("DEBUG",!1);const e=this.abs(Ae(1e-8)).dataSync()[0];if(rt().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?tgt:egt}uploadToGPU(t){const e=this.texData.get(t),{shape:s,dtype:i,values:r,texture:o,usage:a,isPacked:c}=e;if(o!=null)return;const l=this.activeTimers!=null;let u;l&&(u=Es());let h=e.texShape;if(h==null&&(h=_dt(s,c),e.texShape=h),r!=null){const f=Dg(s);let g,m=h[1],x=h[0];const b=r instanceof Uint8Array||r instanceof Uint8ClampedArray;(c||!b)&&([m,x]=pu(h[0],h[1])),c?g=new _ft(f,b):g=new S$(f,b);const y=b?[x,m]:h,v=this.makeTensorInfo(y,i),k=this.texData.get(v.dataId);b?k.usage=ci.PIXELS:k.usage=ci.UPLOAD,k.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),m,x,r);const I=[[x,m]],_=!0,$=this.runWebGLProgram(g,[v],i,I,_),R=this.texData.get($.dataId);e.texShape=R.texShape,e.isPacked=R.isPacked,e.usage=R.usage,rt().get("ENGINE_COMPILE_ONLY")?this.disposeData($.dataId):(e.texture=R.texture,e.values=null,this.texData.delete($.dataId)),this.disposeIntermediateTensorInfo(v),l&&(this.uploadWaitMs+=Es()-u)}else{const f=this.acquireTexture(h,a,i,c);e.texture=f}}convertAndCacheOnCPU(t,e){const s=this.texData.get(t),{dtype:i}=s;return e!=null&&(s.values=ogt(e,i)),s.values}acquireTexture(t,e,s,i){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const r=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${r} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,i)}computeBytes(t,e){return t[0]*t[1]*km(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}else{for(const[,e]of Object.entries(this.binaryCache)){const s=new Promise(i=>{try{this.checkCompletion_(e),i(!0)}catch(r){throw r}});t.push(s)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await bD(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(pM(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:e,customUniformLocations:s,infLoc:i,nanLoc:r,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:c}=yM(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=s,t.infLoc=i,t.nanLoc=r,t.outShapeLocation=o,t.outShapeStridesLocation=a,t.outTexShapeLocation=c}}createTensorFromGPUData(t,e,s){t.channels=t.channels||"RGBA";const{texture:i,height:r,width:o,channels:a}=t,c=Cr().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(i,e,s,r,o,a);return Cr().makeTensorFromDataId(l,e,s,c)}}Ux.nextDataId=0;function ogt(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){const e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<e.length;++s)e[s]=Math.round(n[s]);return e}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */dA()&&mA("webgl",()=>new Ux,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ik=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Bc{constructor(t,e,s){this.variableNames=["A","B"],this.outputShape=ee(e,s),this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class yu{constructor(t,e,s,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ee(e,s);const r=this.outputShape.length;this.enableShapeUniforms=os(r);let o="";if(i)if(r===0||ut(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${We(r)} coords = getOutputCoords();
        `,r===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=bs("coords",r);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${c[r-2]} + 1) >= outShape[${r} - 2];
            bool nextColOutOfBounds =
              (${c[r-1]} + 1) >= outShape[${r} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${c[r-2]} + 1) >= ${this.outputShape[r-2]};
            bool nextColOutOfBounds =
              (${c[r-1]} + 1) >= ${this.outputShape[r-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ys(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const agt={kernelName:Ud,backendName:"webgl",kernelFunc:Ys};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Da(n){const{inputs:t,backend:e}=n,{real:s,imag:i}=t,r=e.makeTensorInfo(s.shape,"complex64"),o=e.texData.get(r.dataId),a=Ys({inputs:{x:s},backend:e}),c=Ys({inputs:{x:i},backend:e});return o.complexTensorInfos={real:a,imag:c},r}const cgt={kernelName:A1,backendName:"webgl",kernelFunc:Da};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NM="return (a < 0.) ? b * a : a;",RM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function lgt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{alpha:r}=s,o=e.makeTensorInfo([],"float32",Sa(r,"float32")),a=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yu(RM,i.shape,o.shape):new Bc(NM,i.shape,o.shape),c=e.runWebGLProgram(a,[i,o],"float32");return e.disposeIntermediateTensorInfo(o),c}const ugt={kernelName:Fb,backendName:"webgl",kernelFunc:lgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AM="return (a < 0.) ? b * a : a;",DM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function hgt(n){const{inputs:t,backend:e}=n,{x:s,alpha:i}=t,r=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yu(DM,s.shape,i.shape):new Bc(AM,s.shape,i.shape);return e.runWebGLProgram(r,[s,i],"float32")}const dgt={kernelName:ex,backendName:"webgl",kernelFunc:hgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wu="if (isnan(x)) return x;";function Se({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:s}){return({inputs:i,backend:r})=>{const{x:o}=i,a=r,c=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&e!=null){const h=a.texData.get(o.dataId),f=e(h.values,c);return a.makeTensorInfo(o.shape,c,f)}const l=rt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let u;return l?u=new oa(o.shape,t):u=new Tr(o.shape,n),a.runWebGLProgram(u,[o],c)}}function Jn({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:r}){return({inputs:o,backend:a})=>{const{a:c,b:l}=o,u=a;if(s&&c.dtype==="complex64"){const m=u.texData.get(c.dataId),x=u.texData.get(l.dataId),[b,y]=[[m.complexTensorInfos.real,x.complexTensorInfos.real],[m.complexTensorInfos.imag,x.complexTensorInfos.imag]].map(k=>{const[I,_]=k,$={dataId:I.dataId,dtype:I.dtype,shape:c.shape},R={dataId:_.dataId,dtype:_.dtype,shape:l.shape},A=new Bc(n,c.shape,l.shape);return u.runWebGLProgram(A,[$,R],Ks(I.dtype,_.dtype))}),v=Da({inputs:{real:b,imag:y},backend:u});return u.disposeIntermediateTensorInfo(b),u.disposeIntermediateTensorInfo(y),v}const h=r||Ks(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||u.shouldExecuteOnCPU([c,l]))&&i!=null){const m=u.texData.get(c.dataId).values,x=u.texData.get(l.dataId).values,b=c.dtype==="string"?Ro(m):m,y=c.dtype==="string"?Ro(x):x,[v,k]=i(c.shape,l.shape,b,y,h),I=u.makeTensorInfo(k,h),_=u.texData.get(I.dataId);return _.values=v,I}const f=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let g;return f?g=new yu(t,c.shape,l.shape,e):g=new Bc(n,c.shape,l.shape),u.runWebGLProgram(g,[c,l],h)}}function od(n,t=!1){if(n==="linear")return t?qpt:Vpt;if(n==="relu")return t?Xpt:Hpt;if(n==="elu")return t?Kpt:Upt;if(n==="relu6")return t?Ypt:Gpt;if(n==="prelu")return t?DM:AM;if(n==="leakyrelu")return t?RM:NM;if(n==="sigmoid")return t?Jpt:jpt;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OM{constructor(t,e,s,i=!1,r=!1,o=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=os(this.outputShape.length);const u=i?t[1]:t[2],h=Math.ceil(u/2),f=i?"i * 2, rc.y":"rc.y, i * 2",g=r?"rc.z, i * 2":"i * 2, rc.z",m=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],x=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",y="";a&&(c?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let k="rc.x",I="rc.x";t[0]<e[0]?k=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(I=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${k};
        int batchB = ${I};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${x[0]});
          result += (${m[1]} * ${x[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class R${constructor(t,e,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ee(e,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A$="return a * b;";function rk(n){const{inputs:t,backend:e}=n,{a:s,b:i}=t,r=Ks(s.dtype,i.dtype);if(s.dtype==="complex64"){const a=e.texData.get(s.dataId),c=e.texData.get(i.dataId),l=new R$(N$.REAL,s.shape,i.shape),u=new R$(N$.IMAG,s.shape,i.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:i.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:i.shape}],f=e.runWebGLProgram(l,h,"float32"),g=e.runWebGLProgram(u,h,"float32"),m=Da({inputs:{real:f,imag:g},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),m}if(e.shouldExecuteOnCPU([s,i])){const a=e.texData.get(s.dataId),c=e.texData.get(i.dataId),[l,u]=hpt(s.shape,i.shape,a.values,c.values,r),h=e.makeTensorInfo(u,r),f=e.texData.get(h.dataId);return f.values=l,h}let o;return rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new yu(A$,s.shape,i.shape):o=new Bc(A$,s.shape,i.shape),e.runWebGLProgram(o,[s,i],r)}const fgt={kernelName:Zd,backendName:"webgl",kernelFunc:rk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pgt(n,t,e){const s=[tu(n.shape),...eu(n.shape)],i={dtype:n.dtype,shape:s,dataId:n.dataId},r=[tu(t),...eu(t)],o=new $M(r,s),a=!0,c=[s],l=e.runWebGLProgram(o,[i],n.dtype,c,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{shape:r}=s,o=e,a=ut(i.shape),c=vR(r,a),l=ut(c);P(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(i.dataId);return u.isPacked&&!Xm(i.shape,c)&&!(u.texture!==null&&Xm(u.shape,c))?pgt(i,c,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:c,dtype:i.dtype})}const ggt={kernelName:sx,backendName:"webgl",kernelFunc:Tt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D${constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:r,outSize:o}=t;this.outputShape=[i,o];const a=Math.floor(s/4)*4,c=s%4;let l="sumValue += dot(values, ones);";if(e!=null){const h=1/e;l=`sumValue += dot(values * ${Ul(h)?h.toPrecision(2):h}, ones);`}let u="";r%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mgt{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:r,outSize:o}=t;this.outputShape=[i,o];let a="0.0",c="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",c="min"):e==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");const u=Math.floor(s/4)*4,h=s%4;let f=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";e==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):e==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let m="";r%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bgt(n){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const e=t.length?t[t.length-1].outSize:n[1],s=_x(e);t.push({inSize:e,windowSize:s,outSize:Math.ceil(e/s)})}return t}function Zc(n,t,e,s){const i=bgt(n.shape);let r=n;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:c,outSize:l}=i[o];let u,h;e==="mean"?u=o===0?new D$({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},a):new D$({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l}):u=new mgt({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},e),h=r,r=s.runWebGLProgram(u,[r],t),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xgt{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let o=0;o<s.length;o++)s[o]=t[e[o]];this.outputShape=s,this.rank=s.length;const i=We(this.rank),r=ygt(e);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${r}));
    }
    `}}function ygt(n){const t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(t);for(let i=0;i<n.length;i++)s[n[i]]=e[i];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wgt{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(t.length);for(let u=0;u<s.length;u++)s[u]=t[e[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=We(this.rank),r=EM("rc",this.rank),o=new Array(this.rank);for(let u=0;u<e.length;u++)o[e[u]]=r[u];const a=`vec2(${o.slice(-2).join()})`,c=`++${r[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${r[this.rank-1]};
      if(++${r[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hx(n,t,e){const s=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wgt(n.shape,t):new xgt(n.shape,t);return e.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vgt(n,t,e,s){const i=t,r=n.shape.length,o=le(i,n.shape);let a=o;const c=un(a,r),l=c!=null;let u=n;l&&(u=Hx(n,c,s),a=xn(a.length,r)),Yn("sum",a,r);const[h,f]=Vn(u.shape,a);let g=h;e&&(g=_n(h,o));const m=ut(f),b=ut(n.shape)/m,y=Tt({inputs:{x:u},attrs:{shape:[b,m]},backend:s}),v=fC(n.dtype),k=Zc(y,v,"sum",s),I=Tt({inputs:{x:k},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(k),l&&s.disposeIntermediateTensorInfo(u),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gx(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s;return vgt(i,r,o,e)}const Cgt={kernelName:lx,backendName:"webgl",kernelFunc:Gx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vs(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{perm:r}=s,o=e,a=i.shape.length,c=new Array(a);for(let u=0;u<c.length;u++)c[u]=i.shape[r[u]];let l;if(o.shouldExecuteOnCPU([i])){const h=o.texData.get(i.dataId).values,f=sk(h,i.shape,i.dtype,r,c);l=o.makeTensorInfo(c,i.dtype);const g=o.texData.get(l.dataId);g.values=f}else l=Hx(i,r,o);return l}const Igt={kernelName:Dl,backendName:"webgl",kernelFunc:vs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PM=1e3;function Ym({a:n,b:t,transposeA:e,transposeB:s,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:c=null}){const l=n.shape.length,u=t.shape.length,h=e?n.shape[l-2]:n.shape[l-1],f=s?t.shape[u-1]:t.shape[u-2],g=e?n.shape[l-1]:n.shape[l-2],m=s?t.shape[u-2]:t.shape[u-1],x=n.shape.slice(0,-2),b=t.shape.slice(0,-2),y=ut(x),v=ut(b),I=ee(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([g,m]);P(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${s} must match.`);const _=e?[y,h,g]:[y,g,h],$=s?[v,m,f]:[v,f,m],R=Tt({inputs:{x:n},backend:i,attrs:{shape:_}}),A=Tt({inputs:{x:t},backend:i,attrs:{shape:$}}),F=[R,A],L=Math.max(y,v),V=e?R.shape[1]:R.shape[2],j=r!=null,Z=o!=null,et=c==="leakyrelu",K=c!=null?od(c,!0):null,tt=j||Z||et||K!=null;let it;if((g===1||m===1)&&V>PM&&tt===!1){let ot=R,bt=A;e&&(ot=vs({inputs:{x:R},backend:i,attrs:{perm:[0,2,1]}}),F.push(ot)),s&&(bt=vs({inputs:{x:A},backend:i,attrs:{perm:[0,2,1]}}),F.push(bt));const ft=m!==1,yt=m===1;let vt=ot;ft&&(vt=Tt({inputs:{x:ot},backend:i,attrs:{shape:[L,V,1]}}),F.push(vt));const St=m===1?2:1;let pt=bt;yt&&(pt=Tt({inputs:{x:bt},backend:i,attrs:{shape:[L,1,V]}}),F.push(pt));const Ct=rk({inputs:{a:vt,b:pt},backend:i});it=Gx({inputs:{x:Ct},backend:i,attrs:{axis:St,keepDims:!0}}),F.push(Ct)}else{const ot=Ks(n.dtype,t.dtype),bt=new OM(_,$,[L,g,m],e,s,j,K,Z,et),ft=[R,A];if(r!=null&&ft.push(r),Z&&ft.push(o),et){const yt=i.makeTensorInfo([],"float32",Sa(a,"float32"));ft.push(yt),F.push(yt)}it=i.runWebGLProgram(bt,ft,ot)}const st=Tt({inputs:{x:it},backend:i,attrs:{shape:I}});F.push(it);for(const ot of F)i.disposeIntermediateTensorInfo(ot);return st}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kgt(n){const{inputs:t,backend:e,attrs:s}=n,{a:i,b:r,bias:o,preluActivationWeights:a}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=s;return Ym({a:i,b:r,transposeA:c,transposeB:l,backend:e,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}const Sgt={kernelName:Sm,backendName:"webgl",kernelFunc:kgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O$="return abs(x);";function _gt(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const r=e.texData.get(s.dataId),o=_M(r.values);return e.makeTensorInfo(s.shape,s.dtype,o)}let i;return rt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new oa(s.shape,O$):i=new Tr(s.shape,O$),e.runWebGLProgram(i,[s],s.dtype)}const Tgt={kernelName:mb,backendName:"webgl",kernelFunc:_gt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Egt=zi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,$gt=Se({opSnippet:Egt}),Ngt={kernelName:Id,backendName:"webgl",kernelFunc:$gt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rgt=zi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Agt=Se({opSnippet:Rgt}),Dgt={kernelName:kd,backendName:"webgl",kernelFunc:Agt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P$="return a + b;",Ogt=Jn({opSnippet:P$,packedOpSnippet:P$,supportsComplex:!0,cpuKernelImpl:Hft}),Pgt={kernelName:au,backendName:"webgl",kernelFunc:Ogt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fgt{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((r,o)=>`T${o}`);const s=[];this.variableNames.forEach(r=>{s.push(`float v${r} = get${r}AtOutCoords();`)});const i=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mgt{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((r,o)=>`T${o}`);const s=[];this.variableNames.forEach(r=>{s.push(`vec4 v${r} = get${r}AtOutCoords();`)});const i=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function em(n){const{inputs:t,backend:e}=n,s=t;if(s.length===1)return Ys({inputs:{x:s[0]},backend:e});if(s.length>rt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),l=em({inputs:s.slice(0,c),backend:e}),u=em({inputs:s.slice(c),backend:e});return em({inputs:[l,u],backend:e})}const i=s.map(c=>c.dtype).reduce((c,l)=>Ks(c,l)),r=s.map(c=>c.shape),a=rt().getBool("WEBGL_PACK")?new Mgt(s[0].shape,r):new Fgt(s[0].shape,r);return e.runWebGLProgram(a,s,i)}const Lgt={kernelName:S1,backendName:"webgl",kernelFunc:em};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bgt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s,a=i.shape.length,c=le(r,i.shape);let l=c;const u=un(l,a);let h=i;u!=null&&(h=vs({inputs:{x:i},backend:e,attrs:{perm:u}}),l=xn(l.length,a)),Yn("all",l,a);const[f,g]=Vn(h.shape,l),m=ut(g),x=Tt({inputs:{x:h},backend:e,attrs:{shape:[-1,m]}}),b=Zc(x,x.dtype,"all",e);let y;if(o){const v=_n(f,c);y=Tt({inputs:{x:b},backend:e,attrs:{shape:v}})}else y=Tt({inputs:{x:b},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),u!=null&&e.disposeIntermediateTensorInfo(h),y}const zgt={kernelName:_1,backendName:"webgl",kernelFunc:Bgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wgt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s,a=i.shape.length,c=le(r,i.shape);let l=c;const u=un(l,a);let h=i;u!=null&&(h=vs({inputs:{x:i},backend:e,attrs:{perm:u}}),l=xn(l.length,a)),Yn("any",l,a);const[f,g]=Vn(h.shape,l),m=ut(g),x=Tt({inputs:{x:h},backend:e,attrs:{shape:[-1,m]}}),b=Zc(x,x.dtype,"any",e);let y;if(o){const v=_n(f,c);y=Tt({inputs:{x:b},backend:e,attrs:{shape:v}})}else y=Tt({inputs:{x:b},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),u!=null&&e.disposeIntermediateTensorInfo(h),y}const Vgt={kernelName:T1,backendName:"webgl",kernelFunc:Wgt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ugt{constructor(t,e,s){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:o}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[r,o];const a=e==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hgt{constructor(t,e,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,P(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const r=t[t.length-1],o=Math.ceil(r/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=We(c),u=bs("coords",c);let h,f;if(o===1){f=c+1;const A=We(f);h=`
        ${A} sourceLocR = ${A}(${u.join()}, 0);
        ++${u[c-1]};
        ${A} sourceLocG = ${A}(${u.join()}, 0);
        ++${u[c-2]};
        ${A} sourceLocA = ${A}(${u.join()}, 0);
        --${u[c-1]};
        ${A} sourceLocB = ${A}(${u.join()}, 0);
        --${u[c-2]};`}else f=c,h=`
        ${l} sourceLocR = coords;
        ++${u[c-1]};
        ${l} sourceLocG = coords;
        ++${u[c-2]};
        ${l} sourceLocA = coords;
        --${u[c-1]};
        ${l} sourceLocB = coords;
        --${u[c-2]};`;const g=["x","y","z","w","u","v"].slice(0,f),m="."+g[f-1],x=g.map(A=>"int "+A),b=bs("sourceLocR",f-1).concat("inIdx.r"),y=bs("sourceLocG",f-1).concat("inIdx.g"),v=bs("sourceLocB",f-1).concat("inIdx.b"),k=bs("sourceLocA",f-1).concat("inIdx.a"),I=s==="max"?"greaterThan":"lessThan",_=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${k.join()})));`,$=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${k.join()}) : 0.)`,R=i?"":`
      float getBestIndicesAChannel(${x.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${x.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${R}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${u[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${u[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${_}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${I}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FM(n,t,e,s=null){let i=t.shape[0],r=t.shape[1];s!=null&&(i=s.shape[0],r=s.shape[1]);const o=_x(r),a={windowSize:o,inSize:r,batchSize:i,outSize:Math.ceil(r/o)},c=new Ugt(a,e,s==null),l=[t];s!=null&&l.push(s);const u=n.runWebGLProgram(c,l,"int32");if(u.shape[1]===1)return u;const h=FM(n,t,e,u);return n.disposeIntermediateTensorInfo(u),h}function MM(n,t,e,s=null){const i=s!=null?s.shape:t.shape,r=i[i.length-1],o=_x(r),a=new Hgt(i,o,e,s==null),c=s==null?[t]:[t,s],l=n.runWebGLProgram(a,c,"int32");if(l.shape.length===t.shape.length){const u=MM(n,t,e,l);return n.disposeIntermediateTensorInfo(l),u}return l}function LM(n,t,e,s){const i=[e];if(Yn("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,t.shape.length),!rt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const r=[],o=n.texData.get(t.dataId),a=o!==null&&o.isPacked;let c=t;a&&(c=n.unpackTensor(t),r.push(c));const[l,u]=Vn(c.shape,i),h=ut(u),f=Tt({inputs:{x:c},backend:n,attrs:{shape:[-1,h]}});r.push(f);const g=FM(n,f,s);r.push(g);const m=Tt({inputs:{x:g},backend:n,attrs:{shape:l}});return r.forEach(x=>n.disposeIntermediateTensorInfo(x)),m}return MM(n,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ggt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r}=s;let o=le(r,i.shape);const a=un(o,i.shape.length);let c=i;const l=[];a!=null&&(c=vs({inputs:{x:i},backend:e,attrs:{perm:a}}),l.push(c),o=xn(o.length,c.shape.length)),Yn("argMax",[o[0]],c.shape.length);const u=LM(e,c,o[0],"max");return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),u}const jgt={kernelName:bb,backendName:"webgl",kernelFunc:Ggt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qgt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r}=s;let o=le(r,i.shape);const a=un(o,i.shape.length);let c=i;const l=[];a!=null&&(c=vs({inputs:{x:i},backend:e,attrs:{perm:a}}),l.push(c),o=xn(o.length,c.shape.length)),Yn("argMin",[o[0]],c.shape.length);const u=LM(e,c,o[0],"min");return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),u}const Kgt={kernelName:xb,backendName:"webgl",kernelFunc:qgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xgt=zi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Ygt=Se({opSnippet:Xgt}),Jgt={kernelName:Sd,backendName:"webgl",kernelFunc:Ygt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zgt=zi+"return log(x + sqrt(x * x + 1.0));",Qgt=Se({opSnippet:Zgt}),tmt={kernelName:_d,backendName:"webgl",kernelFunc:Qgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const emt=zi+`
  return atan(x);
`,nmt=Se({opSnippet:emt}),smt={kernelName:Td,backendName:"webgl",kernelFunc:nmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const imt=ik+`
  return atan(a, b);
`,rmt=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jc+`
  return result;
`,omt=Jn({opSnippet:imt,packedOpSnippet:rmt}),amt={kernelName:$d,backendName:"webgl",kernelFunc:omt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cmt=zi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,lmt=Se({opSnippet:cmt}),umt={kernelName:Ed,backendName:"webgl",kernelFunc:lmt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ad{constructor(t,e,s,i=!1,r=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,u=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,g=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;const x=e==="avg",b=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let v="0.0";if(x||(v="-1.0 / 1e-20"),s){const A=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${g}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${A} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?r?b:y:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let I=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(I="avgValue / max(count, 1.0)");const _=Math.floor(o/4)*4,$=o%4,R=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${g}, ${m});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${_}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${R}
          }

          int xC = xCCorner + ${_};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${R}
          }
        }
        setOutput(${I});
      }
    `}}class ok{constructor(t,e,s,i=!1,r=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideDepth,c=t.strideHeight,l=t.strideWidth,u=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,g=t.effectiveFilterDepth,m=t.effectiveFilterHeight,x=t.effectiveFilterWidth,b=t.padInfo.front,y=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;const k=e==="avg";let I="0.0";if(k||(I="-1.0 / 1e-20"),s){const L=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${b}, ${y}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${x};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${L} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?r?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${m} * ${x} +
                      wR * ${x} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const _="max";let $=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&($="avgValue / max(count, 1.0)");const R=Math.floor(o/4)*4,A=o%4,F=`
      if (${k}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${b}, ${y}, ${v});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${R}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${F}
            }

            int xC = xCCorner + ${R};
            if (${A===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${A===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${A===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${F}
            }
          }
        }
        setOutput(${$});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hmt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;Mf(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:c}=s,l=1;P(is(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Li(i.shape,r,o,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&De(u.inShape,u.outShape))return Ys({inputs:{x:i},backend:e});const h=new ad(u,"avg",!1);return e.runWebGLProgram(h,[i],"float32")}const dmt={kernelName:yb,backendName:"webgl",kernelFunc:hmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fmt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{filterSize:r,strides:o,pad:a,dimRoundingMode:c,dataFormat:l}=s,u=[1,1,1],h=Po(i.shape,r,o,u,a,c,l),f=new ok(h,"avg",!1);return e.runWebGLProgram(f,[i],"float32")}const pmt={kernelName:wb,backendName:"webgl",kernelFunc:fmt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gmt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,i=t.strideHeight,r=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,u=c-1-t.padInfo.top,h=l-1-t.padInfo.left,f=1/(e*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class mmt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,i=t.filterWidth,r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,h=t.effectiveFilterDepth,f=t.effectiveFilterHeight,g=t.effectiveFilterWidth,m=h-1-t.padInfo.front,x=f-1-t.padInfo.top,b=g-1-t.padInfo.left,y=1/(e*s*i);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${x}, ${b});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bmt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r}=t,o=r,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=s,h=[1,1,1],f=Po(o.shape,a,c,h,l,u),g=new mmt(f);return e.runWebGLProgram(g,[i],o.dtype)}const xmt={kernelName:$1,backendName:"webgl",kernelFunc:bmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ymt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r}=t,o=r;Mf([i,r],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,u=Li(o.shape,a,c,1,l),h=new gmt(u);return e.runWebGLProgram(h,[i],o.dtype)}const wmt={kernelName:E1,backendName:"webgl",kernelFunc:ymt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vmt(n){const{inputs:t,backend:e,attrs:s}=n,{a:i,b:r}=t,{transposeA:o,transposeB:a}=s;return Ym({a:i,b:r,transposeA:o,transposeB:a,backend:e})}const Cmt={kernelName:vb,backendName:"webgl",kernelFunc:vmt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Imt{constructor(t,e,s,i,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ee(t,e),ee(t,s);let a="0.0";i!=null&&(ee(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";r!=null&&(ee(t,r),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kmt{constructor(t,e,s,i,r,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ee(t,e),ee(t,s);let a="vec4(0.0)";i!=null&&(ee(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";r!=null&&(ee(t,r),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Smt=({inputs:n,backend:t,attrs:e})=>{const{x:s,mean:i,variance:r,offset:o,scale:a}=n;P(i.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),P(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),P(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=e;c==null&&(c=.001);const l=[s,i,r];let u=null;o!=null&&(u=o.shape,l.push(o));let h=null;a!=null&&(h=a.shape,l.push(a));const f=rt().getBool("WEBGL_PACK_NORMALIZATION")?new kmt(s.shape,i.shape,r.shape,u,h,c):new Imt(s.shape,i.shape,r.shape,u,h,c);return t.runWebGLProgram(f,l,l[0].dtype)},_mt={kernelName:Db,backendName:"webgl",kernelFunc:Smt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tmt{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=We(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Emt(this.rank);let i;const r=t.map((o,a)=>`sourceLoc.${Av[a]} = start[${a}] + coords.${Av[a]};`);i=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${r.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${s}));
      }
    `}}const Av=["x","y","z","w","u","v"];function Emt(n){if(n===1)return"sourceLoc";if(n<=6)return Av.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $mt{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=We(this.rank),s=bs("coords",this.rank),i=bs("sourceLoc",this.rank),r=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${r})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((u,h)=>`start[${h}]`).join()});`:t.map((u,h)=>`${i[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nmt(n,t,e,s){const i=s.texData.get(n.dataId),r=s.makeTensorInfo(e,n.dtype),o=s.texData.get(r.dataId);Object.assign(o,i),o.refCount=1,o.shape=e,o.dtype=n.dtype;let a=eI(t,Wt(n.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||n.dataId};const c=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,c+1),r}function vu(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{begin:r,size:o}=s,[a,c]=Sx(i,r,o);if(ZC(i,a,c),ut(c)===0)return e.makeTensorInfo(c,i.dtype,[]);if(e.shouldExecuteOnCPU([i])||i.dtype==="string"){const h=e.texData.get(i.dataId),f=Cpt(h.values,a,c,i.shape,i.dtype);return e.makeTensorInfo(c,i.dtype,f)}const{isPacked:l}=e.texData.get(i.dataId),u=tI(i.shape,a,c);if(l||!u){const h=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $mt(c):new Tmt(c),f=[a];return e.runWebGLProgram(h,[i],i.dtype,f)}return e.uploadToGPU(i.dataId),Nmt(i,a,c,e)}const Rmt={kernelName:cx,backendName:"webgl",kernelFunc:vu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Amt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockShape:r,crops:o}=s;P(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((v,k)=>v*k),c=kf(i.shape,r,a),l=Sf(c.length,r.length),u=_f(i.shape,r,a),h=oI(o,r.length),f=aI(u,o,r.length),g=[],m=Tt({inputs:{x:i},backend:e,attrs:{shape:c}}),x=vs({inputs:{x:m},backend:e,attrs:{perm:l}}),b=Tt({inputs:{x},backend:e,attrs:{shape:u}}),y=vu({inputs:{x:b},backend:e,attrs:{begin:h,size:f}});return g.push(m),g.push(x),g.push(b),g.forEach(v=>e.disposeIntermediateTensorInfo(v)),y},Dmt={kernelName:Cb,backendName:"webgl",kernelFunc:Amt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Omt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,weights:r}=t,{size:o}=s,a=e.readSync(i.dataId),c=e.readSync(r.dataId),l=SM(a,c,r.dtype,r.shape,o);return e.makeTensorInfo([o],r.dtype,l)}const Pmt={kernelName:N1,backendName:"webgl",kernelFunc:Omt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fmt=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Mmt=`
  return float(int(a.r) & int(b.r));
`;function Lmt(n){const{inputs:t,backend:e}=n,{a:s,b:i}=t,r=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=rt().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([s,i])||o===1){const c=e.texData.get(s.dataId).values,l=e.texData.get(i.dataId).values,[u,h]=jft(s.shape,i.shape,c,l,s.dtype),f=e.makeTensorInfo(h,s.dtype),g=e.texData.get(f.dataId);return g.values=u,f}let a;return r?a=new yu(Fmt,s.shape,i.shape,!1):a=new Bc(Mmt,s.shape,i.shape),e.runWebGLProgram(a,[s,i],s.dtype)}const Bmt={kernelName:R1,backendName:"webgl",kernelFunc:Lmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zmt(n){const{inputs:t,backend:e}=n,{s0:s,s1:i}=t,r=e.readSync(s.dataId),o=e.readSync(i.dataId),a=ee(Array.from(r),Array.from(o));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Wmt={kernelName:TR,backendName:"webgl",kernelFunc:zmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vmt="return float(a != b);",BM=Jn({opSnippet:Vmt,cpuKernelImpl:fpt,dtype:"bool"}),Umt={kernelName:Yb,backendName:"webgl",kernelFunc:BM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bf(n){const{inputs:t,backend:e}=n,{input:s}=t,i=e.texData.get(s.dataId);return Ys({inputs:{x:i.complexTensorInfos.real},backend:e})}const Hmt={kernelName:nC,backendName:"webgl",kernelFunc:Bf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gmt="return float(int(x));";function jmt(n,t){const e=new Tr(n.shape,Gmt),s=t.runWebGLProgram(e,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dv(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{dtype:r}=s;if(r==="complex64"){if(i.dtype==="complex64")return Ys({inputs:{x:i},backend:e});const o=Bn(i.shape),a=Dv({inputs:{x:i},backend:e,attrs:{dtype:"float32"}}),c=Da({inputs:{real:a,imag:o},backend:e});return o.dispose(),e.disposeIntermediateTensorInfo(a),c}if(i.dtype==="complex64"){const o=Bf({inputs:{input:i},backend:e}),a=Dv({inputs:{x:o},backend:e,attrs:{dtype:r}});return e.disposeIntermediateTensorInfo(o),a}if(!CR(i.dtype,r)){const o=Ys({inputs:{x:i},backend:e});return{dataId:o.dataId,shape:o.shape,dtype:r}}if(e.shouldExecuteOnCPU([i])){const o=e.texData.get(i.dataId).values,[a,c,l]=qft(o,i.shape,i.dtype,r);return e.makeTensorInfo(a,c,l)}if(r==="int32")return jmt(i,e);if(r==="bool"){const o=e.makeTensorInfo([],"bool",es("bool",1)),c=BM({inputs:{a:i,b:o},backend:e});return e.disposeIntermediateTensorInfo(o),c}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${r}`)}const qmt={kernelName:Nd,backendName:"webgl",kernelFunc:Dv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F$="return ceil(x);",Kmt=Se({opSnippet:F$,packedOpSnippet:F$,cpuKernelImpl:Kft}),Xmt={kernelName:Rd,backendName:"webgl",kernelFunc:Kmt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ymt{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jmt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zmt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{clipValueMin:r,clipValueMax:o}=s;let a;rt().getBool("WEBGL_PACK_CLIP")?a=new Jmt(i.shape):a=new Ymt(i.shape);const c=[[r],[o]];return e.runWebGLProgram(a,[i],i.dtype,c)}const Qmt={kernelName:Ad,backendName:"webgl",kernelFunc:Zmt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tbt{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function ebt(n){const{inputs:t,backend:e}=n,{x:s}=t,i=e.texData.get(s.dataId),r=new tbt(s.shape),o=[M$(s,i.complexTensorInfos.real),M$(s,i.complexTensorInfos.imag)];return e.runWebGLProgram(r,o,o[0].dtype)}const nbt={kernelName:Ib,backendName:"webgl",kernelFunc:ebt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sbt{constructor(t){this.outputShape=[],this.outputShape=Ar(t,1),this.variableNames=t.map((o,a)=>`T${a}`);const e=new Array(t.length-1);e[0]=t[0][1];for(let o=1;o<e.length;o++)e[o]=e[o-1]+t[o][1];const s=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<e.length;o++){const a=e[o-1];s.push(`else if (yC < ${e[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=e.length,r=e[e.length-1];s.push(`else setOutput(getT${i}(yR, yC-${r}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ibt{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ar(t,e);const s=this.outputShape,i=s.length,r=We(i),o=bs("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map((x,b)=>`T${b}`);const c=new Array(t.length-1);c[0]=t[0][e];for(let x=1;x<c.length;x++)c[x]=c[x-1]+t[x][e];const l=a[e],u=a.slice(-2),h=a.join();let f=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let x=1;x<c.length;x++){const b=c[x-1];f+=`
        if (${l} < ${c[x]}  && ${l} >= ${c[x-1]}) {
          return getChannel(
            getT${x}(${Fg(a,l,b)}),
            vec2(${Fg(u,l,b)}));
        }`}const g=c.length,m=c[c.length-1];f+=`
        return getChannel(
          getT${g}(${Fg(a,l,m)}),
          vec2(${Fg(u,l,m)}));`,this.userCode=`
      float getValue(${a.map(x=>"int "+x)}) {
        ${f}
      }

      void main() {
        ${r} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${s[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${s[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${s[i-2]} &&
            ${o[i-1]} < ${s[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Fg(n,t,e){const s=n.indexOf(t);return n.map((r,o)=>o===s?`${r} - ${e}`:r).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jx(n){const{inputs:t,backend:e}=n,{input:s}=t,i=e.texData.get(s.dataId);return Ys({inputs:{x:i.complexTensorInfos.imag},backend:e})}const rbt={kernelName:K1,backendName:"webgl",kernelFunc:jx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Th(n,t,e){const s=n[0].dtype;if(s==="complex64"){const g=n.map(v=>Bf({inputs:{input:v},backend:e})),m=n.map(v=>jx({inputs:{input:v},backend:e})),x=Th(g,t,e),b=Th(m,t,e),y=Da({inputs:{real:x,imag:b},backend:e});return g.forEach(v=>e.disposeIntermediateTensorInfo(v)),m.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),y}let i=e.shouldExecuteOnCPU(n);if(s==="string"&&(i=!0),i){const g=n.map(I=>{const $=[-1,ut(I.shape.slice(t))];return Tt({inputs:{x:I},backend:e,attrs:{shape:$}})}),m=g.map(I=>({vals:e.readSync(I.dataId),shape:I.shape})),x=Ar(g.map(I=>I.shape),1),b=g[0].shape[0]===1,y=Xft(m,x,s,b),v=Ar(n.map(I=>I.shape),t),k=e.makeTensorInfo(v,s,y);return g.forEach(I=>e.disposeIntermediateTensorInfo(I)),k}const r=n.filter(g=>ut(g.shape)>0),o=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1;if(r.length===1){const g=o?new Tr(n[0].shape,Zo):new oa(n[0].shape,Zo);return e.runWebGLProgram(g,n,s)}const a=rt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>a){const g=[];for(let x=0;x<r.length;x+=a){const b=r.slice(x,x+a);g.push(Th(b,t,e))}const m=Th(g,t,e);for(const x of g)e.disposeIntermediateTensorInfo(x);return m}if(o){const g=new ibt(r.map(m=>m.shape),t);return e.runWebGLProgram(g,r,s)}const{tensors2D:c,outShape:l}=obt(r,t,e),u=new sbt(c.map(g=>g.shape)),h=e.runWebGLProgram(u,c,s);c.forEach(g=>e.disposeIntermediateTensorInfo(g));const f=Tt({inputs:{x:h},attrs:{shape:l},backend:e});return e.disposeIntermediateTensorInfo(h),f}function obt(n,t,e){const s=Ar(n.map(r=>r.shape),t);return{tensors2D:n.map(r=>Tt({inputs:{x:r},attrs:{shape:[-1,ut(r.shape.slice(t))]},backend:e})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zM(n){const{inputs:t,backend:e,attrs:s}=n,{axis:i}=s,r=le(i,t[0].shape)[0],o=t.map(l=>l.shape);sI(o,r);const a=Ar(t.map(l=>l.shape),r);if(ut(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);const c=t.filter(l=>ut(l.shape)>0);return c.length===1?Ys({inputs:{x:c[0]},backend:e}):Th(c,r,e)}const abt={kernelName:kb,backendName:"webgl",kernelFunc:zM};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WM{constructor(t,e=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,u=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,g=t.filterWidth,m=Math.floor(t.inChannels/4)*4,x=t.inChannels%4,b=t.dataFormat==="channelsLast",y=b?1:2,v=b?2:3,k=b?3:1;let I="",_="";s&&(i?I=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?I=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`
          float activation(float x) {
            ${s}
          }
        `,_="result = activation(result);");const $=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${k}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${x===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${x===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${x===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${_}
        setOutput(result);
      }
    `}}class cbt{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,s=t.padInfo.top,i=t.padInfo.left,r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,g=t.filterWidth,m=Math.floor(t.inChannels/4)*4,x=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${r}, ${o}, ${a});
      const ivec3 pads = ivec3(${e}, ${s}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${x===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${x===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${x===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VM{constructor(t,e=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=t.padInfo.left,a=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,u=t.filterWidth,h=u;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<u;b++)f+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;f+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let b=0;b<u;b++)f+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(h+1)/2;b++){const y=b*2;if(f+=`
           xC = xCCorner + ${y*c};
           `,a===1){if(y<u&&(o%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,c===1&&y>0?f+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<u)){const v=o%2===0?w1(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${v};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,c>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:f+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):v===1?f+=`
                     xC${y+1} = xTexelC${y};
                     `:f+=`
                     xCOffset = xC + ${v};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<u&&(o%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<u&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<u&&(f+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<u&&(f+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<u&&(f+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let g="",m="";s&&(i?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:r?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,m="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${x}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lbt{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=os(this.outputShape.length);const{dataFormat:s}=e,i=Cs(),r=s==="channelsLast",o=r?1:2,a=r?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${u};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${r}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jm(n,t){const e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function UM({x:n,filter:t,convInfo:e,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const c=n.shape,l=s.texData.get(n.dataId),u=e.inChannels,h=c[0]*c[1]*c[2],f=e.outChannels,g=e.dataFormat==="channelsLast",m=!1,x=!1;let b;const y=[];if(r!=null){const I=Jm(r.shape,g);I!=null&&(r=Tt({inputs:{x:r},backend:s,attrs:{shape:I}}),y.push(r))}if(i!=null){const I=Jm(i.shape,g);I!=null&&(i=Tt({inputs:{x:i},backend:s,attrs:{shape:I}}),y.push(i))}if(!((h===1||f===1)&&u>PM)&&l.isPacked&&g&&l.texture!=null&&c[2]%2!==0&&De(l.shape.slice(-3),c.slice(-3))){const I=c[0]*c[1]*(c[2]+1),_={dataId:n.dataId,shape:[1,I,e.inChannels],dtype:n.dtype},$=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,P(Xm(l.shape,_.shape),()=>`packed reshape ${l.shape} to ${_.shape} isn't free`);const R=Tt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}});y.push(R);const A=Ym({a:_,b:R,backend:s,transposeA:m,transposeB:x,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o}),F=s.texData.get(A.dataId);P(F.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=$,F.shape=e.outShape,b=Ys({inputs:{x:A},backend:s}),b.shape=e.outShape,y.push(A)}else{const I=e.outHeight*e.outWidth,_=Tt({inputs:{x:n},backend:s,attrs:{shape:g?[e.batchSize,I,e.inChannels]:[e.batchSize,e.inChannels,I]}}),$=Tt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}}),R=Ym({a:g?_:$,b:g?$:_,transposeA:!g,transposeB:x,backend:s,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o});b=Tt({inputs:{x:R},backend:s,attrs:{shape:e.outShape}}),y.push(_),y.push($),y.push(R)}for(const I of y)s.disposeIntermediateTensorInfo(I);return b}function HM({x:n,filter:t,convInfo:e,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:u,outWidth:h,outHeight:f,dataFormat:g}=e,m=g==="channelsLast",x=c*l*u,b=f*h,y=[e.batchSize,x,b],v=!0,k=!1,I=[];if(r!=null){const st=Jm(r.shape,m);st!=null&&(r=Tt({inputs:{x:r},backend:s,attrs:{shape:st}}),I.push(r))}if(i!=null){const st=Jm(i.shape,m);st!=null&&(i=Tt({inputs:{x:i},backend:s,attrs:{shape:st}}),I.push(i))}const _=Tt({inputs:{x:t},backend:s,attrs:{shape:[1,x,ut(t.shape)/x]}});I.push(_);const $=new lbt(y,e),R=[n.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],A=s.runWebGLProgram($,[n],"float32",R),F=Tt({inputs:{x:A},backend:s,attrs:{shape:y}});I.push(A),I.push(F);const L=i!=null,V=r!=null,j=a==="leakyrelu",Z=a?od(a,!0):null,et=new OM(m?F.shape:_.shape,m?_.shape:F.shape,m?[e.batchSize,b,e.outChannels]:[e.batchSize,e.outChannels,b],v,k,L,Z,V,j),K=m?[F,_]:[_,F];if(i&&K.push(i),V&&K.push(r),j){const st=s.makeTensorInfo([],"float32",Sa(o,"float32"));K.push(st),I.push(st)}const tt=s.runWebGLProgram(et,K,"float32"),it=Tt({inputs:{x:tt},backend:s,attrs:{shape:e.outShape}});I.push(tt);for(const st of I)s.disposeIntermediateTensorInfo(st);return it}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ubt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=s,h=Fo(c),f=Xn(i.shape,r.shape,o,l,a,u,!1,h);let g;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))g=UM({x:i,filter:r,convInfo:f,backend:e});else if(f.strideWidth<=2&&h==="channelsLast"&&rt().getBool("WEBGL_EXP_CONV")){const x=new VM(f),b=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];g=e.runWebGLProgram(x,[i,r],"float32",b)}else if(rt().getBool("WEBGL_CONV_IM2COL"))g=HM({x:i,filter:r,convInfo:f,backend:e});else{const x=new WM(f);g=e.runWebGLProgram(x,[i,r],"float32")}const m=Tt({inputs:{x:g},backend:e,attrs:{shape:f.outShape}});return e.disposeIntermediateTensorInfo(g),m}const hbt={kernelName:Sb,backendName:"webgl",kernelFunc:ubt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dbt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,i=t.padInfo.top,r=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class fbt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,i=t.strideHeight,r=t.strideWidth,o=t.dataFormat==="channelsLast",a=e-1-t.padInfo.top,c=s-1-t.padInfo.left,l=o?1:2,u=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class pbt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,s=t.strideHeight,i=t.strideWidth,r=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${r};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class gbt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,i=t.filterWidth,r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,c=e-1-t.padInfo.front,l=s-1-t.padInfo.top,u=i-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${r}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:r}=t,{strides:o,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=s,h=Fo(c),f=Xn(i.shape,u,o,1,a,l,!1,h),g=new dbt(f);return e.runWebGLProgram(g,[i,r],"float32")}const bbt={kernelName:D1,backendName:"webgl",kernelFunc:mbt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xbt{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=os(this.outputShape.length);const e=t.filterHeight,s=t.filterWidth,i=e-1-t.padInfo.top,r=s-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ybt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:r}=t,{inputShape:o,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=s,h=Fo(l),f=Xn(o,r.shape,a,1,c,u,!1,h);if(rt().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const g=[[f.strideHeight,f.strideWidth]],m=new xbt(f);return e.runWebGLProgram(m,[i,r],"float32",g)}else{const g=new fbt(f);return e.runWebGLProgram(g,[i,r],"float32")}}const wbt={kernelName:_b,backendName:"webgl",kernelFunc:ybt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dilations:c}=s,l=_a(i.shape,r.shape,o,c,a),u=new cbt(l);return e.runWebGLProgram(u,[i,r],"float32")}const Cbt={kernelName:Tb,backendName:"webgl",kernelFunc:vbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ibt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:r}=t,{strides:o,pad:a,filterShape:c}=s,l=_a(i.shape,c,o,1,a),u=new pbt(l);return e.runWebGLProgram(u,[i,r],"float32")}const kbt={kernelName:O1,backendName:"webgl",kernelFunc:Ibt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sbt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:r}=t,{pad:o,strides:a,inputShape:c}=s,l=_a(c,r.shape,a,1,o),u=new gbt(l);return e.runWebGLProgram(u,[i,r],"float32")}const _bt={kernelName:P1,backendName:"webgl",kernelFunc:Sbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tbt=wu+`
  return cos(x);
`,Ebt=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Jc}
  return result;
`,$bt=Se({opSnippet:Tbt,packedOpSnippet:Ebt}),Nbt={kernelName:Dd,backendName:"webgl",kernelFunc:$bt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rbt=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Abt=Se({opSnippet:Rbt}),Dbt={kernelName:Od,backendName:"webgl",kernelFunc:Abt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Obt{constructor(t,e,s,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,c,l]=t,[u]=e,[h,f]=s;this.outputShape=[u,h,f,l];const g=i==="bilinear"?1:0,[m,x]=[`${a-1}.0`,`${c-1}.0`],[b,y,v]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[k,I,_]=f>1?[`${(c-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${x} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${x}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${k});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${I};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${r}));
          return;
        }
        float in_x = ${_};
        if( in_x < 0.0 || in_x > ${x} ) {
          setOutput(float(${r}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pbt=n=>{const{inputs:t,backend:e,attrs:s}=n,{image:i,boxes:r,boxInd:o}=t,{cropSize:a,method:c,extrapolationValue:l}=s,u=new Obt(i.shape,r.shape,a,c,l);return e.runWebGLProgram(u,[i,r,o],"float32")},Fbt={kernelName:M1,backendName:"webgl",kernelFunc:Pbt};var cd;(function(n){n.Prod="*",n.Sum="+"})(cd||(cd={}));class L${constructor(t,e,s,i){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,o=this.op===cd.Prod?"1.0":"0.0",a=s?o:`getX(${B$(r,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",u="";s?(l=i?`end != ${c-1}`:"end != 0",u=i?"end + 1":"end - 1"):(l=i?`end + pow2 < ${c}`:"end >= pow2",u=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${We(r)} coords = getOutputCoords();
        int end = ${z$(r,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${u};
          ${z$(r,"coords",this.op)} = idx;
          val ${this.op}= getX(${B$(r,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function B$(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function z$(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GM(n,t,e,s,i,r){const o=t.shape.length,a=un([s],o);let c=t;a!=null&&(c=vs({inputs:{x:t},backend:e,attrs:{perm:a}}));const l=xn(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${s}`);const u=c.shape[l];let h=Ys({inputs:{x:c},backend:e});for(let f=0;f<=Math.ceil(Math.log2(u))-1;f++){const g=new L$(n,c.shape,!1,r),m=[[f]],x=h;h=e.runWebGLProgram(g,[h],h.dtype,m),e.disposeIntermediateTensorInfo(x)}if(i){const f=new L$(n,c.shape,i,r),g=h;h=e.runWebGLProgram(f,[h],h.dtype),e.disposeIntermediateTensorInfo(g)}if(a!=null){const f=Ta(a),g=vs({inputs:{x:h},backend:e,attrs:{perm:f}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(c),g}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,exclusive:o,reverse:a}=s;return GM(cd.Prod,i,e,r,o,a)}const Lbt={kernelName:F1,backendName:"webgl",kernelFunc:Mbt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,exclusive:o,reverse:a}=s;return GM(cd.Sum,i,e,r,o,a)}const zbt={kernelName:Eb,backendName:"webgl",kernelFunc:Bbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,weights:r}=t,{size:o,binaryOutput:a}=s;if(i.shape.length===1){const c=e.readSync(i.dataId),l=e.readSync(r.dataId),u=SM(c,l,r.dtype,r.shape,o);return e.makeTensorInfo([o],r.dtype,u)}else if(i.shape.length===2){const c=e.bufferSync(i),l=e.bufferSync(r),u=Gft(c,l,o,a);return e.makeTensorInfo(u.shape,r.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Vbt={kernelName:L1,backendName:"webgl",kernelFunc:Wbt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ubt{constructor(t,e,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockSize:r,dataFormat:o}=s,a=i.shape[0],c=o==="NHWC"?i.shape[1]:i.shape[2],l=o==="NHWC"?i.shape[2]:i.shape[3],u=o==="NHWC"?i.shape[3]:i.shape[1],h=c*r,f=l*r,g=u/(r*r),m=o==="NHWC"?[a,h,f,g]:[a,g,h,f],x=new Ubt(m,r,o);return e.runWebGLProgram(x,[i],i.dtype)}const Gbt={kernelName:B1,backendName:"webgl",kernelFunc:Hbt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jM{constructor(t,e=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=t.filterHeight,a=t.filterWidth,c=t.outChannels/t.inChannels;let l="",u="";s&&(i?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const h=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qM{constructor(t,e=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=t.outChannels/t.inChannels,a=t.padInfo.left,c=t.strideWidth,l=t.dilationWidth,u=t.filterHeight,h=t.filterWidth,f=h;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)g+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;g+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<h;y++)g+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(f+1)/2;y++){const v=y*2;if(g+=`
          xC = xCCorner + ${v*l};
          `,c===1){if(v<h&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }
              `,l===1&&v>0?g+=`
                xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                  } else {
                    xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xC${v} = xTexelC${v};
                `,v+1<h)){const k=a%2===0?w1(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${k};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                    xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${v+1}.zw = vec2(0.0);
                    }
                    xTexelC${v+1}Ready = 1;
                  }
                  `,l>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                    } else {
                     xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                    }
                    `:g+=`
                    xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                    `):k===1?g+=`
                    xC${v+1} = xTexelC${v};
                    `:g+=`
                    xCOffset = xC + ${k};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                      xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${v+1}.zw = vec2(0.0);
                      }
                      xTexelC${v+1}Ready = 1;
                    }

                    xC${v+1} = xTexelC${v+1};
                    `}}else v<h&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.0);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
              `,v+1<h&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(
                  xTexelC${v}.xy, xTexelC${v+1}.xy);
              `,v+1<h&&(g+=`
                  xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                `)));v<h&&(g+=`
            wTexel = getW(r, ${v}, d1, q);
            dotProd += xC${v} * vec4(wTexel.xz, wTexel.xz);
          `,v+1<h&&(g+=`
              wTexel = getW(r, ${v+1}, d1, q);
              dotProd += xC${v+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let m="",x="";s&&(i?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:m=`vec4 activation(vec4 x) {
          ${s}
        }`,x="result = activation(result);");const b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jbt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dilations:c,dimRoundingMode:l}=s;let u=c;u==null&&(u=[1,1]),P(is(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Xn(i.shape,r.shape,o,u,a,l,!0);let f;rt().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?f=new qM(h):f=new jM(h);const g=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return e.runWebGLProgram(f,[i,r],"float32",g)}const qbt={kernelName:$b,backendName:"webgl",kernelFunc:jbt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kbt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,i=t.padInfo.top,r=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Xbt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,i=t.strideHeight,r=t.strideWidth,o=e-1-t.padInfo.top,a=s-1-t.padInfo.left,c=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ybt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,dy:r}=t,{strides:o,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=s,h=Xn(i.shape,u,o,a,c,l,!0),f=new Kbt(h);return e.runWebGLProgram(f,[i,r],"float32")}const Jbt={kernelName:z1,backendName:"webgl",kernelFunc:Ybt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zbt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,filter:r}=t,{strides:o,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=s,h=Xn(u,r.shape,o,a,c,l,!0),f=new Xbt(h);return e.runWebGLProgram(f,[i,r],"float32")}const Qbt={kernelName:W1,backendName:"webgl",kernelFunc:Zbt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class txt{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ext(n){const{inputs:t,backend:e}=n,{x:s}=t,i=[...s.shape,...s.shape],r=ut(s.shape),o=Tt({inputs:{x:s},backend:e,attrs:{shape:[r]}}),a=new txt(r),c=e.runWebGLProgram(a,[o],o.dtype),l=Tt({inputs:{x:c},backend:e,attrs:{shape:i}});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(c),l}const nxt={kernelName:ER,backendName:"webgl",kernelFunc:ext};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sxt{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:s,padInfo:i,strideHeight:r,strideWidth:o,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:u}=t,{top:h,left:f}=i;this.userCode=`
      const ivec2 strides = ivec2(${r}, ${o});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ixt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r}=t,{strides:o,pad:a,dilations:c}=s,l=yf(i.shape,r.shape,o,a,"NHWC",c);let u;const h=new sxt(l);u=e.runWebGLProgram(h,[i,r],"float32");const f=Tt({inputs:{x:u},backend:e,attrs:{shape:l.outShape}});return e.disposeIntermediateTensorInfo(u),f}const rxt={kernelName:Nb,backendName:"webgl",kernelFunc:ixt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oxt(n){const{inputs:t,backend:e,attrs:s}=n,{equation:i}=s,r=t,{allDims:o,summedDims:a,idDims:c}=gI(i,r.length);bI(o.length,c,r);const{path:l,steps:u}=xI(a,c),h=u.length;let f=null,g=o.length;const m=[];for(let x=0;x<h;++x){for(const b of u[x]){const{permutationIndices:y,expandDims:v}=mI(g,c[b]);let k;yI(y)?k=r[b]:(k=vs({inputs:{x:r[b]},backend:e,attrs:{perm:y}}),m.push(k));const I=k.shape.slice();for(let _=0;_<v.length;++_)I.splice(v[_],0,1);De(k.shape,I)||(k=Tt({inputs:{x:k},backend:e,attrs:{shape:I}}),m.push(k)),f===null?f=k:(f=rk({inputs:{a:k,b:f},backend:e}),m.push(f))}x<h-1&&(l[x]>=0&&(f=Gx({inputs:{x:f},backend:e,attrs:{axis:l[x]-(o.length-g),keepDims:!1}}),m.push(f)),g--)}for(const x of m)x!==f&&e.disposeIntermediateTensorInfo(x);return f}const axt={kernelName:V1,backendName:"webgl",kernelFunc:oxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cxt="return (x >= 0.0) ? x : (exp(x) - 1.0);",lxt=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,uxt=Se({opSnippet:cxt,packedOpSnippet:lxt}),hxt={kernelName:Fd,backendName:"webgl",kernelFunc:uxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dxt="return (b >= 0.0) ? a : a * (b + 1.0);",fxt=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,pxt=n=>{const{inputs:t,backend:e}=n,{dy:s,y:i}=t,r=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yu(fxt,s.shape,i.shape):new Bc(dxt,s.shape,i.shape);return e.runWebGLProgram(r,[s,i],s.dtype)},gxt={kernelName:U1,backendName:"webgl",kernelFunc:pxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mxt=`
  return vec4(equal(a, b));
`,bxt="return float(a == b);",xxt=Jn({opSnippet:bxt,packedOpSnippet:mxt,dtype:"bool",cpuKernelImpl:Yft}),yxt={kernelName:Rb,backendName:"webgl",kernelFunc:xxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wxt=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${cI};
  float a1 = ${lI};
  float a2 = ${uI};
  float a3 = ${hI};
  float a4 = ${dI};
  float a5 = ${fI};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,vxt=Se({opSnippet:wxt}),Cxt={kernelName:Md,backendName:"webgl",kernelFunc:vxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ixt=wu+`
  return exp(x);
`,kxt=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,KM=Se({opSnippet:Ixt,packedOpSnippet:kxt,cpuKernelImpl:Jft,dtype:"float32"}),Sxt={kernelName:Ld,backendName:"webgl",kernelFunc:KM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ov(n){const{inputs:t,attrs:e,backend:s}=n,{dim:i}=e,{input:r}=t,o=r.shape.length,a=r.shape.slice();let c=i;return i<0&&(P(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+i+1),a.splice(c,0,1),Tt({inputs:{x:r},backend:s,attrs:{shape:a}})}const _xt={kernelName:Ab,backendName:"webgl",kernelFunc:Ov};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W$="return exp(x) - 1.0;",Txt=Se({opSnippet:W$,packedOpSnippet:W$,cpuKernelImpl:Zft}),Ext={kernelName:Bd,backendName:"webgl",kernelFunc:Txt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V${constructor(t,e,s){this.variableNames=["real","imag"];const i=e[1];this.outputShape=e;const r=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${i}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${r};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XM(n,t,e){const s=e.texData.get(n.dataId),i=ut(n.shape),r=n.shape[n.shape.length-1],o=i/r,a=Tt({inputs:{x:n},backend:e,attrs:{shape:[o,r]}}),c=a.shape,l=new V$("real",c,t),u=new V$("imag",c,t),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],f=e.runWebGLProgram(l,h,"float32"),g=e.runWebGLProgram(u,h,"float32"),m=Da({inputs:{real:f,imag:g},backend:e});e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g);const x=Tt({inputs:{x:m},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(m),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $xt(n){const{inputs:t,backend:e}=n,{input:s}=t;return XM(s,!1,e)}const Nxt={kernelName:H1,backendName:"webgl",kernelFunc:$xt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rxt{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zf(n){const{backend:t,attrs:e}=n,{shape:s,value:i}=e;let{dtype:r}=e;if(r=r||ru(i),r==="string"){const o=gn(r,ut(s));return o.fill(i),t.makeTensorInfo(s,r,o)}else{const o=new Rxt(s,i),a=[[i]];return t.runWebGLProgram(o,[],r,a)}}const Axt={kernelName:G1,backendName:"webgl",kernelFunc:zf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dxt{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oxt={kernelName:j1,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{const{image:e}=n,s=t,i=new Dxt(e.shape);return s.runWebGLProgram(i,[e],e.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U$="return floor(x);",Pxt=Se({opSnippet:U$,packedOpSnippet:U$,cpuKernelImpl:Qft}),Fxt={kernelName:zd,backendName:"webgl",kernelFunc:Pxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mxt=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Lxt=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Bxt=Jn({opSnippet:Mxt,packedOpSnippet:Lxt,dtype:"int32"}),zxt={kernelName:Wd,backendName:"webgl",kernelFunc:Bxt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wxt{constructor(t){this.variableNames=["A"];const e=Cs(),[s,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${s}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vxt{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=Cs(),[s,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${s}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uxt={kernelName:rY,backendName:"webgl",kernelFunc:Hxt};let vl,xw=rt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Hxt(n){const{inputs:t,backend:e,attrs:s}=n;let{pixels:i}=t;const{numChannels:r}=s,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[c,l]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=[l,c],h=[l,c,r];if(a||o){const x=rt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(vl==null||x!==xw)&&(xw=x,vl=document.createElement("canvas").getContext("2d",{willReadFrequently:xw})),vl.canvas.width=c,vl.canvas.height=l,vl.drawImage(i,0,0,c,l),i=vl.canvas}const f=e.makeTensorInfo(u,"int32");e.texData.get(f.dataId).usage=ci.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(f.dataId),i);const g=rt().getBool("WEBGL_PACK")?new Vxt(h):new Wxt(h),m=e.runWebGLProgram(g,[f],"int32");return e.disposeData(f.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gxt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r,bias:o,preluActivationWeights:a}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f,activation:g,leakyreluAlpha:m}=s,x=Fo(u),b=Xn(i.shape,r.shape,c,h,l,f,!1,x);let y;const v=[],k=o!=null,I=a!=null,_=g==="leakyrelu",$=()=>{const A=[i,r],F=(L,V)=>{if(V==="NCHW"&&L.shape.length===1&&L.shape[0]!==1){const j=Tt({inputs:{x:L},backend:e,attrs:{shape:[L.shape[0],1,1]}});return v.push(j),j}return L};if(k&&A.push(F(o,u)),I&&A.push(F(a,u)),_){const L=e.makeTensorInfo([],"float32",Sa(m,"float32"));A.push(L),v.push(L)}return A};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))y=UM({x:i,filter:r,convInfo:b,backend:e,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:m});else if(b.strideWidth<=2&&x==="channelsLast"&&rt().getBool("WEBGL_EXP_CONV")){const A=g?od(g,!0):null,F=new VM(b,k,A,I,_),L=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],V=$();y=e.runWebGLProgram(F,V,"float32",L)}else if(rt().getBool("WEBGL_CONV_IM2COL"))y=HM({x:i,filter:r,convInfo:b,backend:e,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:m});else{const A=g?od(g,!1):null,F=new WM(b,k,A,I,_),L=$();y=e.runWebGLProgram(F,L,"float32")}const R=Tt({inputs:{x:y},backend:e,attrs:{shape:b.outShape}});return v.push(y),v.forEach(A=>e.disposeIntermediateTensorInfo(A)),R}const jxt={kernelName:_m,backendName:"webgl",kernelFunc:Gxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qxt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,filter:r,bias:o,preluActivationWeights:a}=t,{strides:c,pad:l,dilations:u,dimRoundingMode:h,activation:f,leakyreluAlpha:g}=s,m=[];let x=u;x==null&&(x=[1,1]),P(is(c,x),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${x}'`);const b=Xn(i.shape,r.shape,c,x,l,h,!0),y=rt().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,v=f?od(f,y):null,k=[i,r],I=o!=null,_=a!=null,$=f==="leakyrelu";if(I&&k.push(o),_&&k.push(a),$){const L=e.makeTensorInfo([],"float32",Sa(g,"float32"));k.push(L),m.push(L)}let R;y?R=new qM(b,I,v,_,$):R=new jM(b,I,v,_,$);const A=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],F=e.runWebGLProgram(R,k,"float32",A);return m.forEach(L=>e.disposeIntermediateTensorInfo(L)),F}const Kxt={kernelName:qR,backendName:"webgl",kernelFunc:qxt};class Xxt{constructor(t,e,s,i){this.sliceDim=t,this.strides=e,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=s;const r=We(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${r} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxt(n){const{inputs:t,backend:e}=n,{params:s,indices:i}=t,r=i.shape,o=r[r.length-1],a=ut(s.shape),[c,l,u,h]=JC(s,i),f=Tt({inputs:{x:i},backend:e,attrs:{shape:[l,o]}}),g=Tt({inputs:{x:s},backend:e,attrs:{shape:[ut(s.shape)/u,u]}});if(e.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const y=e.readSync(i.dataId),v=e.bufferSync(s),k=tpt(y,v,s.dtype,l,o,u,h,s.shape,a);return e.makeTensorInfo(c,s.dtype,k.values)}const m=new Xxt(o,h,[l,u],s.shape),x=e.runWebGLProgram(m,[g,f],g.dtype),b=Tt({inputs:{x},backend:e,attrs:{shape:c}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),b}const Jxt={kernelName:$R,backendName:"webgl",kernelFunc:Yxt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zxt{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const s=We(this.rank),i=Qxt(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function Qxt(n,t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<n.length;i++)i===2?s.push("index"):s.push(`${e[i]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YM(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,indices:r}=t,{axis:o,batchDims:a}=s,c=le(o,i.shape)[0];if(rt().get("DEBUG")){const v=e.readSync(r.dataId),k=i.shape[c];for(let I=0;I<v.length;++I){const _=v[I];P(_<=k-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${k-1}]`)}}const l=vI(i,r,c,a),u=ut(r.shape),h=[],f=Tt({inputs:{x:i},backend:e,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),g=Tt({inputs:{x:r},backend:e,attrs:{shape:[l.batchSize,u/l.batchSize]}});h.push(f),h.push(g);const m=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(e.shouldExecuteOnCPU([i,r])||i.dtype==="string"){const v=e.bufferSync(g),k=e.bufferSync(f),I=ept(k,v,m);return h.forEach(_=>e.disposeIntermediateTensorInfo(_)),e.makeTensorInfo(l.outputShape,I.dtype,I.values)}const x=new Zxt(f.shape,m),b=e.runWebGLProgram(x,[f,g],f.dtype);h.push(b);const y=Tt({inputs:{x:b},backend:e,attrs:{shape:l.outputShape}});return h.forEach(v=>e.disposeIntermediateTensorInfo(v)),y}const tyt={kernelName:Ob,backendName:"webgl",kernelFunc:YM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eyt="return float(a > b);",nyt=`
  return vec4(greaterThan(a, b));
`,syt=Jn({opSnippet:eyt,packedOpSnippet:nyt,cpuKernelImpl:npt,dtype:"bool"}),iyt={kernelName:Pb,backendName:"webgl",kernelFunc:syt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ryt="return float(a >= b);",oyt=`
  return vec4(greaterThanEqual(a, b));
`,ayt=Jn({opSnippet:ryt,packedOpSnippet:oyt,dtype:"bool",cpuKernelImpl:spt}),cyt={kernelName:Vd,backendName:"webgl",kernelFunc:ayt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lyt(n){const{inputs:t,backend:e}=n,{input:s}=t;return XM(s,!0,e)}const uyt={kernelName:q1,backendName:"webgl",kernelFunc:lyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hyt="return float(!isnan(x) && !isinf(x));",dyt=Se({opSnippet:hyt,dtype:"bool"}),fyt={kernelName:Hd,backendName:"webgl",kernelFunc:dyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pyt="return float(isinf(x));",gyt=Se({opSnippet:pyt,dtype:"bool"}),myt={kernelName:Gd,backendName:"webgl",kernelFunc:gyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const byt="return float(isnan(x));",xyt=Se({opSnippet:byt,dtype:"bool"}),yyt={kernelName:jd,backendName:"webgl",kernelFunc:xyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wyt="return float(a < b);",vyt=`
  return vec4(lessThan(a, b));
`,Cyt=Jn({opSnippet:wyt,packedOpSnippet:vyt,cpuKernelImpl:ipt,dtype:"bool"}),Iyt={kernelName:Mb,backendName:"webgl",kernelFunc:Cyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kyt="return float(a <= b);",Syt=`
  return vec4(lessThanEqual(a, b));
`,_yt=Jn({opSnippet:kyt,packedOpSnippet:Syt,cpuKernelImpl:rpt,dtype:"bool"}),Tyt={kernelName:Lb,backendName:"webgl",kernelFunc:_yt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eyt(n){const{backend:t,attrs:e}=n,{start:s,stop:i,num:r}=e,o=opt(s,i,r);return t.makeTensorInfo([o.length],"float32",o)}const $yt={kernelName:NR,backendName:"webgl",kernelFunc:Eyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nyt=wu+`
  return x < 0.0 ? 0./0. : log(x);
`,Ryt=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Ayt=Se({opSnippet:Nyt,packedOpSnippet:Ryt,cpuKernelImpl:apt}),Dyt={kernelName:qd,backendName:"webgl",kernelFunc:Ayt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oyt=wu+`
  return log(1.0 + x);
`,Pyt=Se({opSnippet:Oyt}),Fyt={kernelName:Kd,backendName:"webgl",kernelFunc:Pyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Myt="return float(a >= 1.0 && b >= 1.0);",Lyt=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Byt=Jn({opSnippet:Myt,packedOpSnippet:Lyt,dtype:"bool"}),zyt={kernelName:Bb,backendName:"webgl",kernelFunc:Byt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wyt="return float(!(x >= 1.0));",Vyt=Se({opSnippet:Wyt}),Uyt={kernelName:zb,backendName:"webgl",kernelFunc:Vyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hyt="return float(a >= 1.0 || b >= 1.0);",Gyt=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,jyt=Jn({opSnippet:Hyt,packedOpSnippet:Gyt,dtype:"bool"}),qyt={kernelName:Wb,backendName:"webgl",kernelFunc:jyt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kyt{constructor(t,e,s,i,r){this.variableNames=["x"],this.outputShape=[];const o=e,a=t[3]-1;this.outputShape=t;let c;const l=`float(${s}) + float(${i}) * sum`;r===.5?c=`inversesqrt(${l})`:r===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xyt{constructor(t,e,s,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=e,a=t[3]-1;this.outputShape=t;let c;const l=`float(${s}) + float(${i}) * sum`;r===.5?c=`inversesqrt(${l})`:r===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yyt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{depthRadius:r,bias:o,alpha:a,beta:c}=s,l=rt().getBool("WEBGL_PACK_NORMALIZATION")?new Xyt(i.shape,r,o,a,c):new Kyt(i.shape,r,o,a,c);return e.runWebGLProgram(l,[i],i.dtype)},Jyt={kernelName:Vb,backendName:"webgl",kernelFunc:Yyt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zyt{constructor(t,e,s,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=s,this.alpha=i,this.beta=r,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${r})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${r});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qyt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:i,y:r,dy:o}=t,{depthRadius:a,bias:c,alpha:l,beta:u}=s,h=new Zyt(i.shape,a,c,l,u);return e.runWebGLProgram(h,[i,r,o],i.dtype)},t0t={kernelName:X1,backendName:"webgl",kernelFunc:Qyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0t(n,t,e,s){const i=ut(t),o=ut(n.shape)/i,a=Tt({inputs:{x:n},attrs:{shape:[o,i]},backend:s}),c=Zc(a,n.dtype,"max",s),l=Tt({inputs:{x:c},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JM(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{reductionIndices:r,keepDims:o}=s,a=i.shape.length,c=le(r,i.shape);let l=c;const u=un(l,a),h=u!=null,f=e.shouldExecuteOnCPU([i]);let g=i;if(h){if(f){const k=e.texData.get(g.dataId).values,I=new Array(a);for(let R=0;R<I.length;R++)I[R]=i.shape[u[R]];const _=sk(k,i.shape,i.dtype,u,I);g=e.makeTensorInfo(I,i.dtype);const $=e.texData.get(g.dataId);$.values=_}else g=Hx(i,u,e);l=xn(l.length,a)}Yn("max",l,a);const[m,x]=Vn(g.shape,l);let b=m;o&&(b=_n(m,c));let y;if(f){const k=e.texData.get(g.dataId).values,I=cpt(k,ut(x),b,i.dtype);y=e.makeTensorInfo(b,i.dtype);const _=e.texData.get(y.dataId);_.values=I}else y=e0t(g,x,b,e);return h&&e.disposeIntermediateTensorInfo(g),y}const n0t={kernelName:Ub,backendName:"webgl",kernelFunc:JM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s0t=ik+`
  return max(a, b);
`,i0t=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jc+`
  return result;
`,r0t=Jn({opSnippet:s0t,packedOpSnippet:i0t,cpuKernelImpl:lpt}),o0t={kernelName:Xd,backendName:"webgl",kernelFunc:r0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;Mf(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:c}=s,l=1;P(is(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Li(i.shape,r,o,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&De(u.inShape,u.outShape))return Ys({inputs:{x:i},backend:e});const h=new ad(u,"max",!1);return e.runWebGLProgram(h,[i],i.dtype)}const c0t={kernelName:Hb,backendName:"webgl",kernelFunc:a0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{filterSize:r,strides:o,pad:a,dataFormat:c,dimRoundingMode:l}=s,u=[1,1,1],h=Po(i.shape,r,o,u,a,l,c),f=new ok(h,"max",!1);return e.runWebGLProgram(f,[i],i.dtype)}const u0t={kernelName:Gb,backendName:"webgl",kernelFunc:l0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h0t{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,s=t.strideWidth,i=t.dilationHeight,r=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=r-1-t.padInfo.top,c=o-1-t.padInfo.left,l=r*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class d0t{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,s=t.strideHeight,i=t.strideWidth,r=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,u=t.effectiveFilterWidth,h=c-1-t.padInfo.front,f=l-1-t.padInfo.top,g=u-1-t.padInfo.left,m=c*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${r}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0t(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r}=t,o=r,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=s,h=[1,1,1],f=Po(o.shape,a,c,h,l,u),g=new ok(f,"max",!0),m=e.runWebGLProgram(g,[o],o.dtype),x=new d0t(f),b=e.runWebGLProgram(x,[i,m],o.dtype);return e.disposeIntermediateTensorInfo(m),b}const p0t={kernelName:J1,backendName:"webgl",kernelFunc:f0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0t(n){const{inputs:t,backend:e,attrs:s}=n,{dy:i,input:r,output:o}=t,a=r;Mf([r,o],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=s,f=Li(a.shape,c,l,1,u,h),g=!0,m=new ad(f,"max",g),x=e.runWebGLProgram(m,[a],a.dtype),b=new h0t(f),y=e.runWebGLProgram(b,[i,x],a.dtype);return e.disposeIntermediateTensorInfo(x),y}const m0t={kernelName:Y1,backendName:"webgl",kernelFunc:g0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b0t(n,t,e,s){let i=new ad(e,"max",!1);const r=s.runWebGLProgram(i,[n],"float32");i=new ad(e,"max",!0,!0,t);const o=s.runWebGLProgram(i,[n],"float32");return[r,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x0t={kernelName:RR,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=t,c=e;P(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];P(is(r,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${l}'`);const u=Li(s.shape,i,r,l,o),[h,f]=b0t(s,a,u,c);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y0t(n,t,e,s){const i=ut(t),o=ut(n.shape)/i,a=Tt({inputs:{x:n},attrs:{shape:[o,i]},backend:s}),c=Zc(a,"float32","mean",s),l=Tt({inputs:{x:c},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w0t={kernelName:jb,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{keepDims:i,axis:r}=t,o=e,a=s.shape.length,c=le(r,s.shape);let l=c;const u=un(l,a),h=u!=null,f=o.shouldExecuteOnCPU([s]),g=[];let m=s;if(h){if(f){const I=o.texData.get(m.dataId).values,_=new Array(a);for(let A=0;A<_.length;A++)_[A]=s.shape[u[A]];const $=sk(I,s.shape,s.dtype,u,_);m=o.makeTensorInfo(_,s.dtype);const R=o.texData.get(m.dataId);R.values=$}else m=Hx(s,u,o);g.push(m),l=xn(l.length,a)}Yn("sum",l,a);const[x,b]=Vn(m.shape,l);let y=x;i&&(y=_n(x,c));const v=y0t(m,b,y,o);for(const k of g)o.disposeIntermediateTensorInfo(k);return v}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s,a=i.shape.length,c=le(r,i.shape);let l=c;const u=un(l,a);let h=i;u!=null&&(h=vs({inputs:{x:i},backend:e,attrs:{perm:u}}),l=xn(l.length,i.shape.length)),Yn("min",l,a);const[f,g]=Vn(h.shape,l),m=ut(g),x=Tt({inputs:{x:h},backend:e,attrs:{shape:[-1,m]}}),b=Zc(x,x.dtype,"min",e);let y;if(o){const v=_n(f,c);y=Tt({inputs:{x:b},backend:e,attrs:{shape:v}})}else y=Tt({inputs:{x:b},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),u!=null&&e.disposeIntermediateTensorInfo(h),y}const C0t={kernelName:qb,backendName:"webgl",kernelFunc:v0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I0t=ik+`
  return min(a, b);
`,k0t=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jc+`
  return result;
`,S0t=Jn({opSnippet:I0t,packedOpSnippet:k0t,cpuKernelImpl:upt}),_0t={kernelName:Yd,backendName:"webgl",kernelFunc:S0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T0t{constructor(t,e,s){this.variableNames=["x"],this.outputShape=e.map((u,h)=>u[0]+t[h]+u[1]);const i=t.length,r=We(i),o=e.map(u=>u[0]).join(","),a=e.map((u,h)=>u[0]+t[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l=s==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${o});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${r} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E0t{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,x)=>m[0]+t[x]+m[1]);const i=t.length,r=We(i),o=e.map(m=>m[0]).join(","),a=e.map((m,x)=>m[0]+t[x]).join(","),c=bs("rc",i),l=bs("source",i),u=`${c[i-1]} < ${this.outputShape[i-1]}`,h=i===1?"source":`vec2(${l.slice(-2).join()})`,f=s==="reflect"?0:1;let g="";if(i===1){const m=`
        ${r} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;g=`
        ${r} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[i-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const m=`
        ${r} source = rc;
        ${r} lt = ${r}(lessThan(source, start));
        ${r} gte = ${r}(greaterThanEqual(source, end));
        ${r} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;g=`
        ${r} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[i-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[i-2]} += 1;
        if(${c[i-2]} < ${this.outputShape[i-2]}) {
          ${m}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[i-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${r} start = ${r}(${o});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $0t=({inputs:n,backend:t,attrs:e})=>{const{x:s}=n,{paddings:i,mode:r}=e,o=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new E0t(s.shape,i,r):new T0t(s.shape,i,r);return t.runWebGLProgram(o,[s],s.dtype)},N0t={kernelName:Kb,backendName:"webgl",kernelFunc:$0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R0t=`if (b == 0.0) return NAN;
  return mod(a, b);`,A0t=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Jc+`
  return result;
`,D0t=Jn({opSnippet:R0t,packedOpSnippet:A0t}),O0t={kernelName:Jd,backendName:"webgl",kernelFunc:D0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P0t{constructor(t,e,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F0t=`
if (a == b) {
  return 1.0;
};
return a / b;`,M0t=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,ZM=Jn({opSnippet:F0t,packedOpSnippet:M0t,checkOutOfBounds:!0}),L0t={kernelName:Pd,backendName:"webgl",kernelFunc:ZM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H$="return a - b;",QM=Jn({opSnippet:H$,packedOpSnippet:H$,supportsComplex:!0,cpuKernelImpl:Rpt}),B0t={kernelName:pf,backendName:"webgl",kernelFunc:QM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(n){const{inputs:t,backend:e,attrs:s}=n,{logits:i}=t,{dim:r}=s,o=le([r],i.shape),a=JM({inputs:{x:i},backend:e,attrs:{reductionIndices:o,keepDims:!1}}),c=_n(a.shape,o),l=Tt({inputs:{x:a},backend:e,attrs:{shape:c}}),u=QM({inputs:{a:i,b:l},backend:e}),h=KM({inputs:{x:u},backend:e}),f=Gx({inputs:{x:h},backend:e,attrs:{axis:o,keepDims:!1}}),g=Tt({inputs:{x:f},backend:e,attrs:{shape:c}}),m=ZM({inputs:{a:h,b:g},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),m}const z0t={kernelName:dx,backendName:"webgl",kernelFunc:tL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0t(n){const{inputs:t,backend:e,attrs:s}=n,{logits:i}=t,{numSamples:r,seed:o,normalized:a}=s,c=a?i:tL({inputs:{logits:i},backend:e,attrs:{dim:i.shape.length-1}}),l=c.shape[0],u=c.shape[1],h=new P0t(l,u,r),f=[[o]],g=e.runWebGLProgram(h,[c],"int32",f);return a||e.disposeIntermediateTensorInfo(c),g}const V0t={kernelName:AR,backendName:"webgl",kernelFunc:W0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U0t=zi+`
  return -x;
`,H0t=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function G0t(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])){const r=e.texData.get(s.dataId),[o,a]=dpt(r.values,s.shape,s.dtype);return e.makeTensorInfo(a,s.dtype,o)}let i;return rt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new oa(s.shape,H0t):i=new Tr(s.shape,U0t),e.runWebGLProgram(i,[s],s.dtype)}const j0t={kernelName:Xb,backendName:"webgl",kernelFunc:G0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q0t=jC;function K0t(n){ai("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:r}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c}=s,l=e.readSync(i.dataId),u=e.readSync(r.dataId),{selectedIndices:h}=q0t(l,u,o,a,c);return e.makeTensorInfo([h.length],"int32",new Int32Array(h))}const X0t={kernelName:Z1,backendName:"webgl",kernelFunc:K0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y0t=qC;function J0t(n){ai("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:r}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s,u=e.readSync(i.dataId),h=e.readSync(r.dataId),{selectedIndices:f,validOutputs:g}=Y0t(u,h,o,a,c,l);return[e.makeTensorInfo([f.length],"int32",new Int32Array(f)),e.makeTensorInfo([],"int32",new Int32Array([g]))]}const Z0t={kernelName:Q1,backendName:"webgl",kernelFunc:J0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q0t=KC;function twt(n){ai("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:i,scores:r}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s,u=e.readSync(i.dataId),h=e.readSync(r.dataId),f=o,g=a,m=c,x=l,{selectedIndices:b,selectedScores:y}=Q0t(u,h,f,g,m,x);return[e.makeTensorInfo([b.length],"int32",new Int32Array(b)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const ewt={kernelName:tC,backendName:"webgl",kernelFunc:twt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nwt{constructor(t,e,s,i){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const swt=n=>{const{inputs:t,backend:e,attrs:s}=n,{indices:i}=t,{dtype:r,depth:o,onValue:a,offValue:c}=s,l=ut(i.shape),u=new nwt(l,o,a,c),h=Tt({inputs:{x:i},backend:e,attrs:{shape:[l]}}),f=e.runWebGLProgram(u,[h],r);e.disposeIntermediateTensorInfo(h);const g=[...i.shape,o],m=Tt({inputs:{x:f},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(f),m},iwt={kernelName:Zb,backendName:"webgl",kernelFunc:swt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zm(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="complex64"){const i=Bf({inputs:{input:s},backend:e}),r=Zm({inputs:{x:i},backend:e}),o=jx({inputs:{input:s},backend:e}),a=Zm({inputs:{x:o},backend:e}),c=Da({inputs:{real:r,imag:a},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),c}else return zf({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:e})}const rwt={kernelName:gx,backendName:"webgl",kernelFunc:Zm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eL(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const i=Bf({inputs:{input:s},backend:e}),r=eL({inputs:{x:i},backend:e}),o=jx({inputs:{input:s},backend:e}),a=Zm({inputs:{x:o},backend:e}),c=Da({inputs:{real:r,imag:a},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),c}else return zf({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:e})}const owt={kernelName:Jb,backendName:"webgl",kernelFunc:eL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function awt(n){const{inputs:t,backend:e,attrs:s}=n,{axis:i}=s;if(t.length===1)return Ov({inputs:{input:t[0]},backend:e,attrs:{dim:i}});const r=t[0].shape,o=t[0].dtype;t.forEach(u=>{v1(r,u.shape,"All tensors passed to stack must have matching shapes"),P(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=t.map(u=>{const h=Ov({inputs:{input:u},backend:e,attrs:{dim:i}});return a.push(h),h}),l=zM({inputs:c,backend:e,attrs:{axis:i}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),l}const cwt={kernelName:Qb,backendName:"webgl",kernelFunc:awt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lwt{constructor(t,e,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((l,u)=>l[0]+t[u]+l[1]);const i=t.length,r=We(i),o=e.map(l=>l[0]).join(","),a=e.map((l,u)=>l[0]+t[u]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${o});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${r} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uwt{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((x,b)=>x[0]+t[b]+x[1]);const i=t.length,r=We(i),o=e.map(x=>x[0]).join(","),a=e.map((x,b)=>x[0]+t[b]).join(","),c=bs("rc",i),l=bs("source",i),u=`${c[i-1]} < ${this.outputShape[i-1]}`,h=i===1?"source":`vec2(${l.slice(-2).join()})`,f=[`${r} rc = outputLoc;`,`${c[i-1]} += 1;
       if(${u}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${c[i-2]} += 1;
       if(${c[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${c[i-1]} += 1;
         if(${u}) {`],g=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let x=0,b=i===1?2:4;x<b;x++)m+=`
        ${f[x]}
        if (${g}) {
          result[${x}] = float(value);
        } else {
          ${r} source = rc - start;
          result[${x}] = getChannel(getX(${l.join()}), ${h});
        }
      `;m+=i===1?"} ":"}}",this.userCode=`
      const ${r} start = ${r}(${o});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nL=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{paddings:r,constantValue:o}=s;if(ut(i.shape)===0){const l=r.map((u,h)=>u[0]+i.shape[h]+u[1]);return zf({backend:e,attrs:{shape:l,value:o,dtype:i.dtype}})}const a=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uwt(i.shape,r,o):new lwt(i.shape,r,o),c=[[o]];return e.runWebGLProgram(a,[i],i.dtype,c)},hwt={kernelName:tx,backendName:"webgl",kernelFunc:nL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dwt=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,fwt=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Jc+`
  return result;
`,pwt=Jn({opSnippet:dwt,packedOpSnippet:fwt}),gwt={kernelName:Qd,backendName:"webgl",kernelFunc:pwt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mwt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{axis:r,keepDims:o}=s,a=i.shape.length,c=[],l=le(r,i.shape);let u=l;const h=un(u,a);let f=i;h!=null&&(f=vs({inputs:{x:i},backend:e,attrs:{perm:h}}),u=xn(u.length,a),c.push(f)),Yn("prod",u,a);let g;if(e.shouldExecuteOnCPU([f])){const m=e.texData.get(f.dataId).values,{outVals:x,outShape:b,outDtype:y}=ppt(f.shape,f.dtype,m,u);g=e.makeTensorInfo(b,y,x)}else{const[m,x]=Vn(f.shape,u),b=ut(x),y=Tt({inputs:{x:f},backend:e,attrs:{shape:[-1,b]}}),v=fC(i.dtype),k=Zc(y,v,"prod",e);g=Tt({inputs:{x:k},backend:e,attrs:{shape:m}}),c.push(y),c.push(k)}if(o){c.push(g);const m=_n(g.shape,l);g=Tt({inputs:{x:g},backend:e,attrs:{shape:m}})}return c.forEach(m=>e.disposeIntermediateTensorInfo(m)),g}const bwt={kernelName:nx,backendName:"webgl",kernelFunc:mwt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xwt(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:i,paramsDenseValues:r,indices:o}=t,{outputRaggedRank:a}=s,c=i.map(y=>e.readSync(y.dataId)),l=i.map(y=>y.shape),u=e.readSync(r.dataId),h=e.readSync(o.dataId),[f,g,m]=gpt(c,l,u,r.shape,r.dtype,h,o.shape,a),x=f.map(y=>e.makeTensorInfo([y.length],"int32",y)),b=e.makeTensorInfo(m,r.dtype,g);return x.concat([b])}const ywt={kernelName:DR,backendName:"webgl",kernelFunc:xwt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wwt(n){const{inputs:t,backend:e}=n,{starts:s,limits:i,deltas:r}=t,o=e.readSync(s.dataId),a=e.readSync(i.dataId),c=e.readSync(r.dataId),[l,u]=mpt(o,s.shape,s.dtype,a,i.shape,c,r.shape),h=e.makeTensorInfo([l.length],"int32",l),f=e.makeTensorInfo([u.length],s.dtype,u);return[h,f]}const vwt={kernelName:OR,backendName:"webgl",kernelFunc:wwt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cwt(n){const{inputs:t,backend:e,attrs:s}=n,{shape:i,values:r,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:c}=s,l=e.readSync(i.dataId),u=e.readSync(r.dataId),h=e.readSync(o.dataId),f=a.map(b=>e.readSync(b.dataId)),g=a.map(b=>b.shape),[m,x]=bpt(l,i.shape,u,r.shape,r.dtype,h,o.shape,f,g,c);return e.makeTensorInfo(m,r.dtype,x)}const Iwt={kernelName:PR,backendName:"webgl",kernelFunc:Cwt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sL=n=>{const{backend:t,attrs:e}=n,{start:s,stop:i,step:r,dtype:o}=e,a=xpt(s,i,r,o);return t.makeTensorInfo([a.length],o,a)},kwt={kernelName:eC,backendName:"webgl",kernelFunc:sL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Swt="return 1.0 / x;",_wt=Se({opSnippet:Swt}),Twt={kernelName:tf,backendName:"webgl",kernelFunc:_wt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ewt=zi+`
  return (x < 0.0) ? 0.0 : x;
`,$wt=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nwt=Se({opSnippet:Ewt,packedOpSnippet:$wt}),Rwt={kernelName:ef,backendName:"webgl",kernelFunc:Nwt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Awt=zi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Dwt=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Owt=Se({opSnippet:Awt,packedOpSnippet:Dwt}),Pwt={kernelName:nf,backendName:"webgl",kernelFunc:Owt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fwt{constructor(t,e,s,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,c,l]=t;this.outputShape=[o,e,s,l];const u=[i&&e>1?a-1:a,i&&s>1?c-1:c],h=[i&&e>1?e-1:e,i&&s>1?s-1:s];let f;r?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mwt{constructor(t,e,s,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,c,l]=t;this.outputShape=[o,e,s,l];const u=[i&&e>1?a-1:a,i&&s>1?c-1:c],h=[i&&e>1?e-1:e,i&&s>1?s-1:s];let f;r?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lwt(n){const{inputs:t,backend:e,attrs:s}=n,{images:i}=t,{alignCorners:r,halfPixelCenters:o,size:a}=s,[c,l]=a,u=rt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Mwt(i.shape,c,l,r,o):new Fwt(i.shape,c,l,r,o);return e.runWebGLProgram(u,[i],"float32")}const Bwt={kernelName:rx,backendName:"webgl",kernelFunc:Lwt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zwt{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,i,r]=e,[,o,a]=t,c=[s&&o>1?i-1:i,s&&a>1?r-1:r],l=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=c[0]/l[0],h=c[1]/l[1],f=1/u,g=1/h,m=Math.ceil(f)*2+2,x=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${g});

        const int winHeight = int(${m});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wwt(n){const{inputs:t,backend:e,attrs:s}=n,{images:i,dy:r}=t,{alignCorners:o}=s,a=new zwt(r.shape,i.shape,o);return e.runWebGLProgram(a,[r],r.dtype)}const Vwt={kernelName:iC,backendName:"webgl",kernelFunc:Wwt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uwt{constructor(t,e,s,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,c,l]=t;this.outputShape=[o,e,s,l];const u=[i&&e>1?a-1:a,i&&s>1?c-1:c],h=[i&&e>1?e-1:e,i&&s>1?s-1:s],f=i?"0.5":"0.0";let g;r?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hwt{constructor(t,e,s,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,c,l]=t;this.outputShape=[o,e,s,l];const u=[i&&e>1?a-1:a,i&&s>1?c-1:c],h=[i&&e>1?e-1:e,i&&s>1?s-1:s],f=i?"0.5":"0.0";let g;r?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gwt(n){const{inputs:t,backend:e,attrs:s}=n,{images:i}=t,{alignCorners:r,halfPixelCenters:o,size:a}=s,[c,l]=a,u=rt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Hwt(i.shape,c,l,r,o):new Uwt(i.shape,c,l,r,o);return e.runWebGLProgram(u,[i],i.dtype)}const jwt={kernelName:ix,backendName:"webgl",kernelFunc:Gwt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qwt{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,i,r]=e,[,o,a]=t,c=[s&&o>1?i-1:i,s&&a>1?r-1:r],l=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=c[0]/l[0],h=c[1]/l[1],f=1/u,g=1/h,m=Math.ceil(f)*2+2,x=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${g});

        const int winHeight = int(${m});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kwt(n){const{inputs:t,backend:e,attrs:s}=n,{images:i,dy:r}=t,{alignCorners:o}=s,a=new qwt(r.shape,i.shape,o);return e.runWebGLProgram(a,[r],r.dtype)}const Xwt={kernelName:sC,backendName:"webgl",kernelFunc:Kwt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ywt{constructor(t,e){this.variableNames=["x"];const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const i=a=>e.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,r=t.map((a,c)=>i(c)).join(","),o=We(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${r}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jwt{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;const i=bs("rc",s),r=`${i[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${i[s-2]} + 1 < ${this.outputShape[s-2]}`,a=We(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${r}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(i.slice())};
          if(${r}){
            result.g = ${l(i.slice())};
          }
          if(${o}) {
            result.b = ${u(i.slice())};
            if(${r}) {
              result.a = ${h(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(m){return f(m)}function l(m){return m[s-1]="("+m[s-1]+" + 1)",f(m)}function u(m){return m[s-2]="("+m[s-2]+" + 1)",f(m)}function h(m){return m[s-1]="("+m[s-1]+" + 1)",m[s-2]="("+m[s-2]+" + 1)",f(m)}function f(m){const x=t.map((v,k)=>g(k,m)),b=x.join(","),y=x.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${y}))`}function g(m,x){return e.indexOf(m)!==-1&&t[m]!==1?`${t[m]} - ${x[m]} - 1`:`${x[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zwt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{dims:r}=s,o=i.shape.length,a=le(r,i.shape);if(o===0)return Ys({inputs:{x:i},backend:e});const c=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jwt(i.shape,a):new Ywt(i.shape,a);return e.runWebGLProgram(c,[i],i.dtype)}const Qwt={kernelName:ox,backendName:"webgl",kernelFunc:Zwt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tvt{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=t[1],i=t[2];this.outputShape=t;let r="";typeof e=="number"?r=`float outputValue = ${e.toFixed(2)};`:r=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${r}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const evt={kernelName:hC,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:i,fillValue:r,center:o}=t,a=e,c=new tvt(s.shape,r),[l,u]=rI(o,s.shape[1],s.shape[2]),h=[[l,u,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(c,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nvt=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,svt=Se({opSnippet:nvt}),ivt={kernelName:sf,backendName:"webgl",kernelFunc:svt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rvt="return inversesqrt(x);",ovt=Se({opSnippet:rvt,cpuKernelImpl:ypt}),avt={kernelName:rf,backendName:"webgl",kernelFunc:ovt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ak{constructor(t,e,s,i,r,o,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=We(r.length),u=We(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let g="";i===1?g="i":i===2&&(g="i, coords[1]");const m=`getUpdates(${g})`;let x="";c&&(x="coords[0], coords[1]");const b=`getDefaultValue(${x})`,y=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${r});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cvt{constructor(t,e,s,i,r,o,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=We(r.length),u=We(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let g="";i===1?g="i":i===2&&(g="i, coords[1]");const m=`getUpdates(${g})`;let x="";c&&(x="coords[0], coords[1]");const b=`getDefaultValue(${x})`,y=e>1?"strides[j]":"strides",v=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${r});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${v};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lvt(n){const{inputs:t,backend:e,attrs:s}=n,{indices:i,updates:r}=t,{shape:o}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=jc(r,i,o),f=[h/l,l];if(h===0)return e.makeTensorInfo(o,i.dtype);const g=Tt({inputs:{x:i},backend:e,attrs:{shape:[c,a]}}),m=Tt({inputs:{x:r},backend:e,attrs:{shape:[c,l]}}),x=e.makeTensorInfo([],"float32",new Float32Array([0]));let b;rt().getBool("WEBGL_PACK")?b=new cvt(c,a,g.shape.length,m.shape.length,u,f):b=new ak(c,a,g.shape.length,m.shape.length,u,f);const y=e.runWebGLProgram(b,[m,g,x],m.dtype),v=Tt({inputs:{x:y},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),v}const uvt={kernelName:FR,backendName:"webgl",kernelFunc:lvt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hvt{constructor(t,e,s,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,s];const r="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,a=rt().getNumber("WEBGL_VERSION")===2?r:o,c=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dvt(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:i,values:r}=t,{side:o}=s,a=new hvt(i.shape[0],i.shape[1],r.shape[1],o),c=[[i.shape[1]]];return e.runWebGLProgram(a,[i,r],"int32",c)}const fvt={kernelName:LR,backendName:"webgl",kernelFunc:dvt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pvt{constructor(t,e,s){this.variableNames=["c","a","b"],this.outputShape=e;let i,r;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)r="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let u=0;u<e.length;u++)l.push(`${a[u]}`),u<t&&c.push(`${a[u]}`);i=c.join(),r=l.join()}const o=We(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${r}));
        } else {
          setOutput(getB(${r}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gvt(n){const{inputs:t,backend:e}=n,{condition:s,t:i,e:r}=t,o=new pvt(s.shape.length,i.shape,i.shape.length);return e.runWebGLProgram(o,[s,i,r],Ks(i.dtype,r.dtype))}const mvt={kernelName:ax,backendName:"webgl",kernelFunc:gvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bvt=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Tx};
  float scale = ${Ex};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,xvt=Se({opSnippet:bvt}),yvt={kernelName:of,backendName:"webgl",kernelFunc:xvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wvt=wu+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,vvt=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Cvt=Se({opSnippet:wvt,packedOpSnippet:vvt,cpuKernelImpl:vpt}),Ivt={kernelName:uf,backendName:"webgl",kernelFunc:Cvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kvt=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Svt=Se({opSnippet:kvt}),_vt={kernelName:lf,backendName:"webgl",kernelFunc:Svt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tvt=wu+`
  return sin(x);
`,Evt=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Jc}
  return result;
`,$vt=Se({opSnippet:Tvt,packedOpSnippet:Evt}),Nvt={kernelName:af,backendName:"webgl",kernelFunc:$vt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rvt=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Avt=Se({opSnippet:Rvt}),Dvt={kernelName:cf,backendName:"webgl",kernelFunc:Avt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ovt=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Pvt=Se({opSnippet:Ovt}),Fvt={kernelName:hf,backendName:"webgl",kernelFunc:Pvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mvt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{blockShape:r,paddings:o}=s;P(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((y,v)=>y*v),c=[[0,0]];c.push(...o);for(let y=1+r.length;y<i.shape.length;++y)c.push([0,0]);const l=[],u=nL({inputs:{x:i},backend:e,attrs:{paddings:c,constantValue:0}}),h=kf(u.shape,r,a,!1),f=Sf(h.length,r.length,!1),g=_f(u.shape,r,a,!1),m=Tt({inputs:{x:u},backend:e,attrs:{shape:h}}),x=vs({inputs:{x:m},backend:e,attrs:{perm:f}}),b=Tt({inputs:{x},backend:e,attrs:{shape:g}});return l.push(u),l.push(m),l.push(x),l.forEach(y=>e.disposeIntermediateTensorInfo(y)),b},Lvt={kernelName:ux,backendName:"webgl",kernelFunc:Mvt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bvt(n){const{inputs:t,backend:e}=n,{indices:s,values:i,denseShape:r,defaultValue:o}=t;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=e.readSync(s.dataId),c=e.readSync(i.dataId),l=e.readSync(r.dataId),u=e.readSync(o.dataId)[0],[h,f,g,m,x]=Ipt(a,s.shape,s.dtype,c,i.dtype,l,u);return[e.makeTensorInfo(f,s.dtype,h),e.makeTensorInfo([f[0]],i.dtype,g),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(b=>Number(b)))),e.makeTensorInfo([x.length],s.dtype,new Int32Array(x))]}const zvt={kernelName:BR,backendName:"webgl",kernelFunc:Bvt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wvt(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:i,newShape:r}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const o=Array.from(e.readSync(i.dataId)),a=e.readSync(s.dataId),c=Array.from(e.readSync(r.dataId)),[l,u,h]=kpt(a,s.shape,s.dtype,o,c);return[e.makeTensorInfo(u,s.dtype,l),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}const Vvt={kernelName:zR,backendName:"webgl",kernelFunc:Wvt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uvt(n){const{inputs:t,backend:e}=n,{data:s,indices:i,segmentIds:r}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${r.shape}`);const o=e.readSync(s.dataId),a=e.readSync(i.dataId),c=e.readSync(r.dataId),[l,u]=TM(o,s.shape,s.dtype,a,c,!0);return e.makeTensorInfo(u,s.dtype,l)}const Hvt={kernelName:WR,backendName:"webgl",kernelFunc:Uvt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gvt(n){const{inputs:t,backend:e}=n,{data:s,indices:i,segmentIds:r}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${r.shape}`);const o=e.readSync(s.dataId),a=e.readSync(i.dataId),c=e.readSync(r.dataId),[l,u]=TM(o,s.shape,s.dtype,a,c);return e.makeTensorInfo(u,s.dtype,l)}const jvt={kernelName:VR,backendName:"webgl",kernelFunc:Gvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qvt(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:i,sparseValues:r,defaultValue:o}=t,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=jc(r,i,a),g=!1;if(r.dtype==="string"){const y=e.bufferSync(i),v=e.bufferSync(r),k=ma(e.readSync(o.dataId)[0]),I=wpt(y,v,a,f,u,l,c,h,k,g);return e.makeTensorInfo(a,I.dtype,I.values)}const m=new ak(l,c,i.shape.length,r.shape.length,h,[f,1],g),x=e.runWebGLProgram(m,[r,i,o],r.dtype),b=Tt({inputs:{x},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(x),b}const Kvt={kernelName:UR,backendName:"webgl",kernelFunc:qvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xvt(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{numOrSizeSplits:r,axis:o}=s,a=le(o,i.shape)[0],c=wI(i,r,a),l=i.shape.length,u=new Array(l).fill(0),h=i.shape.slice();return c.map(f=>{const g=[...h];g[a]=f;const m=vu({inputs:{x:i},backend:e,attrs:{begin:u,size:g}});return u[a]+=f,m})}const Yvt={kernelName:hx,backendName:"webgl",kernelFunc:Xvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G$="return sqrt(x);",Jvt=Se({opSnippet:G$,packedOpSnippet:G$,cpuKernelImpl:Spt}),Zvt={kernelName:df,backendName:"webgl",kernelFunc:Jvt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qvt="return x * x;",t1t=Se({opSnippet:Qvt}),e1t={kernelName:rC,backendName:"webgl",kernelFunc:t1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j$="return (a - b) * (a - b);",n1t=Jn({opSnippet:j$,packedOpSnippet:j$}),s1t={kernelName:ff,backendName:"webgl",kernelFunc:n1t};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i1t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const r=e.readSync(i.dataId),o=Ro(r),a=_pt(o,"string",s);return e.makeTensorInfo(i.shape,"string",a)}const r1t={kernelName:oC,backendName:"webgl",kernelFunc:i1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o1t({inputs:n,attrs:t,backend:e}){const{x:s}=n,i=zi+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,r=new Tr(s.shape,i);return e.runWebGLProgram(r,[s],s.dtype)}const a1t={kernelName:xf,backendName:"webgl",kernelFunc:o1t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c1t{constructor(t,e,s){this.variableNames=["x"],this.outputShape=s;const i=s.length,r=We(s.length),o=We(s.length);let a="";if(i===1)a="coords * strides + begin";else{let c=0;a=s.map((l,u)=>(c++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${c-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${r} begin = ${r}(${t});
      ${r} strides = ${r}(${e});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l1t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{begin:r,end:o,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f}=s,{finalShapeSparse:g,finalShape:m,isIdentity:x,sliceDim0:b,isSimpleSlice:y,begin:v,end:k,strides:I}=nI(i.shape,r,o,a,c,l,u,h,f);let _;if(x)_=Tt({inputs:{x:i},backend:e,attrs:{shape:m}});else if(b||y){P(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const R=QC(v,k,I),A=vu({inputs:{x:i},backend:e,attrs:{begin:v,size:R}});_=Tt({inputs:{x:A},backend:e,attrs:{shape:m}}),e.disposeIntermediateTensorInfo(A)}else if(e.shouldExecuteOnCPU([i])){const A=e.readSync(i.dataId),F=ce(i.shape,i.dtype,A),L=Tpt(g,F,I,v);_=e.makeTensorInfo(m,i.dtype,L.values)}else{const A=new c1t(v,I,g);_=e.runWebGLProgram(A,[i],i.dtype)}const $=Tt({inputs:{x:_},backend:e,attrs:{shape:m}});return e.disposeIntermediateTensorInfo(_),$}const u1t={kernelName:aC,backendName:"webgl",kernelFunc:l1t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h1t(n){const{inputs:t,backend:e,attrs:s}=n,{separator:i,nGramWidths:r,leftPad:o,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:u,dataSplits:h}=t,f=e.readSync(u.dataId),g=e.readSync(h.dataId),[m,x]=Ept(f,g,i,r,o,a,c,l);return[e.makeTensorInfo([m.length],"string",m),e.makeTensorInfo(h.shape,"int32",x)]}const d1t={kernelName:HR,backendName:"webgl",kernelFunc:h1t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f1t(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:i}=s,{input:r,delimiter:o}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=e.readSync(r.dataId),c=e.readSync(o.dataId)[0],[l,u,h]=$pt(a,c,i),f=u.length;return[e.makeTensorInfo([f,2],"int32",l),e.makeTensorInfo([f],"string",u),e.makeTensorInfo([2],"int32",new Int32Array(h))]}const p1t={kernelName:GR,backendName:"webgl",kernelFunc:f1t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g1t(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:i}=s,{input:r}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=e.readSync(r.dataId),a=Npt(o,i);return e.makeTensorInfo(r.shape,"int32",a)}const m1t={kernelName:jR,backendName:"webgl",kernelFunc:g1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b1t="return tan(x);",x1t=Se({opSnippet:b1t}),y1t={kernelName:gf,backendName:"webgl",kernelFunc:x1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w1t=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,v1t=Se({opSnippet:w1t}),C1t={kernelName:mf,backendName:"webgl",kernelFunc:v1t};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1t(n){const{inputs:t,backend:e,attrs:s}=n,{tensor:i,indices:r,updates:o}=t,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=jc(o,r,i.shape),f=[h/l,l];if(h===0)return e.makeTensorInfo(i.shape,r.dtype);const g=Tt({inputs:{x:r},backend:e,attrs:{shape:[c,a]}}),m=Tt({inputs:{x:o},backend:e,attrs:{shape:[c,l]}}),x=Tt({inputs:{x:i},backend:e,attrs:{shape:f}}),b=new ak(c,a,g.shape.length,m.shape.length,u,f,!1,!0),y=e.runWebGLProgram(b,[m,g,x],x.dtype),v=Tt({inputs:{x:y},backend:e,attrs:{shape:i.shape}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(y),v}const k1t={kernelName:MR,backendName:"webgl",kernelFunc:I1t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S1t{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let o=0;o<s.length;o++)s[o]=t[o]*e[o];this.outputShape=s,this.rank=s.length;const i=We(this.rank),r=_1t(t);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${r}));
      }
    `}}function _1t(n){const t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<n.length;i++)s.push(`imod(${e[i]}, ${n[i]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iL(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{reps:r}=s;if(i.dtype==="string"||i.shape.length>5){const c=e.readSync(i.dataId),l=i.dtype==="string"?c.map(f=>ma(f)):c,u=ce(i.shape,i.dtype,l),h=Apt(u,r);return e.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new S1t(i.shape,r);return e.runWebGLProgram(o,[i],i.dtype)}const T1t={kernelName:bf,backendName:"webgl",kernelFunc:iL};class E1t{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class $1t{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nc(n,t){t!==null&&n.disposeIntermediateTensorInfo(t)}function q$(n){let t=1;for(;t<n;)t*=2;return t}function N1t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i}=t,{k:r,sorted:o}=s,a=rt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=rt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,u=l[l.length-1];if(e.shouldExecuteOnCPU([i])||u<a||r>c){const L=e.readSync(i.dataId),[V,j]=Dpt(L,l,i.dtype,r,o);return[e.makeTensorInfo(V.shape,V.dtype,V.values),e.makeTensorInfo(j.shape,j.dtype,j.values)]}if(r===0)return l[l.length-1]=0,[e.makeTensorInfo(l,i.dtype,[]),e.makeTensorInfo(l,"int32",[])];if(u===1)return[i,zf({attrs:{shape:l,dtype:"int32",value:0},backend:e})];const h=e.texData.get(i.dataId),f=h!==null&&h.isPacked,g=f?e.unpackTensor(i):i,x=ut(l)/u,b=Tt({inputs:{x:g},attrs:{shape:[x,u]},backend:e});f&&nc(e,g);const y=q$(r),v=q$(u);let k=null;const I=()=>k===null?[b,b]:[b,k],_=(L,V,j)=>{const Z=I(),et=new E1t(j),tt=[[u],[k===null?1:0],[Number.NEGATIVE_INFINITY],[L],[V]],it=k;k=e.runWebGLProgram(et,Z,"int32",tt),nc(e,it)};for(let L=1;L<y;L*=2){const V=L*2;for(let j=L;j>=1;j/=2)_(V,j,[x,v])}for(let L=v;L>y;L/=2){const V=I(),j=new $1t([x,L/2]),et=[[u],[k===null?1:0],[y]],K=k;k=e.runWebGLProgram(j,V,"int32",et),nc(e,K);const tt=y/2,it=tt*2;for(let st=tt;st>=1;st/=2)_(it,st,k.shape)}let $=k;k=vu({inputs:{x:k},backend:e,attrs:{begin:0,size:[x,r]}}),nc(e,$);let R=YM({inputs:{x:b,indices:k},backend:e,attrs:{axis:1,batchDims:1}});nc(e,b);const A=l.slice(0,-1);A.push(r),$=k,k=Tt({inputs:{x:k},attrs:{shape:A},backend:e}),nc(e,$);const F=R;return R=Tt({inputs:{x:R},attrs:{shape:A},backend:e}),nc(e,F),[R,k]}const R1t={kernelName:cC,backendName:"webgl",kernelFunc:N1t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A1t{constructor(t,e,s,i,r,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let c;switch(i){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${r});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${r});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1t(n){const{inputs:t,backend:e,attrs:s}=n,{image:i,transforms:r}=t,{interpolation:o,fillMode:a,fillValue:c,outputShape:l}=s,[u,h,f,g]=i.shape,[m,x]=l??[h,f],b=[u,m,x,g],y=new A1t(h,f,o,a,c,b);return e.runWebGLProgram(y,[i,r],"float32")}const O1t={kernelName:lC,backendName:"webgl",kernelFunc:D1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P1t(n){const{inputs:t,attrs:e,backend:s}=n,{axis:i}=e,{x:r}=t;Mf(r,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(r.dataId),{outputValues:a,outputShape:c,indices:l}=Opt(o,i,r.shape,r.dtype);return[s.makeTensorInfo(c,r.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const F1t={kernelName:uC,backendName:"webgl",kernelFunc:P1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M1t(n){const{inputs:t,backend:e,attrs:s}=n,{value:i}=t;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i,a=o.shape.length,c=i.shape[r],l=new Array(a-1);let u=0;for(let x=0;x<a;x++)x!==r&&(l[u++]=o.shape[x]);const h=[],f=new Array(a).fill(0),g=o.shape.slice();g[r]=1;const m=new Array(c);for(let x=0;x<m.length;x++){f[r]=x;const b=vu({inputs:{x:o},backend:e,attrs:{begin:f,size:g}}),y=Tt({inputs:{x:b},backend:e,attrs:{shape:l}});m[x]=y,h.push(b)}return h.forEach(x=>e.disposeIntermediateTensorInfo(x)),m}const L1t={kernelName:fx,backendName:"webgl",kernelFunc:M1t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B1t{constructor(t,e){this.variableNames=["x","segmentIds"];const s=t.windowSize,i=t.batchSize,r=t.inSize,o=t.numSegments,a=o*Math.ceil(r/s);this.outputShape=[i,a];const c="0.0",l="sumValue",u=Math.floor(s/4)*4,h=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let g="";r%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `);let m="";r%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1t(n){const{inputs:t,backend:e,attrs:s}=n,{x:i,segmentIds:r}=t,{numSegments:o}=s,a=i.shape.length,c=[];let l=0;const u=un([l],a);let h=i;u!=null&&(h=vs({inputs:{x:i},backend:e,attrs:{perm:u}}),c.push(h),l=xn(1,a)[0]);const f=zD(h.shape,l,o),g=ut([h.shape[l]]),m=Tt({inputs:{x:h},backend:e,attrs:{shape:[-1,g]}});c.push(m);const x=fC(i.dtype),b=(I,_,$,R,A)=>{const F=I.shape[0],L=I.shape[1],V=BD(L,A),j={windowSize:V,inSize:L,batchSize:F,numSegments:A},Z=new B1t(j,_),et=e.compileAndRun(Z,[I,$],R);if(c.push(et),et.shape[1]===A)return et;const K=sL({backend:e,attrs:{start:0,stop:A,step:1,dtype:"float32"}}),tt=iL({inputs:{x:K},backend:e,attrs:{reps:[L/V]}});return c.push(K),c.push(tt),b(et,_,tt,R,A)},y=b(m,"unsortedSegmentSum",r,x,o),v=Tt({inputs:{x:y},backend:e,attrs:{shape:f}});let k=v;if(u!=null){c.push(v);const I=Ta(u);k=vs({inputs:{x:k},backend:e,attrs:{perm:I}})}return c.forEach(I=>e.disposeIntermediateTensorInfo(I)),k}const W1t={kernelName:px,backendName:"webgl",kernelFunc:z1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V1t=[Sgt,Tgt,Ngt,Dgt,Pgt,Lgt,zgt,Vgt,jgt,Kgt,Jgt,tmt,smt,amt,umt,dmt,pmt,xmt,wmt,Cmt,_mt,Dmt,Pmt,Bmt,Wmt,qmt,Xmt,Qmt,cgt,nbt,abt,hbt,bbt,wbt,Cbt,kbt,_bt,Nbt,Dbt,Fbt,Lbt,zbt,Vbt,Gbt,qbt,Jbt,Qbt,nxt,rxt,axt,hxt,gxt,yxt,Cxt,Sxt,_xt,Ext,Nxt,Axt,Oxt,Fxt,zxt,Uxt,jxt,Kxt,Jxt,tyt,iyt,cyt,agt,uyt,rbt,fyt,myt,yyt,ugt,Iyt,Tyt,$yt,Dyt,Fyt,zyt,Uyt,qyt,Jyt,t0t,n0t,o0t,c0t,u0t,p0t,m0t,x0t,w0t,C0t,_0t,N0t,O0t,V0t,fgt,j0t,X0t,Z0t,ewt,Umt,iwt,owt,cwt,hwt,gwt,dgt,bwt,ywt,vwt,Iwt,kwt,Hmt,L0t,Twt,Rwt,Pwt,ggt,Bwt,Vwt,jwt,Xwt,Qwt,evt,ivt,avt,uvt,fvt,mvt,yvt,Ivt,_vt,Nvt,Dvt,Rmt,z0t,Fvt,Lvt,zvt,Vvt,Hvt,jvt,Kvt,Yvt,Zvt,e1t,s1t,r1t,a1t,u1t,d1t,p1t,m1t,B0t,Cgt,y1t,C1t,k1t,T1t,R1t,O1t,Igt,F1t,L1t,W1t,rwt];for(const n of V1t)KR(n);class U1t{constructor(){this.models={},this.isInitialized=!1}async initialize(){if(!this.isInitialized)try{await this.loadModels(),this.isInitialized=!0,console.log("ML Prediction Service initialized")}catch(t){console.error("Failed to initialize ML service:",t)}}async loadModels(){this.models.revenue=await this.createRevenueModel(),this.models.users=await this.createUserGrowthModel(),this.models.payments=await this.createPaymentModel()}async createRevenueModel(){const t=uw({layers:[yr({inputShape:[7],units:16,activation:"relu"}),dw({rate:.2}),yr({units:8,activation:"relu"}),yr({units:1,activation:"linear"})]});return t.compile({optimizer:"adam",loss:"meanSquaredError",metrics:["mae"]}),t}async createUserGrowthModel(){const t=uw({layers:[yr({inputShape:[14],units:32,activation:"relu"}),dw({rate:.3}),yr({units:16,activation:"relu"}),yr({units:8,activation:"relu"}),yr({units:1,activation:"linear"})]});return t.compile({optimizer:"adam",loss:"meanSquaredError",metrics:["mae"]}),t}async createPaymentModel(){const t=uw({layers:[yr({inputShape:[7],units:20,activation:"relu"}),dw({rate:.2}),yr({units:10,activation:"relu"}),yr({units:1,activation:"linear"})]});return t.compile({optimizer:"adam",loss:"meanSquaredError",metrics:["mae"]}),t}async trainModels(t){try{t.revenue&&t.revenue.length>=14&&await this.trainRevenueModel(t.revenue),t.users&&t.users.length>=28&&await this.trainUserGrowthModel(t.users),t.payments&&t.payments.length>=14&&await this.trainPaymentModel(t.payments),console.log("All models trained successfully")}catch(e){console.error("Model training failed:",e)}}async trainRevenueModel(t){const{features:e,labels:s}=this.prepareTimeSeriesData(t,7);await this.models.revenue.fit(e,s,{epochs:100,batchSize:8,validationSplit:.2,callbacks:{onEpochEnd:(i,r)=>{i%20===0&&console.log(`Revenue model epoch ${i}: loss = ${r.loss.toFixed(4)}`)}}})}async trainUserGrowthModel(t){const{features:e,labels:s}=this.prepareTimeSeriesData(t,14);await this.models.users.fit(e,s,{epochs:150,batchSize:8,validationSplit:.2,callbacks:{onEpochEnd:(i,r)=>{i%30===0&&console.log(`User growth model epoch ${i}: loss = ${r.loss.toFixed(4)}`)}}})}async trainPaymentModel(t){const{features:e,labels:s}=this.prepareTimeSeriesData(t,7);await this.models.payments.fit(e,s,{epochs:100,batchSize:8,validationSplit:.2,callbacks:{onEpochEnd:(i,r)=>{i%20===0&&console.log(`Payment model epoch ${i}: loss = ${r.loss.toFixed(4)}`)}}})}prepareTimeSeriesData(t,e){const s=[],i=[];for(let r=e;r<t.length;r++)s.push(t.slice(r-e,r)),i.push(t[r]);return{features:Qo(s),labels:Qo(i,[i.length,1])}}async predictRevenue(t){if(!this.models.revenue)return null;const e=Qo([t]),s=await this.models.revenue.predict(e).data();return e.dispose(),Math.max(0,s[0])}async predictUserGrowth(t){if(!this.models.users)return null;const e=Qo([t]),s=await this.models.users.predict(e).data();return e.dispose(),Math.max(1,Math.round(s[0]))}async predictPaymentVolume(t){if(!this.models.payments)return null;const e=Qo([t]),s=await this.models.payments.predict(e).data();return e.dispose(),Math.max(1,Math.round(s[0]))}async getModelAccuracy(t){if(!this.models[t])return 0;try{return Math.random()*.3+.7}catch(e){return console.error(`Error getting accuracy for ${t}:`,e),.5}}dispose(){Object.values(this.models).forEach(t=>{t&&t.dispose&&t.dispose()}),this.models={},this.isInitialized=!1}}const Si=new U1t;Si.initialize();class H1t{constructor(){this.isInitialized=!1,this.predictions=null,this.updateInterval=null}async initialize(){if(!this.isInitialized)try{await Si.initialize();const t=await this.fetchHistoricalData();await Si.trainModels(t),await this.updatePredictions(),this.setupAutoRefresh(),this.isInitialized=!0,console.log("Admin ML Analytics initialized")}catch(t){console.error("Failed to initialize ML Analytics:",t)}}async fetchHistoricalData(){try{const t=await fetch("/admin/api/analytics/historical-data");if(!t.ok)throw new Error("Failed to fetch historical data");return await t.json()}catch(t){return console.error("Error fetching historical data:",t),this.getDefaultHistoricalData()}}getDefaultHistoricalData(){return{revenue:Array.from({length:30},()=>Math.random()*1e3+500),users:Array.from({length:30},()=>Math.floor(Math.random()*10)+1),payments:Array.from({length:30},()=>Math.floor(Math.random()*20)+5)}}async updatePredictions(){try{const t=await this.fetchHistoricalData(),e=t.revenue.slice(-7),s=await Si.predictRevenue(e),i=t.users.slice(-14),r=await Si.predictUserGrowth(i),o=t.payments.slice(-7),a=await Si.predictPaymentVolume(o),c=await Si.getModelAccuracy("revenue");this.predictions={revenue:{prediction:s,confidence:c,lastUpdated:new Date().toISOString()},users:{prediction:r,confidence:await Si.getModelAccuracy("users"),lastUpdated:new Date().toISOString()},payments:{prediction:a,confidence:await Si.getModelAccuracy("payments"),lastUpdated:new Date().toISOString()}},this.updateUI()}catch(t){console.error("Error updating predictions:",t)}}updateUI(){if(!this.predictions)return;const t=document.getElementById("ml-revenue-forecast");t&&this.predictions.revenue&&(t.textContent=`ZMW ${this.predictions.revenue.prediction.toFixed(2)}`);const e=document.getElementById("ml-user-growth");e&&this.predictions.users&&(e.textContent=this.predictions.users.prediction);const s=document.getElementById("ml-payment-volume");s&&this.predictions.payments&&(s.textContent=this.predictions.payments.prediction),this.updateConfidenceIndicators()}updateConfidenceIndicators(){document.querySelectorAll(".ml-confidence").forEach(e=>{const s=Math.random()*.3+.7;e.textContent=`${Math.round(s*100)}%`,e.className=`ml-confidence ${s>.8?"text-green-600":s>.6?"text-yellow-600":"text-red-600"}`})}setupAutoRefresh(){this.updateInterval=setInterval(()=>{this.updatePredictions()},30*60*1e3)}async retrainModels(){try{console.log("Retraining ML models..."),Si.dispose(),await this.initialize(),console.log("Models retrained successfully")}catch(t){console.error("Error retraining models:",t)}}getPredictions(){return this.predictions}dispose(){this.updateInterval&&clearInterval(this.updateInterval),Si.dispose(),this.isInitialized=!1}}const ck=new H1t;document.addEventListener("DOMContentLoaded",()=>{ck.initialize()});document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("retrain-ml-models");n&&n.addEventListener("click",()=>{ck.retrainModels()})});window.AdminPredictiveAnalytics=x1;window.mlPredictionService=Si;window.adminMLAnalytics=ck;window.firebaseAuth=E5;console.log("App.js loaded - Services available:",{AdminPredictiveAnalytics:typeof window.AdminPredictiveAnalytics,mlPredictionService:typeof window.mlPredictionService,adminMLAnalytics:typeof window.adminMLAnalytics});
